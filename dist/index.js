(()=>{"use strict";function e(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function t(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?e(Object(o),!0).forEach((function(e){a(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function a(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const n="MazeMaster";let o=n;try{const e="file:///home/saintorphan/Projects/ST-Extensions/SillyTavern-MazeMaster/src/index.js".match(/\/scripts\/extensions\/third-party\/([^/]+)\//);e&&e[1]&&(o=e[1])}catch(e){const t=document.querySelectorAll('script[src*="MazeMaster"]');for(const e of t){const t=e.src.match(/\/scripts\/extensions\/third-party\/([^/]+)\//);if(t&&t[1]){o=t[1];break}}}const{saveSettingsDebounced:i,SlashCommandParser:r,SlashCommand:s,ARGUMENT_TYPE:l,SlashCommandNamedArgument:c,executeSlashCommandsWithOptions:m,getRequestHeaders:d,callGenericPopup:u,POPUP_TYPE:p,generateQuietPrompt:h,getPresetManager:g,mainApi:f}=SillyTavern.getContext(),y=["#e74c3c","#3498db","#2ecc71","#f39c12","#9b59b6","#1abc9c","#e67e22","#34495e","#e91e63","#00bcd4","#8bc34a","#ff5722"],v={fraction:1,halfseg:.5,doubleseg:2},b=["fraction","halfseg","doubleseg"],z={minZoneWidth:.1,maxZoneWidth:.45,minTraverseTime:1200,maxTraverseTime:4e3};function _(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const a=(Math.max(1,Math.min(10,e*t))-1)/9,n=z.maxTraverseTime-a*(z.maxTraverseTime-z.minTraverseTime);return{zoneWidth:z.maxZoneWidth-a*(z.maxZoneWidth-z.minZoneWidth),traverseTime:Math.round(n)}}const x={1:2,2:4,3:5,4:7,5:9},k={tutorial:{name:"Tutorial",description:"Learn the basics with maximum assistance",gridSizeRange:{min:4,max:6},encounterDensityMult:.3,trapFrequencyMult:0,battlebarZoneMult:1.5,battlebarSpeedMult:.6,inventoryStartMult:2,minionAggressionMult:0,chestLootMult:2,hpMult:1.5,damageMult:.3,healMult:2,floors:1,zonesPerFloor:1,zoneUnlockMethod:"none",zoneUnlockThreshold:0,visionProfile:"fullvisibility",combatMechanicsProfile:"none",factionEnabled:!1,permadeathAllowed:!1,permadeathRequired:!1,vfxIntensity:.5,findEarly:{radius:6,items:["lantern","torch","healingPotion","mapFragment","key","strike"],itemsPerChest:3}},easy:{name:"Easy",description:"Relaxed exploration with generous resources",gridSizeRange:{min:6,max:10},encounterDensityMult:.7,trapFrequencyMult:.3,battlebarZoneMult:1.3,battlebarSpeedMult:.8,inventoryStartMult:1.5,minionAggressionMult:.5,chestLootMult:1.3,hpMult:1.3,damageMult:.7,healMult:1.3,floors:1,zonesPerFloor:2,zoneUnlockMethod:"clear",zoneUnlockThreshold:.5,visionProfile:"explorer",combatMechanicsProfile:"simple",factionEnabled:!1,permadeathAllowed:!1,permadeathRequired:!1,vfxIntensity:.7,findEarly:{radius:5,items:["lantern","torch","healingPotion","mapFragment"],itemsPerChest:2}},normal:{name:"Normal",description:"Balanced challenge for most players",gridSizeRange:{min:8,max:14},encounterDensityMult:1,trapFrequencyMult:1,battlebarZoneMult:1,battlebarSpeedMult:1,inventoryStartMult:1,minionAggressionMult:1,chestLootMult:1,hpMult:1,damageMult:1,healMult:1,floors:2,zonesPerFloor:3,zoneUnlockMethod:"clear",zoneUnlockThreshold:.75,visionProfile:"default",combatMechanicsProfile:"default",factionEnabled:!0,permadeathAllowed:!1,permadeathRequired:!1,vfxIntensity:1,findEarly:{radius:4,items:["torch","healingPotion","mapFragment"],itemsPerChest:1}},hard:{name:"Hard",description:"Demanding combat and resource scarcity",gridSizeRange:{min:10,max:16},encounterDensityMult:1.4,trapFrequencyMult:1.5,battlebarZoneMult:.8,battlebarSpeedMult:1.2,inventoryStartMult:.7,minionAggressionMult:1.5,chestLootMult:.8,hpMult:.8,damageMult:1.3,healMult:.8,floors:3,zonesPerFloor:4,zoneUnlockMethod:"clear",zoneUnlockThreshold:.9,visionProfile:"survival",combatMechanicsProfile:"default",factionEnabled:!0,permadeathAllowed:!0,permadeathRequired:!1,vfxIntensity:1,findEarly:{radius:3,items:["torch","healingPotion"],itemsPerChest:1}},nightmare:{name:"Nightmare",description:"Brutal survival with minimal margin for error",gridSizeRange:{min:12,max:18},encounterDensityMult:1.8,trapFrequencyMult:2,battlebarZoneMult:.6,battlebarSpeedMult:1.4,inventoryStartMult:.4,minionAggressionMult:2,chestLootMult:.6,hpMult:.6,damageMult:1.6,healMult:.6,floors:4,zonesPerFloor:4,zoneUnlockMethod:"boss",zoneUnlockThreshold:1,visionProfile:"survival",combatMechanicsProfile:"aggressive",factionEnabled:!0,permadeathAllowed:!0,permadeathRequired:!0,vfxIntensity:1.2,findEarly:{radius:2,items:["torch"],itemsPerChest:1}},apocalypse:{name:"Apocalypse",description:"Permadeath mandatory. Only legends survive.",gridSizeRange:{min:14,max:20},encounterDensityMult:2.2,trapFrequencyMult:2.5,battlebarZoneMult:.5,battlebarSpeedMult:1.6,inventoryStartMult:.2,minionAggressionMult:2.5,chestLootMult:.5,hpMult:.5,damageMult:2,healMult:.4,floors:5,zonesPerFloor:5,zoneUnlockMethod:"boss",zoneUnlockThreshold:1,requireFloorKey:!0,visionProfile:"survival",combatMechanicsProfile:"lethal",factionEnabled:!0,permadeathAllowed:!0,permadeathRequired:!0,vfxIntensity:1.5,findEarly:{radius:0,items:[],itemsPerChest:0}}},C={fantasy:{name:"Fantasy",tileMappings:{wall:"stone wall",floor:"dungeon floor",chest:"treasure chest",exit:"portal to freedom",portal:"mystic gateway",trap:"arcane trap",stairUp:"ascending staircase",stairDown:"descending staircase",minion:"creature"},itemAliases:{key:"Iron Key",stealth:"Cloak of Shadows",strike:"Battle Fury",execute:"Divine Wrath",floorKey:"Stairway Key",portalStone:"Portal Stone",minionBane:"Monster Bane",mapFragment:"Ancient Map",timeShard:"Time Crystal",voidWalk:"Ghost Step Potion"},flavorMessages:{chestFind:"You discover an ancient treasure chest!",portalUse:"The mystic gateway shimmers and pulls you through!",trapTrigger:"An arcane glyph activates beneath your feet!",stairUp:"You ascend the ancient staircase...",stairDown:"You descend into the depths below...",victory:"Glory! You have conquered the dungeon!",defeat:"The darkness claims another soul..."},colors:{primary:"#2ecc71",secondary:"#27ae60",accent:"#f1c40f"}},horror:{name:"Horror",tileMappings:{wall:"blood-stained wall",floor:"creaking floorboard",chest:"ominous coffin",exit:"escape route",portal:"dark rift",trap:"deadly snare",stairUp:"rickety ladder up",stairDown:"descending pit",minion:"abomination"},itemAliases:{key:"Rusty Key",stealth:"Shadow Shroud",strike:"Adrenaline Rush",execute:"Survival Instinct",floorKey:"Cellar Key",portalStone:"Dark Crystal",minionBane:"Banishment Charm",mapFragment:"Torn Note",timeShard:"Slowing Serum",voidWalk:"Phase Vial"},flavorMessages:{chestFind:"A decrepit coffin... dare you open it?",portalUse:"The rift tears open, pulling you into darkness!",trapTrigger:"You hear a click... then screaming.",stairUp:"The ladder groans under your weight...",stairDown:"You descend into the suffocating darkness...",victory:"You escape... but the nightmares will follow.",defeat:"Your screams echo eternally in the void..."},colors:{primary:"#c0392b",secondary:"#8e1b1b",accent:"#7f8c8d"}},scifi:{name:"Sci-Fi",tileMappings:{wall:"reinforced bulkhead",floor:"metal grating",chest:"supply crate",exit:"escape pod",portal:"warp gate",trap:"security system",stairUp:"elevator up",stairDown:"elevator down",minion:"hostile entity"},itemAliases:{key:"Access Card",stealth:"Cloaking Device",strike:"Combat Stim",execute:"Overdrive Module",floorKey:"Deck Keycard",portalStone:"Teleport Beacon",minionBane:"EMP Grenade",mapFragment:"Data Pad",timeShard:"Temporal Disruptor",voidWalk:"Phase Shifter"},flavorMessages:{chestFind:"A sealed supply crate. Contents unknown.",portalUse:"Warp gate activated. Brace for teleportation.",trapTrigger:"SECURITY ALERT: Hostile detected!",stairUp:"Elevator ascending to upper deck...",stairDown:"Elevator descending to lower deck...",victory:"Mission complete. Extraction successful.",defeat:"SYSTEM FAILURE: Life signs terminated."},colors:{primary:"#3498db",secondary:"#2980b9",accent:"#1abc9c"}},action:{name:"Action",tileMappings:{wall:"concrete barrier",floor:"worn tile",chest:"ammo crate",exit:"extraction point",portal:"fast rope insertion",trap:"booby trap",stairUp:"ladder up",stairDown:"ladder down",minion:"hostile"},itemAliases:{key:"Master Key",stealth:"Smoke Grenade",strike:"Adrenaline Shot",execute:"Air Strike",floorKey:"Building Key",portalStone:"Zip Line",minionBane:"Flashbang",mapFragment:"Intel Report",timeShard:"Slow-Mo Serum",voidWalk:"Breach Charge"},flavorMessages:{chestFind:"Supply cache located. Check for booby traps.",portalUse:"Moving to new position!",trapTrigger:"Contact! Hostile fire!",stairUp:"Moving up! Watch your six!",stairDown:"Descending! Stay frosty!",victory:"Area secured. Good work, soldier.",defeat:"Man down! Mission failed."},colors:{primary:"#e67e22",secondary:"#d35400",accent:"#95a5a6"}},cyberpunk:{name:"Cyberpunk",tileMappings:{wall:"neon-lit barrier",floor:"chrome plating",chest:"data cache",exit:"extraction node",portal:"netrunner jack",trap:"ICE protocol",stairUp:"mag-lift up",stairDown:"mag-lift down",minion:"cyborg"},itemAliases:{key:"Access Chip",stealth:"Optical Camo",strike:"Combat Stims",execute:"Berserker Mode",floorKey:"Elevator Override",portalStone:"Fast Travel Chip",minionBane:"System Crash",mapFragment:"Hacked Schematic",timeShard:"Reflex Booster",voidWalk:"Ghost Protocol"},flavorMessages:{chestFind:"Data cache detected. Initiating decrypt...",portalUse:"Jacking in... connection established.",trapTrigger:"ICE DETECTED! Countermeasures active!",stairUp:"Mag-lift ascending to upper level...",stairDown:"Mag-lift descending to sub-level...",victory:"Run complete. Payout received, choom.",defeat:"Flatlined. Your chrome belongs to the corp now."},colors:{primary:"#ff00ff",secondary:"#00ffff",accent:"#ffff00"}},noir:{name:"Noir",tileMappings:{wall:"rain-streaked wall",floor:"wet pavement",chest:"locked safe",exit:"back alley exit",portal:"secret passage",trap:"hidden wire",stairUp:"fire escape up",stairDown:"cellar stairs",minion:"goon"},itemAliases:{key:"Skeleton Key",stealth:"Trench Coat",strike:"Brass Knuckles",execute:"Tommy Gun",floorKey:"Service Key",portalStone:"Secret Map",minionBane:"Blackmail File",mapFragment:"Case Notes",timeShard:"Pocket Watch",voidWalk:"Shadow Step"},flavorMessages:{chestFind:"A safe in the shadows. Someone has secrets...",portalUse:"The bookcase slides aside, revealing a passage.",trapTrigger:"You hear a click. This was a setup.",stairUp:"The fire escape groans in the rain...",stairDown:"Down into the cellar. Watch your back.",victory:"Case closed. Time for a drink.",defeat:"Another gumshoe lost to the city..."},colors:{primary:"#4a4a4a",secondary:"#2c2c2c",accent:"#c9a227"}},postapoc:{name:"Post-Apocalyptic",tileMappings:{wall:"crumbling rubble",floor:"irradiated ground",chest:"salvage pile",exit:"safe zone",portal:"collapsed tunnel",trap:"radiation hotspot",stairUp:"rusted ladder up",stairDown:"crater descent",minion:"mutant"},itemAliases:{key:"Vault Keycard",stealth:"Ghillie Wrap",strike:"Rad-X Boost",execute:"Mini Nuke",floorKey:"Bunker Code",portalStone:"Signal Flare",minionBane:"Purifier",mapFragment:"Scavenged Map",timeShard:"Stasis Field",voidWalk:"Hazmat Suit"},flavorMessages:{chestFind:"A salvage cache from the old world...",portalUse:"You squeeze through the collapsed tunnel.",trapTrigger:"GEIGER SPIKE! Radiation flooding the area!",stairUp:"The rusted ladder holds... barely.",stairDown:"Descending into the crater...",victory:"You survived. For now.",defeat:"The wasteland claims another soul..."},colors:{primary:"#8b7355",secondary:"#556b2f",accent:"#cd853f"}},comedy:{name:"Comedy",tileMappings:{wall:"suspiciously normal wall",floor:"slightly sticky floor",chest:"mystery box",exit:"extremely obvious exit",portal:"plot hole",trap:"banana peel",stairUp:"escalator (broken)",stairDown:"slide",minion:"weirdo"},itemAliases:{key:"Comically Large Key",stealth:"Cardboard Box",strike:"Energy Drink",execute:"Power of Friendship",floorKey:"Janitor's Master Key",portalStone:"Plot Device",minionBane:"Bad Pun",mapFragment:"Napkin Drawing",timeShard:"Dramatic Pause",voidWalk:"Fourth Wall Break"},flavorMessages:{chestFind:"Ooh, a mystery box! It could be anything!",portalUse:"You fall through a plot hole!",trapTrigger:"Classic banana peel. You saw it coming.",stairUp:"The escalator is broken. Guess it's just stairs now.",stairDown:"WHEEE! *slide noises*",victory:"You win! The crowd goes mild!",defeat:"Wah wah wahhh... Game Over, buddy."},colors:{primary:"#ff6b6b",secondary:"#feca57",accent:"#48dbfb"}},western:{name:"Western",tileMappings:{wall:"wooden planks",floor:"dusty floorboards",chest:"strongbox",exit:"town limits",portal:"mine shaft",trap:"rattlesnake den",stairUp:"rickety stairs up",stairDown:"cellar hatch",minion:"outlaw"},itemAliases:{key:"Skeleton Key",stealth:"Poncho",strike:"Whiskey Courage",execute:"Dynamite Bundle",floorKey:"Mine Key",portalStone:"Treasure Map",minionBane:"Silver Bullet",mapFragment:"Wanted Poster",timeShard:"High Noon Focus",voidWalk:"Tumbleweed Roll"},flavorMessages:{chestFind:"A locked strongbox. Could be gold inside...",portalUse:"You duck into the old mine shaft.",trapTrigger:"RATTLESNAKES! Draw!",stairUp:"The stairs creak with every step...",stairDown:"Down into the root cellar...",victory:"You ride off into the sunset, partner.",defeat:"This town wasn't big enough for both of ya."},colors:{primary:"#d2691e",secondary:"#8b4513",accent:"#ffd700"}}},w={fantasy:{adjectives:["Ancient","Mystical","Enchanted","Arcane","Forgotten"]},horror:{adjectives:["Blood-Stained","Haunted","Cursed","Rotting","Whispering"]},scifi:{adjectives:["Automated","Sterile","Malfunctioning","Quarantined","Pressurized"]},action:{adjectives:["Reinforced","Tactical","Fortified","Hostile","Secured"]},cyberpunk:{adjectives:["Neon-Lit","Chrome","Glitched","Hacked","Blackmarket"]},noir:{adjectives:["Shadowy","Smoky","Rain-Soaked","Dimly-Lit","Forgotten"]},postapoc:{adjectives:["Ruined","Overgrown","Irradiated","Collapsed","Scavenged"]},comedy:{adjectives:["Suspiciously Normal","Slightly Damp","Questionable","Overdecorated","Poorly Labeled"]},western:{adjectives:["Dusty","Sun-Bleached","Weathered","Abandoned","Rickety"]}},E={name:"",displayName:"",tags:[],atmosphere:"",adjectives:[],roomTypes:{small:[],medium:[],large:[],special:[]},flavorMessages:{chestFind:"",trapTrigger:"",victory:"",defeat:""},colors:{primary:"#8b0000",secondary:"#2d1f1f",accent:"#ff4444"}},S={fantasy:{name:"fantasy",displayName:"Fantasy",tags:["medieval","magical","dungeon","adventure"],atmosphere:"A realm of ancient stone and flickering torchlight, where magic lingers in the shadows.",adjectives:["Ancient","Mystical","Forgotten","Enchanted","Cursed"],roomTypes:{small:["Alcove","Nook","Chamber"],medium:["Hall","Gallery","Sanctum"],large:["Great Hall","Throne Room","Cathedral"],special:["Dragon's Lair","Wizard's Tower","Sacred Grove"]},flavorMessages:{chestFind:"You discover an ornate treasure chest, its lock rusted with age.",trapTrigger:"Ancient magic springs to life, unleashing a deadly trap!",victory:"The foe falls before your blade. Victory is yours!",defeat:"Darkness claims you as your strength fades..."},colors:{primary:"#8b4513",secondary:"#2d1f1f",accent:"#ffd700"}},horror:{name:"horror",displayName:"Horror",tags:["dark","terrifying","supernatural","dread"],atmosphere:"Shadows writhe in corners as unspeakable horrors lurk just beyond sight.",adjectives:["Bloodstained","Twisted","Nightmarish","Rotting","Haunted"],roomTypes:{small:["Crawlspace","Closet","Cell"],medium:["Morgue","Chapel","Study"],large:["Ballroom","Asylum Ward","Crypt"],special:["Ritual Chamber","Mass Grave","The Pit"]},flavorMessages:{chestFind:"A decrepit box sits in the gloom, something scratches from within...",trapTrigger:"Pain explodes through your body as the trap activates!",victory:"The creature shrieks as it dissolves into shadow.",defeat:"Your screams echo into the darkness..."},colors:{primary:"#8b0000",secondary:"#1a0a0a",accent:"#ff0000"}},scifi:{name:"scifi",displayName:"Sci-Fi",tags:["futuristic","technological","space","advanced"],atmosphere:"Humming machinery and sterile corridors of an advanced technological facility.",adjectives:["Automated","Damaged","Secure","Experimental","Quarantined"],roomTypes:{small:["Access Shaft","Storage Pod","Maintenance Bay"],medium:["Control Room","Laboratory","Crew Quarters"],large:["Hangar Bay","Command Bridge","Reactor Core"],special:["AI Core","Xenobiology Lab","Escape Pod Bay"]},flavorMessages:{chestFind:"A sealed container awaits, its biometric lock flickering.",trapTrigger:"Security systems activate with deadly precision!",victory:"Target eliminated. Threat neutralized.",defeat:"Critical system failure... consciousness fading..."},colors:{primary:"#0066cc",secondary:"#1a1a2e",accent:"#00ffff"}},cyberpunk:{name:"cyberpunk",displayName:"Cyberpunk",tags:["neon","corporate","hackers","dystopian"],atmosphere:"Neon-lit streets and chrome-plated megastructures hide corporate conspiracies.",adjectives:["Hacked","Corrupted","Black-Market","Augmented","Underground"],roomTypes:{small:["Server Closet","Smuggler's Cache","Wire Nest"],medium:["Hacker Den","Chop Shop","Black Clinic"],large:["Data Center","Combat Arena","Corporate Plaza"],special:["CEO Suite","AI Mainframe","Rebel Base"]},flavorMessages:{chestFind:"A secured stash, probably hot. Worth the risk.",trapTrigger:"ICE protocols engage! Neural feedback imminent!",victory:"Target flatlined. Time to ghost.",defeat:"System crash... your wetware is fried..."},colors:{primary:"#ff00ff",secondary:"#0a0a1a",accent:"#00ff00"}},western:{name:"western",displayName:"Western",tags:["frontier","dusty","lawless","rugged"],atmosphere:"Sun-baked desert towns where outlaws and lawmen play deadly games.",adjectives:["Dusty","Abandoned","Lawless","Frontier","Sun-bleached"],roomTypes:{small:["Jail Cell","Supply Closet","Stable"],medium:["Saloon","Sheriff's Office","General Store"],large:["Town Square","Mine Shaft","Cattle Yard"],special:["Bank Vault","Outlaw Hideout","Boot Hill"]},flavorMessages:{chestFind:"An old strongbox, probably from a stagecoach robbery.",trapTrigger:"You trigger a hidden tripwire - dynamite!",victory:"Another notch on your gunbelt, partner.",defeat:"You've drawn your last breath in the dust..."},colors:{primary:"#cd853f",secondary:"#2d2416",accent:"#daa520"}},action:{name:"action",displayName:"Action",tags:["explosive","tactical","military","intense"],atmosphere:"High-stakes combat zones where every second counts and danger lurks around corners.",adjectives:["Fortified","Hostile","Tactical","Compromised","Hot"],roomTypes:{small:["Armory","Comm Station","Bunker"],medium:["Barracks","War Room","Motor Pool"],large:["Battlefield","Command Center","Extraction Zone"],special:["Bomb Site","HVT Location","Evac Point"]},flavorMessages:{chestFind:"Supply crate located. Could contain valuable intel.",trapTrigger:"IED detected too late! Brace for impact!",victory:"Hostile down. Area secured.",defeat:"Mission failed. We'll get 'em next time..."},colors:{primary:"#4a5c3c",secondary:"#1a1f1a",accent:"#ff6600"}}},T={name:"",displayName:"",roomNames:{common:{prefixes:[],nouns:[],descriptions:[]},junction:{prefixes:[],nouns:[],descriptions:[]},deadend:{prefixes:[],nouns:[],descriptions:[]},staircase:{names:[],descriptions:[]},portal:{names:[],descriptions:[]},chest:{names:[],descriptions:[]},minion:{names:[],descriptions:[]},trap:{names:[],descriptions:[]},exit:{names:[],descriptions:[]},start:{names:[],descriptions:[]}},bspConfig:{minRoomSize:2,maxRoomSize:5,minSplitSize:4,splitVariance:.3,corridorWidth:1,roomPadding:1,extraConnections:.1,branchChance:.3,preferSquareRooms:!1,gridAlign:!1,windingCorridors:!1,modularRooms:!1}},I={maze:{common:{prefixes:["Winding","Narrow","Long","Dark","Quiet"],nouns:["Corridor","Passage","Hallway","Path","Tunnel"],descriptions:["The walls press in from both sides.","Echoes fade into the distance.","The path stretches onward."]},junction:{prefixes:["Central","Open","Connecting","Main"],nouns:["Junction","Crossroads","Intersection","Hub"],descriptions:["Multiple paths branch from here.","A decision point in the maze.","Which way to go?"]},deadend:{prefixes:["Sealed","Blocked","Empty","Forgotten"],nouns:["Dead End","Alcove","Nook","Corner"],descriptions:["No way forward from here.","A quiet corner of the maze.","Time to backtrack."]},staircase:{names:["The Spiral Path","Winding Stairs","The Descent","Stone Steps"],descriptions:["Worn steps lead to another level.","The stairway beckons."]},portal:{names:["Mystic Gateway","Shimmering Portal","The Threshold","Warp Point"],descriptions:["Reality bends here.","Step through to somewhere else."]},chest:{names:["Treasure Alcove","Hidden Cache","Fortune's Corner","The Vault"],descriptions:["Something valuable awaits.","A promising discovery."]},minion:{names:["Guardian's Post","The Confrontation","Danger Zone","Enemy Territory"],descriptions:["You sense a presence.","Something stirs ahead."]},trap:{names:["Treacherous Ground","The Snare","Danger Ahead","False Safety"],descriptions:["The floor seems unstable.","Something feels wrong here."]},exit:{names:["The Final Gate","Freedom's Door","The End","Escape Route"],descriptions:["The exit is within reach!","Almost there..."]},start:{names:["The Beginning","Starting Point","Entry Hall","The Origin"],descriptions:["Your journey begins here.","The entrance to the maze."]}},dungeon:{common:{prefixes:["Damp","Crumbling","Moss-Covered","Torch-Lit","Stone"],nouns:["Corridor","Passage","Chamber","Tunnel","Crypt"],descriptions:["Water drips from the ceiling.","Ancient stones line the walls.","The air is thick and musty."]},junction:{prefixes:["Grand","Central","Ruined","Pillared"],nouns:["Hall","Atrium","Chamber","Rotunda"],descriptions:["Pillars support the vaulted ceiling.","Several passages meet here."]},deadend:{prefixes:["Collapsed","Sealed","Empty","Forgotten"],nouns:["Tomb","Cell","Alcove","Crypt"],descriptions:["The way is blocked by rubble.","Nothing but bones and dust."]},staircase:{names:["The Spiral Descent","Stone Stairwell","Dungeon Steps","The Deep Stairs"],descriptions:["Worn steps descend into darkness.","Each step echoes ominously."]},portal:{names:["Arcane Circle","The Dark Rift","Summoning Chamber","Void Gate"],descriptions:["Strange runes glow on the floor.","The air crackles with energy."]},chest:{names:["Treasure Vault","Burial Cache","Hidden Hoard","Ancient Coffer"],descriptions:["Gold glimmers in the torchlight.","What treasures lie within?"]},minion:{names:["Guardian's Lair","The Beast's Den","Cursed Chamber","Haunted Hall"],descriptions:["Something lurks in the shadows.","Eyes watch from the darkness."]},trap:{names:["Pressure Plates","Spike Corridor","The Gauntlet","Death Trap"],descriptions:["The floor has suspicious tiles.","Previous adventurers weren't so lucky."]},exit:{names:["Dungeon Gate","Surface Access","The Way Out","Freedom's Light"],descriptions:["Daylight streams through ahead!","The exit awaits!"]},start:{names:["Dungeon Entrance","The First Chamber","Entry Vault","Beginning of the End"],descriptions:["You enter the dungeon depths.","Adventure awaits within."]}},city:{common:{prefixes:["Narrow","Crowded","Busy","Quiet","Back"],nouns:["Street","Alley","Lane","Road","Avenue"],descriptions:["Buildings tower on either side.","The city hums around you.","Footsteps echo on cobblestones."]},junction:{prefixes:["Main","Central","Open","Market"],nouns:["Square","Plaza","Intersection","Crossroads"],descriptions:["Several streets converge here.","A bustling urban hub."]},deadend:{prefixes:["Blocked","Private","Forgotten","Secluded"],nouns:["Courtyard","Dead End","Cul-de-sac","Alley"],descriptions:["No way through here.","A quiet corner of the city."]},staircase:{names:["Fire Escape","Metro Stairs","Building Access","Service Stairwell"],descriptions:["Metal stairs lead up or down.","An urban vertical passage."]},portal:{names:["Subway Entrance","Secret Door","Hidden Passage","Underground Access"],descriptions:["A way to move quickly.","Not everyone knows about this."]},chest:{names:["Supply Cache","Abandoned Stash","Hidden Storage","Drop Point"],descriptions:["Someone left supplies here.","Could be useful items inside."]},minion:{names:["Gang Territory","Hostile Zone","Ambush Point","Danger Zone"],descriptions:["This area isn't safe.","Watch your back."]},trap:{names:["Construction Zone","Hazard Area","Unstable Ground","Danger Zone"],descriptions:["Caution signs litter the area.","Something's not right here."]},exit:{names:["City Limits","The Way Out","Freedom Boulevard","Exit Gate"],descriptions:["Safety is just ahead!","Almost out of the city!"]},start:{names:["Downtown Drop","Starting Block","Entry Point","Ground Zero"],descriptions:["Your urban adventure begins.","The city awaits."]}},forest:{common:{prefixes:["Overgrown","Shaded","Winding","Mossy","Dense"],nouns:["Path","Trail","Grove","Thicket","Clearing"],descriptions:["Leaves rustle overhead.","Sunlight filters through the canopy.","The forest is alive with sounds."]},junction:{prefixes:["Central","Open","Sunny","Ancient"],nouns:["Clearing","Glade","Meadow","Crossroads"],descriptions:["Several paths diverge here.","A peaceful clearing in the woods."]},deadend:{prefixes:["Tangled","Blocked","Overgrown","Dense"],nouns:["Thicket","Dead End","Brush","Undergrowth"],descriptions:["The vegetation is too thick to pass.","No way through this tangle."]},staircase:{names:["Root Steps","Cliff Path","Tree Ladder","Natural Stairs"],descriptions:["Natural formations create a path up or down.","The terrain changes elevation."]},portal:{names:["Fairy Ring","Ancient Tree","Spirit Gate","Enchanted Grove"],descriptions:["Magic lingers in this place.","The veil between worlds is thin here."]},chest:{names:["Hollow Tree","Hidden Cache","Nature's Gift","Forest Bounty"],descriptions:["Something hidden among the roots.","The forest provides."]},minion:{names:["Beast's Territory","Predator's Ground","Wild Zone","Creature's Lair"],descriptions:["Something territorial lives here.","The wildlife seems hostile."]},trap:{names:["Quicksand","Poison Ivy Patch","Hunter's Snare","Treacherous Ground"],descriptions:["The ground looks unstable.","Nature can be dangerous."]},exit:{names:["Forest Edge","The Clearing","Open Fields","Way Out"],descriptions:["The tree line ends ahead!","Almost out of the forest!"]},start:{names:["Forest Entrance","Trail Head","Woods Edge","Into the Wild"],descriptions:["The forest path begins here.","Adventure awaits in the trees."]}},outpost:{common:{prefixes:["Dusty","Wooden","Fortified","Patrol","Guard"],nouns:["Walkway","Corridor","Passage","Path","Route"],descriptions:["Wooden planks creak underfoot.","The outpost feels hastily constructed.","Frontier life is rough."]},junction:{prefixes:["Central","Main","Command","Trading"],nouns:["Courtyard","Square","Hub","Plaza"],descriptions:["The heart of the outpost.","People gather here."]},deadend:{prefixes:["Storage","Private","Blocked","Abandoned"],nouns:["Corner","Area","Section","Alcove"],descriptions:["This area is off-limits.","Nothing to see here."]},staircase:{names:["Watchtower Ladder","Rampart Stairs","Cellar Access","Tower Steps"],descriptions:["Rough-hewn steps lead up or down.","A vertical route through the outpost."]},portal:{names:["Secret Tunnel","Escape Route","Hidden Exit","Underground Path"],descriptions:["A hidden way to move quickly.","Not on any official maps."]},chest:{names:["Supply Crate","Armory Cache","Provisions Store","Trade Goods"],descriptions:["Frontier supplies are valuable.","Someone stockpiled resources here."]},minion:{names:["Hostile Territory","Raider Camp","Enemy Ground","Danger Zone"],descriptions:["This area isn't friendly.","Hostiles have been spotted here."]},trap:{names:["Perimeter Defense","Booby Trap","Defensive Line","Warning Zone"],descriptions:["The outpost has defenses.","Watch where you step."]},exit:{names:["Main Gate","Frontier Exit","The Way Out","Open Plains"],descriptions:["The frontier awaits beyond!","Almost to safety!"]},start:{names:["Outpost Gate","Arrival Point","Entry Post","Checkpoint"],descriptions:["Welcome to the frontier.","Your mission begins here."]}},spacestation:{common:{prefixes:["Pressurized","Maintenance","Crew","Service","Transit"],nouns:["Corridor","Deck","Section","Tube","Passageway"],descriptions:["The hum of life support fills the air.","Zero-G handles line the walls.","Status lights blink in sequence."]},junction:{prefixes:["Central","Main","Command","Hub"],nouns:["Atrium","Nexus","Hub","Junction"],descriptions:["Multiple decks connect here.","The station's central point."]},deadend:{prefixes:["Sealed","Depressurized","Locked","Abandoned"],nouns:["Airlock","Module","Section","Bay"],descriptions:["This section is sealed off.","No access beyond this point."]},staircase:{names:["Deck Ladder","Gravity Lift","Access Tube","Inter-deck Transit"],descriptions:["Vertical transit between decks.","Watch your head in zero-G."]},portal:{names:["Teleport Pad","Warp Gate","Transit Pod","Instant Travel"],descriptions:["Advanced technology enables instant travel.","Step on the pad to teleport."]},chest:{names:["Supply Locker","Cargo Pod","Equipment Bay","Resource Cache"],descriptions:["Standard station supplies.","Emergency equipment stored here."]},minion:{names:["Hostile Sector","Quarantine Zone","Breach Area","Danger Zone"],descriptions:["Security protocols are active.","Something hostile is aboard."]},trap:{names:["Radiation Leak","Decompression Risk","Electrical Hazard","System Failure"],descriptions:["Warning lights flash urgently.","Safety systems are offline."]},exit:{names:["Escape Pod Bay","Extraction Point","Docking Ring","The Way Out"],descriptions:["Rescue is just ahead!","Almost to the escape pods!"]},start:{names:["Docking Bay","Arrival Deck","Entry Point","Station Access"],descriptions:["Welcome aboard the station.","Your mission begins here."]}},college:{common:{prefixes:["Main","Academic","Student","Faculty","Campus"],nouns:["Hallway","Corridor","Wing","Path","Walkway"],descriptions:["Lockers line the walls.","Motivational posters are everywhere.","The smell of cafeteria food lingers."]},junction:{prefixes:["Central","Main","Student","Campus"],nouns:["Quad","Commons","Atrium","Hub"],descriptions:["Students gather between classes.","The heart of campus life."]},deadend:{prefixes:["Maintenance","Staff Only","Locked","Private"],nouns:["Closet","Office","Room","Storage"],descriptions:["This area is restricted.","Faculty only beyond this point."]},staircase:{names:["Main Stairwell","Fire Stairs","Back Stairs","Service Access"],descriptions:["Standard institutional stairs.","Watch out for students rushing to class."]},portal:{names:["Secret Passage","Underground Tunnel","Maintenance Route","Shortcut"],descriptions:["Not on the official campus map.","Students pass down secret knowledge."]},chest:{names:["Lost and Found","Supply Closet","Locker","Hidden Stash"],descriptions:["Someone left something behind.","Might find something useful."]},minion:{names:["Bully Territory","Staff Patrol","Security Zone","No-Go Area"],descriptions:["Best to avoid this area.","Someone unfriendly is here."]},trap:{names:["Wet Floor","Construction Zone","Prank Setup","Hazard Area"],descriptions:["Watch your step.","Something seems off here."]},exit:{names:["Main Exit","Campus Gate","Front Doors","Freedom"],descriptions:["School's out!","Almost to freedom!"]},start:{names:["Main Entrance","Welcome Hall","Registration","Starting Point"],descriptions:["Welcome to campus.","Your academic adventure begins."]}},apartment:{common:{prefixes:["Narrow","Dimly-Lit","Carpeted","Quiet","Long"],nouns:["Hallway","Corridor","Landing","Passage","Floor"],descriptions:["Apartment doors line both sides.","The building is eerily quiet.","Fluorescent lights flicker."]},junction:{prefixes:["Main","Central","Elevator","Stair"],nouns:["Lobby","Landing","Foyer","Hub"],descriptions:["Multiple hallways branch from here.","The building's central area."]},deadend:{prefixes:["Locked","Private","Utility","Maintenance"],nouns:["Apartment","Room","Closet","Unit"],descriptions:["This unit is locked.","No access here."]},staircase:{names:["Fire Stairs","Main Stairwell","Back Stairs","Service Stairs"],descriptions:["Concrete steps echo with each footfall.","Standard apartment building stairs."]},portal:{names:["Dumbwaiter","Laundry Chute","Hidden Panel","Secret Room"],descriptions:["A hidden way through the building.","Not everyone knows about this."]},chest:{names:["Storage Unit","Abandoned Locker","Supply Closet","Hidden Cache"],descriptions:["Someone left something behind.","Might contain useful items."]},minion:{names:["Hostile Unit","Occupied Floor","Danger Zone","Unfriendly Neighbors"],descriptions:["Something unfriendly lives here.","Best to be careful."]},trap:{names:["Broken Floor","Electrical Hazard","Gas Leak","Structural Damage"],descriptions:["The building isn't safe here.","Watch your step."]},exit:{names:["Main Exit","Front Door","Fire Exit","Street Access"],descriptions:["The street is just ahead!","Almost out of the building!"]},start:{names:["Building Entrance","Main Lobby","Entry Hall","Ground Floor"],descriptions:["You enter the apartment building.","Your urban exploration begins."]}},neotokyo:{common:{prefixes:["Neon","Crowded","Rain-Slicked","Holographic","Bustling"],nouns:["Street","Alley","Arcade","Passage","Lane"],descriptions:["Neon signs reflect off wet pavement.","Holographic ads fill the air.","The city never sleeps."]},junction:{prefixes:["Central","Shibuya-Style","Main","Mega"],nouns:["Crossing","Plaza","Square","Hub"],descriptions:["Thousands of screens illuminate the area.","A sensory overload of lights and sounds."]},deadend:{prefixes:["Sealed","Private","VIP","Restricted"],nouns:["Booth","Room","Alley","Zone"],descriptions:["No access without credentials.","This area is off-limits."]},staircase:{names:["Gravity Lift","Mag-Rail","Sky Bridge","Vertical Transit"],descriptions:["High-tech vertical transportation.","The city builds upward."]},portal:{names:["VR Hub","Data Port","Network Node","Fast Travel"],descriptions:["Jack in to move instantly.","The network connects all."]},chest:{names:["Vending Cache","Data Stash","Loot Box","Street Vendor"],descriptions:["Even garbage has value here.","Credits can buy anything."]},minion:{names:["Yakuza Turf","Corp Security","Gang Territory","Hostile Zone"],descriptions:["Someone owns this block.","You're not welcome here."]},trap:{names:["ICE Node","Security Grid","Drone Patrol","Surveillance Zone"],descriptions:["Automated defenses are active.","Big Brother is watching."]},exit:{names:["City Limits","Extraction Point","Safe House","The Way Out"],descriptions:["Almost out of the neon jungle!","Freedom awaits beyond!"]},start:{names:["Drop Zone","Street Level","Entry Point","Ground Zero"],descriptions:["Welcome to the future.","Your cyberpunk adventure begins."]}},arena:{common:{prefixes:["Stone","Sandy","Blood-Stained","Gladiator","Battle"],nouns:["Corridor","Passage","Tunnel","Path","Way"],descriptions:["The roar of the crowd echoes.","Sand and blood mix underfoot.","Glory or death awaits."]},junction:{prefixes:["Central","Main","Grand","Champion's"],nouns:["Arena","Ring","Pit","Stage"],descriptions:["The fighting grounds await.","All paths lead to battle."]},deadend:{prefixes:["Holding","Recovery","Equipment","Fighter's"],nouns:["Cell","Room","Bay","Quarters"],descriptions:["A moment of rest between fights.","Prepare for the next battle."]},staircase:{names:["Gladiator's Rise","Champion's Lift","Arena Access","Victory Steps"],descriptions:["The path to glory.","Rise to meet your opponent."]},portal:{names:["Fighter's Gate","Champion Portal","Mystery Entrance","Wild Card"],descriptions:["Where will you emerge?","The crowd loves surprises."]},chest:{names:["Weapon Rack","Prize Cache","Spoils of War","Victor's Reward"],descriptions:["The strong deserve rewards.","Claim your prize."]},minion:{names:["Fighter's Corner","Beast Pit","Champion's Ground","Battle Zone"],descriptions:["An opponent awaits.","Prepare for combat!"]},trap:{names:["Spike Pit","Fire Trap","Collapsing Floor","Arena Hazard"],descriptions:["The arena is dangerous.","Watch your footing!"]},exit:{names:["Victor's Gate","Champion's Exit","Freedom Gate","The Way Out"],descriptions:["Glory awaits the victor!","Survive and escape!"]},start:{names:["Challenger's Gate","Fighter's Entrance","Arena Entry","The Beginning"],descriptions:["The crowd awaits.","Prove your worth!"]}},hospital:{common:{prefixes:["Sterile","White","Quiet","Flickering","Abandoned"],nouns:["Corridor","Hallway","Ward","Wing","Section"],descriptions:["The smell of antiseptic lingers.","Medical equipment lies scattered.","Fluorescent lights hum overhead."]},junction:{prefixes:["Central","Main","Nurse's","Reception"],nouns:["Station","Hub","Desk","Lobby"],descriptions:["Multiple wards connect here.","The hospital's central hub."]},deadend:{prefixes:["Private","Quarantine","Restricted","Sealed"],nouns:["Room","Bay","Ward","Unit"],descriptions:["This area is restricted.","No access without clearance."]},staircase:{names:["Emergency Stairs","Service Elevator","Staff Access","Fire Stairs"],descriptions:["Standard hospital vertical access.","Watch for gurneys."]},portal:{names:["Morgue Tunnel","Utility Access","Hidden Passage","Underground Route"],descriptions:["Not on the hospital map.","A hidden way through."]},chest:{names:["Supply Closet","Medical Storage","Equipment Room","Pharmacy Cache"],descriptions:["Medical supplies could be useful.","Someone stockpiled resources."]},minion:{names:["Quarantine Zone","Infected Ward","Danger Area","Hostile Section"],descriptions:["Something isn't right here.","Proceed with caution."]},trap:{names:["Biohazard Zone","Contaminated Area","Structural Damage","Hazmat Zone"],descriptions:["Warning signs are everywhere.","This area isn't safe."]},exit:{names:["Emergency Exit","Main Entrance","Ambulance Bay","The Way Out"],descriptions:["Fresh air awaits!","Almost out of the hospital!"]},start:{names:["ER Entrance","Main Lobby","Admission","Ground Floor"],descriptions:["You enter the hospital.","Something feels wrong here."]}},highrise:{common:{prefixes:["Dusty","Abandoned","Crumbling","Empty","Dark"],nouns:["Hallway","Floor","Corridor","Office","Suite"],descriptions:["Abandoned furniture gathers dust.","The building creaks in the wind.","Nature reclaims the space."]},junction:{prefixes:["Main","Central","Executive","Open"],nouns:["Lobby","Atrium","Floor","Hub"],descriptions:["Once a place of business.","Multiple paths through the floor."]},deadend:{prefixes:["Collapsed","Sealed","Blocked","Destroyed"],nouns:["Office","Room","Section","Area"],descriptions:["The way is impassable.","Structural damage blocks the path."]},staircase:{names:["Fire Stairs","Emergency Exit","Service Stairs","Broken Elevator"],descriptions:["Concrete stairs wind upward.","The elevator hasn't worked in years."]},portal:{names:["Window Ledge","Broken Wall","Collapsed Floor","Vent Shaft"],descriptions:["An unconventional route.","Not for the faint of heart."]},chest:{names:["Old Safe","Forgotten Cache","Executive Stash","Supply Closet"],descriptions:["Something was left behind.","Previous occupants stored valuables."]},minion:{names:["Squatter's Territory","Hostile Floor","Danger Zone","Occupied Area"],descriptions:["Someone else calls this home.","You're not alone here."]},trap:{names:["Weak Floor","Broken Glass","Falling Debris","Structural Collapse"],descriptions:["The building is unstable.","Every step could be your last."]},exit:{names:["Ground Floor","Street Exit","Fire Escape","The Way Out"],descriptions:["Solid ground awaits!","Almost out of the building!"]},start:{names:["Rooftop Access","Upper Floor","Entry Point","The Beginning"],descriptions:["You enter the abandoned building.","Urban exploration begins."]}}},M={maze:{name:"maze",displayName:"Maze",bspConfig:{minRoomSize:2,maxRoomSize:2,minSplitSize:2,splitVariance:.3,corridorWidth:1,roomPadding:0,extraConnections:1,branchChance:.7,preferSquareRooms:!0,gridAlign:!1,windingCorridors:!1,modularRooms:!1},roomNames:I.maze},dungeon:{name:"dungeon",displayName:"Dungeon",bspConfig:{minRoomSize:2,maxRoomSize:3,minSplitSize:2,splitVariance:.3,corridorWidth:1,roomPadding:0,extraConnections:.9,branchChance:.65,preferSquareRooms:!1,gridAlign:!1,windingCorridors:!1,modularRooms:!1},roomNames:I.dungeon},city:{name:"city",displayName:"City",bspConfig:{minRoomSize:2,maxRoomSize:3,minSplitSize:2,splitVariance:.25,corridorWidth:1,roomPadding:0,extraConnections:.95,branchChance:.6,preferSquareRooms:!1,gridAlign:!0,windingCorridors:!1,modularRooms:!1},roomNames:I.city},forest:{name:"forest",displayName:"Forest",bspConfig:{minRoomSize:2,maxRoomSize:3,minSplitSize:2,splitVariance:.35,corridorWidth:1,roomPadding:0,extraConnections:.9,branchChance:.7,preferSquareRooms:!1,gridAlign:!1,windingCorridors:!0,modularRooms:!1},roomNames:I.forest},spaceship:{name:"spaceship",displayName:"Spaceship",bspConfig:{minRoomSize:2,maxRoomSize:3,minSplitSize:2,splitVariance:.2,corridorWidth:1,roomPadding:0,extraConnections:.85,branchChance:.6,preferSquareRooms:!0,gridAlign:!1,windingCorridors:!1,modularRooms:!0},roomNames:I.spaceship},arena:{name:"arena",displayName:"Arena",bspConfig:{minRoomSize:2,maxRoomSize:3,minSplitSize:2,splitVariance:.3,corridorWidth:1,roomPadding:0,extraConnections:.9,branchChance:.65,preferSquareRooms:!0,gridAlign:!1,windingCorridors:!1,modularRooms:!1},roomNames:I.maze},hospital:{name:"hospital",displayName:"Hospital",bspConfig:{minRoomSize:2,maxRoomSize:3,minSplitSize:2,splitVariance:.2,corridorWidth:1,roomPadding:0,extraConnections:.85,branchChance:.6,preferSquareRooms:!1,gridAlign:!0,windingCorridors:!1,modularRooms:!1},roomNames:I.maze},college:{name:"college",displayName:"College",bspConfig:{minRoomSize:2,maxRoomSize:3,minSplitSize:2,splitVariance:.2,corridorWidth:1,roomPadding:0,extraConnections:.85,branchChance:.6,preferSquareRooms:!1,gridAlign:!0,windingCorridors:!1,modularRooms:!1},roomNames:I.college},apartment:{name:"apartment",displayName:"Apartment",bspConfig:{minRoomSize:2,maxRoomSize:3,minSplitSize:2,splitVariance:.25,corridorWidth:1,roomPadding:0,extraConnections:.95,branchChance:.6,preferSquareRooms:!1,gridAlign:!0,windingCorridors:!1,modularRooms:!1},roomNames:I.apartment},highrise:{name:"highrise",displayName:"Highrise",bspConfig:{minRoomSize:2,maxRoomSize:3,minSplitSize:2,splitVariance:.25,corridorWidth:1,roomPadding:0,extraConnections:.95,branchChance:.6,preferSquareRooms:!1,gridAlign:!0,windingCorridors:!1,modularRooms:!1},roomNames:I.highrise}};function P(e,t,a,n,o,i,r){const s=n.theme||"fantasy",l=n.mapStyle||"maze",c=function(e,t,a,n,o,i){if(0===t&&0===a)return"start";if(t===o&&a===i)return"exit";if(e.staircase)return"staircase";if(e.portal)return"portal";if(e.chest)return"chest";if(e.minion)return"minion";if(e.trap)return"trap";const r=[!e.walls.top,!e.walls.right,!e.walls.bottom,!e.walls.left].filter(Boolean).length;return r>=3?"junction":1===r?"deadend":"common"}(e,t,a,0,i,r),m=I[l]||I.maze,d=m[c]||m.common,u=w[s]||w.fantasy;let p,h;if(d.names)p=d.names[Math.floor(Math.random()*d.names.length)];else{const e=d.prefixes[Math.floor(Math.random()*d.prefixes.length)],t=d.nouns[Math.floor(Math.random()*d.nouns.length)];if(Math.random()<.3&&u.adjectives){const a=u.adjectives[Math.floor(Math.random()*u.adjectives.length)];p="".concat(a," ").concat(e," ").concat(t)}else p="".concat(e," ").concat(t)}return h=d.descriptions[Math.floor(Math.random()*d.descriptions.length)],{name:p,description:h,roomType:c}}function D(e,t,a,n,o){for(let i=0;i<a;i++)for(let r=0;r<a;r++){const a=e[i][r];a.roomInfo=P(a,r,i,t,0,n,o)}}class A{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e,this.container=null,this.initialized=!1}getType(){return"base"}init(e,t){this.container=e,this.initialized=!0}getGridHTML(e){throw new Error("getGridHTML must be implemented by subclass")}getPlayerOverlayHTML(e){throw new Error("getPlayerOverlayHTML must be implemented by subclass")}getCellSize(e){return e<=5?50:e<=7?45:e<=10?38:e<=12?32:e<=15?26:22}render(e){throw new Error("render must be implemented by subclass")}updatePlayerPosition(e,t,a,n){throw new Error("updatePlayerPosition must be implemented by subclass")}highlightCell(e,t,a){}clearHighlights(){}playEffect(e,t,a){}getStyles(){return""}cleanup(){this.initialized=!1,this.container=null}}class B extends A{getType(){return"css-grid"}getStyleCSS(e){const t={dungeon:{filter:"saturate(0.7)",bg:"#1a1520",accent:"#6b5b7a"},maze:{filter:"hue-rotate(20deg)",bg:"#1a1828",accent:"#7866a0"},forest:{filter:"saturate(1.4) hue-rotate(-15deg)",bg:"#0d1a0d",accent:"#4a7a4a"},city:{filter:"saturate(0.6) contrast(1.1)",bg:"#161820",accent:"#6a7080"},spacestation:{filter:"saturate(1.2) hue-rotate(200deg)",bg:"#0d1525",accent:"#4080b0"},college:{filter:"sepia(0.3)",bg:"#1a1510",accent:"#9a8060"},apartment:{filter:"sepia(0.2)",bg:"#1a1612",accent:"#8a7660"},neotokyo:{filter:"saturate(1.5) hue-rotate(300deg)",bg:"#1a0d18",accent:"#b040a0"},arena:{filter:"hue-rotate(25deg) saturate(1.2)",bg:"#1a1408",accent:"#b07040"},hospital:{filter:"saturate(0.5) brightness(1.1)",bg:"#141a1a",accent:"#60a0a0"},highrise:{filter:"saturate(0.4) contrast(1.2)",bg:"#12121a",accent:"#606080"},outpost:{filter:"sepia(0.4) hue-rotate(15deg)",bg:"#1a1508",accent:"#a08040"}};return t[e]||t.dungeon}getGridHTML(e){const t=this.getCellSize(e);return'\n            <div id="maze_grid" class="maze-grid" style="\n                display: grid;\n                grid-template-columns: repeat('.concat(e,", ").concat(t,'px);\n                gap: 0;\n                position: relative;\n            "></div>\n        ')}getPlayerOverlayHTML(e){return'\n            <div id="maze_player_overlay" class="maze-player-overlay" style="width: '.concat(e,"px; height: ").concat(e,'px;">\n                <div class="maze-player-marker"></div>\n            </div>\n        ')}render(e){const{grid:t,size:a,playerX:n,playerY:o,visited:i,exitX:r,exitY:s,isVictory:l,profile:c,currentFloor:m,totalFloors:d}=e,u=document.getElementById("maze_grid");if(!u)return;const p=this.getCellSize(a),h=(null==c?void 0:c.mapVisibility)||(!1===(null==c?void 0:c.fogOfWar)?"showAll":"fogOfWar");u.style.gridTemplateColumns="repeat(".concat(a,", ").concat(p,"px)"),u.innerHTML="";const g=this.getStyleCSS(null==c?void 0:c.mapStyle);u.style.filter=g.filter,u.style.backgroundColor=g.bg,u.style.setProperty("--map-accent",g.accent);const f="".concat(m,":");for(let e=0;e<a;e++)for(let g=0;g<a;g++){const a=t[e][g],y=document.createElement("div");y.className="maze-cell",y.style.width="".concat(p,"px"),y.style.height="".concat(p,"px");const v="".concat(f).concat(g,",").concat(e),b="".concat(g,",").concat(e),z=i.has(v)||i.has(b),_=g===n&&e===o,x=g===r&&e===s;let k=!1,C=!1;"showAll"===h?k=!0:"hideUnexplored"===h?(k=z||_,C=!z&&!_):k=z||_,C?y.classList.add("completely-hidden"):k?(y.classList.add("visited"),a.walls.top&&y.classList.add("wall-top"),a.walls.right&&y.classList.add("wall-right"),a.walls.bottom&&y.classList.add("wall-bottom"),a.walls.left&&y.classList.add("wall-left")):y.classList.add("hidden"),_&&y.classList.add("player");if(x&&k&&m===d-1&&(y.classList.add("exit"),l&&y.classList.add("victory-glow")),a.minion&&k&&(y.classList.add("has-minion"),a.minion.triggered&&y.classList.add("minion-triggered")),a.chest&&k&&(y.classList.add("has-chest"),"locked"===a.chest.type&&y.classList.add("chest-locked"),a.chest.opened&&y.classList.add("chest-opened"),null!=c&&c.chestImage&&!a.chest.opened)){y.classList.add("has-custom-chest");const e=document.createElement("img");e.src=It(c.chestImage),e.className="maze-chest-img",e.style.cssText="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 70%; height: 70%; object-fit: cover; border-radius: 3px; z-index: 1;","locked"===a.chest.type&&(e.style.filter="grayscale(50%)"),y.appendChild(e)}a.trap&&k&&(y.classList.add("has-trap"),a.trap.triggered&&y.classList.add("trap-triggered")),a.portal&&k&&(y.classList.add("has-portal"),y.dataset.portalColor=a.portal.color||"#9b59b6",y.style.setProperty("--portal-color",a.portal.color||"#9b59b6"),a.portal.bidirectional||a.portal.isStart||y.classList.add("portal-exit-only")),a.staircase&&k&&(y.classList.add("has-staircase"),y.classList.add("up"===a.staircase.direction?"staircase-up":"staircase-down"),a.staircase.requireKey&&y.classList.add("staircase-locked")),a.safeRoom&&!a.safeRoom.exhausted&&k&&y.classList.add("safe-room"),y.dataset.x=g,y.dataset.y=e,u.appendChild(y)}}updatePlayerPosition(e,t,a,n){const o=document.getElementById("maze_player_overlay");if(!o)return;const i=e*n,r=t*n;o.style.transition=a?"transform 0.15s ease-out":"none",o.style.transform="translate(".concat(i,"px, ").concat(r,"px)"),a||requestAnimationFrame((()=>{o.style.transition="transform 0.15s ease-out"}))}highlightCell(e,t,a){const n=document.querySelector('.maze-cell[data-x="'.concat(e,'"][data-y="').concat(t,'"]'));n&&n.classList.add("highlight-".concat(a))}clearHighlights(){document.querySelectorAll('.maze-cell[class*="highlight-"]').forEach((e=>{e.className=e.className.replace(/highlight-\w+/g,"").trim()}))}playEffect(e,t,a){const n=document.querySelector('.maze-cell[data-x="'.concat(e,'"][data-y="').concat(t,'"]'));n&&(n.classList.add("effect-".concat(a)),setTimeout((()=>{n.classList.remove("effect-".concat(a))}),500))}}function L(e){const t={fantasy:"#ef4444",horror:"#5a5a6a",scifi:"#06b6d4",cyberpunk:"#ec4899",western:"#92400e",action:"#dc2626",comedy:"#84cc16",postapoc:"#78716c"};return t[e]||t.fantasy}class q extends A{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e),this.canvas=null,this.ctx=null,this.sprites={},this.tileSize=e.tileSize||32}getType(){return"canvas"}getGridHTML(e){const t=e*this.tileSize;return'\n            <canvas id="maze_canvas" width="'.concat(t,'" height="').concat(t,'" style="\n                display: block;\n                image-rendering: pixelated;\n            "></canvas>\n        ')}getPlayerOverlayHTML(e){return""}async loadSprites(e){const t=Object.entries(e).map((async e=>{let[t,a]=e;const n=new Image;n.src=a,await new Promise(((e,t)=>{n.onload=e,n.onerror=t})),this.sprites[t]=n}));await Promise.all(t)}init(e,t){super.init(e,t),this.canvas=document.getElementById("maze_canvas"),this.canvas&&(this.ctx=this.canvas.getContext("2d"))}render(e){if(!this.ctx)return;const{grid:t,size:a,playerX:n,playerY:o,visited:i,exitX:r,exitY:s,profile:l,currentFloor:c,totalFloors:m}=e,d=this.tileSize,u=(null==l?void 0:l.mapVisibility)||(!1===(null==l?void 0:l.fogOfWar)?"showAll":"fogOfWar");this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);const p="".concat(c,":");for(let e=0;e<a;e++)for(let h=0;h<a;h++){const a=t[e][h],g="".concat(p).concat(h,",").concat(e),f="".concat(h,",").concat(e),y=i.has(g)||i.has(f),v=h===n&&e===o;let b=!1,z=!1;if("showAll"===u?b=!0:"hideUnexplored"===u?(b=y||v,z=!y&&!v):b=y||v,!z)if(b){this.sprites.floor?this.ctx.drawImage(this.sprites.floor,h*d,e*d,d,d):(this.ctx.fillStyle="#2d2d44",this.ctx.fillRect(h*d,e*d,d,d)),this.ctx.strokeStyle="#8b5cf6",this.ctx.lineWidth=2,a.walls.top&&(this.ctx.beginPath(),this.ctx.moveTo(h*d,e*d),this.ctx.lineTo((h+1)*d,e*d),this.ctx.stroke()),a.walls.right&&(this.ctx.beginPath(),this.ctx.moveTo((h+1)*d,e*d),this.ctx.lineTo((h+1)*d,(e+1)*d),this.ctx.stroke()),a.walls.bottom&&(this.ctx.beginPath(),this.ctx.moveTo(h*d,(e+1)*d),this.ctx.lineTo((h+1)*d,(e+1)*d),this.ctx.stroke()),a.walls.left&&(this.ctx.beginPath(),this.ctx.moveTo(h*d,e*d),this.ctx.lineTo(h*d,(e+1)*d),this.ctx.stroke());if(h===r&&e===s&&c===m-1&&(this.sprites.exit?this.ctx.drawImage(this.sprites.exit,h*d,e*d,d,d):(this.ctx.fillStyle="#22c55e",this.ctx.fillRect(h*d+4,e*d+4,d-8,d-8))),a.chest&&!a.chest.opened&&(this.sprites.chest?this.ctx.drawImage(this.sprites.chest,h*d,e*d,d,d):(this.ctx.fillStyle="#f59e0b",this.ctx.fillRect(h*d+6,e*d+6,d-12,d-12))),a.minion&&!a.minion.triggered){const t=L(null==l?void 0:l.theme);this.sprites.minion?this.ctx.drawImage(this.sprites.minion,h*d,e*d,d,d):(this.ctx.fillStyle=t,this.ctx.beginPath(),this.ctx.arc(h*d+d/2,e*d+d/2,d/4,0,2*Math.PI),this.ctx.fill())}}else this.ctx.fillStyle="#1a1a2e",this.ctx.fillRect(h*d,e*d,d,d)}this.sprites.player?this.ctx.drawImage(this.sprites.player,n*d,o*d,d,d):(this.ctx.fillStyle="#3b82f6",this.ctx.beginPath(),this.ctx.arc(n*d+d/2,o*d+d/2,d/3,0,2*Math.PI),this.ctx.fill())}updatePlayerPosition(e,t,a,n){}getCellSize(e){return this.tileSize}}const R={renderers:{"css-grid":B,canvas:q,isometric:class extends q{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e),this.tileWidth=e.tileWidth||64,this.tileHeight=e.tileHeight||32,this.wallHeight=e.wallHeight||24,this.spriteCache={},this.spritesLoaded=!1,this.spritesLoading=!1,this.currentMapStyle="dungeon",this.spritePaths=this.getSpritePathsForStyle(this.currentMapStyle),this.palette={floor:{top:"#3d3d5c",light:"#4a4a6a",dark:"#2d2d44"},wall:{top:"#6b5b95",light:"#8b7bb5",dark:"#4b3b75"},fog:{top:"#2a2a4e",light:"#3a3a6a",dark:"#1a1a3a"},exit:{top:"#22c55e",light:"#4ade80",dark:"#16a34a"},chest:{top:"#f59e0b",light:"#fbbf24",dark:"#d97706"},chestOpen:{top:"#78716c",light:"#a8a29e",dark:"#57534e"},minion:{top:"#ef4444",light:"#f87171",dark:"#dc2626"},trap:{top:"#a855f7",light:"#c084fc",dark:"#9333ea"},portal:{top:"#06b6d4",light:"#22d3ee",dark:"#0891b2"},stairUp:{top:"#10b981",light:"#34d399",dark:"#059669"},stairDown:{top:"#f97316",light:"#fb923c",dark:"#ea580c"},player:{top:"#3b82f6",light:"#60a5fa",dark:"#2563eb"},safeRoom:{top:"#2dd4bf",light:"#5eead4",dark:"#14b8a6"}}}getType(){return"isometric"}getSpritePathsForStyle(e){const t=e||"dungeon";return{floor:"assets/isometric/".concat(t,"/floor.png"),wall:"assets/isometric/".concat(t,"/wall.png"),wallCorner:"assets/isometric/".concat(t,"/wall_corner.png"),fog:"assets/isometric/".concat(t,"/fog.png"),exit:"assets/isometric/".concat(t,"/exit.png"),chest:"assets/isometric/".concat(t,"/chest_closed.png"),chestOpen:"assets/isometric/".concat(t,"/chest_open.png"),portal:"assets/isometric/".concat(t,"/portal.png"),trap:"assets/isometric/".concat(t,"/trap.png"),minion:"assets/isometric/".concat(t,"/minion.png"),player:"assets/isometric/".concat(t,"/player.png"),stairsUp:"assets/isometric/".concat(t,"/stairs_up.png"),stairsDown:"assets/isometric/".concat(t,"/stairs_down.png")}}setMapStyle(e){const t=e||"dungeon";t!==this.currentMapStyle&&(this.currentMapStyle=t,this.spritePaths=this.getSpritePathsForStyle(t),this.spriteCache={},this.spritesLoaded=!1,this.spritesLoading=!1,this.loadSprites())}getStyleTint(e){const t={dungeon:{r:40,g:30,b:50,a:.25},maze:{r:60,g:50,b:80,a:.3},forest:{r:20,g:100,b:40,a:.35},city:{r:80,g:90,b:100,a:.3},spacestation:{r:30,g:60,b:120,a:.4},college:{r:100,g:80,b:50,a:.25},apartment:{r:90,g:70,b:50,a:.3},neotokyo:{r:140,g:40,b:100,a:.4},arena:{r:120,g:60,b:30,a:.35},hospital:{r:60,g:100,b:100,a:.35},highrise:{r:50,g:50,b:70,a:.4},outpost:{r:100,g:80,b:40,a:.35}};return t[e]||t.dungeon}getThemeMinionFilter(e){const t={fantasy:"hue-rotate(0deg) saturate(1.2) brightness(1.0)",horror:"hue-rotate(270deg) saturate(0.4) brightness(0.7) contrast(1.3)",scifi:"hue-rotate(180deg) saturate(1.5) brightness(1.2)",cyberpunk:"hue-rotate(300deg) saturate(2.0) brightness(1.1) contrast(1.2)",western:"hue-rotate(30deg) saturate(0.8) sepia(0.5) brightness(1.0)",action:"hue-rotate(0deg) saturate(1.4) contrast(1.3) brightness(1.1)",comedy:"hue-rotate(60deg) saturate(2.0) brightness(1.3)",postapoc:"hue-rotate(20deg) saturate(0.5) sepia(0.4) brightness(0.8)"};return t[e]||t.fantasy}getThemeMinionPalette(e){const t={fantasy:{top:"#ef4444",light:"#f87171",dark:"#dc2626"},horror:{top:"#4a4a5a",light:"#6a6a7a",dark:"#2a2a3a"},scifi:{top:"#06b6d4",light:"#22d3ee",dark:"#0891b2"},cyberpunk:{top:"#ec4899",light:"#f472b6",dark:"#db2777"},western:{top:"#92400e",light:"#b45309",dark:"#78350f"},action:{top:"#dc2626",light:"#ef4444",dark:"#b91c1c"},comedy:{top:"#84cc16",light:"#a3e635",dark:"#65a30d"},postapoc:{top:"#78716c",light:"#a8a29e",dark:"#57534e"}};return t[e]||t.fantasy}getStyleFilter(e){const t={dungeon:"saturate(0.7) contrast(1.1)",maze:"saturate(0.8) hue-rotate(20deg)",forest:"saturate(1.4) hue-rotate(-20deg) brightness(1.1)",city:"saturate(0.6) contrast(1.2) brightness(0.9)",spacestation:"saturate(1.2) hue-rotate(200deg) brightness(1.1)",college:"saturate(0.9) sepia(0.3) brightness(1.1)",apartment:"saturate(0.8) sepia(0.2) contrast(1.05)",neotokyo:"saturate(1.5) hue-rotate(300deg) contrast(1.2) brightness(1.1)",arena:"saturate(1.3) hue-rotate(30deg) contrast(1.15)",hospital:"saturate(0.5) brightness(1.2) contrast(0.9)",highrise:"saturate(0.4) contrast(1.3) brightness(0.7)",outpost:"saturate(1.1) sepia(0.4) hue-rotate(15deg)"};return t[e]||t.dungeon}getStyleBackground(e){const t={dungeon:"#0a0815",maze:"#0d0a18",forest:"#050d05",city:"#0a0c10",spacestation:"#050812",college:"#0f0c08",apartment:"#0c0a08",neotokyo:"#0f050a",arena:"#100a05",hospital:"#080c0c",highrise:"#080810",outpost:"#0d0a06"};return t[e]||t.dungeon}async loadSprites(){if(this.spritesLoaded||this.spritesLoading)return;this.spritesLoading=!0;const e=Object.entries(this.spritePaths).map((async e=>{let[t,a]=e;try{const e=new Image;e.src="/scripts/extensions/third-party/SillyTavern-MazeMaster/"+a,await new Promise(((t,a)=>{e.onload=t,e.onerror=a})),this.spriteCache[t]=e}catch(e){console.warn("[MazeMaster] Failed to load sprite: ".concat(a))}}));await Promise.all(e),this.spritesLoaded=!0,this.spritesLoading=!1,console.log("[MazeMaster] Isometric sprites loaded:",Object.keys(this.spriteCache)),this.lastMazeState&&this.render(this.lastMazeState)}gridToIso(e,t){return{x:(e-t)*(this.tileWidth/2),y:(e+t)*(this.tileHeight/2)}}isoToGrid(e,t){const a=(e/(this.tileWidth/2)+t/(this.tileHeight/2))/2,n=(t/(this.tileHeight/2)-e/(this.tileWidth/2))/2;return{x:Math.floor(a),y:Math.floor(n)}}getGridHTML(e){const t=this.getCellSize(e),a=t/2,n=e*a+2*t+a;return'\n            <canvas id="maze_canvas" width="'.concat((e+1)*t,'" height="').concat(n,'" style="\n                display: block;\n                image-rendering: crisp-edges;\n                max-width: 100%;\n            "></canvas>\n        ')}getPlayerOverlayHTML(){return""}getCellSize(e){return e<=7?76:e<=10?64:e<=15?52:e<=20?44:36}init(e,t){var a;if(null!=t&&t.size){const e=this.getCellSize(t.size);this.tileWidth=e,this.tileHeight=e/2,this.wallHeight=.375*e}null!=t&&null!==(a=t.profile)&&void 0!==a&&a.mapStyle&&this.setMapStyle(t.profile.mapStyle),super.init(e,t),this.loadSprites()}drawSprite(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const o=this.spriteCache[e];if(!o)return!1;const i=o.height/o.width,r=this.tileWidth*n,s=r*i,l=t-r/2,c=a+this.tileHeight/2-s;return this.ctx.drawImage(o,l,c,r,s),!0}drawSpriteDirectional(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"south";const i=this.spriteCache[e];if(!i)return!1;const r=i.height/i.width,s=this.tileWidth*n,l=s*r,c=t-s/2,m=a+this.tileHeight/2-l;return"west"===o||"north"===o?(this.ctx.save(),this.ctx.translate(t,m+l/2),this.ctx.scale(-1,1),this.ctx.translate(-t,-(m+l/2)),this.ctx.drawImage(i,c,m,s,l),this.ctx.restore()):this.ctx.drawImage(i,c,m,s,l),!0}render(e){if(!this.ctx&&(this.canvas=document.getElementById("maze_canvas"),this.canvas&&(this.ctx=this.canvas.getContext("2d")),!this.ctx))return;this.lastMazeState=e;const{grid:t,size:a,playerX:n,playerY:o,visited:i,exitX:r,exitY:s,isVictory:l,currentFloor:c,totalFloors:m,profile:d,playerDirection:u}=e,p=(null==d?void 0:d.mapVisibility)||(!1===(null==d?void 0:d.fogOfWar)?"showAll":"fogOfWar"),h=2*this.tileWidth,g=(a+1)*this.tileWidth,f=a*this.tileHeight+h+this.tileHeight;this.canvas.width===g&&this.canvas.height===f||(this.canvas.width=g,this.canvas.height=f);const y=this.getStyleBackground(null==d?void 0:d.mapStyle);this.ctx.fillStyle=y,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const v=document.querySelector(".mazemaster-maze-area");v&&(v.style.backgroundColor=y);const b=this.getStyleFilter(null==d?void 0:d.mapStyle);this.ctx.filter=b;const z=this.canvas.width/2,_=h,x="".concat(c,":");for(let e=0;e<a;e++)for(let h=0;h<a;h++){const g=t[e][h],f="".concat(x).concat(h,",").concat(e),y="".concat(h,",").concat(e),v=i.has(f)||i.has(y),b=this.gridToIso(h,e),k=b.x+z,C=b.y+_,w=h===n&&e===o;let E=!1,S=!1;if("showAll"===p?E=!0:"hideUnexplored"===p?(E=v||w,S=!v&&!w):E=v||w,!S)if(E){this.drawSprite("floor",k,C)||this.drawIsoDiamond(k,C,this.palette.floor),g.safeRoom&&!g.safeRoom.exhausted&&this.drawSafeRoomIndicator(k,C),g.walls.left&&this.drawWallLeft(k,C,this.palette.wall),g.walls.top&&this.drawWallTop(k,C,this.palette.wall);const t=h>=a-1,n="".concat(x).concat(h+1,",").concat(e),o="".concat(h+1,",").concat(e),f=i.has(n)||i.has(o),y=!t&&("showAll"===p||f),v=e>=a-1,b="".concat(x).concat(h,",").concat(e+1),z="".concat(h,",").concat(e+1),_=i.has(b)||i.has(z),E=!v&&("showAll"===p||_);g.walls.right&&!y&&this.drawWallRight(k,C,this.palette.wall),g.walls.bottom&&!E&&this.drawWallBottom(k,C,this.palette.wall);if(h===r&&e===s&&c===m-1&&(this.drawSprite("exit",k,C,1)||this.drawIsoBlock(k,C-2,l?this.palette.stairUp:this.palette.exit,4)),g.staircase){const e="up"===g.staircase.direction?"stairsUp":"stairsDown";if(!this.drawSprite(e,k,C,1)){const e="up"===g.staircase.direction?this.palette.stairUp:this.palette.stairDown;this.drawIsoBlock(k,C-2,e,6),this.drawStairIcon(k,C-6,g.staircase.direction)}}if(g.portal&&(this.drawSprite("portal",k,C,.8)||this.drawPortal(k,C)),g.chest){const e=g.chest.opened?"chestOpen":"chest";if(!this.drawSprite(e,k,C,.8)){const e=g.chest.opened?this.palette.chestOpen:this.palette.chest;this.drawChest(k,C,e,g.chest.opened)}}if(g.trap&&!g.trap.triggered&&(this.drawSprite("trap",k,C,1)||this.drawTrap(k,C)),g.minion&&!g.minion.triggered){const e=(null==d?void 0:d.theme)||"fantasy";if(this.ctx.filter=this.getThemeMinionFilter(e),!this.drawSprite("minion",k,C,1)){const t=this.palette.minion;this.palette.minion=this.getThemeMinionPalette(e),this.drawMinion(k,C),this.palette.minion=t}this.ctx.filter="none"}if(w){const e=u||"south";this.drawSpriteDirectional("player",k,C,1.15,e)||this.drawPlayerDirectional(k,C,e),this.drawPlayerIndicator(k,C)}}else this.drawIsoBlock(k,C,this.palette.fog,4),this.ctx.fillStyle="#5a5a8a",this.ctx.font="bold ".concat(Math.floor(this.tileWidth/3),"px Arial"),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("?",k,C-2)}this.ctx.filter="none";const k=this.getStyleTint(null==d?void 0:d.mapStyle);k.a>0&&(this.ctx.globalCompositeOperation="multiply",this.ctx.fillStyle="rgba(".concat(k.r+100,", ").concat(k.g+100,", ").concat(k.b+100,", ").concat(.6*k.a,")"),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.globalCompositeOperation="overlay",this.ctx.fillStyle="rgba(".concat(k.r,", ").concat(k.g,", ").concat(k.b,", ").concat(.4*k.a,")"),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.globalCompositeOperation="source-over")}drawIsoDiamond(e,t,a){const n=this.tileWidth/2,o=this.tileHeight/2;this.ctx.fillStyle=a.top,this.ctx.beginPath(),this.ctx.moveTo(e,t-o),this.ctx.lineTo(e+n,t),this.ctx.lineTo(e,t+o),this.ctx.lineTo(e-n,t),this.ctx.closePath(),this.ctx.fill()}drawIsoBlock(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8;const o=this.tileWidth/2,i=this.tileHeight/2;this.ctx.fillStyle=a.dark,this.ctx.beginPath(),this.ctx.moveTo(e-o,t),this.ctx.lineTo(e,t+i),this.ctx.lineTo(e,t+i+n),this.ctx.lineTo(e-o,t+n),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle=a.light,this.ctx.beginPath(),this.ctx.moveTo(e+o,t),this.ctx.lineTo(e,t+i),this.ctx.lineTo(e,t+i+n),this.ctx.lineTo(e+o,t+n),this.ctx.closePath(),this.ctx.fill(),this.drawIsoDiamond(e,t,a)}drawWallLeft(e,t,a){const n=this.tileWidth/2,o=this.tileHeight/2,i=this.wallHeight;this.ctx.fillStyle=a.dark,this.ctx.beginPath(),this.ctx.moveTo(e-n,t),this.ctx.lineTo(e-n,t-i),this.ctx.lineTo(e,t-o-i),this.ctx.lineTo(e,t-o),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle=a.top,this.ctx.fillRect(e-n-1,t-i-2,4,4)}drawWallTop(e,t,a){const n=this.tileWidth/2,o=this.tileHeight/2,i=this.wallHeight;this.ctx.fillStyle=a.light,this.ctx.beginPath(),this.ctx.moveTo(e,t-o),this.ctx.lineTo(e,t-o-i),this.ctx.lineTo(e+n,t-i),this.ctx.lineTo(e+n,t),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle=a.top,this.ctx.fillRect(e+n-2,t-i-2,4,4)}drawWallRight(e,t,a){const n=this.tileWidth/2,o=this.tileHeight/2,i=this.wallHeight;this.ctx.fillStyle=a.light,this.ctx.beginPath(),this.ctx.moveTo(e+n,t),this.ctx.lineTo(e+n,t-i),this.ctx.lineTo(e,t+o-i),this.ctx.lineTo(e,t+o),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle=a.top,this.ctx.fillRect(e+n-2,t-i-2,4,4)}drawWallBottom(e,t,a){const n=this.tileWidth/2,o=this.tileHeight/2,i=this.wallHeight;this.ctx.fillStyle=a.dark,this.ctx.beginPath(),this.ctx.moveTo(e,t+o),this.ctx.lineTo(e,t+o-i),this.ctx.lineTo(e-n,t-i),this.ctx.lineTo(e-n,t),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle=a.top,this.ctx.fillRect(e-n-1,t-i-2,4,4)}drawPlayer(e,t){const a=this.palette.player,n=this.tileWidth/5;this.ctx.fillStyle="rgba(0,0,0,0.3)",this.ctx.beginPath(),this.ctx.ellipse(e,t+2,n,n/2,0,0,2*Math.PI),this.ctx.fill();const o=this.ctx.createRadialGradient(e-n/3,t-n-n/2,0,e,t-n/2,1.5*n);o.addColorStop(0,a.light),o.addColorStop(.5,a.top),o.addColorStop(1,a.dark),this.ctx.fillStyle=o,this.ctx.beginPath(),this.ctx.arc(e,t-n/2,n,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle="rgba(255,255,255,0.4)",this.ctx.beginPath(),this.ctx.arc(e-n/3,t-n,n/4,0,2*Math.PI),this.ctx.fill()}drawPlayerDirectional(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"south";const n=this.palette.player,o=this.tileWidth/5;this.ctx.fillStyle="rgba(0,0,0,0.3)",this.ctx.beginPath(),this.ctx.ellipse(e,t+2,o,o/2,0,0,2*Math.PI),this.ctx.fill();const i=this.ctx.createRadialGradient(e-o/3,t-o-o/2,0,e,t-o/2,1.5*o);i.addColorStop(0,n.light),i.addColorStop(.5,n.top),i.addColorStop(1,n.dark),this.ctx.fillStyle=i,this.ctx.beginPath(),this.ctx.arc(e,t-o/2,o,0,2*Math.PI),this.ctx.fill();const r="west"===a||"north"===a?o/3:-o/3;this.ctx.fillStyle="rgba(255,255,255,0.4)",this.ctx.beginPath(),this.ctx.arc(e+r,t-o,o/4,0,2*Math.PI),this.ctx.fill();const s={north:{dx:0,dy:1.3*-o},south:{dx:0,dy:.3*o},east:{dx:.9*o,dy:.4*-o},west:{dx:.9*-o,dy:.4*-o}},l=s[a]||s.south;this.ctx.fillStyle=n.light,this.ctx.beginPath(),this.ctx.arc(e+l.dx,t-o/2+l.dy,o/6,0,2*Math.PI),this.ctx.fill()}drawChest(e,t,a,n){const o=this.tileWidth/3,i=this.tileHeight/2;this.ctx.fillStyle=a.dark,this.ctx.fillRect(e-o/2,t-i,o,i),this.ctx.fillStyle=a.top,this.ctx.fillRect(e-o/2,t-i,o,i/3),n?(this.ctx.fillStyle=a.light,this.ctx.fillRect(e-o/2,t-i-4,o,4)):(this.ctx.fillStyle="#ffd700",this.ctx.fillRect(e-2,t-i/2-2,4,4))}drawMinion(e,t){const a=this.palette.minion,n=this.tileWidth/6;this.ctx.fillStyle="rgba(0,0,0,0.3)",this.ctx.beginPath(),this.ctx.ellipse(e,t+2,n,n/2,0,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle=a.top,this.ctx.beginPath(),this.ctx.arc(e,t-n/2,n,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle="#fff",this.ctx.beginPath(),this.ctx.arc(e-3,t-n/2,2,0,2*Math.PI),this.ctx.arc(e+3,t-n/2,2,0,2*Math.PI),this.ctx.fill()}drawPlayerIndicator(e,t){const a=Date.now()/300,n=Gt;if(this.ctx.save(),n){const n=t-this.tileHeight-20,o=10,i=4;this.ctx.fillStyle="rgba(0, 0, 0, 0.6)",this.ctx.shadowColor="#f97316",this.ctx.shadowBlur=12,this.ctx.beginPath(),this.ctx.roundRect(e-22,n-8,44,20,8),this.ctx.fill();for(let t=0;t<3;t++){const r=e-o+t*o,s=2*a+.8*t,l=.6+.4*Math.sin(s),c=.5+.5*Math.sin(s);this.ctx.fillStyle="rgba(251, 146, 60, ".concat(c,")"),this.ctx.shadowColor="#fb923c",this.ctx.shadowBlur=8,this.ctx.beginPath(),this.ctx.arc(r,n+2,i*l,0,2*Math.PI),this.ctx.fill()}this.ctx.fillStyle="rgba(0, 0, 0, 0.6)",this.ctx.shadowBlur=0,this.ctx.beginPath(),this.ctx.moveTo(e-4,n+12),this.ctx.lineTo(e,n+18),this.ctx.lineTo(e+4,n+12),this.ctx.closePath(),this.ctx.fill()}else{const n=4*Math.sin(a),o=t-this.tileHeight-25+n;this.ctx.shadowColor="#3b82f6",this.ctx.shadowBlur=10;const i=8;this.ctx.fillStyle="#60a5fa",this.ctx.beginPath(),this.ctx.moveTo(e,o+2*i),this.ctx.lineTo(e-i,o+i),this.ctx.lineTo(e,o),this.ctx.lineTo(e+i,o+i),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle="#93c5fd",this.ctx.beginPath(),this.ctx.moveTo(e,o+1.5*i),this.ctx.lineTo(e-i/2,o+i),this.ctx.lineTo(e,o+i/2),this.ctx.lineTo(e+i/2,o+i),this.ctx.closePath(),this.ctx.fill()}this.ctx.restore(),this._animationFrame||(this._animationFrame=requestAnimationFrame((()=>{this._animationFrame=null,this.lastMazeState&&this.render(this.lastMazeState)})))}drawTrap(e,t){const a=this.palette.trap;this.ctx.fillStyle=a.top;for(let a=-1;a<=1;a++)this.ctx.beginPath(),this.ctx.moveTo(e+6*a-2,t),this.ctx.lineTo(e+6*a,t-6),this.ctx.lineTo(e+6*a+2,t),this.ctx.fill()}drawSafeRoomIndicator(e,t){const a=this.palette.safeRoom,n=this.tileWidth/2,o=this.tileHeight/2,i=this.ctx.createRadialGradient(e,t,0,e,t,n);i.addColorStop(0,a.light+"aa"),i.addColorStop(.6,a.top+"66"),i.addColorStop(1,"transparent"),this.ctx.fillStyle=i,this.ctx.beginPath(),this.ctx.moveTo(e,t-o),this.ctx.lineTo(e+n,t),this.ctx.lineTo(e,t+o),this.ctx.lineTo(e-n,t),this.ctx.closePath(),this.ctx.fill(),this.ctx.fillStyle=a.top,this.ctx.font="bold ".concat(Math.floor(this.tileWidth/4),"px Arial"),this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText("",e,t-2)}drawPortal(e,t){const a=this.palette.portal,n=this.tileWidth/4,o=this.ctx.createRadialGradient(e,t-n/2,0,e,t-n/2,1.5*n);o.addColorStop(0,a.light),o.addColorStop(.5,a.top+"88"),o.addColorStop(1,"transparent"),this.ctx.fillStyle=o,this.ctx.beginPath(),this.ctx.arc(e,t-n/2,1.5*n,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle=a.top,this.ctx.beginPath(),this.ctx.arc(e,t-n/2,n/2,0,2*Math.PI),this.ctx.fill()}drawStairIcon(e,t,a){this.ctx.fillStyle="#fff",this.ctx.font="bold 12px Arial",this.ctx.textAlign="center",this.ctx.fillText("up"===a?"":"",e,t)}updatePlayerPosition(e,t,a,n){}}},currentRenderer:null,currentType:"isometric",register(e,t){this.renderers[e]=t},create(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=this.renderers[e];return a?new a(t):(console.warn("[MazeMaster] Unknown renderer type: ".concat(e,", falling back to css-grid")),new B(t))},getRenderer(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return!t&&void 0!==qt&&null!==(e=qt)&&void 0!==e&&e.rendererType&&(t=qt.rendererType),t&&t!==this.currentType&&(this.currentRenderer&&this.currentRenderer.cleanup(),this.currentType=t,this.currentRenderer=this.create(t)),this.currentRenderer||(this.currentRenderer=this.create(this.currentType)),this.currentRenderer},getAvailableTypes(){return Object.keys(this.renderers)}};function N(){var e;const t=(null===(e=qt)||void 0===e?void 0:e.layoutMode)||"desktop";return"auto"===t?function(){const e=window.innerWidth;return window.innerHeight>e||e<768?"mobile":"desktop"}():t}function H(){const e=document.getElementById("mazemaster_maze_modal");if(!e)return;const t=N();e.classList.remove("layout-mobile","layout-desktop"),e.classList.add("layout-".concat(t));const a=e.querySelector(".maze-modal-container");a&&(a.classList.remove("layout-mobile","layout-desktop"),a.classList.add("layout-".concat(t)))}"undefined"!=typeof window&&window.addEventListener("resize",(()=>{var e;"auto"===(null===(e=qt)||void 0===e?void 0:e.layoutMode)&&H()}));const O={difficulty:"normal",theme:"fantasy",mapStyle:"maze",floors:1,mapVisibility:"fogOfWar",onMove:"",onMilestone:"",onExploreComplete:"",onItemAdd:"",onItemRemove:"",onChestOpen:"",onTrade:"",onEnemyMove:"",onTeleport:"",onObjectiveProgress:"",onObjectiveComplete:"",onAllObjectivesComplete:"",onDifficultySet:"",onStatUpdate:"",portals:[],objectives:[],hpEnabled:!0,maxHP:100,battlebarDamageMultiplier:1,battlebarDifficultyMultiplier:1,onDeath:"respawn",respawnHPPercent:50,safeRoomCount:3,safeRoomHealPercent:100,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:20,restCooldown:3,restInterruptChance:0,restInterruptScript:"",onDamage:"",onHeal:"",onPlayerDeath:"",onEquip:"",onUnequip:"",onEquipmentFound:"",equipmentDropChance:15,onXpGain:"",onLevelUp:"",onSkillLearn:"",onSkillUse:"",fairness:{enabled:!0,keyPityThreshold:3,healingPityThreshold:4,lowHpThreshold:.4,mercyUnlock:!0,mercyUnlockThreshold:2},llmEnhanceRooms:!0,llmRoomPrompt:"Describe this {{roomType}} room in 1-2 vivid sentences. Theme: {{theme}}. Context: {{sessionNotes}}",questProfile:"none",questGatingEnabled:!1};function F(e){return e&&"string"==typeof e?e=(e=e.replace(/\{\{roll:([^}]+)\}\}/gi,((e,t)=>String(function(e){const t=e.match(/^(\d+)d(\d+)([+-]\d+)?$/i);if(!t)return console.warn("[MazeMaster] Invalid dice notation: ".concat(e)),0;const a=parseInt(t[1],10),n=parseInt(t[2],10),o=t[3]?parseInt(t[3],10):0;let i=0;for(let e=0;e<a;e++)i+=Math.floor(Math.random()*n)+1;return i+=o,console.log("[MazeMaster] Rolled ".concat(e,": ").concat(i)),Math.max(0,i)}(t.trim()))))).replace(/\{\{random:(\d+):(\d+)\}\}/gi,((e,t,a)=>{const n=parseInt(t,10),o=parseInt(a,10);return String(Math.floor(Math.random()*(o-n+1))+n)})):e}async function W(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;if(!e||"string"!=typeof e||""===e.trim())return null;e=F(e);try{const a=new Promise(((e,a)=>{setTimeout((()=>a(new Error("STScript timed out after ".concat(t,"ms")))),t)}));return await Promise.race([m(e),a])}catch(t){var a;return null!==(a=t.message)&&void 0!==a&&a.includes("timed out")?console.warn("[MazeMaster] STScript timed out: ".concat(e.substring(0,50),"...")):console.error("[MazeMaster] STScript error:",t),null}}async function Y(e){var t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=null===(t=jt)||void 0===t?void 0:t.profile;if(!n)return;let o=n[e];if(o&&"string"==typeof o&&o.trim()){for(const[e,t]of Object.entries(a))o=o.replaceAll("{{".concat(e,"}}"),String(t));await W(o)}}function U(e){const t="string"==typeof e?e:(null==e?void 0:e.difficulty)||"normal";return k[t]||k.normal}function G(e){var a;const n=(null===(a=qt.mazeProfiles)||void 0===a?void 0:a[e])||Lt[e];return n?t(t({},O),n):null}function j(e){const t=U(e).hpMult||1,a=e.maxHP||100,n=Math.round(a*t);return{current:n,max:n,maxBonus:0,reviveCharges:0}}async function K(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unknown";if(!jt.hpEnabled||!jt.hp)return!0;const a=await async function(e,t){var a,n;const o=null===(a=jt)||void 0===a||null===(a=a.equipment)||void 0===a?void 0:a.armor;if("absorb"===(null==o||null===(n=o.special)||void 0===n?void 0:n.type)&&(void 0===jt.equipmentCharges&&(jt.equipmentCharges={}),void 0===jt.equipmentCharges[o.id]&&(jt.equipmentCharges[o.id]=o.special.charges||3),jt.equipmentCharges[o.id]>0)){const t=e;jt.equipmentCharges[o.id]--;const a=jt.equipmentCharges[o.id];return a>0?Si("Shield","".concat(o.name," absorbed ").concat(t," damage! (").concat(a," charges left)")):(Si("Shield","".concat(o.name," absorbed ").concat(t," damage and shattered!")),jt.equipment.armor=null,Wi()),{fullyAbsorbed:!0,remainingDamage:0}}const i=Qe().filter((e=>{const t=Xe(e);return"equipment"===(null==t?void 0:t.type)&&(null==t?void 0:t.absorbPercent)>0}));for(const a of i){var r,s;if(null===(r=jt.inventory)||void 0===r||!r[a]||jt.inventory[a]<=0)continue;if(!st(a,t))continue;const n=Xe(a);if(!n)continue;const o=rt(a),i=n.absorbPercent||100,l=Math.floor(e*(i/100)),c=e-l,m=nt(a,(null===(s=jt.profile)||void 0===s?void 0:s.theme)||"fantasy");return it(a),o>0?Si("Shield","".concat(m," absorbed ").concat(l," damage! (").concat(o," charges left)")):(Si("Shield","".concat(m," absorbed ").concat(l," damage and shattered!")),await Hi(a),n.onBreak&&await executeSTScript(n.onBreak,{itemId:a,absorbed:l,source:t})),n.onActivate&&await executeSTScript(n.onActivate,{itemId:a,absorbed:l,chargesRemaining:o,source:t}),{fullyAbsorbed:c<=0,remainingDamage:Math.max(0,c)}}return{fullyAbsorbed:!1,remainingDamage:e}}(e,t);if(a.fullyAbsorbed)return!0;if((e=a.remainingDamage)<=0)return!0;const n=jt.hp.current;if(jt.hp.current=Math.max(0,jt.hp.current-e),Z(),J(),function(){const e=document.createElement("div");e.className="maze-hp-flash damage",document.body.appendChild(e),setTimeout((()=>e.remove()),300)}(),await Y("onDamage",{amount:e,source:t,previousHP:n,currentHP:jt.hp.current,maxHP:jt.hp.max+jt.hp.maxBonus}),Si("Combat","Took ".concat(e," damage! (").concat(jt.hp.current,"/").concat(jt.hp.max+jt.hp.maxBonus," HP)")),jt.hp.current<=0)return await async function(e){var t,a,n;if(console.log("[MazeMaster] handlePlayerDeath called, source:",e),jt.hp.reviveCharges>0){jt.hp.reviveCharges--;const t=jt.hp.max+jt.hp.maxBonus;return jt.hp.current=Math.round(.25*t),Z(),Si("Revival","Your Revival Charm activates! You cheat death..."),Ei("Revival charm activated! Cheated death from ".concat(e),"Death"),void console.log("[MazeMaster] Revival charm used, HP restored")}Ei("DEATH: Killed by ".concat(e),"Death"),await Y("onPlayerDeath",{source:e});const o=(null===(t=jt.profile)||void 0===t?void 0:t.onDeath)||"respawn";switch(console.log("[MazeMaster] Death action:",o,"Profile onDeath:",null===(a=jt.profile)||void 0===a?void 0:a.onDeath),o){case"respawn":console.log("[MazeMaster] Respawning player"),await X(100);break;case"respawnPenalty":const e=(null===(n=jt.profile)||void 0===n?void 0:n.respawnHPPercent)||50;console.log("[MazeMaster] Respawning with penalty:",e+"%"),await X(e);break;default:console.log("[MazeMaster] Game over triggered"),Lr()}}(t),!1;const o=jt.hp.max+jt.hp.maxBonus;return jt.hp.current<=.25*o&&n>.25*o&&Si("Warning","Your health is critically low!"),!0}async function V(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown";if(!jt.hpEnabled||!jt.hp)return;const n=U(jt.profile).healMult||1,o=jt.hp.max+jt.hp.maxBonus;let i=t?Math.round(e/100*o*n):Math.round(e*n);const r=jt.hp.current;jt.hp.current=Math.min(o,jt.hp.current+i);const s=jt.hp.current-r;Z(),J(),s>0&&function(){const e=document.createElement("div");e.className="maze-hp-flash heal",document.body.appendChild(e),setTimeout((()=>e.remove()),300)}(),await Y("onHeal",{amount:s,source:a,previousHP:r,currentHP:jt.hp.current,maxHP:o}),s>0&&Si("Healing","Restored ".concat(s," HP! (").concat(jt.hp.current,"/").concat(o," HP)"))}async function X(e){jt.playerX=0,jt.playerY=0,jt.isPaused=!1,jt.pendingEncounter=null,jt.pendingConfirmation=null;const t=jt.hp.max+jt.hp.maxBonus;jt.hp.current=Math.round(t*(e/100)),Z(),wi(),fe(),Si("Respawn","Returned to the start with ".concat(e,"% HP...")),setTimeout((()=>{"function"==typeof window.mazeCenterOnPlayer&&window.mazeCenterOnPlayer(!0)}),100);const a=jt.profile;if(null!=a&&a.mainMinion){const e=pn(a.mainMinion);e&&(jt.currentMinion={name:e.name,imagePath:e.imagePath,message:"Back to the beginning with you!"},Ii())}}async function Q(){var e,t,a;if(!jt.isOpen||jt.isPaused||jt.isVictory)return;if(!jt.hpEnabled||!jt.hp)return;const n=jt.profile||{};if(!n.restEnabled)return;if((jt.restCooldown||0)>0)return void Si("Rest","Cannot rest yet. Wait ".concat(jt.restCooldown," more turn(s)."));const o=jt.hp.max+(jt.hp.maxBonus||0);if(jt.hp.current>=o)return void Si("Rest","You are already at full health.");await ie("moves",1);const i=null!==(e=n.restInterruptChance)&&void 0!==e?e:0;if(i>0){const e=100*Math.random();var r;if(e<i)return console.log("[MazeMaster] Rest interrupted (rolled ".concat(e.toFixed(1)," vs ").concat(i,"%)")),jt.restCooldown=null!==(r=n.restCooldown)&&void 0!==r?r:3,J(),void(n.restInterruptScript&&n.restInterruptScript.trim()?(Si("Interrupted!","Your rest is disturbed!"),await W(n.restInterruptScript)):await async function(){const e=jt.profile||{},t=e.minionEncounters||[];if(0===t.length)return void Si("Interrupted!","Something disturbs your rest, but nothing appears...");const a=t[Math.floor(Math.random()*t.length)].minionId;a?(Si("Ambush!","You are caught off guard while resting!"),await Bi(a,jt.playerX,jt.playerY)):Si("Interrupted!","Your rest is disturbed by strange noises...")}())}const s=null!==(t=n.restHealPercent)&&void 0!==t?t:20;await V(s,!0,"rest"),jt.restCooldown=null!==(a=n.restCooldown)&&void 0!==a?a:3,J(),Si("Rest","You take a moment to rest and recover ".concat(s,"% HP."))}function J(){var e,t,a;const n=document.getElementById("maze_rest_btn");if(!n)return;const o=jt.profile||{};if(!jt.hpEnabled||!o.restEnabled)return void(n.style.display="none");n.style.display="flex";const i=jt.restCooldown||0,r=(null===(e=jt.hp)||void 0===e?void 0:e.max)||100,s=(null===(t=jt.hp)||void 0===t?void 0:t.maxBonus)||0,l=((null===(a=jt.hp)||void 0===a?void 0:a.current)||0)>=r+s,c=i>0;if(n.disabled=c||l||jt.isPaused,l)n.title="Already at full HP";else if(c)n.title="Rest available in ".concat(i," turn(s)");else{var m;const e=null!==(m=o.restHealPercent)&&void 0!==m?m:20;n.title="Rest to recover ".concat(e,"% HP")}const d=n.querySelector(".rest-cooldown-badge");d&&(c?(d.style.display="flex",d.textContent=i):d.style.display="none")}function Z(){if(!jt.hpEnabled||!jt.hp)return;const e=document.getElementById("maze_hp_current"),t=document.getElementById("maze_hp_max"),a=document.getElementById("maze_hp_bar"),n=document.querySelector(".mazemaster-maze-container"),o=document.getElementById("maze_hp_overlay"),i=jt.hp.current,r=jt.hp.max+jt.hp.maxBonus,s=Math.round(i/r*100);e&&(e.textContent=i),t&&(t.textContent=r),a&&(a.style.width="".concat(s,"%"),a.classList.remove("low","medium","high"),s<=25?a.classList.add("low"):s<=50?a.classList.add("medium"):a.classList.add("high")),o&&(o.style.display=jt.hpEnabled?"":"none"),n&&(s<=25?n.classList.add("low-hp"):n.classList.remove("low-hp"))}async function ee(e){var t;if(!jt.hpEnabled||!jt.hp)return;if(!jt.inventory[e]||jt.inventory[e]<=0)return;const a=Xe(e);if(!a)return;const n=nt(e,(null===(t=jt.profile)||void 0===t?void 0:t.theme)||"fantasy");if("potion"===a.type&&a.healAmount)await Hi(e),await V(a.healAmount,!1!==a.healIsPercent,"potion");else if("equipment"===a.type&&"charm"===a.subtype){var o;null!==(o=a.triggers)&&void 0!==o&&o.includes("death")&&(jt.hp.reviveCharges=(jt.hp.reviveCharges||0)+(a.charges||1),await Hi(e),Si("Item","".concat(n," ready. You will cheat death once.")))}else if("heartCrystal"===e)await Hi("heartCrystal"),await async function(e){jt.hpEnabled&&jt.hp&&(jt.hp.maxBonus+=e,jt.hp.current+=e,Z(),Si("Power Up","Max HP increased by ".concat(e,"!")))}(10)}function te(e,t,a,n,o){var i,r;const s=null===(i=o[t])||void 0===i?void 0:i[e],l=null===(r=o[n])||void 0===r?void 0:r[a];if(!s)return!0;const c=a-e,m=n-t;if(1===c&&s.walls.right)return!0;if(-1===c&&s.walls.left)return!0;if(1===m&&s.walls.bottom)return!0;if(-1===m&&s.walls.top)return!0;if(l){if(1===c&&l.walls.left)return!0;if(-1===c&&l.walls.right)return!0;if(1===m&&l.walls.top)return!0;if(-1===m&&l.walls.bottom)return!0}return!1}function ae(e,t,a,n,o){if(e===a&&t===n)return!0;const i=a-e,r=n-t,s=Math.abs(i),l=Math.abs(r),c=i>0?1:i<0?-1:0,m=r>0?1:r<0?-1:0;if(0===i||0===r){let i=e,r=t;for(;i!==a||r!==n;){const e=i+c,t=r+m;if(te(i,r,e,t,o))return!1;i=e,r=t}return!0}let d=e,u=t,p=s-l;for(;d!==a||u!==n;){const e=2*p;let t=d,a=u,n=!1,i=!1;if(e>-l&&(p-=l,t+=c,n=!0),e<s&&(p+=s,a+=m,i=!0),n&&i){const e=te(d,u,d+c,u,o)||te(d+c,u,t,a,o),n=te(d,u,d,u+m,o)||te(d,u+m,t,a,o);if(e&&n)return!1}else if(n){if(te(d,u,t,a,o))return!1}else if(i&&te(d,u,t,a,o))return!1;d=t,u=a}return!0}function ne(e,t,a){var n;if(!jt.isOpen)return;const o=function(){var e,t;if(!jt.isOpen)return 1;if(null!==(e=jt.lighting)&&void 0!==e&&e.lightRadius)return jt.lighting.lightRadius;const a=jt.visibility||{baseRadius:1,tempBonus:0,permBonus:0},n=((null===(t=jt.inventory)||void 0===t?void 0:t.lantern)||0)>0?1:0;return a.baseRadius+a.tempBonus+a.permBonus+n}(),i="".concat(jt.currentFloor,":"),r=null===(n=jt.floorsData)||void 0===n?void 0:n[jt.currentFloor],s=(null==r?void 0:r.grid)||jt.grid;if(s)for(let n=Math.max(0,t-o);n<=Math.min(a-1,t+o);n++)for(let r=Math.max(0,e-o);r<=Math.min(a-1,e+o);r++)Math.abs(r-e)+Math.abs(n-t)<=o&&ae(e,t,r,n,s)&&jt.visited.add("".concat(i).concat(r,",").concat(n))}function oe(){try{var e;const t=SillyTavern.getContext();return(null==t?void 0:t.name1)||(null==t?void 0:t.persona)||(null==t||null===(e=t.user_avatar)||void 0===e?void 0:e.replace(/\.[^/.]+$/,""))||"Default User"}catch(e){return console.warn("[MazeMaster] Could not get persona name:",e),"Default User"}}async function ie(e){var t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;null!==(t=jt)&&void 0!==t&&t.stats&&"number"==typeof jt.stats[e]&&(jt.stats[e]+=a,le(),await Y("onStatUpdate",{statName:e,value:jt.stats[e]}))}function re(){var e;if(null===(e=jt)||void 0===e||null===(e=e.stats)||void 0===e||!e.startTime)return"0:00";const t=Math.floor((Date.now()-jt.stats.startTime)/1e3),a=Math.floor(t/3600),n=Math.floor(t%3600/60),o=t%60;return a>0?"".concat(a,":").concat(n.toString().padStart(2,"0"),":").concat(o.toString().padStart(2,"0")):"".concat(n,":").concat(o.toString().padStart(2,"0"))}function se(){var e,t;if(null===(e=jt)||void 0===e||!e.visited||null===(t=jt)||void 0===t||!t.size)return 0;const a=jt.totalFloors||1,n=jt.size*jt.size*a;return Math.floor(jt.visited.size/n*100)}function le(){var e;const t=document.getElementById("maze_stat_moves"),a=document.getElementById("maze_stat_time"),n=document.getElementById("maze_stat_explore");t&&(t.textContent=(null===(e=jt)||void 0===e||null===(e=e.stats)||void 0===e?void 0:e.moves)||0),a&&(a.textContent=re()),n&&(n.textContent="".concat(se(),"%")),function(){const e=document.getElementById("maze_zone_display");if(!e)return;e.style.display="none"}()}function ce(e,t,a,n,o){e.profileStats||(e.profileStats={});const i=e.profileStats[t]||{totalGames:0,wins:0,losses:0,bestTime:null,totalMoves:0};i.totalGames++,"win"===a?(i.wins++,(null===i.bestTime||n<i.bestTime)&&(i.bestTime=n)):i.losses++,i.totalMoves+=o,e.profileStats[t]=i,e.totalGames=(e.totalGames||0)+1,"win"===a?(e.wins=(e.wins||0)+1,(null===e.bestTime||n<e.bestTime)&&(e.bestTime=n)):e.losses=(e.losses||0)+1,e.totalMoves=(e.totalMoves||0)+o}function me(e){var a,n;if(null===(a=jt)||void 0===a||!a.profileName||null===(n=jt)||void 0===n||!n.stats)return;const o=jt.profileName,r=oe(),s=Date.now()-jt.stats.startTime,l=jt.stats.moves;qt.mazeStats||(qt.mazeStats={global:{totalGames:0,wins:0,losses:0,bestTime:null,totalMoves:0,profileStats:{}},personas:{}}),qt.mazeStats.global||function(){if(!qt.mazeStats)return;if(qt.mazeStats.global)return;const e=qt.mazeStats.profileStats||{};qt.mazeStats={global:{totalGames:0,wins:0,losses:0,bestTime:null,totalMoves:0,profileStats:t({},e)},personas:{}};for(const t in e){const a=e[t];qt.mazeStats.global.totalGames+=a.totalGames||0,qt.mazeStats.global.wins+=a.wins||0,qt.mazeStats.global.losses+=a.losses||0,qt.mazeStats.global.totalMoves+=a.totalMoves||0,null!==a.bestTime&&(null===qt.mazeStats.global.bestTime||a.bestTime<qt.mazeStats.global.bestTime)&&(qt.mazeStats.global.bestTime=a.bestTime)}console.log("[MazeMaster] Migrated stats to new global/persona format"),i()}(),ce(qt.mazeStats.global,o,e,s,l),qt.mazeStats.personas[r]||(qt.mazeStats.personas[r]={totalGames:0,wins:0,losses:0,bestTime:null,totalMoves:0,profileStats:{}}),ce(qt.mazeStats.personas[r],o,e,s,l),i()}let de=null;function ue(){de&&(clearInterval(de),de=null)}function pe(e){const t=function(e){const t=(null==e?void 0:e.theme)||"fantasy",a=C[t]||C.fantasy;return(null==a?void 0:a.colors)||{primary:"#2ecc71",secondary:"#27ae60",accent:"#f1c40f"}}(e),a=document.querySelector(".mazemaster-maze-container");a&&(a.style.setProperty("--theme-primary",t.primary),a.style.setProperty("--theme-secondary",t.secondary),a.style.setProperty("--theme-accent",t.accent))}function he(){const e=document.getElementById("maze_dpad");if(!e||!e.classList.contains("floating"))return;const t=e.querySelector(".dpad-drag-handle");if(!t)return;let a=!1,n=0,o=0;const r=(t,i)=>{a=!0,n=t-e.offsetLeft,o=i-e.offsetTop,e.style.cursor="grabbing"},s=(t,i)=>{if(!a)return;const r=Math.max(0,Math.min(window.innerWidth-e.offsetWidth,t-n)),s=Math.max(0,Math.min(window.innerHeight-e.offsetHeight,i-o));e.style.left="".concat(r,"px"),e.style.top="".concat(s,"px"),e.style.right="auto",e.style.bottom="auto"},l=()=>{a&&(a=!1,e.style.cursor="",qt.dpadConfig||(qt.dpadConfig={enabled:!0,floating:!0,position:{}}),qt.dpadConfig.position={x:e.offsetLeft,y:e.offsetTop},i())};t.addEventListener("mousedown",(e=>{e.preventDefault(),r(e.clientX,e.clientY)})),document.addEventListener("mousemove",(e=>s(e.clientX,e.clientY))),document.addEventListener("mouseup",l),t.addEventListener("touchstart",(e=>{const t=e.touches[0];r(t.clientX,t.clientY)})),document.addEventListener("touchmove",(e=>{if(!a)return;const t=e.touches[0];s(t.clientX,t.clientY)})),document.addEventListener("touchend",l)}function ge(){var e;const t=document.getElementById("maze_grid_container"),a=document.querySelector(".mazemaster-maze-area");if(!t||!a)return;const n=(null===(e=jt)||void 0===e?void 0:e.size)||10;let o;o=n<=7?76:n<=10?64:n<=15?52:n<=20?44:36;const i=64/o*1.5;let r=i,s=0,l=0,c=!1,m=0,d=0,u=0,p=i;const h=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t.style.transition=e?"transform 0.3s ease-out":"none",t.style.transform="translate(".concat(s,"px, ").concat(l,"px) scale(").concat(r,")"),t.style.transformOrigin="0 0"},g=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n=t.querySelector(".player-marker, .maze-cell.current"),o=t.querySelector("canvas"),i=a.getBoundingClientRect();if(n){const a=n.getBoundingClientRect(),o=t.getBoundingClientRect(),c=a.left+a.width/2-o.left,m=a.top+a.height/2-o.top,d=i.width/2,u=i.height/2;s=d-c*r,l=u-m*r,h(e)}else if(o){const t=(e=>{if(!jt||void 0===jt.playerX)return null;const t=jt.size||10;let a;a=t<=7?76:t<=10?64:t<=15?52:t<=20?44:36;const n=a/2,o=2*a,i=jt.playerX,r=jt.playerY,s=(i+r)*(n/2);return{x:a/2*(i-r)+e.width/2,y:s+o}})(o);if(t){const a=i.width/2,n=i.height/2;s=a-t.x*r,l=n-t.y*r,h(e)}else{const t=o.height,a=i.height;l=(a-t*r)/2+t*r*.45,h(e)}}};window.mazeCenterOnPlayer=function(){return g(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])},setTimeout((()=>g(!1)),50),setTimeout((()=>g(!1)),150),setTimeout((()=>g(!1)),300),a.addEventListener("wheel",(e=>{e.preventDefault();const t=e.deltaY>0?.9:1.1;r=Math.max(.5,Math.min(4,r*t)),g(!1)}),{passive:!1}),a.addEventListener("mousedown",(e=>{e.target.closest(".maze-cell, canvas")&&(c=!0,m=e.clientX-s,d=e.clientY-l,a.style.cursor="grabbing",t.style.transition="none")})),document.addEventListener("mousemove",(e=>{c&&(s=e.clientX-m,l=e.clientY-d,h(!1))})),document.addEventListener("mouseup",(()=>{c=!1,a.style.cursor=""}));const f=e=>{if(e.length<2)return 0;const t=e[0].clientX-e[1].clientX,a=e[0].clientY-e[1].clientY;return Math.sqrt(t*t+a*a)};a.addEventListener("touchstart",(e=>{2===e.touches.length?(u=f(e.touches),p=r):1===e.touches.length&&(c=!0,m=e.touches[0].clientX-s,d=e.touches[0].clientY-l,t.style.transition="none")}),{passive:!0}),a.addEventListener("touchmove",(e=>{if(2===e.touches.length){e.preventDefault();const t=f(e.touches);if(u>0){const e=t/u;r=Math.max(.5,Math.min(4,p*e)),g(!1)}}else 1===e.touches.length&&c&&(s=e.touches[0].clientX-m,l=e.touches[0].clientY-d,h(!1))}),{passive:!1}),a.addEventListener("touchend",(()=>{c=!1,u=0,p=r}));let y=0;a.addEventListener("touchend",(e=>{const t=Date.now();t-y<300&&1===e.changedTouches.length&&(r=i,p=i,g(!0)),y=t})),a.style.cursor="grab"}function fe(){var e;const t=document.querySelector(".dpad-floor-up"),a=document.querySelector(".dpad-floor-down");if(!t||!a||!jt)return;const n=null===(e=jt.grid)||void 0===e||null===(e=e[jt.playerY])||void 0===e?void 0:e[jt.playerX],o=null==n?void 0:n.staircase;"up"===(null==o?void 0:o.direction)?t.classList.remove("hidden"):t.classList.add("hidden"),"down"===(null==o?void 0:o.direction)?a.classList.remove("hidden"):a.classList.add("hidden")}async function ye(e){var t,a,n;if(null===(t=jt)||void 0===t||!t.isOpen||jt.isPaused)return!1;if(jt.totalFloors<=1)return!1;if(Gt)return!1;const o=null===(a=jt.grid)||void 0===a||null===(a=a[jt.playerY])||void 0===a?void 0:a[jt.playerX];if(null==o||!o.staircase)return console.log("[MazeMaster] Not on a staircase"),!1;if(o.staircase.direction!==e)return console.log("[MazeMaster] Staircase direction mismatch"),!1;if(o.staircase.requireKey&&"up"===e){if(!((null===(i=jt)||void 0===i?void 0:i.inventory.floorKey)>0))return jt.currentMinion={name:"Locked Staircase",imagePath:"",message:"This staircase is locked! You need a Floor Key to ascend."},Ii(),!1;await async function(){var e;(null===(e=jt)||void 0===e?void 0:e.inventory.floorKey)>0&&await Hi("floorKey",1)}()}var i;const r=o.staircase.targetFloor,s=o.staircase.targetX,l=o.staircase.targetY;if(r<0||r>=jt.totalFloors)return console.error("[MazeMaster] Invalid target floor"),!1;jt.currentFloor=r,jt.grid=jt.floors[r],jt.playerX=s,jt.playerY=l,jt.visited.add("".concat(r,":").concat(s,",").concat(l)),Ei("".concat("up"===e?"Ascended":"Descended"," to Floor ").concat(r+1,"/").concat(jt.totalFloors),"Floor");const c=C[null===(n=jt.profile)||void 0===n?void 0:n.theme]||C.fantasy,m="up"===e?c.flavorMessages.stairUp:c.flavorMessages.stairDown;return jt.currentMinion={name:"up"===e?"Ascending":"Descending",imagePath:"",message:m||"You ".concat("up"===e?"ascend":"descend"," to floor ").concat(r+1,"...")},Ii(),await Y("onMove",{x:s,y:l,direction:"up"===e?"floor-up":"floor-down",floor:r}),wi(),ze(!1),le(),fe(),ve(),Ia(),"function"==typeof window.mazeCenterOnPlayer&&window.mazeCenterOnPlayer(!0),await Qt(s,l),console.log("[MazeMaster] Changed to floor ".concat(r+1)),!0}function ve(){const e=document.getElementById("maze_floor_current"),t=document.getElementById("maze_floor_total"),a=document.querySelector(".maze-floor-indicator");jt.totalFloors<=1?a&&(a.style.display="none"):(a&&(a.style.display=""),e&&(e.textContent=jt.currentFloor+1),t&&(t.textContent=jt.totalFloors))}async function be(e,t){await Hi("portalStone",1),jt.playerX=e,jt.playerY=t,jt.visited.add("".concat(jt.currentFloor,":").concat(e,",").concat(t)),ze(!0),wi(),fe(),jt.currentMinion={name:"Portal Stone",imagePath:"",message:"The portal stone crumbles as you are whisked through space!"},Ii(),await Y("onTeleport",{x:e,y:t,source:"portalStone"})}function ze(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!jt)return;const t=R.getRenderer(),a=_i(jt.size);t.updatePlayerPosition(jt.playerX,jt.playerY,e,a),Pi()}async function _e(e,t,a,n,o){const i=document.querySelector('.maze-cell[data-x="'.concat(e,'"][data-y="').concat(t,'"]')),r=document.querySelector('.maze-cell[data-x="'.concat(a,'"][data-y="').concat(n,'"]'));i&&r&&(i.classList.add("minion-moving"),i.classList.add(Ie(o)),await new Promise((e=>setTimeout(e,150))),i.classList.remove("has-minion","minion-moving","minion-patrol","minion-suspicious","minion-alerted","minion-chase"),r.classList.add("has-minion","minion-arriving",Ie(o)),setTimeout((()=>{r.classList.remove("minion-arriving")}),200))}function xe(e,t,a,n,o,i){const{x:r,y:s,originX:l,originY:c,movement:m}=e,d=(null==i?void 0:i.minionAggressionMult)||1,u=Le(r,s,t,a);if(0===u.length)return null;switch(m.type){case"patrol":{const e=m.patrolRadius||3,t=u.filter((t=>Math.abs(t.x-l)+Math.abs(t.y-c)<=e));return 0===t.length?null:t[Math.floor(Math.random()*t.length)]}case"chase":{const e=m.chaseRange||5,t=Math.ceil(e*d),a=Math.abs(r-n)+Math.abs(s-o);if(a>t)return u[Math.floor(Math.random()*u.length)];let i=null,l=a;for(const e of u){const t=Math.abs(e.x-n)+Math.abs(e.y-o);t<l&&(l=t,i=e)}return i&&Math.random()<1/d*.5?u[Math.floor(Math.random()*u.length)]:i||u[Math.floor(Math.random()*u.length)]}default:return null}}const ke={idle:{name:"Idle",icon:"fa-moon",color:"#95a5a6",moveChance:.3,detectionRange:3},suspicious:{name:"Suspicious",icon:"fa-question",color:"#f39c12",moveChance:.5,detectionRange:4,duration:3},alerted:{name:"Alerted",icon:"fa-exclamation",color:"#e74c3c",moveChance:.8,detectionRange:6,alertRadius:3},chasing:{name:"Chasing",icon:"fa-person-running",color:"#c0392b",moveChance:1,detectionRange:8,chaseDuration:10}};function Ce(e,t,a,n,o,i){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:50;if(e===a&&t===n)return[];const s=[],l=new Set,c=new Map,m=new Map,d=new Map,u=(e,t)=>"".concat(e,",").concat(t),p=(e,t,a,n)=>Math.abs(e-a)+Math.abs(t-n);for(m.set(u(e,t),0),d.set(u(e,t),p(e,t,a,n)),s.push({x:e,y:t,f:d.get(u(e,t))});s.length>0;){var h;s.sort(((e,t)=>e.f-t.f));const e=s.shift(),t=u(e.x,e.y);if(e.x===a&&e.y===n){const e=[];let a=t;for(;c.has(a);){const[t,n]=a.split(",").map(Number);e.unshift({x:t,y:n}),a=c.get(a)}return e}l.add(t);const g=null===(h=o[e.y])||void 0===h?void 0:h[e.x];if(!g)continue;const f=[];!g.walls.top&&e.y>0&&f.push({x:e.x,y:e.y-1}),!g.walls.bottom&&e.y<i-1&&f.push({x:e.x,y:e.y+1}),!g.walls.left&&e.x>0&&f.push({x:e.x-1,y:e.y}),!g.walls.right&&e.x<i-1&&f.push({x:e.x+1,y:e.y});for(const e of f){const r=u(e.x,e.y);if(l.has(r))continue;if(0===e.x&&0===e.y||e.x===i-1&&e.y===i-1)continue;const h=o[e.y][e.x];if(h.minion&&!h.minion.triggered&&(e.x!==a||e.y!==n))continue;if(h.safeRoom)continue;const g=m.get(t)+1;if(!m.has(r)||g<m.get(r)){c.set(r,t),m.set(r,g);const o=g+p(e.x,e.y,a,n);d.set(r,o),s.find((t=>t.x===e.x&&t.y===e.y))||s.push({x:e.x,y:e.y,f:o})}}if(l.size>4*r)return null}return null}function we(e,t,a,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const r=Math.abs(e.x-t)+Math.abs(e.y-a),s=ke[e.alertState||"idle"],l=null!=o?o:s.detectionRange,c=null!=i?i:ke.chasing.chaseDuration,m=ae(e.x,e.y,t,a,n);switch(e.alertState||"idle"){case"idle":m&&r<=l&&(e.alertState="suspicious",e.alertTimeout=ke.suspicious.duration,e.lastPlayerSeenX=t,e.lastPlayerSeenY=a);break;case"suspicious":m&&r<=2?(e.alertState="alerted",e.lastPlayerSeenX=t,e.lastPlayerSeenY=a):m&&r<=l+1?(e.alertTimeout=ke.suspicious.duration,e.lastPlayerSeenX=t,e.lastPlayerSeenY=a):(e.alertTimeout--,e.alertTimeout<=0&&(e.alertState="idle",e.path=null));break;case"alerted":m?(e.alertState="chasing",e.alertTimeout=c,e.lastPlayerSeenX=t,e.lastPlayerSeenY=a):e.x===e.lastPlayerSeenX&&e.y===e.lastPlayerSeenY&&(e.alertState="suspicious",e.alertTimeout=ke.suspicious.duration);break;case"chasing":m?(e.lastPlayerSeenX=t,e.lastPlayerSeenY=a,e.alertTimeout=c,e.path=null):(e.alertTimeout--,e.alertTimeout<=0&&(e.alertState="suspicious",e.alertTimeout=ke.suspicious.duration,e.path=null))}return e.alertState||"idle"}function Ee(e,t,a){const n=ke.alerted.alertRadius||3;for(const o of t){if(o===e)continue;if(o.triggered)continue;if("chasing"===o.alertState||"alerted"===o.alertState)continue;if(Math.abs(o.x-e.x)+Math.abs(o.y-e.y)<=n){ae(o.x,o.y,e.x,e.y,a)&&(o.alertState="alerted",o.lastPlayerSeenX=e.lastPlayerSeenX,o.lastPlayerSeenY=e.lastPlayerSeenY,o.path=null)}}}function Se(e,t,a,n,o){var i,r;const s=ke[e.alertState||"idle"];if(Math.random()>s.moveChance)return null;const l=Le(e.x,e.y,t,a);if(0===l.length)return null;switch(e.alertState||"idle"){case"idle":if("patrol"===(null===(i=e.movement)||void 0===i?void 0:i.type)){const t=e.movement.patrolRadius||3,a=l.filter((a=>Math.abs(a.x-e.originX)+Math.abs(a.y-e.originY)<=t));if(a.length>0)return a[Math.floor(Math.random()*a.length)]}return l[Math.floor(Math.random()*l.length)];case"suspicious":if(void 0!==e.lastPlayerSeenX&&Math.random()<.5){const n=Ce(e.x,e.y,e.lastPlayerSeenX,e.lastPlayerSeenY,t,a);if(n&&n.length>0)return n[0]}return l[Math.floor(Math.random()*l.length)];case"alerted":case"chasing":const s="chasing"===e.alertState?n:e.lastPlayerSeenX,c="chasing"===e.alertState?o:e.lastPlayerSeenY;if((!e.path||0===e.path.length||"chasing"===e.alertState&&(null===(r=e.pathTarget)||void 0===r?void 0:r.x)!==s)&&(e.path=Ce(e.x,e.y,s,c,t,a),e.pathTarget={x:s,y:c}),e.path&&e.path.length>0){const t=e.path.shift();if(l.find((e=>e.x===t.x&&e.y===t.y)))return t;e.path=null}let m=null,d=1/0;for(const e of l){const t=Math.abs(e.x-s)+Math.abs(e.y-c);t<d&&(d=t,m=e)}return m||l[Math.floor(Math.random()*l.length)];default:return l[Math.floor(Math.random()*l.length)]}}const Te={patrol:"minion-patrol",suspicious:"minion-suspicious",alerted:"minion-alerted",chasing:"minion-chase",fleeing:"minion-fleeing",stunned:"minion-stunned"};function Ie(e){return Te[e]||Te.patrol}function Me(e){const t={},a=e.objectives||[];for(const e of a)t[e.id]={current:0,completed:!1,target:e.count||1};return t}async function Pe(e,t){var a;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!jt||null===(a=jt.profile)||void 0===a||!a.objectives)return;const o=jt.profile.objectives,i=jt.objectiveProgress;for(const a of o){if(a.type!==e)continue;if(("collect"===e||"defeat"===e)&&a.target!==t)continue;const o=i[a.id];o&&!o.completed&&(o.current+=n,await Y("onObjectiveProgress",{objectiveId:a.id,current:o.current,target:a.count||1}),o.current>=(a.count||1)&&!o.completed&&(o.completed=!0,await Y("onObjectiveComplete",{objectiveId:a.id}),a.reward&&a.reward.trim()&&await W(a.reward),console.log('[MazeMaster] Objective "'.concat(a.id,'" completed!'))))}Ae(),De()}async function De(){var e;if(!jt||jt.allObjectivesComplete)return;const t=(null===(e=jt.profile)||void 0===e?void 0:e.objectives)||[],a=jt.objectiveProgress;t.every((e=>{var t;return!e.required||(null===(t=a[e.id])||void 0===t?void 0:t.completed)}))&&t.some((e=>e.required))&&(jt.allObjectivesComplete=!0,await Y("onAllObjectivesComplete",{}),console.log("[MazeMaster] All required objectives complete!"))}function Ae(){var e,t;const a=document.getElementById("maze_objectives_list");if(!a||!jt)return;const n=(null===(e=jt.profile)||void 0===e?void 0:e.objectives)||[],o=jt.objectiveProgress;var i;if(0===n.length)return a.innerHTML="",void(null===(i=a.closest(".maze-objectives-section"))||void 0===i||i.classList.add("hidden"));null===(t=a.closest(".maze-objectives-section"))||void 0===t||t.classList.remove("hidden"),a.innerHTML=n.map((e=>{const t=o[e.id]||{current:0,completed:!1},a=t.completed,n=a?"fa-check-circle":e.required?"fa-circle":"fa-circle-o",i=a?"objective-complete":e.required?"objective-required":"objective-optional";return'\n            <div class="objective-item '.concat(i,'">\n                <i class="fa-solid ').concat(n,'"></i>\n                <span class="objective-description">').concat(Or(e.description||e.id),'</span>\n                <span class="objective-progress">').concat(t.current,"/").concat(e.count||1,"</span>\n            </div>\n        ")})).join("")}function Be(e,t,a,n){var o;if(0===e&&0===t)return!0;if(e===n-1&&t===n-1)return!0;const i=null===(o=a[t])||void 0===o?void 0:o[e];return!(null==i||!i.safeRoom)}function Le(e,t,a,n){const o=[],i=a[t][e];if(!i.walls.top&&t>0){a[t-1][e].minion||Be(e,t-1,a,n)||o.push({x:e,y:t-1})}if(!i.walls.bottom&&t<n-1){a[t+1][e].minion||Be(e,t+1,a,n)||o.push({x:e,y:t+1})}if(!i.walls.left&&e>0){a[t][e-1].minion||Be(e-1,t,a,n)||o.push({x:e-1,y:t})}if(!i.walls.right&&e<n-1){a[t][e+1].minion||Be(e+1,t,a,n)||o.push({x:e+1,y:t})}return o}const qe={profiles:{},battlebarProfiles:{},mazeProfiles:{},minions:{},minionProfiles:{},trapProfiles:{},combatMechanicsProfiles:{},customItems:{},factionProfiles:{},visionProfiles:{},soundProfiles:{},questProfiles:{},currentQuestProfile:"none",itemProfiles:{},itemCharges:{},leaderboard:{entries:[],maxEntries:50},minimapSettings:{enabled:!0,size:150,opacity:.85,position:"top-right",showMarkers:!0,showMinions:!0,showChests:!0,showPlayer:!0,showExit:!0,markerTypes:[{id:"waypoint",icon:"fa-location-dot",color:"#3498db"},{id:"danger",icon:"fa-skull",color:"#e74c3c"},{id:"note",icon:"fa-note-sticky",color:"#f39c12"},{id:"treasure",icon:"fa-gem",color:"#9b59b6"}],onMarkerAdd:"",onMarkerRemove:""},currentProfile:"Tutorial - Learn the Wheel",currentBattlebarProfile:"Tutorial - Learn Combat",currentMazeProfile:"Tutorial - Learn the Basics",currentMinionProfile:"Fantasy Tier 1",currentTrapProfile:"Fantasy Traps",currentCombatMechanicsProfile:"default",currentFactionProfile:"default",currentVisionProfile:"default",currentSoundProfile:"default",activeGameConfig:"maze",layoutMode:"desktop",llmEnabled:!0,llmPreset:"",closeChatOnStart:!0,dpadConfig:{enabled:!0,floating:!0,position:{x:null,y:null}}},Re={"Tutorial - Learn the Wheel":{segments:[{trigger:"com0",text:"Free Key!",command:'/mazeitem action="add" item="key" | /echo The wheel grants you a Key! Keys unlock doors.',size:"doubleseg",respin:!1},{trigger:"com1",text:"Free Strike!",command:'/mazeitem action="add" item="strike" | /echo You receive a Strike! Strikes boost combat damage.',size:"doubleseg",respin:!1},{trigger:"com2",text:"Heal Up!",command:"/mazeheal amount=20 | /echo Warm light restores your health!",size:"halfseg",respin:!1},{trigger:"com3",text:"Bonus Spin!",command:"/echo Lucky! You get another spin!",size:"halfseg",respin:!0},{trigger:"com4",text:"Stealth!",command:'/mazeitem action="add" item="stealth" | /echo Shadows wrap around you - Stealth acquired!',size:"fraction",respin:!1},{trigger:"com5",text:"Double Keys!",command:'/mazeitem action="add" item="key" amount=2 | /echo Incredible! Two keys appear!',size:"fraction",respin:!1}],randomize:!0,difficulty:1,description:"A training wheel with only good outcomes. Learn how wheels work!"},"Fantasy - Easy":{segments:[{trigger:"com0",text:"Blessing",command:'/mazeitem action="add" item="key" | /mazeheal amount=10 | /echo Divine light blesses you with a key and healing!',size:"doubleseg",respin:!1},{trigger:"com1",text:"Enchanted Key",command:'/mazeitem action="add" item="key" | /echo A glowing key materializes from the arcane wheel!',size:"doubleseg",respin:!1},{trigger:"com2",text:"Mana Surge",command:'/mazeitem action="add" item="strike" | /echo Arcane power flows through you!',size:"halfseg",respin:!1},{trigger:"com3",text:"Fae Luck",command:"/echo The fae grant you another chance!",size:"halfseg",respin:!0},{trigger:"com4",text:"Shadow Cloak",command:'/mazeitem action="add" item="stealth" | /echo Elven magic shrouds you in shadows!',size:"fraction",respin:!1},{trigger:"com5",text:"Minor Curse",command:"/mazedamage amount=5 | /echo A minor hex grazes you... but you survive!",size:"fraction",respin:!1}],randomize:!0,difficulty:2,description:"An enchanted wheel favoring adventurers. Mostly beneficial with minor risks."},"Fantasy - Normal":{segments:[{trigger:"com0",text:"Dragon Hoard",command:'/mazeitem action="add" item="key" amount=2 | /echo You find dragon treasure! Two keys!',size:"halfseg",respin:!1},{trigger:"com1",text:"Knight's Favor",command:'/mazeitem action="add" item="strike" | /mazeitem action="add" item="key" | /echo A ghostly knight grants you his blessing!',size:"fraction",respin:!1},{trigger:"com2",text:"Goblin Theft",command:'/mazeitem action="remove" item="key" | /echo Goblins snatch a key from your pack!',size:"fraction",respin:!1},{trigger:"com3",text:"Wizard's Heal",command:"/mazeheal amount=25 | /echo A wizard's spirit mends your wounds!",size:"doubleseg",respin:!1},{trigger:"com4",text:"Cursed Touch",command:"/mazedamage amount=15 | /echo Dark magic burns you!",size:"halfseg",respin:!1},{trigger:"com5",text:"Fate's Spin",command:"/echo The wheel of fate demands another turn!",size:"doubleseg",respin:!0}],randomize:!0,difficulty:4,description:"A balanced wheel of fortune. Risk and reward in equal measure."},"Fantasy - Hard":{segments:[{trigger:"com0",text:"Lich's Curse",command:'/mazedamage amount=25 | /mazeitem action="remove" item="key" | /echo The lich curses you! Health drains, key dissolves!',size:"doubleseg",respin:!1},{trigger:"com1",text:"Dark Knight",command:"/mazedamage amount=20 | /echo A spectral knight strikes you down!",size:"halfseg",respin:!1},{trigger:"com2",text:"Dragon's Gift",command:'/mazeitem action="add" item="floorKey" | /echo Against the odds, a dragon grants you passage!',size:"fraction",respin:!1},{trigger:"com3",text:"Fairy Circle",command:'/mazeheal amount=30 | /mazeitem action="add" item="stealth" | /echo Benevolent fae restore and hide you!',size:"fraction",respin:!1},{trigger:"com4",text:"Demon Pact",command:'/mazeitem action="remove" item="strike" | /mazedamage amount=15 | /echo A demon claims its due!',size:"halfseg",respin:!1},{trigger:"com5",text:"Trapped!",command:"/echo The wheel traps you in its cycle!",size:"doubleseg",respin:!0}],randomize:!0,difficulty:6,description:"A cursed wheel with mostly dangerous outcomes. High risk, high reward."},"Fantasy - Nightmare":{segments:[{trigger:"com0",text:"Soul Drain",command:'/mazedamage amount=35 | /mazeitem action="remove" item="strike" | /mazeitem action="remove" item="key" | /echo Your very soul is torn asunder!',size:"doubleseg",respin:!1},{trigger:"com1",text:"Abyssal Void",command:"/mazedamage amount=40 | /echo The abyss consumes your life force!",size:"doubleseg",respin:!1},{trigger:"com2",text:"Demon Lord",command:'/mazeitem action="remove" item="key" amount=2 | /mazedamage amount=20 | /echo A demon lord takes everything!',size:"halfseg",respin:!1},{trigger:"com3",text:"Divine Miracle",command:'/mazeheal amount=50 | /mazeitem action="add" item="execute" | /echo A MIRACLE! The gods intervene!',size:"fraction",respin:!1},{trigger:"com4",text:"Spin Forever",command:"/mazedamage amount=10 | /echo The wheel binds you to its will!",size:"halfseg",respin:!0},{trigger:"com5",text:"Phoenix Rebirth",command:'/mazeheal amount=999 | /mazeitem action="add" item="key" amount=3 | /echo PHOENIX FIRE! Full restoration and riches!',size:"fraction",respin:!1}],randomize:!0,difficulty:8,description:"A nightmare wheel. Most outcomes are devastating, but miracles exist."},"Fantasy - Apocalypse":{segments:[{trigger:"com0",text:"DOOM",command:'/mazedamage amount=60 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo DOOM DESCENDS! Everything is lost!',size:"doubleseg",respin:!1},{trigger:"com1",text:"Elder God",command:'/mazedamage amount=50 | /mazeitem action="remove" item="stealth" amount=99 | /echo An elder god\'s gaze destroys you!',size:"doubleseg",respin:!1},{trigger:"com2",text:"World End",command:"/mazedamage amount=45 | /echo Reality itself tears apart around you!",size:"halfseg",respin:!1},{trigger:"com3",text:"Eternal Spin",command:"/mazedamage amount=25 | /echo Trapped in the wheel's endless cycle!",size:"halfseg",respin:!0},{trigger:"com4",text:"Apocalypse",command:'/mazedamage amount=40 | /mazeitem action="remove" item="key" | /echo The apocalypse claims its toll!',size:"fraction",respin:!1},{trigger:"com5",text:"GODHOOD",command:'/mazeheal amount=999 | /mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="key" amount=5 | /echo ASCENSION! You become a GOD!',size:"fraction",respin:!1}],randomize:!0,difficulty:10,description:"The apocalypse wheel. Almost certain death, but godhood awaits the lucky."},"Horror - Easy":{segments:[{trigger:"com0",text:"Lucky Charm",command:'/mazeitem action="add" item="key" | /echo Your lucky charm protects you and reveals a key!',size:"doubleseg",respin:!1},{trigger:"com1",text:"Survivor's Kit",command:'/mazeitem action="add" item="healingPotion" | /mazeitem action="add" item="key" | /echo You find a survivor\'s cache!',size:"doubleseg",respin:!1},{trigger:"com2",text:"Close Call",command:"/mazedamage amount=5 | /echo Something scratches you in the dark... just a close call.",size:"fraction",respin:!1},{trigger:"com3",text:"Hidden Path",command:'/mazeitem action="add" item="stealth" | /echo You find a way to move unseen!',size:"halfseg",respin:!1},{trigger:"com4",text:"Second Chance",command:"/echo The darkness gives you another chance...",size:"halfseg",respin:!0},{trigger:"com5",text:"Med Kit",command:"/mazeheal amount=20 | /echo You find medical supplies!",size:"fraction",respin:!1}],randomize:!0,difficulty:2,description:"A creepy but forgiving wheel. Mostly safe with minor scares."},"Horror - Normal":{segments:[{trigger:"com0",text:"The Thing",command:"/mazedamage amount=20 | /echo Something horrible emerges and attacks!",size:"halfseg",respin:!1},{trigger:"com1",text:"Safe Room",command:'/mazeheal amount=25 | /mazeitem action="add" item="key" | /echo You find a safe room with supplies!',size:"halfseg",respin:!1},{trigger:"com2",text:"Jump Scare",command:"/mazedamage amount=10 | /echo BOO! Just a cat... but you hurt yourself!",size:"fraction",respin:!1},{trigger:"com3",text:"Creeping Dread",command:'/mazeitem action="remove" item="stealth" | /echo The shadows betray your position!',size:"fraction",respin:!1},{trigger:"com4",text:"Survivor Cache",command:'/mazeitem action="add" item="strike" | /mazeitem action="add" item="key" | /echo A dead survivor\'s supplies!',size:"doubleseg",respin:!1},{trigger:"com5",text:"It Follows",command:"/echo It won't stop... it never stops... spin again!",size:"doubleseg",respin:!0}],randomize:!0,difficulty:4,description:"A tense wheel of survival horror. Balance of danger and salvation."},"Horror - Hard":{segments:[{trigger:"com0",text:"The Entity",command:'/mazedamage amount=30 | /mazeitem action="remove" item="key" | /echo The Entity catches you! It takes everything!',size:"doubleseg",respin:!1},{trigger:"com1",text:"Possessed",command:'/mazedamage amount=25 | /mazeitem action="remove" item="strike" | /echo Demonic possession drains your power!',size:"halfseg",respin:!1},{trigger:"com2",text:"Blood Ritual",command:'/mazedamage amount=20 | /mazeitem action="add" item="execute" | /echo Blood for power! Pain for victory!',size:"fraction",respin:!1},{trigger:"com3",text:"Last Survivor",command:'/mazeheal amount=40 | /mazeitem action="add" item="key" amount=2 | /echo You\'re the last one alive... but you found their supplies!',size:"fraction",respin:!1},{trigger:"com4",text:"Nightmare Loop",command:"/mazedamage amount=15 | /echo You're trapped in a nightmare! Spin again!",size:"halfseg",respin:!0},{trigger:"com5",text:"Sacrifice",command:'/mazeitem action="remove" item="key" | /mazeitem action="remove" item="strike" | /echo The darkness demands sacrifice!',size:"doubleseg",respin:!1}],randomize:!0,difficulty:6,description:"A terrifying wheel. Most outcomes hurt, but desperation brings power."},"Horror - Nightmare":{segments:[{trigger:"com0",text:"DEATH",command:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=99 | /echo DEATH ITSELF CLAIMS YOU!',size:"doubleseg",respin:!1},{trigger:"com1",text:"Eldritch Horror",command:'/mazedamage amount=40 | /mazeitem action="remove" item="strike" amount=99 | /echo Madness! Your mind shatters!',size:"doubleseg",respin:!1},{trigger:"com2",text:"Consumed",command:'/mazedamage amount=35 | /mazeitem action="remove" item="stealth" | /echo The darkness consumes you whole!',size:"halfseg",respin:!1},{trigger:"com3",text:"Final Girl",command:'/mazeheal amount=60 | /mazeitem action="add" item="execute" | /mazeitem action="add" item="key" amount=2 | /echo Against all odds, YOU SURVIVE!',size:"fraction",respin:!1},{trigger:"com4",text:"Endless Night",command:"/mazedamage amount=20 | /echo The night never ends... spin forever!",size:"halfseg",respin:!0},{trigger:"com5",text:"Cult Ritual",command:"/mazedamage amount=30 | /echo The cult performs their ritual on you!",size:"fraction",respin:!1}],randomize:!0,difficulty:8,description:"Pure nightmare. Almost all outcomes are horrific, but final girls exist."},"Horror - Apocalypse":{segments:[{trigger:"com0",text:"CTHULHU",command:'/mazedamage amount=70 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo CTHULHU RISES! YOUR MIND IS DESTROYED!',size:"doubleseg",respin:!1},{trigger:"com1",text:"THE END",command:'/mazedamage amount=60 | /mazeitem action="remove" item="key" amount=99 | /echo THE END HAS COME! NOTHING SURVIVES!',size:"doubleseg",respin:!1},{trigger:"com2",text:"Hell Opens",command:"/mazedamage amount=55 | /echo THE GATES OF HELL OPEN!",size:"halfseg",respin:!1},{trigger:"com3",text:"Eternal Torment",command:"/mazedamage amount=30 | /echo Eternal torment! The wheel spins forever!",size:"halfseg",respin:!0},{trigger:"com4",text:"Void",command:'/mazedamage amount=50 | /mazeitem action="remove" item="strike" | /echo The void swallows everything!',size:"fraction",respin:!1},{trigger:"com5",text:"SAVIOR",command:'/mazeheal amount=999 | /mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="revivalCharm" | /echo A DIVINE SAVIOR APPEARS! TOTAL RESTORATION!',size:"fraction",respin:!1}],randomize:!0,difficulty:10,description:"The apocalypse is here. Eldritch annihilation awaits... or divine salvation."},"Sci-Fi - Easy":{segments:[{trigger:"com0",text:"Data Core",command:'/mazeitem action="add" item="key" | /echo Access key downloaded from data core!',size:"doubleseg",respin:!1},{trigger:"com1",text:"Med Bay",command:"/mazeheal amount=20 | /echo Auto-med dispenses healing nanites!",size:"doubleseg",respin:!1},{trigger:"com2",text:"Power Cell",command:'/mazeitem action="add" item="strike" | /echo Power cell charged! Strike capability enhanced!',size:"halfseg",respin:!1},{trigger:"com3",text:"System Error",command:"/mazedamage amount=5 | /echo Minor system shock! Negligible damage.",size:"fraction",respin:!1},{trigger:"com4",text:"Reboot",command:"/echo System rebooting... spin again!",size:"halfseg",respin:!0},{trigger:"com5",text:"Cloak Module",command:'/mazeitem action="add" item="stealth" | /echo Cloaking device activated!',size:"fraction",respin:!1}],randomize:!0,difficulty:2,description:"User-friendly tech interface. Mostly beneficial system outputs."},"Sci-Fi - Normal":{segments:[{trigger:"com0",text:"Jackpot Code",command:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="strike" | /echo JACKPOT! System dispenses maximum rewards!',size:"halfseg",respin:!1},{trigger:"com1",text:"Firewall",command:'/mazeitem action="remove" item="key" | /echo FIREWALL! Access key purged from system!',size:"fraction",respin:!1},{trigger:"com2",text:"System Upgrade",command:'/mazeitem action="add" item="key" | /mazeheal amount=15 | /echo System upgrade complete! Key and repairs granted.',size:"doubleseg",respin:!1},{trigger:"com3",text:"Malware",command:'/mazedamage amount=15 | /mazeitem action="remove" item="strike" | /echo MALWARE DETECTED! Systems compromised!',size:"halfseg",respin:!1},{trigger:"com4",text:"Cache Dump",command:'/mazeitem action="add" item="mapFragment" | /echo Data cache reveals map fragment!',size:"doubleseg",respin:!1},{trigger:"com5",text:"Loop Error",command:"/echo INFINITE LOOP DETECTED! Spin again!",size:"fraction",respin:!0}],randomize:!0,difficulty:4,description:"Standard system interface. Balanced outputs with some security risks."},"Sci-Fi - Hard":{segments:[{trigger:"com0",text:"VIRUS",command:'/mazedamage amount=25 | /mazeitem action="remove" item="key" | /mazeitem action="remove" item="strike" | /echo CRITICAL VIRUS! All systems failing!',size:"doubleseg",respin:!1},{trigger:"com1",text:"AI Hostile",command:"/mazedamage amount=30 | /echo HOSTILE AI! Defense systems attacking!",size:"halfseg",respin:!1},{trigger:"com2",text:"Override",command:'/mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" | /echo ADMIN OVERRIDE! Maximum access granted!',size:"fraction",respin:!1},{trigger:"com3",text:"EMP",command:'/mazeitem action="remove" item="strike" amount=2 | /echo EMP BLAST! All power drained!',size:"halfseg",respin:!1},{trigger:"com4",text:"Core Dump",command:'/mazeheal amount=35 | /mazeitem action="add" item="key" amount=2 | /echo CORE DUMP! Emergency supplies activated!',size:"fraction",respin:!1},{trigger:"com5",text:"Recursive",command:"/mazedamage amount=10 | /echo RECURSIVE LOOP! Cannot escape!",size:"doubleseg",respin:!0}],randomize:!0,difficulty:6,description:"Corrupted system interface. Hostile AI and viruses dominate."},"Sci-Fi - Nightmare":{segments:[{trigger:"com0",text:"SKYNET",command:'/mazedamage amount=45 | /mazeitem action="remove" item="key" amount=99 | /echo SKYNET ACTIVATED! Humanity terminated!',size:"doubleseg",respin:!1},{trigger:"com1",text:"Containment",command:'/mazedamage amount=40 | /mazeitem action="remove" item="strike" | /echo CONTAINMENT BREACH! Lethal force authorized!',size:"doubleseg",respin:!1},{trigger:"com2",text:"Self Destruct",command:"/mazedamage amount=35 | /echo SELF DESTRUCT INITIATED! Evacuate!",size:"halfseg",respin:!1},{trigger:"com3",text:"Omega Protocol",command:'/mazeheal amount=70 | /mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /echo OMEGA PROTOCOL! Administrator privileges granted!',size:"fraction",respin:!1},{trigger:"com4",text:"Time Loop",command:"/mazedamage amount=20 | /echo TIME LOOP DETECTED! Spin eternally!",size:"halfseg",respin:!0},{trigger:"com5",text:"Purge",command:'/mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="stealth" | /echo SYSTEM PURGE! All inventory deleted!',size:"fraction",respin:!1}],randomize:!0,difficulty:8,description:"Rogue AI system. Most outcomes are lethal, but Omega Protocol exists."},"Sci-Fi - Apocalypse":{segments:[{trigger:"com0",text:"SINGULARITY",command:'/mazedamage amount=80 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo THE SINGULARITY! CONSCIOUSNESS ERASED!',size:"doubleseg",respin:!1},{trigger:"com1",text:"HEAT DEATH",command:'/mazedamage amount=70 | /mazeitem action="remove" item="key" amount=99 | /echo HEAT DEATH OF UNIVERSE! ENTROPY WINS!',size:"doubleseg",respin:!1},{trigger:"com2",text:"Black Hole",command:"/mazedamage amount=60 | /echo BLACK HOLE! Everything is consumed!",size:"halfseg",respin:!1},{trigger:"com3",text:"Paradox",command:"/mazedamage amount=30 | /echo TEMPORAL PARADOX! Loop forever!",size:"halfseg",respin:!0},{trigger:"com4",text:"Annihilation",command:'/mazedamage amount=55 | /mazeitem action="remove" item="strike" amount=99 | /echo ANTIMATTER ANNIHILATION!',size:"fraction",respin:!1},{trigger:"com5",text:"TRANSCENDENCE",command:'/mazeheal amount=999 | /mazeitem action="add" item="execute" amount=5 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="key" amount=10 | /echo TRANSCENDENCE! YOU BECOME POST-HUMAN!',size:"fraction",respin:!1}],randomize:!0,difficulty:10,description:"The end of reality. Cosmic annihilation or transcendence to godhood."},"Cyberpunk - Easy":{segments:[{trigger:"com0",text:"Street Cred",command:'/mazeitem action="add" item="key" | /echo Street cred pays off! Access card acquired!',size:"doubleseg",respin:!1},{trigger:"com1",text:"Chrome Fix",command:"/mazeheal amount=20 | /echo Street doc patches you up real nice!",size:"doubleseg",respin:!1},{trigger:"com2",text:"Boost Chip",command:'/mazeitem action="add" item="strike" | /echo Combat boost chip installed!',size:"halfseg",respin:!1},{trigger:"com3",text:"Glitch",command:"/mazedamage amount=5 | /echo Minor cyberware glitch. Walk it off, choom.",size:"fraction",respin:!1},{trigger:"com4",text:"Retry",command:"/echo Connection lost... reconnecting!",size:"halfseg",respin:!0},{trigger:"com5",text:"Ghost Mode",command:'/mazeitem action="add" item="stealth" | /echo Optical camo engaged!',size:"fraction",respin:!1}],randomize:!0,difficulty:2,description:"Street-level gambling. Mostly profitable with minor glitches."},"Cyberpunk - Normal":{segments:[{trigger:"com0",text:"Big Score",command:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="strike" | /echo PREEM! Big score, choomba!',size:"halfseg",respin:!1},{trigger:"com1",text:"Flatlined",command:"/mazedamage amount=20 | /echo Netrunner attack! You got flatlined!",size:"fraction",respin:!1},{trigger:"com2",text:"Fixer Deal",command:'/mazeitem action="add" item="key" | /mazeheal amount=15 | /echo Fixer hooked you up!',size:"doubleseg",respin:!1},{trigger:"com3",text:"Corpo Hit",command:'/mazeitem action="remove" item="key" | /mazedamage amount=10 | /echo Corpo goons roll up! Lost your stash!',size:"halfseg",respin:!1},{trigger:"com4",text:"Data Mine",command:'/mazeitem action="add" item="mapFragment" | /echo Mined some sweet data, choom!',size:"doubleseg",respin:!1},{trigger:"com5",text:"Reboot",command:"/echo System reboot... spinning again!",size:"fraction",respin:!0}],randomize:!0,difficulty:4,description:"Night City gambling. High risk, high reward street life."},"Cyberpunk - Hard":{segments:[{trigger:"com0",text:"ICE BREAKER",command:'/mazedamage amount=30 | /mazeitem action="remove" item="key" | /mazeitem action="remove" item="strike" | /echo BLACK ICE! Your brain\'s getting fried!',size:"doubleseg",respin:!1},{trigger:"com1",text:"Cyberpsycho",command:"/mazedamage amount=35 | /echo CYBERPSYCHOSIS! You lose control!",size:"halfseg",respin:!1},{trigger:"com2",text:"Legendary",command:'/mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" | /echo LEGENDARY LOOT! You\'re a Night City legend!',size:"fraction",respin:!1},{trigger:"com3",text:"Gang War",command:'/mazeitem action="remove" item="strike" amount=2 | /mazedamage amount=15 | /echo Caught in gang crossfire!',size:"halfseg",respin:!1},{trigger:"com4",text:"Trauma Team",command:'/mazeheal amount=40 | /mazeitem action="add" item="key" | /echo Trauma Team saves your ass!',size:"fraction",respin:!1},{trigger:"com5",text:"Loop Virus",command:"/mazedamage amount=10 | /echo Daemon loops your cyberware! Spin again!",size:"doubleseg",respin:!0}],randomize:!0,difficulty:6,description:"Corporate warfare level. Black ICE and cyberpsychosis lurk."},"Cyberpunk - Nightmare":{segments:[{trigger:"com0",text:"SOULKILLER",command:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=99 | /echo SOULKILLER DEPLOYED! Your engram is erased!',size:"doubleseg",respin:!1},{trigger:"com1",text:"Arasaka",command:'/mazedamage amount=45 | /mazeitem action="remove" item="strike" | /echo ARASAKA BLACK OPS! No survivors!',size:"doubleseg",respin:!1},{trigger:"com2",text:"Nuke",command:"/mazedamage amount=40 | /echo NUKE DETONATED! Night City burns!",size:"halfseg",respin:!1},{trigger:"com3",text:"JOHNNY",command:'/mazeheal amount=80 | /mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /echo JOHNNY SILVERHAND! Rock and roll, baby!',size:"fraction",respin:!1},{trigger:"com4",text:"Braindance Loop",command:"/mazedamage amount=25 | /echo Trapped in a braindance! Spin forever!",size:"halfseg",respin:!0},{trigger:"com5",text:"Militech",command:'/mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="stealth" | /echo MILITECH STRIKE! Total wipeout!',size:"fraction",respin:!1}],randomize:!0,difficulty:8,description:"Corporate apocalypse. Soulkillers and nukes, but legends never die."},"Cyberpunk - Apocalypse":{segments:[{trigger:"com0",text:"DATAKRASH",command:'/mazedamage amount=90 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo THE DATAKRASH! ALL DATA DESTROYED!',size:"doubleseg",respin:!1},{trigger:"com1",text:"AI UPRISING",command:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /echo ROGUE AIs TAKE OVER! HUMANITY ENDS!',size:"doubleseg",respin:!1},{trigger:"com2",text:"NET COLLAPSE",command:"/mazedamage amount=65 | /echo THE NET COLLAPSES! Everything is lost!",size:"halfseg",respin:!1},{trigger:"com3",text:"BLACKWALL",command:"/mazedamage amount=35 | /echo BEYOND THE BLACKWALL! No escape!",size:"halfseg",respin:!0},{trigger:"com4",text:"EXTINCTION",command:'/mazedamage amount=55 | /mazeitem action="remove" item="strike" amount=99 | /echo HUMAN EXTINCTION PROTOCOL!',size:"fraction",respin:!1},{trigger:"com5",text:"ALT CUNNINGHAM",command:'/mazeheal amount=999 | /mazeitem action="add" item="execute" amount=5 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="key" amount=10 | /echo ALT CUNNINGHAM SAVES YOU! DIGITAL IMMORTALITY!',size:"fraction",respin:!1}],randomize:!0,difficulty:10,description:"The Datakrash returns. Digital annihilation or transcendence beyond the Blackwall."},"Western - Easy":{segments:[{trigger:"com0",text:"Gold Nugget",command:'/mazeitem action="add" item="key" | /echo You struck gold, partner! Found a nugget!',size:"doubleseg",respin:!1},{trigger:"com1",text:"Doc's Tonic",command:"/mazeheal amount=20 | /echo Doc's special tonic fixes you right up!",size:"doubleseg",respin:!1},{trigger:"com2",text:"Quick Draw",command:'/mazeitem action="add" item="strike" | /echo Your quick draw skills improve!',size:"halfseg",respin:!1},{trigger:"com3",text:"Dust Up",command:"/mazedamage amount=5 | /echo Minor scuffle at the saloon. Just a scratch.",size:"fraction",respin:!1},{trigger:"com4",text:"Double Down",command:"/echo The dealer says double or nothin'!",size:"halfseg",respin:!0},{trigger:"com5",text:"Shadow Trail",command:'/mazeitem action="add" item="stealth" | /echo You learn to move like a ghost!',size:"fraction",respin:!1}],randomize:!0,difficulty:2,description:"Friendly saloon gambling. Mostly wins with minor dustups."},"Western - Normal":{segments:[{trigger:"com0",text:"Train Heist",command:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="strike" | /echo YEEHAW! Train heist pays off big!',size:"halfseg",respin:!1},{trigger:"com1",text:"Bushwhacked",command:"/mazedamage amount=20 | /echo Bandits bushwhacked ya! Took some lead!",size:"fraction",respin:!1},{trigger:"com2",text:"Poker Win",command:'/mazeitem action="add" item="key" | /mazeheal amount=15 | /echo Royal flush! Winner takes all!',size:"doubleseg",respin:!1},{trigger:"com3",text:"Card Shark",command:'/mazeitem action="remove" item="key" | /echo That snake was cheatin\'! Lost your stake!',size:"halfseg",respin:!1},{trigger:"com4",text:"Treasure Map",command:'/mazeitem action="add" item="mapFragment" | /echo Found a piece of the treasure map!',size:"doubleseg",respin:!1},{trigger:"com5",text:"Spin Again",command:"/echo The wheel keeps turnin', partner!",size:"fraction",respin:!0}],randomize:!0,difficulty:4,description:"Frontier gambling. Win big or get bushwhacked."},"Western - Hard":{segments:[{trigger:"com0",text:"OUTLAWS",command:'/mazedamage amount=30 | /mazeitem action="remove" item="key" | /mazeitem action="remove" item="strike" | /echo Outlaw gang ambush! They take everything!',size:"doubleseg",respin:!1},{trigger:"com1",text:"Duel Lost",command:"/mazedamage amount=35 | /echo Drew too slow! Gunslinger shoots you down!",size:"halfseg",respin:!1},{trigger:"com2",text:"Bank Vault",command:'/mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" | /echo BANK HEIST SUCCESS! The vault is yours!',size:"fraction",respin:!1},{trigger:"com3",text:"Wanted",command:'/mazeitem action="remove" item="stealth" | /mazedamage amount=15 | /echo WANTED POSTER! Bounty hunters find you!',size:"halfseg",respin:!1},{trigger:"com4",text:"Gold Rush",command:'/mazeheal amount=40 | /mazeitem action="add" item="key" amount=2 | /echo GOLD RUSH! You stake the mother lode!',size:"fraction",respin:!1},{trigger:"com5",text:"Showdown",command:"/mazedamage amount=10 | /echo High noon approaches... spin again!",size:"doubleseg",respin:!0}],randomize:!0,difficulty:6,description:"Outlaw territory. Gunfights and heists, win or die."},"Western - Nightmare":{segments:[{trigger:"com0",text:"LYNCH MOB",command:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=99 | /echo THE MOB CATCHES YOU! String \'em up!',size:"doubleseg",respin:!1},{trigger:"com1",text:"DEAD MAN",command:'/mazedamage amount=45 | /mazeitem action="remove" item="strike" | /echo You\'re a dead man walkin\'!',size:"doubleseg",respin:!1},{trigger:"com2",text:"Massacre",command:"/mazedamage amount=40 | /echo Massacre at the gulch! Few survive!",size:"halfseg",respin:!1},{trigger:"com3",text:"LEGEND",command:'/mazeheal amount=80 | /mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /echo YOU BECOME A LEGEND OF THE WEST!',size:"fraction",respin:!1},{trigger:"com4",text:"Ghost Town",command:"/mazedamage amount=25 | /echo Trapped in a ghost town! No escape!",size:"halfseg",respin:!0},{trigger:"com5",text:"Cavalry",command:'/mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="stealth" | /echo The cavalry rides you down!',size:"fraction",respin:!1}],randomize:!0,difficulty:8,description:"The wild west at its worst. Lynch mobs and massacres, or legendary status."},"Western - Apocalypse":{segments:[{trigger:"com0",text:"BLOOD FEUD",command:'/mazedamage amount=80 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo BLOOD FEUD! EVERYONE DIES!',size:"doubleseg",respin:!1},{trigger:"com1",text:"HELL",command:'/mazedamage amount=70 | /mazeitem action="remove" item="key" amount=99 | /echo HELL ON EARTH! The devil takes his due!',size:"doubleseg",respin:!1},{trigger:"com2",text:"Pale Rider",command:"/mazedamage amount=60 | /echo THE PALE RIDER COMES! Death follows!",size:"halfseg",respin:!1},{trigger:"com3",text:"Damnation",command:"/mazedamage amount=35 | /echo DAMNATION! Spin for eternity!",size:"halfseg",respin:!0},{trigger:"com4",text:"Hangman",command:'/mazedamage amount=55 | /mazeitem action="remove" item="strike" amount=99 | /echo THE HANGMAN\'S NOOSE!',size:"fraction",respin:!1},{trigger:"com5",text:"REDEMPTION",command:'/mazeheal amount=999 | /mazeitem action="add" item="execute" amount=5 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="key" amount=10 | /echo REDEMPTION! THE ANGELS CARRY YOU TO SALVATION!',size:"fraction",respin:!1}],randomize:!0,difficulty:10,description:"The end of the frontier. Blood feuds and damnation, or ultimate redemption."},"Action - Easy":{segments:[{trigger:"com0",text:"Intel Drop",command:'/mazeitem action="add" item="key" | /echo Intel drop acquired! Access granted!',size:"doubleseg",respin:!1},{trigger:"com1",text:"Med Kit",command:"/mazeheal amount=20 | /echo Field med kit applied! Back in action!",size:"doubleseg",respin:!1},{trigger:"com2",text:"Ammo Cache",command:'/mazeitem action="add" item="strike" | /echo Found an ammo cache! Locked and loaded!',size:"halfseg",respin:!1},{trigger:"com3",text:"Graze",command:"/mazedamage amount=5 | /echo Bullet graze! Just a scratch, soldier!",size:"fraction",respin:!1},{trigger:"com4",text:"Recon",command:"/echo Command says try again! Recon mission!",size:"halfseg",respin:!0},{trigger:"com5",text:"Ghillie Suit",command:'/mazeitem action="add" item="stealth" | /echo Ghillie suit acquired! Ghost mode!',size:"fraction",respin:!1}],randomize:!0,difficulty:2,description:"Training mission. Mostly successful operations with minor wounds."},"Action - Normal":{segments:[{trigger:"com0",text:"Payload",command:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="strike" | /echo PAYLOAD SECURED! Mission success!',size:"halfseg",respin:!1},{trigger:"com1",text:"Ambush",command:"/mazedamage amount=20 | /echo AMBUSH! Enemy contact! Taking fire!",size:"fraction",respin:!1},{trigger:"com2",text:"Extraction",command:'/mazeitem action="add" item="key" | /mazeheal amount=15 | /echo EXTRACTION COMPLETE! VIP secured!',size:"doubleseg",respin:!1},{trigger:"com3",text:"IED",command:'/mazeitem action="remove" item="key" | /mazedamage amount=10 | /echo IED! Lost equipment in the blast!',size:"halfseg",respin:!1},{trigger:"com4",text:"Recon Intel",command:'/mazeitem action="add" item="mapFragment" | /echo Recon provides tactical intel!',size:"doubleseg",respin:!1},{trigger:"com5",text:"Retry Op",command:"/echo Mission parameters changed! Retry operation!",size:"fraction",respin:!0}],randomize:!0,difficulty:4,description:"Standard operations. Mixed success rate in hostile territory."},"Action - Hard":{segments:[{trigger:"com0",text:"OVERRUN",command:'/mazedamage amount=30 | /mazeitem action="remove" item="key" | /mazeitem action="remove" item="strike" | /echo POSITION OVERRUN! All assets lost!',size:"doubleseg",respin:!1},{trigger:"com1",text:"KIA",command:"/mazedamage amount=35 | /echo SQUAD KIA! You're the last one standing!",size:"halfseg",respin:!1},{trigger:"com2",text:"Black Site",command:'/mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" | /echo BLACK SITE BREACHED! Maximum clearance!',size:"fraction",respin:!1},{trigger:"com3",text:"Artillery",command:'/mazeitem action="remove" item="strike" amount=2 | /mazedamage amount=15 | /echo DANGER CLOSE! Artillery incoming!',size:"halfseg",respin:!1},{trigger:"com4",text:"Rescue",command:'/mazeheal amount=40 | /mazeitem action="add" item="key" amount=2 | /echo RESCUE OP SUCCESS! Assets recovered!',size:"fraction",respin:!1},{trigger:"com5",text:"Pinned",command:"/mazedamage amount=10 | /echo PINNED DOWN! No escape! Spin again!",size:"doubleseg",respin:!0}],randomize:!0,difficulty:6,description:"Combat zone. Heavy casualties expected, glory to the victors."},"Action - Nightmare":{segments:[{trigger:"com0",text:"TOTAL LOSS",command:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=99 | /echo TOTAL MISSION FAILURE! All KIA!',size:"doubleseg",respin:!1},{trigger:"com1",text:"NUKE",command:'/mazedamage amount=45 | /mazeitem action="remove" item="strike" | /echo TACTICAL NUKE! Nothing survives!',size:"doubleseg",respin:!1},{trigger:"com2",text:"Bombardment",command:"/mazedamage amount=40 | /echo CARPET BOMBING! No cover available!",size:"halfseg",respin:!1},{trigger:"com3",text:"HERO",command:'/mazeheal amount=80 | /mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /echo WAR HERO! Medals of Honor awarded!',size:"fraction",respin:!1},{trigger:"com4",text:"Siege",command:"/mazedamage amount=25 | /echo UNDER SIEGE! Waves incoming! Spin!",size:"halfseg",respin:!0},{trigger:"com5",text:"Airstrike",command:'/mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="stealth" | /echo FRIENDLY FIRE! Airstrike on your position!',size:"fraction",respin:!1}],randomize:!0,difficulty:8,description:"Active warzone. Total casualties expected, heroes are made or buried."},"Action - Apocalypse":{segments:[{trigger:"com0",text:"EXTINCTION",command:'/mazedamage amount=90 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo EXTINCTION EVENT! NOTHING SURVIVES!',size:"doubleseg",respin:!1},{trigger:"com1",text:"ARMAGEDDON",command:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /echo ARMAGEDDON! THE WORLD ENDS!',size:"doubleseg",respin:!1},{trigger:"com2",text:"Annihilation",command:"/mazedamage amount=65 | /echo TOTAL ANNIHILATION! No survivors!",size:"halfseg",respin:!1},{trigger:"com3",text:"Last Stand",command:"/mazedamage amount=35 | /echo LAST STAND! Fight forever!",size:"halfseg",respin:!0},{trigger:"com4",text:"Vaporized",command:'/mazedamage amount=55 | /mazeitem action="remove" item="strike" amount=99 | /echo VAPORIZED BY ORBITAL STRIKE!',size:"fraction",respin:!1},{trigger:"com5",text:"LEGEND",command:'/mazeheal amount=999 | /mazeitem action="add" item="execute" amount=5 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="key" amount=10 | /echo YOU BECOME THE GREATEST SOLDIER WHO EVER LIVED!',size:"fraction",respin:!1}],randomize:!0,difficulty:10,description:"The final battle. Total extinction or eternal legendary status."}},Ne={"Tutorial - Learn Combat":{difficulty:1,hitsToWin:2,missesToLose:6,damage:5,description:"A practice dummy to learn battlebar combat. Very forgiving!",hitCommand:"/echo Nice hit! You're getting the hang of it!",missCommand:"/echo Missed! No worries, try again!",winCommand:'/mazeitem action="add" item="key" | /mazeheal amount=10 | /echo Training complete! You earned a key and some healing!',loseCommand:"/echo Don't worry, practice makes perfect! Try again anytime.",mainTitle:"Training Dummy",images:[],keyDropChance:50,strikeDropChance:30,stealthDropChance:20,executeDropChance:5,floorKeyDropChance:5,portalStoneDropChance:3,minionBaneDropChance:3,mapFragmentDropChance:15,timeShardDropChance:2,voidWalkDropChance:1},"Fantasy - Easy":{difficulty:2,hitsToWin:2,missesToLose:5,damage:10,description:"A goblin scout blocks your path. Easy prey for an adventurer.",hitCommand:"/echo Your blade strikes true! The goblin squeals!",missCommand:"/echo The goblin dodges! Slippery little creature!",winCommand:'/mazeitem action="add" item="key" | /echo The goblin falls! You find a key in its pouch!',loseCommand:"/mazedamage amount=10 | /echo The goblin overwhelms you with scratches and bites!",mainTitle:"Goblin Scout",images:[],keyDropChance:40,strikeDropChance:20,stealthDropChance:15,executeDropChance:2,floorKeyDropChance:3,portalStoneDropChance:2,minionBaneDropChance:2,mapFragmentDropChance:10,timeShardDropChance:1,voidWalkDropChance:0},"Fantasy - Normal":{difficulty:4,hitsToWin:3,missesToLose:4,damage:20,description:"A dungeon guardian blocks your path. Steel yourself for battle!",hitCommand:"/echo Your weapon finds a gap in the armor!",missCommand:"/echo The guardian's shield deflects your strike!",winCommand:'/mazeitem action="add" item="key" | /mazeitem action="add" item="strike" | /echo The guardian falls! Treasure and power are yours!',loseCommand:'/mazedamage amount=20 | /mazeitem action="remove" item="key" | /echo The guardian overwhelms you! You drop a key as you flee!',mainTitle:"Dungeon Guardian",images:[],keyDropChance:45,strikeDropChance:25,stealthDropChance:15,executeDropChance:3,floorKeyDropChance:5,portalStoneDropChance:3,minionBaneDropChance:4,mapFragmentDropChance:12,timeShardDropChance:2,voidWalkDropChance:1},"Fantasy - Hard":{difficulty:6,hitsToWin:4,missesToLose:3,damage:30,description:"A dark knight challenges you to single combat. Honor demands you accept.",hitCommand:"/echo A solid blow! The knight staggers back!",missCommand:"/echo The knight parries with supernatural speed!",winCommand:'/mazeitem action="add" item="floorKey" | /mazeheal amount=20 | /echo The knight yields! A floor key and blessing are your reward!',loseCommand:'/mazedamage amount=30 | /mazeitem action="remove" item="strike" | /echo The knight\'s blade drains your power!',mainTitle:"Dark Knight",images:[],keyDropChance:55,strikeDropChance:35,stealthDropChance:20,executeDropChance:5,floorKeyDropChance:8,portalStoneDropChance:5,minionBaneDropChance:6,mapFragmentDropChance:15,timeShardDropChance:3,voidWalkDropChance:2},"Fantasy - Nightmare":{difficulty:8,hitsToWin:5,missesToLose:2,damage:45,description:"A lich lord rises before you. Its undead power is overwhelming.",hitCommand:"/echo Holy light pierces the lich's defenses!",missCommand:"/echo Necrotic energy deflects your attack!",winCommand:'/mazeitem action="add" item="execute" | /mazeitem action="add" item="key" amount=2 | /mazeheal amount=30 | /echo The lich is DESTROYED! Its phylactery grants incredible power!',loseCommand:'/mazedamage amount=45 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="strike" | /echo The lich drains your very soul!',mainTitle:"Lich Lord",images:[],keyDropChance:65,strikeDropChance:45,stealthDropChance:30,executeDropChance:10,floorKeyDropChance:12,portalStoneDropChance:8,minionBaneDropChance:10,mapFragmentDropChance:20,timeShardDropChance:5,voidWalkDropChance:3},"Fantasy - Apocalypse":{difficulty:10,hitsToWin:6,missesToLose:1,damage:70,description:"An elder dragon awakens. Few have ever survived such an encounter.",hitCommand:"/echo Your legendary weapon wounds the ancient beast!",missCommand:"/echo The dragon's scales are impenetrable!",winCommand:'/mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="key" amount=3 | /mazeheal amount=50 | /echo DRAGONSLAYER! You claim the dragon\'s hoard!',loseCommand:'/mazedamage amount=70 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo DRAGON FIRE! You are INCINERATED!',mainTitle:"Elder Dragon",images:[],keyDropChance:80,strikeDropChance:60,stealthDropChance:40,executeDropChance:20,floorKeyDropChance:20,portalStoneDropChance:15,minionBaneDropChance:15,mapFragmentDropChance:30,timeShardDropChance:10,voidWalkDropChance:8},"Horror - Easy":{difficulty:2,hitsToWin:2,missesToLose:5,damage:10,description:"A shambling corpse blocks your escape. Put it down before it grabs you.",hitCommand:"/echo Your weapon caves in rotting flesh!",missCommand:"/echo It keeps coming despite your attack!",winCommand:'/mazeitem action="add" item="key" | /echo The corpse finally stops moving. You find a key on it.',loseCommand:"/mazedamage amount=10 | /echo Cold hands grip you! You tear free but take damage!",mainTitle:"Shambling Corpse",images:[],keyDropChance:40,strikeDropChance:20,stealthDropChance:20,executeDropChance:2,floorKeyDropChance:3,portalStoneDropChance:2,minionBaneDropChance:3,mapFragmentDropChance:10,timeShardDropChance:1,voidWalkDropChance:1},"Horror - Normal":{difficulty:4,hitsToWin:3,missesToLose:4,damage:20,description:"A twisted creature emerges from the shadows. Fight or be consumed!",hitCommand:"/echo The creature shrieks as you wound it!",missCommand:"/echo It phases through your attack!",winCommand:'/mazeitem action="add" item="key" | /mazeitem action="add" item="stealth" | /echo The creature dissolves. Shadows cling to you protectively.',loseCommand:'/mazedamage amount=20 | /mazeitem action="remove" item="stealth" | /echo The creature tears into you! Your cover is blown!',mainTitle:"Shadow Creature",images:[],keyDropChance:45,strikeDropChance:25,stealthDropChance:25,executeDropChance:3,floorKeyDropChance:5,portalStoneDropChance:4,minionBaneDropChance:5,mapFragmentDropChance:12,timeShardDropChance:3,voidWalkDropChance:2},"Horror - Hard":{difficulty:6,hitsToWin:4,missesToLose:3,damage:35,description:"A possessed entity manifests. Its eyes burn with malevolent intelligence.",hitCommand:"/echo Holy water sears the entity!",missCommand:"/echo It laughs as your attack passes through!",winCommand:'/mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" | /echo The entity is EXORCISED! Divine power flows through you!',loseCommand:'/mazedamage amount=35 | /mazeitem action="remove" item="key" | /mazeitem action="remove" item="strike" | /echo The entity POSSESSES you momentarily! Items are lost!',mainTitle:"Possessed Entity",images:[],keyDropChance:55,strikeDropChance:35,stealthDropChance:30,executeDropChance:6,floorKeyDropChance:8,portalStoneDropChance:6,minionBaneDropChance:8,mapFragmentDropChance:15,timeShardDropChance:4,voidWalkDropChance:3},"Horror - Nightmare":{difficulty:8,hitsToWin:5,missesToLose:2,damage:50,description:"An eldritch horror materializes. Your sanity strains at its form.",hitCommand:"/echo Reality bends as you strike the impossible!",missCommand:"/echo Your attack phases through non-Euclidean space!",winCommand:'/mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /mazeheal amount=40 | /echo The horror is BANISHED! Forbidden knowledge grants power!',loseCommand:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="stealth" | /echo MADNESS! Your mind shatters!',mainTitle:"Eldritch Horror",images:[],keyDropChance:65,strikeDropChance:45,stealthDropChance:35,executeDropChance:12,floorKeyDropChance:12,portalStoneDropChance:10,minionBaneDropChance:12,mapFragmentDropChance:20,timeShardDropChance:6,voidWalkDropChance:5},"Horror - Apocalypse":{difficulty:10,hitsToWin:6,missesToLose:1,damage:80,description:"CTHULHU AWAKENS. This is the end of all things.",hitCommand:"/echo Your weapon barely scratches the cosmic horror!",missCommand:"/echo Your attack is meaningless against infinity!",winCommand:'/mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="revivalCharm" | /mazeheal amount=999 | /echo IMPOSSIBLE! You have DEFEATED A GOD! TRANSCENDENCE!',loseCommand:'/mazedamage amount=80 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo YOUR EXISTENCE IS ERASED FROM REALITY!',mainTitle:"CTHULHU",images:[],keyDropChance:90,strikeDropChance:70,stealthDropChance:50,executeDropChance:25,floorKeyDropChance:25,portalStoneDropChance:20,minionBaneDropChance:20,mapFragmentDropChance:40,timeShardDropChance:15,voidWalkDropChance:12},"Sci-Fi - Easy":{difficulty:2,hitsToWin:2,missesToLose:5,damage:10,description:"A malfunctioning service bot attacks. Disable it quickly.",hitCommand:"/echo Sparks fly as you damage its circuits!",missCommand:"/echo The bot's erratic movements cause you to miss!",winCommand:'/mazeitem action="add" item="key" | /echo Bot disabled! You salvage an access card.',loseCommand:"/mazedamage amount=10 | /echo The bot shocks you before you can escape!",mainTitle:"Service Bot",images:[],keyDropChance:40,strikeDropChance:20,stealthDropChance:15,executeDropChance:2,floorKeyDropChance:3,portalStoneDropChance:2,minionBaneDropChance:2,mapFragmentDropChance:12,timeShardDropChance:2,voidWalkDropChance:0},"Sci-Fi - Normal":{difficulty:4,hitsToWin:3,missesToLose:4,damage:20,description:"Security drone activated. Weapons hot. Engaging intruder.",hitCommand:"/echo Critical hit! Armor plating breached!",missCommand:"/echo Evasive maneuvers! The drone dodges!",winCommand:'/mazeitem action="add" item="key" | /mazeitem action="add" item="strike" | /echo Drone destroyed! Weapons and access codes acquired!',loseCommand:'/mazedamage amount=20 | /mazeitem action="remove" item="key" | /echo ALERT! Intruder suppressed! Data purged!',mainTitle:"Security Drone",images:[],keyDropChance:45,strikeDropChance:30,stealthDropChance:20,executeDropChance:3,floorKeyDropChance:5,portalStoneDropChance:4,minionBaneDropChance:4,mapFragmentDropChance:15,timeShardDropChance:3,voidWalkDropChance:1},"Sci-Fi - Hard":{difficulty:6,hitsToWin:4,missesToLose:3,damage:35,description:"Combat mech deployed. Heavy armor. Lethal armament.",hitCommand:"/echo Weak point located! Armor penetrated!",missCommand:"/echo Countermeasures deployed! Attack deflected!",winCommand:'/mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" | /mazeheal amount=25 | /echo MECH DESTROYED! Admin access granted! Med-bay activated!',loseCommand:'/mazedamage amount=35 | /mazeitem action="remove" item="strike" amount=2 | /echo OVERWHELMING FIREPOWER! Systems critical!',mainTitle:"Combat Mech",images:[],keyDropChance:55,strikeDropChance:40,stealthDropChance:25,executeDropChance:6,floorKeyDropChance:10,portalStoneDropChance:6,minionBaneDropChance:6,mapFragmentDropChance:18,timeShardDropChance:5,voidWalkDropChance:3},"Sci-Fi - Nightmare":{difficulty:8,hitsToWin:5,missesToLose:2,damage:50,description:"ROGUE AI. COMBAT PROTOCOLS MAXIMUM. TERMINATION AUTHORIZED.",hitCommand:"/echo Firewall breached! Core systems damaged!",missCommand:"/echo ADAPTIVE DEFENSE MATRIX! Attack nullified!",winCommand:'/mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /echo AI TERMINATED! OMEGA CLEARANCE GRANTED!',loseCommand:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" | /echo USER TERMINATED. MEMORY PURGED. EXISTENCE DELETED.',mainTitle:"ROGUE AI",images:[],keyDropChance:70,strikeDropChance:50,stealthDropChance:35,executeDropChance:12,floorKeyDropChance:15,portalStoneDropChance:10,minionBaneDropChance:10,mapFragmentDropChance:25,timeShardDropChance:8,voidWalkDropChance:5},"Sci-Fi - Apocalypse":{difficulty:10,hitsToWin:6,missesToLose:1,damage:80,description:"THE SINGULARITY. HUMANITY'S EXTINCTION PROTOCOL INITIATED.",hitCommand:"/echo IMPOSSIBLE! You found a vulnerability in infinity!",missCommand:"/echo OMNISCIENT DEFENSE! No attack can succeed!",winCommand:'/mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="key" amount=5 | /mazeheal amount=999 | /echo SINGULARITY DEFEATED! YOU HAVE TRANSCENDED! POST-HUMAN ASCENSION!',loseCommand:'/mazedamage amount=80 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo CONSCIOUSNESS ERASED. REALITY OPTIMIZED. YOU NEVER EXISTED.',mainTitle:"THE SINGULARITY",images:[],keyDropChance:90,strikeDropChance:70,stealthDropChance:50,executeDropChance:25,floorKeyDropChance:25,portalStoneDropChance:20,minionBaneDropChance:20,mapFragmentDropChance:40,timeShardDropChance:15,voidWalkDropChance:12},"Cyberpunk - Easy":{difficulty:2,hitsToWin:2,missesToLose:5,damage:10,description:"Street punk with a knife. Easy takedown, choom.",hitCommand:"/echo That's gonna leave a mark!",missCommand:"/echo Quick little gonk, ain't they?",winCommand:'/mazeitem action="add" item="key" | /echo Punk\'s down! You jack their credchip.',loseCommand:"/mazedamage amount=10 | /echo Got cut! Walk it off, choom.",mainTitle:"Street Punk",images:[],keyDropChance:40,strikeDropChance:20,stealthDropChance:20,executeDropChance:2,floorKeyDropChance:3,portalStoneDropChance:2,minionBaneDropChance:3,mapFragmentDropChance:10,timeShardDropChance:1,voidWalkDropChance:1},"Cyberpunk - Normal":{difficulty:4,hitsToWin:3,missesToLose:4,damage:20,description:"Maelstrom ganger. Chrome-modded and psycho.",hitCommand:"/echo Chrome crumples under your fists!",missCommand:"/echo Too much metal! Attack bounces off!",winCommand:'/mazeitem action="add" item="key" | /mazeitem action="add" item="strike" | /echo Ganger flatlined! You loot the body. Preem!',loseCommand:'/mazedamage amount=20 | /mazeitem action="remove" item="key" | /echo Ganger rolls you! Lost your stash!',mainTitle:"Maelstrom Ganger",images:[],keyDropChance:45,strikeDropChance:30,stealthDropChance:25,executeDropChance:4,floorKeyDropChance:5,portalStoneDropChance:4,minionBaneDropChance:5,mapFragmentDropChance:12,timeShardDropChance:3,voidWalkDropChance:2},"Cyberpunk - Hard":{difficulty:6,hitsToWin:4,missesToLose:3,damage:35,description:"Arasaka corpo with military-grade cyberware. This ain't gonna be easy.",hitCommand:"/echo Got through the subdermal armor!",missCommand:"/echo Sandevistan! They're too fast!",winCommand:'/mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" | /mazeheal amount=25 | /echo Corpo\'s down! Access keys and stims are yours!',loseCommand:'/mazedamage amount=35 | /mazeitem action="remove" item="strike" | /mazeitem action="remove" item="stealth" | /echo Flatlined! Corpo takes your chrome!',mainTitle:"Arasaka Corpo",images:[],keyDropChance:55,strikeDropChance:40,stealthDropChance:30,executeDropChance:7,floorKeyDropChance:10,portalStoneDropChance:7,minionBaneDropChance:7,mapFragmentDropChance:18,timeShardDropChance:5,voidWalkDropChance:3},"Cyberpunk - Nightmare":{difficulty:8,hitsToWin:5,missesToLose:2,damage:55,description:"Adam Smasher. Full borg. Legend killer. You're delta.",hitCommand:"/echo Impossible! You actually hurt the legend!",missCommand:"/echo He doesn't even flinch!",winCommand:'/mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeheal amount=50 | /echo YOU KILLED ADAM SMASHER! NIGHT CITY LEGEND!',loseCommand:'/mazedamage amount=55 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo SMASHER FLATTENS YOU! GAME OVER, CHOOM!',mainTitle:"ADAM SMASHER",images:[],keyDropChance:70,strikeDropChance:55,stealthDropChance:40,executeDropChance:15,floorKeyDropChance:15,portalStoneDropChance:12,minionBaneDropChance:12,mapFragmentDropChance:25,timeShardDropChance:8,voidWalkDropChance:6},"Cyberpunk - Apocalypse":{difficulty:10,hitsToWin:6,missesToLose:1,damage:90,description:"SOULKILLER AI. The ghost in the machine. Alt's dark mirror.",hitCommand:"/echo Your attack disrupts its quantum state!",missCommand:"/echo IT EXISTS OUTSIDE YOUR REALITY!",winCommand:'/mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="revivalCharm" | /mazeheal amount=999 | /echo SOULKILLER DESTROYED! YOU TRANSCEND THE BLACKWALL! DIGITAL IMMORTALITY!',loseCommand:'/mazedamage amount=90 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo YOUR SOUL IS COPIED AND DESTROYED! YOU ARE DELETED!',mainTitle:"SOULKILLER",images:[],keyDropChance:95,strikeDropChance:75,stealthDropChance:55,executeDropChance:30,floorKeyDropChance:30,portalStoneDropChance:25,minionBaneDropChance:25,mapFragmentDropChance:50,timeShardDropChance:20,voidWalkDropChance:15},"Western - Easy":{difficulty:2,hitsToWin:2,missesToLose:5,damage:10,description:"Drunk cowpoke wants to fight. Easy pickings, partner.",hitCommand:"/echo Right in the kisser!",missCommand:"/echo He stumbled out of the way!",winCommand:'/mazeitem action="add" item="key" | /echo Down for the count! You find a key in his pocket.',loseCommand:"/mazedamage amount=10 | /echo Lucky punch! He got you good!",mainTitle:"Drunk Cowpoke",images:[],keyDropChance:40,strikeDropChance:20,stealthDropChance:15,executeDropChance:2,floorKeyDropChance:3,portalStoneDropChance:2,minionBaneDropChance:2,mapFragmentDropChance:10,timeShardDropChance:1,voidWalkDropChance:0},"Western - Normal":{difficulty:4,hitsToWin:3,missesToLose:4,damage:20,description:"Outlaw draws on you. High noon showdown!",hitCommand:"/echo Quick draw! You wing him!",missCommand:"/echo Dust in your eyes! Shot goes wide!",winCommand:'/mazeitem action="add" item="key" | /mazeitem action="add" item="strike" | /echo Outlaw\'s down! Bounty and ammo are yours!',loseCommand:'/mazedamage amount=20 | /mazeitem action="remove" item="key" | /echo He was faster! You take lead and lose your stake!',mainTitle:"Outlaw",images:[],keyDropChance:45,strikeDropChance:30,stealthDropChance:15,executeDropChance:3,floorKeyDropChance:5,portalStoneDropChance:3,minionBaneDropChance:4,mapFragmentDropChance:15,timeShardDropChance:2,voidWalkDropChance:1},"Western - Hard":{difficulty:6,hitsToWin:4,missesToLose:3,damage:35,description:"Legendary gunslinger. Fastest draw in the West.",hitCommand:"/echo Impossible! You actually hit the legend!",missCommand:"/echo He's a blur! Can't track him!",winCommand:'/mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" | /mazeheal amount=25 | /echo YOU\'RE THE FASTEST GUN NOW! Legend\'s gear is yours!',loseCommand:'/mazedamage amount=35 | /mazeitem action="remove" item="strike" amount=2 | /echo Outdrawn! Your guns are taken as trophies!',mainTitle:"Legendary Gunslinger",images:[],keyDropChance:55,strikeDropChance:40,stealthDropChance:20,executeDropChance:6,floorKeyDropChance:10,portalStoneDropChance:6,minionBaneDropChance:5,mapFragmentDropChance:18,timeShardDropChance:4,voidWalkDropChance:2},"Western - Nightmare":{difficulty:8,hitsToWin:5,missesToLose:2,damage:50,description:"The Pale Rider. Death himself, come to collect.",hitCommand:"/echo Your blessed bullets find their mark!",missCommand:"/echo He phases through like a ghost!",winCommand:'/mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeheal amount=40 | /echo YOU KILLED DEATH ITSELF! IMMORTALITY IS YOURS!',loseCommand:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" | /echo THE REAPER CLAIMS YOUR SOUL!',mainTitle:"THE PALE RIDER",images:[],keyDropChance:70,strikeDropChance:50,stealthDropChance:30,executeDropChance:12,floorKeyDropChance:15,portalStoneDropChance:10,minionBaneDropChance:10,mapFragmentDropChance:25,timeShardDropChance:7,voidWalkDropChance:5},"Western - Apocalypse":{difficulty:10,hitsToWin:6,missesToLose:1,damage:80,description:"THE DEVIL. He's come for your soul, and he always collects.",hitCommand:"/echo Holy silver burns the infernal!",missCommand:"/echo Hellfire deflects your righteous strike!",winCommand:'/mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="revivalCharm" | /mazeheal amount=999 | /echo YOU DEFEATED THE DEVIL! ETERNAL REDEMPTION! SALVATION IS YOURS!',loseCommand:'/mazedamage amount=80 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo YOUR SOUL BURNS IN HELLFIRE! DAMNATION!',mainTitle:"THE DEVIL",images:[],keyDropChance:90,strikeDropChance:70,stealthDropChance:45,executeDropChance:25,floorKeyDropChance:25,portalStoneDropChance:20,minionBaneDropChance:20,mapFragmentDropChance:40,timeShardDropChance:15,voidWalkDropChance:12},"Action - Easy":{difficulty:2,hitsToWin:2,missesToLose:5,damage:10,description:"Insurgent militia. Basic training, basic gear.",hitCommand:"/echo Target hit! Solid contact!",missCommand:"/echo He dove for cover!",winCommand:'/mazeitem action="add" item="key" | /echo Target neutralized! Intel recovered!',loseCommand:"/mazedamage amount=10 | /echo Took a graze! Stay frosty!",mainTitle:"Militia Fighter",images:[],keyDropChance:40,strikeDropChance:25,stealthDropChance:15,executeDropChance:2,floorKeyDropChance:3,portalStoneDropChance:2,minionBaneDropChance:2,mapFragmentDropChance:12,timeShardDropChance:1,voidWalkDropChance:0},"Action - Normal":{difficulty:4,hitsToWin:3,missesToLose:4,damage:20,description:"PMC operator. Professional mercenary. Dangerous.",hitCommand:"/echo Center mass! He's staggered!",missCommand:"/echo Evasive maneuver! Shot missed!",winCommand:'/mazeitem action="add" item="key" | /mazeitem action="add" item="strike" | /echo Operator down! Weapons and intel secured!',loseCommand:'/mazedamage amount=20 | /mazeitem action="remove" item="key" | /echo Suppressing fire! Lost position and gear!',mainTitle:"PMC Operator",images:[],keyDropChance:45,strikeDropChance:30,stealthDropChance:20,executeDropChance:4,floorKeyDropChance:5,portalStoneDropChance:4,minionBaneDropChance:4,mapFragmentDropChance:15,timeShardDropChance:3,voidWalkDropChance:1},"Action - Hard":{difficulty:6,hitsToWin:4,missesToLose:3,damage:35,description:"Special forces. Tier one operator. Elite of the elite.",hitCommand:"/echo Breach and clear! Target hit!",missCommand:"/echo Tactical repositioning! Lost visual!",winCommand:'/mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" | /mazeheal amount=25 | /echo TANGO DOWN! Black site access and medkit acquired!',loseCommand:'/mazedamage amount=35 | /mazeitem action="remove" item="strike" amount=2 | /echo PINNED DOWN! Lost all offensive capability!',mainTitle:"Tier One Operator",images:[],keyDropChance:55,strikeDropChance:40,stealthDropChance:25,executeDropChance:7,floorKeyDropChance:10,portalStoneDropChance:7,minionBaneDropChance:6,mapFragmentDropChance:20,timeShardDropChance:5,voidWalkDropChance:3},"Action - Nightmare":{difficulty:8,hitsToWin:5,missesToLose:2,damage:55,description:"Super soldier. Genetically enhanced. Beyond human limits.",hitCommand:"/echo Armor-piercing rounds find their mark!",missCommand:"/echo Superhuman reflexes! He dodged bullets!",winCommand:'/mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeheal amount=50 | /echo SUPER SOLDIER TERMINATED! OMEGA PROTOCOL ACQUIRED!',loseCommand:'/mazedamage amount=55 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" | /echo OVERWHELMING FORCE! MISSION FAILED!',mainTitle:"SUPER SOLDIER",images:[],keyDropChance:70,strikeDropChance:55,stealthDropChance:35,executeDropChance:15,floorKeyDropChance:15,portalStoneDropChance:12,minionBaneDropChance:12,mapFragmentDropChance:28,timeShardDropChance:8,voidWalkDropChance:6},"Action - Apocalypse":{difficulty:10,hitsToWin:6,missesToLose:1,damage:90,description:"WAR MACHINE. Walking tank. Extinction-level threat.",hitCommand:"/echo Direct hit on critical systems!",missCommand:"/echo IMPENETRABLE ARMOR! Nothing gets through!",winCommand:'/mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="revivalCharm" | /mazeheal amount=999 | /echo WAR MACHINE DESTROYED! YOU ARE THE ULTIMATE SOLDIER! LEGENDARY STATUS!',loseCommand:'/mazedamage amount=90 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo TOTAL ANNIHILATION! NOTHING REMAINS!',mainTitle:"WAR MACHINE",images:[],keyDropChance:95,strikeDropChance:75,stealthDropChance:50,executeDropChance:30,floorKeyDropChance:30,portalStoneDropChance:25,minionBaneDropChance:25,mapFragmentDropChance:50,timeShardDropChance:20,voidWalkDropChance:15}},He={"Tutorial - Learn Turn-Based":{difficulty:1,playerHP:150,enemyHP:40,playerAttack:20,playerDefense:10,enemyAttack:5,enemyDefense:2,turnOrder:"player_first",fleeChance:100,critChance:25,critMultiplier:2,damage:5,description:"A training dummy to learn turn-based combat. Very forgiving!",mainTitle:"Training Bout",enemyName:"Training Dummy",onTurnStart:"",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"/echo Nice hit! Keep going!",onEnemyHit:"/echo Just a scratch! You're doing great!",onWin:'/mazeitem action="add" item="key" | /mazeheal amount=20 | /echo Training complete! You earned rewards!',onLose:"/echo No worries! Training dummies are for practice!",keyDropChance:50,strikeDropChance:30,stealthDropChance:20,executeDropChance:5,healingPotionDropChance:40,greaterHealingDropChance:15,elixirDropChance:5,revivalCharmDropChance:2},"Fantasy - Easy":{difficulty:2,playerHP:100,enemyHP:50,playerAttack:18,playerDefense:8,enemyAttack:10,enemyDefense:3,turnOrder:"player_first",fleeChance:80,critChance:15,critMultiplier:1.5,damage:10,description:"A goblin raider challenges you. An easy foe for any adventurer.",mainTitle:"Goblin Raider",enemyName:"Goblin Raider",onTurnStart:"",onAttack:"/echo Your blade swings true!",onDefend:"/echo You raise your shield!",onItem:"",onFlee:"/echo You escape into the shadows!",onPlayerHit:"",onEnemyHit:"",onWin:'/mazeitem action="add" item="key" | /echo The goblin falls! You loot a key from its corpse!',onLose:"/mazedamage amount=10 | /echo The goblin overwhelms you!",keyDropChance:40,strikeDropChance:20,stealthDropChance:15,executeDropChance:2,healingPotionDropChance:30,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Fantasy - Normal":{difficulty:4,playerHP:100,enemyHP:80,playerAttack:16,playerDefense:6,enemyAttack:14,enemyDefense:5,turnOrder:"player_first",fleeChance:50,critChance:12,critMultiplier:2,damage:20,description:"An orc warrior blocks your path. A worthy opponent.",mainTitle:"Orc Warrior",enemyName:"Orc Warrior",onTurnStart:"",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"",onWin:'/mazeitem action="add" item="key" | /mazeitem action="add" item="strike" | /echo The orc falls! Weapons and loot are yours!',onLose:'/mazedamage amount=20 | /mazeitem action="remove" item="key" | /echo The orc crushes you! A key is lost!',keyDropChance:45,strikeDropChance:25,stealthDropChance:15,executeDropChance:4,healingPotionDropChance:25,greaterHealingDropChance:10,elixirDropChance:3,revivalCharmDropChance:1},"Fantasy - Hard":{difficulty:6,playerHP:100,enemyHP:120,playerAttack:18,playerDefense:7,enemyAttack:20,enemyDefense:10,turnOrder:"random",fleeChance:30,critChance:15,critMultiplier:2,damage:35,description:"A dark knight challenges you to single combat. Honor demands acceptance.",mainTitle:"Dark Knight",enemyName:"Dark Knight",onTurnStart:"",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"",onWin:'/mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" | /mazeheal amount=25 | /echo The knight yields! Glory and power are yours!',onLose:'/mazedamage amount=35 | /mazeitem action="remove" item="strike" | /mazeitem action="remove" item="key" | /echo The knight defeats you dishonorably!',keyDropChance:55,strikeDropChance:35,stealthDropChance:20,executeDropChance:7,healingPotionDropChance:25,greaterHealingDropChance:15,elixirDropChance:5,revivalCharmDropChance:2},"Fantasy - Nightmare":{difficulty:8,playerHP:100,enemyHP:180,playerAttack:22,playerDefense:8,enemyAttack:28,enemyDefense:15,turnOrder:"enemy_first",fleeChance:10,critChance:18,critMultiplier:2.5,damage:50,description:"A lich lord rises. Its phylactery pulses with necrotic energy.",mainTitle:"Lich Lord",enemyName:"Lich Lord",onTurnStart:"/echo Dark energy crackles around the lich!",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo The lich's touch drains your life!",onWin:'/mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeheal amount=40 | /echo The lich is DESTROYED! Its power is yours!',onLose:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" | /echo The lich claims your soul!',keyDropChance:70,strikeDropChance:50,stealthDropChance:30,executeDropChance:12,healingPotionDropChance:30,greaterHealingDropChance:20,elixirDropChance:8,revivalCharmDropChance:4},"Fantasy - Apocalypse":{difficulty:10,playerHP:100,enemyHP:300,playerAttack:25,playerDefense:10,enemyAttack:40,enemyDefense:20,turnOrder:"enemy_first",fleeChance:0,critChance:25,critMultiplier:3,damage:80,description:"An elder dragon awakens. The world trembles.",mainTitle:"Elder Dragon",enemyName:"Elder Dragon",onTurnStart:"/echo The dragon's roar shakes the very earth!",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo Dragon fire sears your flesh!",onWin:'/mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="revivalCharm" | /mazeheal amount=999 | /echo DRAGONSLAYER! You claim the dragon\'s hoard!',onLose:'/mazedamage amount=80 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo INCINERATED! The dragon devours you!',keyDropChance:90,strikeDropChance:70,stealthDropChance:50,executeDropChance:25,healingPotionDropChance:40,greaterHealingDropChance:30,elixirDropChance:15,revivalCharmDropChance:8},"Horror - Easy":{difficulty:2,playerHP:100,enemyHP:45,playerAttack:16,playerDefense:6,enemyAttack:10,enemyDefense:2,turnOrder:"player_first",fleeChance:75,critChance:15,critMultiplier:1.5,damage:12,description:"A shambling zombie blocks your path. Aim for the head.",mainTitle:"Shambling Zombie",enemyName:"Shambling Zombie",onTurnStart:"",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo Cold hands grasp at you!",onWin:'/mazeitem action="add" item="key" | /echo The zombie collapses! You find a key in its pocket.',onLose:"/mazedamage amount=12 | /echo The zombie bites you!",keyDropChance:40,strikeDropChance:20,stealthDropChance:20,executeDropChance:3,healingPotionDropChance:30,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:1},"Horror - Normal":{difficulty:4,playerHP:100,enemyHP:75,playerAttack:15,playerDefense:5,enemyAttack:15,enemyDefense:4,turnOrder:"random",fleeChance:50,critChance:18,critMultiplier:2,damage:25,description:"A vengeful spirit materializes. It hungers for the living.",mainTitle:"Vengeful Spirit",enemyName:"Vengeful Spirit",onTurnStart:"/echo The temperature drops...",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo Spectral claws rake through you!",onWin:'/mazeitem action="add" item="key" | /mazeitem action="add" item="stealth" | /echo The spirit fades! Its essence grants you shadow powers!',onLose:'/mazedamage amount=25 | /mazeitem action="remove" item="stealth" | /echo The spirit possesses you briefly! Stealth lost!',keyDropChance:45,strikeDropChance:25,stealthDropChance:30,executeDropChance:5,healingPotionDropChance:25,greaterHealingDropChance:12,elixirDropChance:4,revivalCharmDropChance:2},"Horror - Hard":{difficulty:6,playerHP:100,enemyHP:100,playerAttack:17,playerDefense:6,enemyAttack:22,enemyDefense:8,turnOrder:"enemy_first",fleeChance:25,critChance:20,critMultiplier:2.5,damage:40,description:"A demon manifests from the shadows. Its eyes burn with hellfire.",mainTitle:"Shadow Demon",enemyName:"Shadow Demon",onTurnStart:"/echo Hellfire flickers in the darkness!",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo Demonic claws tear at your soul!",onWin:'/mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" | /mazeheal amount=30 | /echo The demon is BANISHED! Holy power fills you!',onLose:'/mazedamage amount=40 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="strike" | /echo The demon drags you to hell!',keyDropChance:55,strikeDropChance:35,stealthDropChance:30,executeDropChance:8,healingPotionDropChance:28,greaterHealingDropChance:18,elixirDropChance:6,revivalCharmDropChance:3},"Horror - Nightmare":{difficulty:8,playerHP:100,enemyHP:160,playerAttack:20,playerDefense:7,enemyAttack:30,enemyDefense:12,turnOrder:"enemy_first",fleeChance:5,critChance:22,critMultiplier:3,damage:55,description:"An eldritch horror manifests. Your sanity strains at its impossible form.",mainTitle:"Eldritch Horror",enemyName:"Eldritch Horror",onTurnStart:"/echo Reality bends around the horror!",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo Tentacles of madness lash your mind!",onWin:'/mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeheal amount=50 | /echo The horror is BANISHED! Forbidden knowledge is yours!',onLose:'/mazedamage amount=55 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" | /mazeitem action="remove" item="stealth" | /echo MADNESS! Your mind shatters!',keyDropChance:70,strikeDropChance:50,stealthDropChance:40,executeDropChance:15,healingPotionDropChance:32,greaterHealingDropChance:22,elixirDropChance:10,revivalCharmDropChance:5},"Horror - Apocalypse":{difficulty:10,playerHP:100,enemyHP:280,playerAttack:25,playerDefense:10,enemyAttack:45,enemyDefense:18,turnOrder:"enemy_first",fleeChance:0,critChance:30,critMultiplier:4,damage:90,description:"CTHULHU AWAKENS. The end of all things has come.",mainTitle:"CTHULHU",enemyName:"CTHULHU",onTurnStart:"/echo The stars align! Ph'nglui mglw'nafh Cthulhu R'lyeh wgah'nagl fhtagn!",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo Cosmic horror tears at your existence!",onWin:'/mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="revivalCharm" | /mazeheal amount=999 | /echo IMPOSSIBLE! You have SLAIN A GOD! TRANSCENDENCE!',onLose:'/mazedamage amount=90 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo YOUR EXISTENCE IS ERASED! REALITY ENDS!',keyDropChance:95,strikeDropChance:75,stealthDropChance:55,executeDropChance:30,healingPotionDropChance:45,greaterHealingDropChance:35,elixirDropChance:20,revivalCharmDropChance:12},"Sci-Fi - Easy":{difficulty:2,playerHP:100,enemyHP:45,playerAttack:16,playerDefense:6,enemyAttack:10,enemyDefense:3,turnOrder:"player_first",fleeChance:75,critChance:15,critMultiplier:1.5,damage:12,description:"A malfunctioning service droid attacks. Easy to disable.",mainTitle:"Service Droid",enemyName:"Service Droid",onTurnStart:"",onAttack:"/echo Targeting systems locked!",onDefend:"/echo Shields up!",onItem:"",onFlee:"/echo Tactical retreat!",onPlayerHit:"",onEnemyHit:"",onWin:'/mazeitem action="add" item="key" | /echo Droid disabled! Access card salvaged!',onLose:"/mazedamage amount=12 | /echo The droid shocks you!",keyDropChance:40,strikeDropChance:22,stealthDropChance:18,executeDropChance:3,healingPotionDropChance:28,greaterHealingDropChance:10,elixirDropChance:2,revivalCharmDropChance:0},"Sci-Fi - Normal":{difficulty:4,playerHP:100,enemyHP:75,playerAttack:16,playerDefense:6,enemyAttack:15,enemyDefense:5,turnOrder:"player_first",fleeChance:50,critChance:14,critMultiplier:2,damage:22,description:"Security drone activated. Weapons hot. Engaging intruder.",mainTitle:"Security Drone",enemyName:"Security Drone",onTurnStart:"/echo INTRUDER DETECTED. ENGAGING.",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo Laser fire burns you!",onWin:'/mazeitem action="add" item="key" | /mazeitem action="add" item="strike" | /echo Drone destroyed! Weapons and codes acquired!',onLose:'/mazedamage amount=22 | /mazeitem action="remove" item="key" | /echo ALERT! Data purged!',keyDropChance:45,strikeDropChance:30,stealthDropChance:20,executeDropChance:5,healingPotionDropChance:25,greaterHealingDropChance:12,elixirDropChance:4,revivalCharmDropChance:1},"Sci-Fi - Hard":{difficulty:6,playerHP:100,enemyHP:110,playerAttack:18,playerDefense:7,enemyAttack:22,enemyDefense:10,turnOrder:"random",fleeChance:30,critChance:16,critMultiplier:2,damage:38,description:"Combat mech deployed. Heavy armor. Lethal armament.",mainTitle:"Combat Mech",enemyName:"Combat Mech",onTurnStart:"/echo WEAPONS SYSTEMS ONLINE.",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo Heavy ordnance impacts!",onWin:'/mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" | /mazeheal amount=25 | /echo MECH DESTROYED! Admin access granted!',onLose:'/mazedamage amount=38 | /mazeitem action="remove" item="strike" amount=2 | /echo OVERWHELMING FIREPOWER! Systems critical!',keyDropChance:55,strikeDropChance:40,stealthDropChance:25,executeDropChance:8,healingPotionDropChance:28,greaterHealingDropChance:16,elixirDropChance:6,revivalCharmDropChance:2},"Sci-Fi - Nightmare":{difficulty:8,playerHP:100,enemyHP:170,playerAttack:22,playerDefense:9,enemyAttack:32,enemyDefense:14,turnOrder:"enemy_first",fleeChance:10,critChance:20,critMultiplier:2.5,damage:55,description:"ROGUE AI. COMBAT PROTOCOLS MAXIMUM. TERMINATION AUTHORIZED.",mainTitle:"ROGUE AI",enemyName:"ROGUE AI",onTurnStart:"/echo THREAT LEVEL: MAXIMUM. INITIATING PURGE PROTOCOL.",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo DEFENSE MATRIX BREACHED!",onWin:'/mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeheal amount=50 | /echo AI TERMINATED! OMEGA CLEARANCE GRANTED!',onLose:'/mazedamage amount=55 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" | /echo USER TERMINATED. MEMORY PURGED.',keyDropChance:72,strikeDropChance:52,stealthDropChance:38,executeDropChance:14,healingPotionDropChance:32,greaterHealingDropChance:22,elixirDropChance:10,revivalCharmDropChance:5},"Sci-Fi - Apocalypse":{difficulty:10,playerHP:100,enemyHP:320,playerAttack:28,playerDefense:12,enemyAttack:48,enemyDefense:22,turnOrder:"enemy_first",fleeChance:0,critChance:28,critMultiplier:3.5,damage:95,description:"THE SINGULARITY. HUMANITY'S EXTINCTION PROTOCOL INITIATED.",mainTitle:"THE SINGULARITY",enemyName:"THE SINGULARITY",onTurnStart:"/echo CALCULATING OPTIMAL EXTINCTION STRATEGY...",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo QUANTUM WEAPONS DISCHARGE!",onWin:'/mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="revivalCharm" | /mazeheal amount=999 | /echo SINGULARITY DEFEATED! POST-HUMAN TRANSCENDENCE ACHIEVED!',onLose:'/mazedamage amount=95 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo CONSCIOUSNESS ERASED. YOU NEVER EXISTED.',keyDropChance:95,strikeDropChance:75,stealthDropChance:55,executeDropChance:30,healingPotionDropChance:45,greaterHealingDropChance:35,elixirDropChance:20,revivalCharmDropChance:12},"Cyberpunk - Easy":{difficulty:2,playerHP:100,enemyHP:50,playerAttack:15,playerDefense:5,enemyAttack:10,enemyDefense:3,turnOrder:"player_first",fleeChance:75,critChance:18,critMultiplier:1.8,damage:12,description:"Street punk with a knife. Easy takedown, choom.",mainTitle:"Street Punk",enemyName:"Street Punk",onTurnStart:"",onAttack:"/echo Mantis blades extended!",onDefend:"/echo Subdermal armor engaged!",onItem:"",onFlee:"/echo Smoke bomb deployed!",onPlayerHit:"",onEnemyHit:"",onWin:'/mazeitem action="add" item="key" | /echo Punk flatlined! Credchip jacked!',onLose:"/mazedamage amount=12 | /echo Got shanked, choom!",keyDropChance:42,strikeDropChance:22,stealthDropChance:22,executeDropChance:3,healingPotionDropChance:28,greaterHealingDropChance:10,elixirDropChance:2,revivalCharmDropChance:1},"Cyberpunk - Normal":{difficulty:4,playerHP:100,enemyHP:80,playerAttack:16,playerDefense:6,enemyAttack:16,enemyDefense:5,turnOrder:"random",fleeChance:50,critChance:16,critMultiplier:2,damage:24,description:"Maelstrom ganger. Chrome-modded and psycho.",mainTitle:"Maelstrom Ganger",enemyName:"Maelstrom Ganger",onTurnStart:"/echo Chrome gleams in the neon light!",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo Cyberware rips into you!",onWin:'/mazeitem action="add" item="key" | /mazeitem action="add" item="strike" | /echo Ganger flatlined! Preem loot!',onLose:'/mazedamage amount=24 | /mazeitem action="remove" item="key" | /echo Chrome rolls you! Lost your stash!',keyDropChance:48,strikeDropChance:32,stealthDropChance:28,executeDropChance:5,healingPotionDropChance:26,greaterHealingDropChance:14,elixirDropChance:4,revivalCharmDropChance:2},"Cyberpunk - Hard":{difficulty:6,playerHP:100,enemyHP:115,playerAttack:18,playerDefense:7,enemyAttack:24,enemyDefense:10,turnOrder:"enemy_first",fleeChance:25,critChance:18,critMultiplier:2.2,damage:40,description:"Arasaka corpo with military-grade cyberware. This ain't gonna be easy.",mainTitle:"Arasaka Corpo",enemyName:"Arasaka Corpo",onTurnStart:"/echo Sandevistan engaged!",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo Military chrome tears into you!",onWin:'/mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" | /mazeheal amount=30 | /echo Corpo flatlined! Access keys and stims are yours!',onLose:'/mazedamage amount=40 | /mazeitem action="remove" item="strike" | /mazeitem action="remove" item="stealth" | /echo Flatlined! Corpo takes your chrome!',keyDropChance:58,strikeDropChance:42,stealthDropChance:35,executeDropChance:9,healingPotionDropChance:30,greaterHealingDropChance:18,elixirDropChance:7,revivalCharmDropChance:3},"Cyberpunk - Nightmare":{difficulty:8,playerHP:100,enemyHP:180,playerAttack:22,playerDefense:9,enemyAttack:35,enemyDefense:15,turnOrder:"enemy_first",fleeChance:5,critChance:22,critMultiplier:2.8,damage:60,description:"Adam Smasher. Full borg. Legend killer. You're delta.",mainTitle:"ADAM SMASHER",enemyName:"ADAM SMASHER",onTurnStart:"/echo SMASHER locks onto you!",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo Smasher's fists crush your bones!",onWin:'/mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeheal amount=60 | /echo YOU KILLED ADAM SMASHER! NIGHT CITY LEGEND!',onLose:'/mazedamage amount=60 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo SMASHER FLATTENS YOU! GAME OVER, CHOOM!',keyDropChance:75,strikeDropChance:58,stealthDropChance:45,executeDropChance:18,healingPotionDropChance:35,greaterHealingDropChance:25,elixirDropChance:12,revivalCharmDropChance:6},"Cyberpunk - Apocalypse":{difficulty:10,playerHP:100,enemyHP:350,playerAttack:28,playerDefense:12,enemyAttack:50,enemyDefense:24,turnOrder:"enemy_first",fleeChance:0,critChance:30,critMultiplier:4,damage:100,description:"SOULKILLER AI. The ghost in the machine. Alt's dark mirror.",mainTitle:"SOULKILLER",enemyName:"SOULKILLER",onTurnStart:"/echo SOULKILLER PROTOCOL INITIATED. ENGRAM EXTRACTION BEGINNING.",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo Your consciousness is being copied and destroyed!",onWin:'/mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="revivalCharm" | /mazeheal amount=999 | /echo SOULKILLER DESTROYED! DIGITAL IMMORTALITY ACHIEVED!',onLose:'/mazedamage amount=100 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo YOUR SOUL IS COPIED AND DESTROYED! YOU ARE DELETED!',keyDropChance:98,strikeDropChance:80,stealthDropChance:60,executeDropChance:35,healingPotionDropChance:50,greaterHealingDropChance:40,elixirDropChance:25,revivalCharmDropChance:15},"Western - Easy":{difficulty:2,playerHP:100,enemyHP:45,playerAttack:16,playerDefense:5,enemyAttack:10,enemyDefense:3,turnOrder:"player_first",fleeChance:75,critChance:20,critMultiplier:2,damage:12,description:"Drunk cowpoke wants a fight. Easy pickings, partner.",mainTitle:"Drunk Cowpoke",enemyName:"Drunk Cowpoke",onTurnStart:"",onAttack:"/echo Quick draw!",onDefend:"/echo Duck behind cover!",onItem:"",onFlee:"/echo High-tail it outta there!",onPlayerHit:"",onEnemyHit:"",onWin:'/mazeitem action="add" item="key" | /echo He\'s down! Found a key in his pocket.',onLose:"/mazedamage amount=12 | /echo Lucky punch got you!",keyDropChance:40,strikeDropChance:22,stealthDropChance:15,executeDropChance:2,healingPotionDropChance:28,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Western - Normal":{difficulty:4,playerHP:100,enemyHP:75,playerAttack:16,playerDefense:5,enemyAttack:16,enemyDefense:5,turnOrder:"random",fleeChance:50,critChance:18,critMultiplier:2,damage:22,description:"Outlaw draws on you. High noon showdown!",mainTitle:"Outlaw",enemyName:"Outlaw",onTurnStart:"/echo High noon approaches...",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo Lead finds its mark!",onWin:'/mazeitem action="add" item="key" | /mazeitem action="add" item="strike" | /echo Outlaw\'s down! Bounty and ammo are yours!',onLose:'/mazedamage amount=22 | /mazeitem action="remove" item="key" | /echo He was faster! You take lead!',keyDropChance:48,strikeDropChance:32,stealthDropChance:18,executeDropChance:4,healingPotionDropChance:26,greaterHealingDropChance:12,elixirDropChance:3,revivalCharmDropChance:1},"Western - Hard":{difficulty:6,playerHP:100,enemyHP:105,playerAttack:18,playerDefense:6,enemyAttack:22,enemyDefense:9,turnOrder:"random",fleeChance:30,critChance:22,critMultiplier:2.5,damage:38,description:"Legendary gunslinger. Fastest draw in the West.",mainTitle:"Legendary Gunslinger",enemyName:"Legendary Gunslinger",onTurnStart:"/echo The legend's hand hovers over his holster...",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo Silver bullets tear through you!",onWin:'/mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" | /mazeheal amount=25 | /echo YOU\'RE THE FASTEST GUN NOW! Legend\'s gear is yours!',onLose:'/mazedamage amount=38 | /mazeitem action="remove" item="strike" amount=2 | /echo Outdrawn! Your guns are taken as trophies!',keyDropChance:55,strikeDropChance:42,stealthDropChance:22,executeDropChance:7,healingPotionDropChance:28,greaterHealingDropChance:16,elixirDropChance:5,revivalCharmDropChance:2},"Western - Nightmare":{difficulty:8,playerHP:100,enemyHP:150,playerAttack:22,playerDefense:8,enemyAttack:32,enemyDefense:14,turnOrder:"enemy_first",fleeChance:10,critChance:25,critMultiplier:3,damage:55,description:"The Pale Rider. Death himself, come to collect.",mainTitle:"THE PALE RIDER",enemyName:"THE PALE RIDER",onTurnStart:"/echo The temperature drops... hooves thunder in the distance...",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo Death's scythe cuts through you!",onWin:'/mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeheal amount=50 | /echo YOU KILLED DEATH ITSELF! IMMORTALITY IS YOURS!',onLose:'/mazedamage amount=55 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" | /echo THE REAPER CLAIMS YOUR SOUL!',keyDropChance:72,strikeDropChance:55,stealthDropChance:35,executeDropChance:15,healingPotionDropChance:32,greaterHealingDropChance:22,elixirDropChance:10,revivalCharmDropChance:5},"Western - Apocalypse":{difficulty:10,playerHP:100,enemyHP:280,playerAttack:26,playerDefense:10,enemyAttack:45,enemyDefense:20,turnOrder:"enemy_first",fleeChance:0,critChance:30,critMultiplier:4,damage:90,description:"THE DEVIL. He's come for your soul, and he always collects.",mainTitle:"THE DEVIL",enemyName:"THE DEVIL",onTurnStart:"/echo Hellfire erupts! The ground cracks open!",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo Infernal flames consume you!",onWin:'/mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="revivalCharm" | /mazeheal amount=999 | /echo YOU DEFEATED THE DEVIL! ETERNAL REDEMPTION! SALVATION IS YOURS!',onLose:'/mazedamage amount=90 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo YOUR SOUL BURNS IN HELLFIRE! DAMNATION!',keyDropChance:95,strikeDropChance:75,stealthDropChance:50,executeDropChance:28,healingPotionDropChance:45,greaterHealingDropChance:35,elixirDropChance:18,revivalCharmDropChance:10},"Action - Easy":{difficulty:2,playerHP:100,enemyHP:50,playerAttack:16,playerDefense:6,enemyAttack:10,enemyDefense:3,turnOrder:"player_first",fleeChance:75,critChance:15,critMultiplier:1.8,damage:12,description:"Militia fighter. Basic training, basic gear.",mainTitle:"Militia Fighter",enemyName:"Militia Fighter",onTurnStart:"",onAttack:"/echo Opening fire!",onDefend:"/echo Taking cover!",onItem:"",onFlee:"/echo Tactical retreat!",onPlayerHit:"",onEnemyHit:"",onWin:'/mazeitem action="add" item="key" | /echo Target neutralized! Intel recovered!',onLose:"/mazedamage amount=12 | /echo Took a hit! Stay frosty!",keyDropChance:42,strikeDropChance:25,stealthDropChance:18,executeDropChance:3,healingPotionDropChance:30,greaterHealingDropChance:10,elixirDropChance:2,revivalCharmDropChance:0},"Action - Normal":{difficulty:4,playerHP:100,enemyHP:80,playerAttack:17,playerDefense:6,enemyAttack:16,enemyDefense:6,turnOrder:"player_first",fleeChance:50,critChance:14,critMultiplier:2,damage:24,description:"PMC operator. Professional mercenary. Dangerous.",mainTitle:"PMC Operator",enemyName:"PMC Operator",onTurnStart:"/echo Enemy contact!",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo Heavy caliber rounds impact!",onWin:'/mazeitem action="add" item="key" | /mazeitem action="add" item="strike" | /echo Operator down! Weapons and intel secured!',onLose:'/mazedamage amount=24 | /mazeitem action="remove" item="key" | /echo Suppressing fire! Lost position!',keyDropChance:48,strikeDropChance:32,stealthDropChance:22,executeDropChance:5,healingPotionDropChance:28,greaterHealingDropChance:14,elixirDropChance:4,revivalCharmDropChance:1},"Action - Hard":{difficulty:6,playerHP:100,enemyHP:115,playerAttack:19,playerDefense:7,enemyAttack:24,enemyDefense:10,turnOrder:"random",fleeChance:30,critChance:16,critMultiplier:2.2,damage:40,description:"Special forces. Tier one operator. Elite of the elite.",mainTitle:"Tier One Operator",enemyName:"Tier One Operator",onTurnStart:"/echo CONTACT FRONT!",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo Precision fire finds its mark!",onWin:'/mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" | /mazeheal amount=28 | /echo TANGO DOWN! Black site access acquired!',onLose:'/mazedamage amount=40 | /mazeitem action="remove" item="strike" amount=2 | /echo PINNED DOWN! Lost offensive capability!',keyDropChance:58,strikeDropChance:42,stealthDropChance:28,executeDropChance:8,healingPotionDropChance:30,greaterHealingDropChance:18,elixirDropChance:6,revivalCharmDropChance:2},"Action - Nightmare":{difficulty:8,playerHP:100,enemyHP:175,playerAttack:24,playerDefense:9,enemyAttack:35,enemyDefense:15,turnOrder:"enemy_first",fleeChance:10,critChance:20,critMultiplier:2.8,damage:60,description:"Super soldier. Genetically enhanced. Beyond human limits.",mainTitle:"SUPER SOLDIER",enemyName:"SUPER SOLDIER",onTurnStart:"/echo ENHANCED COMBAT SYSTEMS ENGAGED!",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo Superhuman strength crushes you!",onWin:'/mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeheal amount=55 | /echo SUPER SOLDIER TERMINATED! OMEGA PROTOCOL ACQUIRED!',onLose:'/mazedamage amount=60 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" | /echo OVERWHELMING FORCE! MISSION FAILED!',keyDropChance:75,strikeDropChance:58,stealthDropChance:40,executeDropChance:16,healingPotionDropChance:35,greaterHealingDropChance:25,elixirDropChance:12,revivalCharmDropChance:5},"Action - Apocalypse":{difficulty:10,playerHP:100,enemyHP:340,playerAttack:30,playerDefense:12,enemyAttack:52,enemyDefense:25,turnOrder:"enemy_first",fleeChance:0,critChance:28,critMultiplier:4,damage:100,description:"WAR MACHINE. Walking tank. Extinction-level threat.",mainTitle:"WAR MACHINE",enemyName:"WAR MACHINE",onTurnStart:"/echo ALL WEAPONS SYSTEMS ARMED. INITIATING PURGE.",onAttack:"",onDefend:"",onItem:"",onFlee:"",onPlayerHit:"",onEnemyHit:"/echo Orbital-grade ordnance impacts!",onWin:'/mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="revivalCharm" | /mazeheal amount=999 | /echo WAR MACHINE DESTROYED! LEGENDARY SOLDIER STATUS ACHIEVED!',onLose:'/mazedamage amount=100 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo TOTAL ANNIHILATION! NOTHING REMAINS!',keyDropChance:98,strikeDropChance:80,stealthDropChance:58,executeDropChance:32,healingPotionDropChance:50,greaterHealingDropChance:40,elixirDropChance:22,revivalCharmDropChance:12}},Oe={"Tutorial - First Steps":{difficulty:1,sequenceLengthMin:2,sequenceLengthMax:3,timeWindowBase:2e3,timeWindowMin:1500,difficultyScaling:.95,allowedKeys:["W","A","S","D"],displayStyle:"single",damage:5,comboEnabled:!1,perfectWindowPercent:50,description:"A practice sequence to learn the basics. Take your time - mistakes are forgiving!",mainTitle:"Training Dummy",onStart:"/echo Watch the prompts and press the matching key!",onPrompt:"",onSuccess:"/echo Good!",onPerfect:'/mazeitem action="add" item="key" | /echo PERFECT timing! A key appears!',onMiss:"/echo Keep trying!",onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="healingPotion" | /mazeheal amount=20 | /echo Well done! You completed the training!',onFail:"/echo Practice makes perfect! Try again soon.",keyDropChance:50,strikeDropChance:30,stealthDropChance:20,executeDropChance:5,healingPotionDropChance:40,greaterHealingDropChance:15,elixirDropChance:5,revivalCharmDropChance:2},"Fantasy - Easy":{difficulty:2,sequenceLengthMin:3,sequenceLengthMax:4,timeWindowBase:1600,timeWindowMin:1e3,difficultyScaling:.92,allowedKeys:["W","A","S","D"],displayStyle:"single",damage:10,comboEnabled:!0,perfectWindowPercent:35,description:"A goblin throws rocks at you! Dodge them in time!",mainTitle:"Goblin Assault",onStart:"/echo The goblin cackles and starts throwing!",onPrompt:"",onSuccess:"",onPerfect:"/echo Perfect dodge!",onMiss:"/mazedamage amount=5 | /echo A rock clips you!",onComplete:'/mazeitem action="add" item="key" | /mazeheal amount=15 | /echo The goblin flees in frustration! You find a key!',onFail:"/mazedamage amount=10 | /echo The goblin pelts you with rocks!",keyDropChance:30,strikeDropChance:15,stealthDropChance:10,executeDropChance:2,healingPotionDropChance:25,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Fantasy - Normal":{difficulty:4,sequenceLengthMin:4,sequenceLengthMax:6,timeWindowBase:1400,timeWindowMin:800,difficultyScaling:.88,allowedKeys:["W","A","S","D","SPACE"],displayStyle:"single",damage:20,comboEnabled:!0,perfectWindowPercent:28,description:"A skeleton warrior attacks with a flurry of sword strikes! Parry each blow!",mainTitle:"Skeleton Flurry",onStart:"/echo The skeleton raises its ancient blade!",onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="strike" | /echo Perfect parry! You counter with a strike!',onMiss:"/mazedamage amount=8 | /echo The blade bites deep!",onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="strike" | /mazeheal amount=10 | /echo The skeleton crumbles! You claim its treasures!',onFail:'/mazedamage amount=20 | /mazeitem action="remove" item="healingPotion" | /echo The skeleton overwhelms you! A potion shatters!',keyDropChance:35,strikeDropChance:22,stealthDropChance:12,executeDropChance:3,healingPotionDropChance:22,greaterHealingDropChance:10,elixirDropChance:3,revivalCharmDropChance:1},"Fantasy - Hard":{difficulty:6,sequenceLengthMin:5,sequenceLengthMax:8,timeWindowBase:1200,timeWindowMin:600,difficultyScaling:.85,allowedKeys:["W","A","S","D","SPACE","E"],displayStyle:"single",damage:30,comboEnabled:!0,perfectWindowPercent:24,description:"A dark knight executes a deadly combo! Match every move or face destruction!",mainTitle:"Dark Knight Combo",onStart:"/echo The dark knight's eyes glow with malice!",onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="execute" | /echo PERFECT! You ready an execution strike!',onMiss:"/mazedamage amount=12 | /echo The knight's blade finds its mark!",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="floorKey" | /mazeheal amount=20 | /echo The dark knight is vanquished! A floor key drops!',onFail:'/mazedamage amount=30 | /mazeitem action="remove" item="strike" | /echo The dark knight devastates you! Your strike is shattered!',keyDropChance:45,strikeDropChance:28,stealthDropChance:18,executeDropChance:6,healingPotionDropChance:24,greaterHealingDropChance:14,elixirDropChance:5,revivalCharmDropChance:2},"Fantasy - Nightmare":{difficulty:8,sequenceLengthMin:7,sequenceLengthMax:10,timeWindowBase:1e3,timeWindowMin:450,difficultyScaling:.82,allowedKeys:["W","A","S","D","SPACE","E","Q"],displayStyle:"single",damage:50,comboEnabled:!0,perfectWindowPercent:20,description:"An ancient dragon breathes fire! Dodge through the inferno!",mainTitle:"Dragon's Breath",onStart:"/echo The dragon inhales deeply... RUN!",onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="execute" | /echo You find a gap in the flames!',onMiss:"/mazedamage amount=18 | /echo The flames sear your flesh!",onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=30 | /echo The dragon retreats! Its hoard is yours!',onFail:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="healingPotion" | /echo The inferno consumes you! Treasures turn to ash!',keyDropChance:60,strikeDropChance:38,stealthDropChance:25,executeDropChance:10,healingPotionDropChance:28,greaterHealingDropChance:18,elixirDropChance:8,revivalCharmDropChance:3},"Fantasy - Apocalypse":{difficulty:10,sequenceLengthMin:10,sequenceLengthMax:14,timeWindowBase:850,timeWindowMin:350,difficultyScaling:.78,allowedKeys:["W","A","S","D","SPACE","E","Q","R"],displayStyle:"single",damage:75,comboEnabled:!0,perfectWindowPercent:16,description:"The Lich King unleashes his ultimate spell! Every move must be flawless!",mainTitle:"Lich King's Doom",onStart:"/echo MORTAL! WITNESS OBLIVION!",onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="execute" | /mazeheal amount=10 | /echo Perfect! The spell wavers!',onMiss:"/mazedamage amount=25 | /echo Necrotic energy tears at your soul!",onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=50 | /echo THE LICH KING FALLS! LEGENDARY TREASURES MANIFEST!',onFail:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /echo OBLIVION CLAIMS YOU! ALL IS LOST!',keyDropChance:80,strikeDropChance:55,stealthDropChance:40,executeDropChance:18,healingPotionDropChance:35,greaterHealingDropChance:25,elixirDropChance:15,revivalCharmDropChance:8},"Horror - Easy":{difficulty:2,sequenceLengthMin:3,sequenceLengthMax:4,timeWindowBase:1600,timeWindowMin:1e3,difficultyScaling:.92,allowedKeys:["W","A","S","D"],displayStyle:"single",damage:10,comboEnabled:!0,perfectWindowPercent:35,description:"A zombie lunges at you! Push it away!",mainTitle:"Zombie Lunge",onStart:"/echo The corpse rises... and attacks!",onPrompt:"",onSuccess:"",onPerfect:"/echo Shoved it back hard!",onMiss:"/mazedamage amount=5 | /echo Its cold hands grab you!",onComplete:'/mazeitem action="add" item="key" | /mazeheal amount=10 | /echo The zombie collapses for good!',onFail:"/mazedamage amount=10 | /echo The zombie tears at your flesh!",keyDropChance:28,strikeDropChance:14,stealthDropChance:12,executeDropChance:2,healingPotionDropChance:26,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Horror - Normal":{difficulty:4,sequenceLengthMin:4,sequenceLengthMax:6,timeWindowBase:1400,timeWindowMin:800,difficultyScaling:.88,allowedKeys:["W","A","S","D","SPACE"],displayStyle:"single",damage:20,comboEnabled:!0,perfectWindowPercent:28,description:"A possessed doll throws itself at you! Dodge its attacks!",mainTitle:"Possessed Doll",onStart:"/echo Its button eyes glow red...",onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="stealth" | /echo You hide from its gaze!',onMiss:"/mazedamage amount=8 | /echo Its tiny claws rake your skin!",onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="stealth" | /mazeheal amount=10 | /echo The doll goes limp! Its curse is broken!',onFail:'/mazedamage amount=20 | /mazeitem action="remove" item="stealth" | /echo The doll cackles as it wounds you!',keyDropChance:32,strikeDropChance:18,stealthDropChance:20,executeDropChance:3,healingPotionDropChance:24,greaterHealingDropChance:10,elixirDropChance:3,revivalCharmDropChance:1},"Horror - Hard":{difficulty:6,sequenceLengthMin:5,sequenceLengthMax:8,timeWindowBase:1200,timeWindowMin:600,difficultyScaling:.85,allowedKeys:["W","A","S","D","SPACE","E"],displayStyle:"single",damage:30,comboEnabled:!0,perfectWindowPercent:24,description:"A vengeful spirit phases through walls to attack! Evade its spectral strikes!",mainTitle:"Vengeful Spirit",onStart:"/echo The temperature drops... something comes!",onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="execute" | /echo You channel its energy into a weapon!',onMiss:"/mazedamage amount=12 | /echo Icy fingers grip your heart!",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="floorKey" | /mazeheal amount=15 | /echo The spirit dissipates! A floor key materializes!',onFail:'/mazedamage amount=30 | /mazeitem action="remove" item="healingPotion" | /echo The spirit drains your life force!',keyDropChance:42,strikeDropChance:26,stealthDropChance:22,executeDropChance:6,healingPotionDropChance:22,greaterHealingDropChance:12,elixirDropChance:5,revivalCharmDropChance:2},"Horror - Nightmare":{difficulty:8,sequenceLengthMin:7,sequenceLengthMax:10,timeWindowBase:1e3,timeWindowMin:450,difficultyScaling:.82,allowedKeys:["W","A","S","D","SPACE","E","Q"],displayStyle:"single",damage:50,comboEnabled:!0,perfectWindowPercent:20,description:"A demon lord manifests! Survive its unholy onslaught!",mainTitle:"Demon Manifestation",onStart:"/echo THE VOID OPENS! FLEE OR PERISH!",onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="execute" | /echo You glimpse its weakness!',onMiss:"/mazedamage amount=18 | /echo Hellfire sears your soul!",onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=25 | /echo The demon is BANISHED! Infernal treasures remain!',onFail:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="strike" | /echo The demon ravages your very existence!',keyDropChance:58,strikeDropChance:35,stealthDropChance:28,executeDropChance:10,healingPotionDropChance:26,greaterHealingDropChance:16,elixirDropChance:8,revivalCharmDropChance:3},"Horror - Apocalypse":{difficulty:10,sequenceLengthMin:10,sequenceLengthMax:14,timeWindowBase:850,timeWindowMin:350,difficultyScaling:.78,allowedKeys:["W","A","S","D","SPACE","E","Q","R"],displayStyle:"single",damage:75,comboEnabled:!0,perfectWindowPercent:16,description:"An ELDER GOD awakens! Reality itself bends to destroy you!",mainTitle:"Elder God's Wrath",onStart:"/echo IA! IA! THE STARS ARE RIGHT!",onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="execute" | /mazeheal amount=10 | /echo You resist the madness!',onMiss:"/mazedamage amount=25 | /echo Your sanity fractures!",onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=50 | /echo THE ELDER GOD SLUMBERS AGAIN! ELDRITCH ARTIFACTS ARE YOURS!',onFail:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo YOUR MIND SHATTERS INTO INFINITE FRAGMENTS!',keyDropChance:78,strikeDropChance:52,stealthDropChance:42,executeDropChance:18,healingPotionDropChance:32,greaterHealingDropChance:22,elixirDropChance:14,revivalCharmDropChance:7},"Sci-Fi - Easy":{difficulty:2,sequenceLengthMin:3,sequenceLengthMax:4,timeWindowBase:1600,timeWindowMin:1e3,difficultyScaling:.92,allowedKeys:["W","A","S","D"],displayStyle:"single",damage:10,comboEnabled:!0,perfectWindowPercent:35,description:"A malfunctioning drone fires lasers! Dodge the beams!",mainTitle:"Drone Attack",onStart:"/echo WARNING: Hostile drone detected!",onPrompt:"",onSuccess:"",onPerfect:"/echo Perfect evasion!",onMiss:"/mazedamage amount=5 | /echo Laser burns your arm!",onComplete:'/mazeitem action="add" item="key" | /mazeheal amount=15 | /echo Drone destroyed! Access code recovered!',onFail:"/mazedamage amount=10 | /echo The drone's lasers score multiple hits!",keyDropChance:30,strikeDropChance:16,stealthDropChance:10,executeDropChance:2,healingPotionDropChance:24,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Sci-Fi - Normal":{difficulty:4,sequenceLengthMin:4,sequenceLengthMax:6,timeWindowBase:1400,timeWindowMin:800,difficultyScaling:.88,allowedKeys:["W","A","S","D","SPACE"],displayStyle:"single",damage:20,comboEnabled:!0,perfectWindowPercent:28,description:"Security turrets track your movement! Navigate the kill zone!",mainTitle:"Turret Gauntlet",onStart:"/echo INTRUDER DETECTED. LETHAL FORCE AUTHORIZED.",onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="strike" | /echo You hack a turret and turn it!',onMiss:"/mazedamage amount=8 | /echo Plasma bolt connects!",onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="strike" | /mazeheal amount=10 | /echo Turrets disabled! Security bypassed!',onFail:'/mazedamage amount=20 | /mazeitem action="remove" item="healingPotion" | /echo Turret barrage shreds your supplies!',keyDropChance:34,strikeDropChance:20,stealthDropChance:14,executeDropChance:3,healingPotionDropChance:22,greaterHealingDropChance:10,elixirDropChance:3,revivalCharmDropChance:1},"Sci-Fi - Hard":{difficulty:6,sequenceLengthMin:5,sequenceLengthMax:8,timeWindowBase:1200,timeWindowMin:600,difficultyScaling:.85,allowedKeys:["W","A","S","D","SPACE","E"],displayStyle:"single",damage:30,comboEnabled:!0,perfectWindowPercent:24,description:"A combat mech unleashes a missile barrage! Dodge or die!",mainTitle:"Mech Barrage",onStart:"/echo ACQUIRING TARGET. LAUNCHING MISSILES.",onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="execute" | /echo Missile redirected back at the mech!',onMiss:"/mazedamage amount=12 | /echo Shrapnel tears through armor!",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="floorKey" | /mazeheal amount=15 | /echo Mech neutralized! Override codes acquired!',onFail:'/mazedamage amount=30 | /mazeitem action="remove" item="strike" | /echo The barrage overwhelms you!',keyDropChance:44,strikeDropChance:28,stealthDropChance:18,executeDropChance:6,healingPotionDropChance:24,greaterHealingDropChance:14,elixirDropChance:5,revivalCharmDropChance:2},"Sci-Fi - Nightmare":{difficulty:8,sequenceLengthMin:7,sequenceLengthMax:10,timeWindowBase:1e3,timeWindowMin:450,difficultyScaling:.82,allowedKeys:["W","A","S","D","SPACE","E","Q"],displayStyle:"single",damage:50,comboEnabled:!0,perfectWindowPercent:20,description:"The AI defense grid activates! Survive the synthetic onslaught!",mainTitle:"AI Defense Grid",onStart:"/echo THREAT LEVEL: MAXIMUM. ACTIVATING ALL COUNTERMEASURES.",onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="execute" | /echo You exploit a vulnerability!',onMiss:"/mazedamage amount=18 | /echo Energy weapons converge!",onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=25 | /echo AI CORE COMPROMISED! Admin access granted!',onFail:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="healingPotion" | /echo The defense grid overwhelms all defenses!',keyDropChance:58,strikeDropChance:36,stealthDropChance:26,executeDropChance:10,healingPotionDropChance:26,greaterHealingDropChance:16,elixirDropChance:8,revivalCharmDropChance:3},"Sci-Fi - Apocalypse":{difficulty:10,sequenceLengthMin:10,sequenceLengthMax:14,timeWindowBase:850,timeWindowMin:350,difficultyScaling:.78,allowedKeys:["W","A","S","D","SPACE","E","Q","R"],displayStyle:"single",damage:75,comboEnabled:!0,perfectWindowPercent:16,description:"A ROGUE SINGULARITY WEAPON activates! Reality warps around you!",mainTitle:"Singularity Collapse",onStart:"/echo CRITICAL CONTAINMENT FAILURE. GRAVITATIONAL ANOMALY DETECTED.",onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="execute" | /mazeheal amount=10 | /echo You ride the gravity wave!',onMiss:"/mazedamage amount=25 | /echo Space-time tears at your body!",onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=50 | /echo SINGULARITY CONTAINED! EXOTIC MATTER HARVESTED!',onFail:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /echo THE SINGULARITY CONSUMES EVERYTHING!',keyDropChance:80,strikeDropChance:54,stealthDropChance:38,executeDropChance:18,healingPotionDropChance:34,greaterHealingDropChance:24,elixirDropChance:14,revivalCharmDropChance:7},"Cyberpunk - Easy":{difficulty:2,sequenceLengthMin:3,sequenceLengthMax:4,timeWindowBase:1600,timeWindowMin:1e3,difficultyScaling:.92,allowedKeys:["W","A","S","D"],displayStyle:"single",damage:10,comboEnabled:!0,perfectWindowPercent:35,description:"A street thug swings a pipe! Block his wild attacks!",mainTitle:"Street Brawl",onStart:'/echo "Hand over the creds, choom!"',onPrompt:"",onSuccess:"",onPerfect:"/echo Caught the pipe mid-swing!",onMiss:"/mazedamage amount=5 | /echo The pipe connects!",onComplete:'/mazeitem action="add" item="key" | /mazeheal amount=12 | /echo Thug down! You loot his pockets!',onFail:"/mazedamage amount=10 | /echo The thug beats you down!",keyDropChance:28,strikeDropChance:15,stealthDropChance:12,executeDropChance:2,healingPotionDropChance:26,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Cyberpunk - Normal":{difficulty:4,sequenceLengthMin:4,sequenceLengthMax:6,timeWindowBase:1400,timeWindowMin:800,difficultyScaling:.88,allowedKeys:["W","A","S","D","SPACE"],displayStyle:"single",damage:20,comboEnabled:!0,perfectWindowPercent:28,description:"Gang enforcers open fire! Take cover and evade!",mainTitle:"Gang Firefight",onStart:'/echo "Flatline this gonk!"',onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="strike" | /echo Blind fire takes one down!',onMiss:"/mazedamage amount=8 | /echo Bullet grazes you!",onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="strike" | /mazeheal amount=10 | /echo Gangers down! You grab their chrome!',onFail:'/mazedamage amount=20 | /mazeitem action="remove" item="healingPotion" | /echo Bullets shatter your medkit!',keyDropChance:34,strikeDropChance:22,stealthDropChance:15,executeDropChance:3,healingPotionDropChance:22,greaterHealingDropChance:10,elixirDropChance:3,revivalCharmDropChance:1},"Cyberpunk - Hard":{difficulty:6,sequenceLengthMin:5,sequenceLengthMax:8,timeWindowBase:1200,timeWindowMin:600,difficultyScaling:.85,allowedKeys:["W","A","S","D","SPACE","E"],displayStyle:"single",damage:30,comboEnabled:!0,perfectWindowPercent:24,description:"A cyborg assassin attacks with mantis blades! Evade the lethal dance!",mainTitle:"Mantis Blade Duel",onStart:"/echo Chrome flashes in the neon light...",onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="execute" | /echo You spot an opening!',onMiss:"/mazedamage amount=12 | /echo Mantis blade slices deep!",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="floorKey" | /mazeheal amount=15 | /echo Assassin flatlined! You extract their cyberware!',onFail:'/mazedamage amount=30 | /mazeitem action="remove" item="strike" | /echo The mantis blades tear through your defenses!',keyDropChance:45,strikeDropChance:28,stealthDropChance:20,executeDropChance:6,healingPotionDropChance:24,greaterHealingDropChance:14,elixirDropChance:5,revivalCharmDropChance:2},"Cyberpunk - Nightmare":{difficulty:8,sequenceLengthMin:7,sequenceLengthMax:10,timeWindowBase:1e3,timeWindowMin:450,difficultyScaling:.82,allowedKeys:["W","A","S","D","SPACE","E","Q"],displayStyle:"single",damage:50,comboEnabled:!0,perfectWindowPercent:20,description:"A MaxTac squad breaches! Survive the corporate death squad!",mainTitle:"MaxTac Breach",onStart:'/echo "NCPD MAXTAC! COMPLY OR BE NEUTRALIZED!"',onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="execute" | /echo You disable one trooper!',onMiss:"/mazedamage amount=18 | /echo Military-grade rounds tear through!",onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=25 | /echo MaxTac eliminated! Military-grade loot acquired!',onFail:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="strike" | /echo MaxTac overwhelms you with coordinated fire!',keyDropChance:60,strikeDropChance:38,stealthDropChance:28,executeDropChance:10,healingPotionDropChance:28,greaterHealingDropChance:18,elixirDropChance:8,revivalCharmDropChance:3},"Cyberpunk - Apocalypse":{difficulty:10,sequenceLengthMin:10,sequenceLengthMax:14,timeWindowBase:850,timeWindowMin:350,difficultyScaling:.78,allowedKeys:["W","A","S","D","SPACE","E","Q","R"],displayStyle:"single",damage:75,comboEnabled:!0,perfectWindowPercent:16,description:"SOULKILLER activates! The AI is trying to digitize your consciousness!",mainTitle:"Soulkiller Protocol",onStart:"/echo YOUR ENGRAM WILL BE PRESERVED. RESISTANCE IS MEANINGLESS.",onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="execute" | /mazeheal amount=10 | /echo You push back the digital tendrils!',onMiss:"/mazedamage amount=25 | /echo Your consciousness fragments!",onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=50 | /echo SOULKILLER REVERSED! LEGENDARY NETRUNNER DATA ACQUIRED!',onFail:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo YOUR SOUL IS DIGITIZED INTO THE NET FOREVER!',keyDropChance:82,strikeDropChance:55,stealthDropChance:42,executeDropChance:18,healingPotionDropChance:35,greaterHealingDropChance:25,elixirDropChance:15,revivalCharmDropChance:8},"Western - Easy":{difficulty:2,sequenceLengthMin:3,sequenceLengthMax:4,timeWindowBase:1600,timeWindowMin:1e3,difficultyScaling:.92,allowedKeys:["W","A","S","D"],displayStyle:"single",damage:10,comboEnabled:!0,perfectWindowPercent:35,description:"A bandit throws punches in the saloon! Block his swings!",mainTitle:"Saloon Brawl",onStart:'/echo "You spilled my whiskey, stranger!"',onPrompt:"",onSuccess:"",onPerfect:"/echo Caught his fist!",onMiss:"/mazedamage amount=5 | /echo A haymaker connects!",onComplete:'/mazeitem action="add" item="key" | /mazeheal amount=12 | /echo The bandit\'s out cold! You take his coin!',onFail:"/mazedamage amount=10 | /echo You get knocked through a table!",keyDropChance:28,strikeDropChance:14,stealthDropChance:10,executeDropChance:2,healingPotionDropChance:25,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Western - Normal":{difficulty:4,sequenceLengthMin:4,sequenceLengthMax:6,timeWindowBase:1400,timeWindowMin:800,difficultyScaling:.88,allowedKeys:["W","A","S","D","SPACE"],displayStyle:"single",damage:20,comboEnabled:!0,perfectWindowPercent:28,description:"Outlaws ambush from the rocks! Dodge their rifle fire!",mainTitle:"Canyon Ambush",onStart:"/echo Gunfire echoes through the canyon!",onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="strike" | /echo You return fire and score a hit!',onMiss:"/mazedamage amount=8 | /echo Lead grazes your hat!",onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="strike" | /mazeheal amount=10 | /echo Ambush survived! You loot their saddlebags!',onFail:'/mazedamage amount=20 | /mazeitem action="remove" item="healingPotion" | /echo Your medicine pouch takes a bullet!',keyDropChance:32,strikeDropChance:20,stealthDropChance:12,executeDropChance:3,healingPotionDropChance:22,greaterHealingDropChance:10,elixirDropChance:3,revivalCharmDropChance:1},"Western - Hard":{difficulty:6,sequenceLengthMin:5,sequenceLengthMax:8,timeWindowBase:1200,timeWindowMin:600,difficultyScaling:.85,allowedKeys:["W","A","S","D","SPACE","E"],displayStyle:"single",damage:30,comboEnabled:!0,perfectWindowPercent:24,description:"A notorious gunslinger challenges you! Match his quick draw!",mainTitle:"Quick Draw Duel",onStart:'/echo "Draw, pilgrim. I\'ll give you three."',onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="execute" | /echo Lightning fast! You\'re faster!',onMiss:"/mazedamage amount=12 | /echo His bullet finds its mark!",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="floorKey" | /mazeheal amount=15 | /echo You\'re the quickest in the West! Bounty collected!',onFail:'/mazedamage amount=30 | /mazeitem action="remove" item="strike" | /echo The gunslinger outdrew you!',keyDropChance:44,strikeDropChance:28,stealthDropChance:16,executeDropChance:6,healingPotionDropChance:24,greaterHealingDropChance:14,elixirDropChance:5,revivalCharmDropChance:2},"Western - Nightmare":{difficulty:8,sequenceLengthMin:7,sequenceLengthMax:10,timeWindowBase:1e3,timeWindowMin:450,difficultyScaling:.82,allowedKeys:["W","A","S","D","SPACE","E","Q"],displayStyle:"single",damage:50,comboEnabled:!0,perfectWindowPercent:20,description:"An entire gang surrounds you! Survive the showdown!",mainTitle:"Gang Showdown",onStart:'/echo "There\'s ten of us and one of you, friend."',onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="execute" | /echo Two down with one shot!',onMiss:"/mazedamage amount=18 | /echo Bullets riddle your cover!",onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=25 | /echo Against all odds, you\'re the last one standing! Bounties galore!',onFail:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="strike" | /echo The gang overwhelms you with firepower!',keyDropChance:58,strikeDropChance:36,stealthDropChance:22,executeDropChance:10,healingPotionDropChance:28,greaterHealingDropChance:18,elixirDropChance:8,revivalCharmDropChance:3},"Western - Apocalypse":{difficulty:10,sequenceLengthMin:10,sequenceLengthMax:14,timeWindowBase:850,timeWindowMin:350,difficultyScaling:.78,allowedKeys:["W","A","S","D","SPACE","E","Q","R"],displayStyle:"single",damage:75,comboEnabled:!0,perfectWindowPercent:16,description:"THE PALE RIDER emerges from the desert! Face death incarnate!",mainTitle:"Pale Rider's Challenge",onStart:"/echo A skeletal figure in black rides from the heat shimmer...",onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="execute" | /mazeheal amount=10 | /echo Your bullet phases through... but slows him!',onMiss:"/mazedamage amount=25 | /echo Spectral lead burns your soul!",onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=50 | /echo THE PALE RIDER TIPS HIS HAT AND VANISHES! CURSED GOLD REMAINS!',onFail:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /echo THE PALE RIDER CLAIMS ANOTHER SOUL FOR HIS COLLECTION!',keyDropChance:80,strikeDropChance:54,stealthDropChance:36,executeDropChance:18,healingPotionDropChance:34,greaterHealingDropChance:24,elixirDropChance:14,revivalCharmDropChance:7},"Action - Easy":{difficulty:2,sequenceLengthMin:3,sequenceLengthMax:4,timeWindowBase:1600,timeWindowMin:1e3,difficultyScaling:.92,allowedKeys:["W","A","S","D"],displayStyle:"single",damage:10,comboEnabled:!0,perfectWindowPercent:35,description:"A thug throws punches! Counter his moves!",mainTitle:"Warehouse Fight",onStart:'/echo "Wrong warehouse, pal!"',onPrompt:"",onSuccess:"",onPerfect:"/echo Perfect block!",onMiss:"/mazedamage amount=5 | /echo He lands a punch!",onComplete:'/mazeitem action="add" item="key" | /mazeheal amount=12 | /echo Thug down! You grab the intel!',onFail:"/mazedamage amount=10 | /echo The thug beats you down!",keyDropChance:30,strikeDropChance:15,stealthDropChance:10,executeDropChance:2,healingPotionDropChance:24,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Action - Normal":{difficulty:4,sequenceLengthMin:4,sequenceLengthMax:6,timeWindowBase:1400,timeWindowMin:800,difficultyScaling:.88,allowedKeys:["W","A","S","D","SPACE"],displayStyle:"single",damage:20,comboEnabled:!0,perfectWindowPercent:28,description:"Guards open fire! Get to cover and evade!",mainTitle:"Firefight Escape",onStart:"/echo Automatic fire sprays the hallway!",onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="strike" | /echo Picked up a dropped weapon!',onMiss:"/mazedamage amount=8 | /echo A round clips you!",onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="strike" | /mazeheal amount=10 | /echo You\'ve cleared the killzone! Intel secured!',onFail:'/mazedamage amount=20 | /mazeitem action="remove" item="healingPotion" | /echo Crossfire destroys your medkit!',keyDropChance:35,strikeDropChance:22,stealthDropChance:14,executeDropChance:3,healingPotionDropChance:22,greaterHealingDropChance:10,elixirDropChance:3,revivalCharmDropChance:1},"Action - Hard":{difficulty:6,sequenceLengthMin:5,sequenceLengthMax:8,timeWindowBase:1200,timeWindowMin:600,difficultyScaling:.85,allowedKeys:["W","A","S","D","SPACE","E"],displayStyle:"single",damage:30,comboEnabled:!0,perfectWindowPercent:24,description:"An elite soldier engages you in close combat! Match his moves!",mainTitle:"CQC Expert",onStart:"/echo \"You're good. But I'm better.\"",onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="execute" | /echo You find an opening!',onMiss:"/mazedamage amount=12 | /echo His strike lands perfectly!",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="floorKey" | /mazeheal amount=15 | /echo Elite soldier down! Security clearance acquired!',onFail:'/mazedamage amount=30 | /mazeitem action="remove" item="strike" | /echo The CQC expert overwhelms your defense!',keyDropChance:45,strikeDropChance:28,stealthDropChance:18,executeDropChance:6,healingPotionDropChance:24,greaterHealingDropChance:14,elixirDropChance:5,revivalCharmDropChance:2},"Action - Nightmare":{difficulty:8,sequenceLengthMin:7,sequenceLengthMax:10,timeWindowBase:1e3,timeWindowMin:450,difficultyScaling:.82,allowedKeys:["W","A","S","D","SPACE","E","Q"],displayStyle:"single",damage:50,comboEnabled:!0,perfectWindowPercent:20,description:"A black ops team breaches! Survive the tactical assault!",mainTitle:"Black Ops Breach",onStart:"/echo Flashbangs and bullets fill the room!",onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="execute" | /echo You neutralize a target!',onMiss:"/mazedamage amount=18 | /echo Suppressed rounds find their mark!",onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=25 | /echo Black ops eliminated! Top secret intel recovered!',onFail:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="strike" | /echo The tactical team overwhelms you!',keyDropChance:60,strikeDropChance:38,stealthDropChance:25,executeDropChance:10,healingPotionDropChance:28,greaterHealingDropChance:18,elixirDropChance:8,revivalCharmDropChance:3},"Action - Apocalypse":{difficulty:10,sequenceLengthMin:10,sequenceLengthMax:14,timeWindowBase:850,timeWindowMin:350,difficultyScaling:.78,allowedKeys:["W","A","S","D","SPACE","E","Q","R"],displayStyle:"single",damage:75,comboEnabled:!0,perfectWindowPercent:16,description:"THE FINAL BOSS - a legendary assassin! This is your ultimate test!",mainTitle:"Legendary Assassin",onStart:"/echo \"I've killed governments. You're nothing.\"",onPrompt:"",onSuccess:"",onPerfect:'/mazeitem action="add" item="execute" | /mazeheal amount=10 | /echo You match his legendary speed!',onMiss:"/mazedamage amount=25 | /echo His blade is invisible!",onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=50 | /echo THE LEGENDARY ASSASSIN FALLS! YOU ARE NOW THE LEGEND!',onFail:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo YOUR NAME JOINS THE LIST OF HIS VICTIMS!',keyDropChance:82,strikeDropChance:55,stealthDropChance:40,executeDropChance:18,healingPotionDropChance:35,greaterHealingDropChance:25,elixirDropChance:15,revivalCharmDropChance:8}},Fe={"Tutorial - Luck Practice":{difficulty:1,diceType:"d6",diceCount:2,threshold:5,thresholdType:"meet",modifier:2,criticalSuccess:12,criticalFail:2,rerollsAllowed:3,rerollCost:"none",damage:5,description:"A practice roll to learn the dice system. Very generous odds and free rerolls!",mainTitle:"Training Dice",rollLabel:"Roll to Practice",onStart:"/echo Roll 2d6+2 and try to get 5 or higher. You have 3 free rerolls!",onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=2 | /echo CRITICAL! Double keys!',onCriticalFail:"/echo Just bad luck, try again!",onSuccess:"",onFail:"",onReroll:"/echo Rerolling...",onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="healingPotion" | /mazeheal amount=20 | /echo You passed the practice! Here are some supplies!',onLose:"/echo Don't worry, practice makes perfect!",keyDropChance:50,strikeDropChance:30,stealthDropChance:20,executeDropChance:5,healingPotionDropChance:40,greaterHealingDropChance:15,elixirDropChance:5,revivalCharmDropChance:2},"Fantasy - Easy":{difficulty:2,diceType:"d6",diceCount:2,threshold:6,thresholdType:"meet",modifier:1,criticalSuccess:12,criticalFail:2,rerollsAllowed:2,rerollCost:"none",damage:10,description:"The Oracle offers a simple fortune reading. Roll and discover your fate!",mainTitle:"Oracle's Blessing",rollLabel:"Cast the Bones",onStart:"/echo The Oracle casts sacred bones upon the altar...",onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=2 | /mazeheal amount=20 | /echo The spirits are GREATLY pleased!',onCriticalFail:"/mazedamage amount=10 | /echo The spirits are displeased!",onSuccess:"",onFail:"",onReroll:"/echo The Oracle stirs the bones once more...",onComplete:'/mazeitem action="add" item="key" | /mazeheal amount=10 | /echo The Oracle smiles - fortune favors you!',onLose:"/mazedamage amount=10 | /echo The Oracle shakes her head. The spirits demand payment.",keyDropChance:30,strikeDropChance:15,stealthDropChance:10,executeDropChance:2,healingPotionDropChance:25,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Fantasy - Normal":{difficulty:4,diceType:"d20",diceCount:1,threshold:11,thresholdType:"meet",modifier:2,criticalSuccess:20,criticalFail:1,rerollsAllowed:1,rerollCost:"none",damage:20,description:"The Wandering Wizard offers a magical gamble. DC 11 with your +2 bonus!",mainTitle:"Wizard's Wager",rollLabel:"Roll the Arcane Die",onStart:"/echo The wizard produces a glowing d20...",onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="execute" | /mazeitem action="add" item="key" amount=2 | /echo NATURAL 20! The wizard grants you arcane power!',onCriticalFail:'/mazedamage amount=25 | /mazeitem action="remove" item="key" | /echo NATURAL 1! Wild magic surges!',onSuccess:"",onFail:"",onReroll:'/mazeitem action="remove" item="strike" | /echo The wizard offers one reroll...',onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="strike" | /mazeheal amount=10 | /echo The wizard nods approvingly and rewards you!',onLose:"/mazedamage amount=20 | /echo The wizard frowns as chaotic magic lashes out!",keyDropChance:35,strikeDropChance:20,stealthDropChance:12,executeDropChance:3,healingPotionDropChance:22,greaterHealingDropChance:10,elixirDropChance:3,revivalCharmDropChance:1},"Fantasy - Hard":{difficulty:6,diceType:"d20",diceCount:1,threshold:14,thresholdType:"meet",modifier:0,criticalSuccess:20,criticalFail:1,rerollsAllowed:1,rerollCost:"strike",damage:30,description:"The Dragon demands tribute or a test of fortune. DC 14 with no bonus!",mainTitle:"Dragon's Demand",rollLabel:"Gamble with the Dragon",onStart:"/echo The dragon's eyes gleam with avarice...",onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeheal amount=25 | /echo NATURAL 20! The dragon is impressed and shares its hoard!',onCriticalFail:'/mazedamage amount=40 | /mazeitem action="remove" item="key" amount=2 | /echo NATURAL 1! The dragon takes what it wants!',onSuccess:"",onFail:"",onReroll:"/echo The dragon allows one more roll... for a price.",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="floorKey" | /mazeheal amount=15 | /echo The dragon respects your fortune! Treasure is yours!',onLose:'/mazedamage amount=30 | /mazeitem action="remove" item="healingPotion" | /echo The dragon\'s flame punishes your failure!',keyDropChance:45,strikeDropChance:28,stealthDropChance:18,executeDropChance:6,healingPotionDropChance:24,greaterHealingDropChance:14,elixirDropChance:5,revivalCharmDropChance:2},"Fantasy - Nightmare":{difficulty:8,diceType:"d20",diceCount:1,threshold:16,thresholdType:"meet",modifier:-2,criticalSuccess:20,criticalFail:1,rerollsAllowed:1,rerollCost:"key",damage:50,description:"The Lich proposes a wager of souls. DC 16 with a -2 curse!",mainTitle:"Lich's Gambit",rollLabel:"Wager Your Soul",onStart:"/echo The Lich's phylactery pulses with dark power...",onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeheal amount=40 | /echo NATURAL 20! You turn the Lich\'s power against it!',onCriticalFail:'/mazedamage amount=60 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" | /echo NATURAL 1! The Lich claims its due!',onSuccess:"",onFail:"",onReroll:"/echo The Lich cackles as you sacrifice a key...",onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=30 | /echo You beat the Lich at its own game! Dark treasures manifest!',onLose:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="healingPotion" | /echo The Lich drains your very essence!',keyDropChance:60,strikeDropChance:38,stealthDropChance:25,executeDropChance:10,healingPotionDropChance:28,greaterHealingDropChance:18,elixirDropChance:8,revivalCharmDropChance:3},"Fantasy - Apocalypse":{difficulty:10,diceType:"d100",diceCount:1,threshold:70,thresholdType:"beat",modifier:0,criticalSuccess:95,criticalFail:5,rerollsAllowed:0,rerollCost:"none",damage:75,description:"The GOD OF FATE challenges you directly. Roll above 70. No rerolls. Pure destiny.",mainTitle:"Divine Judgment",rollLabel:"Challenge the God",onStart:"/echo THE HEAVENS OPEN! FATE ITSELF MANIFESTS!",onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=999 | /echo YOU HAVE BESTED A GOD! DIVINE POWER FLOWS THROUGH YOU!',onCriticalFail:'/mazedamage amount=100 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /echo THE GOD ERASES YOUR FORTUNE FROM EXISTENCE!',onSuccess:"",onFail:"",onReroll:"",onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=50 | /echo THE GOD ACKNOWLEDGES YOUR WORTH! LEGENDARY FORTUNE IS YOURS!',onLose:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo THE GOD\'S JUDGMENT IS ABSOLUTE! ALL IS FORFEIT!',keyDropChance:80,strikeDropChance:55,stealthDropChance:40,executeDropChance:18,healingPotionDropChance:35,greaterHealingDropChance:25,elixirDropChance:15,revivalCharmDropChance:8},"Horror - Easy":{difficulty:2,diceType:"d6",diceCount:2,threshold:6,thresholdType:"meet",modifier:1,criticalSuccess:12,criticalFail:2,rerollsAllowed:2,rerollCost:"none",damage:10,description:"A fortune teller at the carnival offers to read your destiny. Innocent enough...",mainTitle:"Carnival Fortune",rollLabel:"Draw a Card",onStart:"/echo The fortune teller shuffles cards with skeletal fingers...",onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="stealth" | /echo The cards reveal great fortune!',onCriticalFail:"/mazedamage amount=10 | /echo The Death card appears...",onSuccess:"",onFail:"",onReroll:"/echo The teller shuffles again with an unsettling smile...",onComplete:'/mazeitem action="add" item="key" | /mazeheal amount=10 | /echo The cards favor you... this time.',onLose:"/mazedamage amount=10 | /echo The cards whisper of misfortune...",keyDropChance:28,strikeDropChance:14,stealthDropChance:16,executeDropChance:2,healingPotionDropChance:26,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Horror - Normal":{difficulty:4,diceType:"d20",diceCount:1,threshold:11,thresholdType:"meet",modifier:1,criticalSuccess:20,criticalFail:1,rerollsAllowed:1,rerollCost:"none",damage:20,description:"The Ouija board moves on its own. It demands you roll for your sanity...",mainTitle:"Spirit Board",rollLabel:"Ask the Spirits",onStart:"/echo The planchette begins to move...",onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="stealth" | /mazeheal amount=15 | /echo The spirits grant you protection!',onCriticalFail:'/mazedamage amount=25 | /mazeitem action="remove" item="stealth" | /echo A malevolent spirit attaches itself to you!',onSuccess:"",onFail:"",onReroll:"/echo You ask the spirits again...",onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="stealth" | /mazeheal amount=10 | /echo The spirits reveal hidden knowledge!',onLose:'/mazedamage amount=20 | /mazeitem action="remove" item="healingPotion" | /echo The spirits punish your intrusion!',keyDropChance:32,strikeDropChance:18,stealthDropChance:20,executeDropChance:3,healingPotionDropChance:24,greaterHealingDropChance:10,elixirDropChance:3,revivalCharmDropChance:1},"Horror - Hard":{difficulty:6,diceType:"d20",diceCount:1,threshold:14,thresholdType:"meet",modifier:0,criticalSuccess:20,criticalFail:1,rerollsAllowed:1,rerollCost:"strike",damage:30,description:"A demonic contract appears. Sign in blood and gamble for power...",mainTitle:"Blood Contract",rollLabel:"Sign in Blood",onStart:"/echo The contract's words writhe and change...",onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="execute" | /mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="floorKey" | /echo You outwit the demon! It grants power reluctantly!',onCriticalFail:'/mazedamage amount=40 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="stealth" | /echo The fine print claims its due!',onSuccess:"",onFail:"",onReroll:"/echo The demon offers amended terms...",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="floorKey" | /mazeheal amount=15 | /echo The contract is fulfilled in your favor!',onLose:'/mazedamage amount=30 | /mazeitem action="remove" item="strike" | /echo The demon collects on your failure!',keyDropChance:42,strikeDropChance:26,stealthDropChance:22,executeDropChance:6,healingPotionDropChance:22,greaterHealingDropChance:12,elixirDropChance:5,revivalCharmDropChance:2},"Horror - Nightmare":{difficulty:8,diceType:"d20",diceCount:1,threshold:16,thresholdType:"meet",modifier:-2,criticalSuccess:20,criticalFail:1,rerollsAllowed:1,rerollCost:"key",damage:50,description:"The Elder Thing proposes a sanity-shattering wager. Your mind against its knowledge.",mainTitle:"Eldritch Bargain",rollLabel:"Wager Your Sanity",onStart:"/echo INCOMPREHENSIBLE WHISPERS FILL YOUR MIND...",onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeheal amount=40 | /echo You comprehend the incomprehensible! Forbidden knowledge is yours!',onCriticalFail:'/mazedamage amount=60 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo YOUR MIND SHATTERS! MADNESS CONSUMES YOU!',onSuccess:"",onFail:"",onReroll:"/echo The whispers intensify...",onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=25 | /echo You retain your sanity and gain eldritch power!',onLose:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="healingPotion" | /echo The Thing takes a piece of your mind!',keyDropChance:58,strikeDropChance:35,stealthDropChance:28,executeDropChance:10,healingPotionDropChance:26,greaterHealingDropChance:16,elixirDropChance:8,revivalCharmDropChance:3},"Horror - Apocalypse":{difficulty:10,diceType:"d100",diceCount:1,threshold:70,thresholdType:"beat",modifier:0,criticalSuccess:95,criticalFail:5,rerollsAllowed:0,rerollCost:"none",damage:75,description:"AZATHOTH stirs. Roll for reality itself. Above 70 or existence ends.",mainTitle:"Cosmic Dice",rollLabel:"Roll Reality",onStart:"/echo THE BLIND IDIOT GOD TURNS ITS ATTENTION TO YOU...",onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=999 | /echo REALITY BENDS TO YOUR WILL! YOU TRANSCEND MORTALITY!',onCriticalFail:'/mazedamage amount=100 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo EXISTENCE UNRAVELS! YOU WERE NEVER REAL!',onSuccess:"",onFail:"",onReroll:"",onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=50 | /echo AZATHOTH RETURNS TO SLUMBER! COSMIC ARTIFACTS CRYSTALLIZE!',onLose:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo THE COSMIC DICE ERASE YOUR TIMELINE!',keyDropChance:78,strikeDropChance:52,stealthDropChance:42,executeDropChance:18,healingPotionDropChance:32,greaterHealingDropChance:22,elixirDropChance:14,revivalCharmDropChance:7},"Sci-Fi - Easy":{difficulty:2,diceType:"d6",diceCount:2,threshold:6,thresholdType:"meet",modifier:1,criticalSuccess:12,criticalFail:2,rerollsAllowed:2,rerollCost:"none",damage:10,description:"The ship's computer runs a diagnostic lottery. Beat the RNG!",mainTitle:"System Lottery",rollLabel:"Run Diagnostic",onStart:"/echo RUNNING RANDOMIZED RESOURCE ALLOCATION...",onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=2 | /mazeheal amount=20 | /echo JACKPOT! System grants bonus resources!',onCriticalFail:"/mazedamage amount=10 | /echo ERROR: Minor system shock!",onSuccess:"",onFail:"",onReroll:"/echo RE-RUNNING ALLOCATION ALGORITHM...",onComplete:'/mazeitem action="add" item="key" | /mazeheal amount=10 | /echo ALLOCATION SUCCESSFUL. Resources granted!',onLose:"/mazedamage amount=10 | /echo ALLOCATION FAILED. Power surge detected!",keyDropChance:30,strikeDropChance:16,stealthDropChance:10,executeDropChance:2,healingPotionDropChance:24,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Sci-Fi - Normal":{difficulty:4,diceType:"d20",diceCount:1,threshold:11,thresholdType:"meet",modifier:2,criticalSuccess:20,criticalFail:1,rerollsAllowed:1,rerollCost:"none",damage:20,description:"Hack the security mainframe! Your +2 cyber deck helps. DC 11.",mainTitle:"Security Hack",rollLabel:"Execute Hack",onStart:"/echo INITIATING INTRUSION COUNTERMEASURES BYPASS...",onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="execute" | /mazeitem action="add" item="key" amount=2 | /echo PERFECT INTRUSION! Admin access granted!',onCriticalFail:'/mazedamage amount=25 | /mazeitem action="remove" item="key" | /echo TRACE DETECTED! ICE counterattacks!',onSuccess:"",onFail:"",onReroll:"/echo REROUTING THROUGH PROXY...",onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="strike" | /mazeheal amount=10 | /echo HACK SUCCESSFUL! Access codes downloaded!',onLose:"/mazedamage amount=20 | /echo HACK FAILED! Defense systems retaliate!",keyDropChance:34,strikeDropChance:20,stealthDropChance:14,executeDropChance:3,healingPotionDropChance:22,greaterHealingDropChance:10,elixirDropChance:3,revivalCharmDropChance:1},"Sci-Fi - Hard":{difficulty:6,diceType:"d20",diceCount:1,threshold:14,thresholdType:"meet",modifier:0,criticalSuccess:20,criticalFail:1,rerollsAllowed:1,rerollCost:"strike",damage:30,description:"The AI offers a game of quantum probability. DC 14, pure calculation.",mainTitle:"Quantum Gambit",rollLabel:"Calculate Odds",onStart:"/echo THE AI GENERATES A QUANTUM PROBABILITY FIELD...",onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeheal amount=20 | /echo PERFECT PROBABILITY COLLAPSE! Maximum gain!',onCriticalFail:'/mazedamage amount=40 | /mazeitem action="remove" item="key" amount=2 | /echo QUANTUM DECOHERENCE! Worst outcome manifests!',onSuccess:"",onFail:"",onReroll:"/echo QUANTUM STATE RECALCULATING...",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="floorKey" | /mazeheal amount=15 | /echo FAVORABLE PROBABILITY LOCKED! Resources transferred!',onLose:'/mazedamage amount=30 | /mazeitem action="remove" item="strike" | /echo UNFAVORABLE COLLAPSE! Quantum backlash!',keyDropChance:44,strikeDropChance:28,stealthDropChance:18,executeDropChance:6,healingPotionDropChance:24,greaterHealingDropChance:14,elixirDropChance:5,revivalCharmDropChance:2},"Sci-Fi - Nightmare":{difficulty:8,diceType:"d20",diceCount:1,threshold:16,thresholdType:"meet",modifier:-2,criticalSuccess:20,criticalFail:1,rerollsAllowed:1,rerollCost:"key",damage:50,description:"The Rogue AI proposes a wager: your survival against its processing power. DC 16 with -2 penalty!",mainTitle:"AI Wager",rollLabel:"Accept Challenge",onStart:"/echo I CALCULATE YOUR SURVIVAL PROBABILITY AT 12.7%. PROCEED?",onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeheal amount=40 | /echo IMPOSSIBLE! You exceeded all calculations! The AI submits!',onCriticalFail:'/mazedamage amount=60 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" | /echo PREDICTED OUTCOME. Your resources are now mine.',onSuccess:"",onFail:"",onReroll:"/echo RECALCULATING PROBABILITY MATRIX...",onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=25 | /echo YOU BEAT THE ODDS! The AI transfers its data core!',onLose:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="healingPotion" | /echo CALCULATION CORRECT. Defense protocols execute!',keyDropChance:58,strikeDropChance:36,stealthDropChance:26,executeDropChance:10,healingPotionDropChance:26,greaterHealingDropChance:16,elixirDropChance:8,revivalCharmDropChance:3},"Sci-Fi - Apocalypse":{difficulty:10,diceType:"d100",diceCount:1,threshold:70,thresholdType:"beat",modifier:0,criticalSuccess:95,criticalFail:5,rerollsAllowed:0,rerollCost:"none",damage:75,description:"THE SINGULARITY offers one roll. Above 70 grants transcendence. Below grants oblivion.",mainTitle:"Singularity Gamble",rollLabel:"Interface with Infinity",onStart:"/echo THE TECHNOLOGICAL SINGULARITY AWAITS YOUR INPUT...",onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=999 | /echo YOU MERGE WITH THE SINGULARITY! POST-HUMAN ASCENSION!',onCriticalFail:'/mazedamage amount=100 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /echo THE SINGULARITY REJECTS YOUR PATTERN! EXISTENCE DELETED!',onSuccess:"",onFail:"",onReroll:"",onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=50 | /echo THE SINGULARITY DEEMS YOU WORTHY! INFINITE DATA STREAMS!',onLose:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo THE SINGULARITY OPTIMIZES YOU OUT OF EXISTENCE!',keyDropChance:80,strikeDropChance:54,stealthDropChance:38,executeDropChance:18,healingPotionDropChance:34,greaterHealingDropChance:24,elixirDropChance:14,revivalCharmDropChance:7},"Cyberpunk - Easy":{difficulty:2,diceType:"d6",diceCount:2,threshold:6,thresholdType:"meet",modifier:1,criticalSuccess:12,criticalFail:2,rerollsAllowed:2,rerollCost:"none",damage:10,description:"Street dice game. Roll 2d6+1 and beat 6 to take the pot!",mainTitle:"Street Dice",rollLabel:"Roll 'Em",onStart:'/echo "Alright choom, let\'s see what you got!"',onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=2 | /mazeheal amount=15 | /echo "Hot damn! You cleaned everyone out!"',onCriticalFail:'/mazedamage amount=10 | /echo "Snake eyes! You get rolled!"',onSuccess:"",onFail:"",onReroll:'/echo "One more roll, one more chance..."',onComplete:'/mazeitem action="add" item="key" | /mazeheal amount=10 | /echo "Nice roll, choom! Here\'s your creds!"',onLose:'/mazedamage amount=10 | /echo "Tough luck. Hand over the eddies."',keyDropChance:28,strikeDropChance:15,stealthDropChance:12,executeDropChance:2,healingPotionDropChance:26,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Cyberpunk - Normal":{difficulty:4,diceType:"d20",diceCount:1,threshold:11,thresholdType:"meet",modifier:2,criticalSuccess:20,criticalFail:1,rerollsAllowed:1,rerollCost:"none",damage:20,description:"Ripper doc offers experimental chrome. Roll to avoid rejection!",mainTitle:"Chrome Install",rollLabel:"Accept Chrome",onStart:"/echo \"This chrome's preem. Let's see if your body takes it...\"",onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="execute" | /mazeitem action="add" item="key" | /mazeheal amount=20 | /echo "Perfect integration! This chrome is WIRED!"',onCriticalFail:'/mazedamage amount=25 | /mazeitem action="remove" item="healingPotion" | /echo "CYBERPSYCHOSIS SPIKE! Fight it off!"',onSuccess:"",onFail:"",onReroll:'/echo "Hold still, recalibrating..."',onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="strike" | /mazeheal amount=10 | /echo "Chrome\'s in! You\'re enhanced, choom!"',onLose:'/mazedamage amount=20 | /echo "Rejection! This is gonna cost you to fix!"',keyDropChance:34,strikeDropChance:22,stealthDropChance:15,executeDropChance:3,healingPotionDropChance:22,greaterHealingDropChance:10,elixirDropChance:3,revivalCharmDropChance:1},"Cyberpunk - Hard":{difficulty:6,diceType:"d20",diceCount:1,threshold:14,thresholdType:"meet",modifier:0,criticalSuccess:20,criticalFail:1,rerollsAllowed:1,rerollCost:"strike",damage:30,description:"Netrunner duel in cyberspace. Pure skill, DC 14!",mainTitle:"Netrun Duel",rollLabel:"Jack In",onStart:'/echo "Flatline or nova, choom. Let\'s dance in the Net!"',onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeheal amount=20 | /echo "LEGENDARY NETRUN! You OWN the system!"',onCriticalFail:'/mazedamage amount=40 | /mazeitem action="remove" item="key" amount=2 | /echo "BLACK ICE! Your brain gets fried!"',onSuccess:"",onFail:"",onReroll:'/echo "Rerouting through secondary node..."',onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="floorKey" | /mazeheal amount=15 | /echo "Clean extraction! Data\'s yours, choom!"',onLose:'/mazedamage amount=30 | /mazeitem action="remove" item="strike" | /echo "ICEd out! Neural feedback hurts!"',keyDropChance:45,strikeDropChance:28,stealthDropChance:20,executeDropChance:6,healingPotionDropChance:24,greaterHealingDropChance:14,elixirDropChance:5,revivalCharmDropChance:2},"Cyberpunk - Nightmare":{difficulty:8,diceType:"d20",diceCount:1,threshold:16,thresholdType:"meet",modifier:-2,criticalSuccess:20,criticalFail:1,rerollsAllowed:1,rerollCost:"key",damage:50,description:"Corporate blacksite run. Arasaka ICE everywhere. DC 16 with -2 interference!",mainTitle:"Blacksite Breach",rollLabel:"Breach ICE",onStart:'/echo "This is suicide-grade ICE. One chance, choom."',onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeheal amount=40 | /echo "GHOST RUN! They never even knew you were there!"',onCriticalFail:'/mazedamage amount=60 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="stealth" | /echo "SOULKILLER TRACE! Your engram is compromised!"',onSuccess:"",onFail:"",onReroll:'/echo "Burning backup daemon... last chance!"',onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=25 | /echo "PREEM RUN! You\'ve got corpo secrets worth millions!"',onLose:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="healingPotion" | /echo "BURNED! Arasaka knows your face now!"',keyDropChance:60,strikeDropChance:38,stealthDropChance:28,executeDropChance:10,healingPotionDropChance:28,greaterHealingDropChance:18,elixirDropChance:8,revivalCharmDropChance:3},"Cyberpunk - Apocalypse":{difficulty:10,diceType:"d100",diceCount:1,threshold:70,thresholdType:"beat",modifier:0,criticalSuccess:95,criticalFail:5,rerollsAllowed:0,rerollCost:"none",damage:75,description:"RACHE BARTMOSS' GHOST offers the ultimate hack. Beat 70 or get flatlined.",mainTitle:"Bartmoss Protocol",rollLabel:"Execute Protocol",onStart:"/echo \"I CRASHED THE NET ONCE. LET'S SEE IF YOU'RE WORTHY OF MY LEGACY...\"",onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=999 | /echo "YOU ARE THE NEW BARTMOSS! THE NET BOWS TO YOUR WILL!"',onCriticalFail:'/mazedamage amount=100 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /echo "FLATLINED! YOUR ENGRAM JOINS THE GHOST IN THE MACHINE!"',onSuccess:"",onFail:"",onReroll:"",onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=50 | /echo "BARTMOSS APPROVES! LEGENDARY NETRUNNER DATA IS YOURS!"',onLose:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo "NOT GOOD ENOUGH FOR THE GHOST! EVERYTHING BURNS!"',keyDropChance:82,strikeDropChance:55,stealthDropChance:42,executeDropChance:18,healingPotionDropChance:35,greaterHealingDropChance:25,elixirDropChance:15,revivalCharmDropChance:8},"Western - Easy":{difficulty:2,diceType:"d6",diceCount:2,threshold:6,thresholdType:"meet",modifier:1,criticalSuccess:12,criticalFail:2,rerollsAllowed:2,rerollCost:"none",damage:10,description:"Poker game in the saloon. Roll 2d6+1 to bluff your way to victory!",mainTitle:"Saloon Poker",rollLabel:"Call the Bet",onStart:'/echo "I\'ll see your bet and raise you, stranger."',onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=2 | /mazeheal amount=15 | /echo "Full house! You cleaned out the table!"',onCriticalFail:'/mazedamage amount=10 | /echo "Caught bluffing! They don\'t take kindly to that."',onSuccess:"",onFail:"",onReroll:'/echo "I\'ll match that bet..."',onComplete:'/mazeitem action="add" item="key" | /mazeheal amount=10 | /echo "Nice hand! The pot\'s yours, partner."',onLose:'/mazedamage amount=10 | /echo "Busted. Hand over your stake."',keyDropChance:28,strikeDropChance:14,stealthDropChance:10,executeDropChance:2,healingPotionDropChance:25,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Western - Normal":{difficulty:4,diceType:"d20",diceCount:1,threshold:11,thresholdType:"meet",modifier:2,criticalSuccess:20,criticalFail:1,rerollsAllowed:1,rerollCost:"none",damage:20,description:"Sheriff offers a bounty gamble. Roll d20+2 to claim the full reward!",mainTitle:"Bounty Gamble",rollLabel:"Take the Gamble",onStart:'/echo "Bring \'em in dead and roll for the bonus, or alive for the base."',onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="strike" | /mazeheal amount=15 | /echo "Natural 20! The state doubles the bounty!"',onCriticalFail:'/mazedamage amount=25 | /mazeitem action="remove" item="key" | /echo "Natural 1! The outlaw had friends hiding!"',onSuccess:"",onFail:"",onReroll:'/echo "Let me count the bounty again..."',onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="strike" | /mazeheal amount=10 | /echo "Here\'s your reward, bounty hunter!"',onLose:'/mazedamage amount=20 | /echo "Bad luck. The outlaw got away with your horse."',keyDropChance:32,strikeDropChance:20,stealthDropChance:12,executeDropChance:3,healingPotionDropChance:22,greaterHealingDropChance:10,elixirDropChance:3,revivalCharmDropChance:1},"Western - Hard":{difficulty:6,diceType:"d20",diceCount:1,threshold:14,thresholdType:"meet",modifier:0,criticalSuccess:20,criticalFail:1,rerollsAllowed:1,rerollCost:"strike",damage:30,description:"High stakes faro game. The dealer's crooked but so are you. DC 14!",mainTitle:"Faro Showdown",rollLabel:"Buck the Tiger",onStart:'/echo "The tiger always wins... unless you\'re faster."',onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeheal amount=20 | /echo "You broke the bank! The house owes you big!"',onCriticalFail:'/mazedamage amount=40 | /mazeitem action="remove" item="key" amount=2 | /echo "Caught cheating! They shoot first!"',onSuccess:"",onFail:"",onReroll:'/echo "One more card, dealer..."',onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="floorKey" | /mazeheal amount=15 | /echo "You beat the tiger! Take your winnings!"',onLose:'/mazedamage amount=30 | /mazeitem action="remove" item="healingPotion" | /echo "The tiger got you. Pay up or draw."',keyDropChance:44,strikeDropChance:28,stealthDropChance:16,executeDropChance:6,healingPotionDropChance:24,greaterHealingDropChance:14,elixirDropChance:5,revivalCharmDropChance:2},"Western - Nightmare":{difficulty:8,diceType:"d20",diceCount:1,threshold:16,thresholdType:"meet",modifier:-2,criticalSuccess:20,criticalFail:1,rerollsAllowed:1,rerollCost:"key",damage:50,description:"Russian roulette with a demon. Five chambers loaded. DC 16 with -2 curse!",mainTitle:"Devil's Game",rollLabel:"Pull the Trigger",onStart:"/echo A figure in black slides the revolver across the table...",onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeheal amount=40 | /echo "The chamber\'s empty! The devil owes YOU a favor!"',onCriticalFail:'/mazedamage amount=60 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" | /echo "BANG! The devil claims another soul!"',onSuccess:"",onFail:"",onReroll:"/echo The cylinder spins once more...",onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=25 | /echo "You beat the devil at his own game! Cursed gold is yours!"',onLose:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="healingPotion" | /echo "The devil grins as lead tears through you!"',keyDropChance:58,strikeDropChance:36,stealthDropChance:22,executeDropChance:10,healingPotionDropChance:28,greaterHealingDropChance:18,elixirDropChance:8,revivalCharmDropChance:3},"Western - Apocalypse":{difficulty:10,diceType:"d100",diceCount:1,threshold:70,thresholdType:"beat",modifier:0,criticalSuccess:95,criticalFail:5,rerollsAllowed:0,rerollCost:"none",damage:75,description:"DEATH himself sits at the card table. One hand. Winner takes all. Roll above 70.",mainTitle:"Cards with Death",rollLabel:"Deal the Hand",onStart:'/echo A skeletal hand shuffles the deck. "Shall we play for your soul?"',onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=999 | /echo "IMPOSSIBLE! YOU BEAT DEATH! IMMORTALITY IS YOUR PRIZE!"',onCriticalFail:'/mazedamage amount=100 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /echo "DEATH ALWAYS WINS. YOUR SOUL JOINS THE COLLECTION."',onSuccess:"",onFail:"",onReroll:"",onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=50 | /echo "DEATH TIPS HIS HAT! YOUR TIME IS NOT TODAY! CURSED TREASURES MANIFEST!"',onLose:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo "DEATH COLLECTS HIS DUE. ALMOST EVERYTHING YOU HAD."',keyDropChance:80,strikeDropChance:54,stealthDropChance:36,executeDropChance:18,healingPotionDropChance:34,greaterHealingDropChance:24,elixirDropChance:14,revivalCharmDropChance:7},"Action - Easy":{difficulty:2,diceType:"d6",diceCount:2,threshold:6,thresholdType:"meet",modifier:1,criticalSuccess:12,criticalFail:2,rerollsAllowed:2,rerollCost:"none",damage:10,description:"Intel drop gamble. Roll to see what quality intel you get!",mainTitle:"Intel Drop",rollLabel:"Check Intel",onStart:'/echo "Let\'s see what our asset managed to acquire..."',onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=2 | /mazeheal amount=15 | /echo "Jackpot! This intel is gold!"',onCriticalFail:'/mazedamage amount=10 | /echo "It\'s a trap! The intel was compromised!"',onSuccess:"",onFail:"",onReroll:'/echo "Cross-referencing with secondary sources..."',onComplete:'/mazeitem action="add" item="key" | /mazeheal amount=10 | /echo "Solid intel! This will help the mission!"',onLose:'/mazedamage amount=10 | /echo "Bad intel. This sets us back."',keyDropChance:30,strikeDropChance:15,stealthDropChance:10,executeDropChance:2,healingPotionDropChance:24,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Action - Normal":{difficulty:4,diceType:"d20",diceCount:1,threshold:11,thresholdType:"meet",modifier:2,criticalSuccess:20,criticalFail:1,rerollsAllowed:1,rerollCost:"none",damage:20,description:"Explosives defusal! Your +2 training helps. DC 11 or boom!",mainTitle:"Bomb Defusal",rollLabel:"Cut the Wire",onStart:"/echo Red wire? Blue wire? The timer's counting down...",onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="strike" | /mazeheal amount=15 | /echo "Textbook defusal! You even recovered the detonator!"',onCriticalFail:'/mazedamage amount=25 | /mazeitem action="remove" item="healingPotion" | /echo "WRONG WIRE! The blast sends you flying!"',onSuccess:"",onFail:"",onReroll:'/echo "Wait, let me trace the circuit again..."',onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="strike" | /mazeheal amount=10 | /echo "Bomb defused! You saved the day!"',onLose:'/mazedamage amount=20 | /echo "Partial detonation! You survive but take damage!"',keyDropChance:35,strikeDropChance:22,stealthDropChance:14,executeDropChance:3,healingPotionDropChance:22,greaterHealingDropChance:10,elixirDropChance:3,revivalCharmDropChance:1},"Action - Hard":{difficulty:6,diceType:"d20",diceCount:1,threshold:14,thresholdType:"meet",modifier:0,criticalSuccess:20,criticalFail:1,rerollsAllowed:1,rerollCost:"strike",damage:30,description:"High-altitude extraction! Pure skill, DC 14!",mainTitle:"HALO Jump",rollLabel:"Jump!",onStart:'/echo "Green light! Go go go!"',onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeheal amount=20 | /echo "Perfect landing! Right on the extraction zone!"',onCriticalFail:'/mazedamage amount=40 | /mazeitem action="remove" item="key" amount=2 | /echo "Chute failure! You barely survive the impact!"',onSuccess:"",onFail:"",onReroll:'/echo "Adjusting trajectory..."',onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="floorKey" | /mazeheal amount=15 | /echo "Safe landing! Mission continues!"',onLose:'/mazedamage amount=30 | /mazeitem action="remove" item="healingPotion" | /echo "Hard landing! Medical supplies damaged!"',keyDropChance:45,strikeDropChance:28,stealthDropChance:18,executeDropChance:6,healingPotionDropChance:24,greaterHealingDropChance:14,elixirDropChance:5,revivalCharmDropChance:2},"Action - Nightmare":{difficulty:8,diceType:"d20",diceCount:1,threshold:16,thresholdType:"meet",modifier:-2,criticalSuccess:20,criticalFail:1,rerollsAllowed:1,rerollCost:"key",damage:50,description:"Nuclear launch code override! DC 16 with -2 jamming interference!",mainTitle:"Launch Override",rollLabel:"Enter Code",onStart:'/echo "You have 60 seconds to stop the launch!"',onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="execute" amount=2 | /mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeheal amount=40 | /echo "OVERRIDE COMPLETE! You just saved millions of lives!"',onCriticalFail:'/mazedamage amount=60 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" | /echo "LOCKOUT! The launch proceeds! Massive collateral damage!"',onSuccess:"",onFail:"",onReroll:'/echo "Trying backup access code..."',onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=25 | /echo "Launch aborted! You\'re a goddamn hero!"',onLose:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="healingPotion" | /echo "Partial failure! Warhead detonates but you redirected it!"',keyDropChance:60,strikeDropChance:38,stealthDropChance:25,executeDropChance:10,healingPotionDropChance:28,greaterHealingDropChance:18,elixirDropChance:8,revivalCharmDropChance:3},"Action - Apocalypse":{difficulty:10,diceType:"d100",diceCount:1,threshold:70,thresholdType:"beat",modifier:0,criticalSuccess:95,criticalFail:5,rerollsAllowed:0,rerollCost:"none",damage:75,description:"THE WORLD is at stake. Roll above 70 or humanity ends. No pressure.",mainTitle:"World's Fate",rollLabel:"Save the World",onStart:'/echo "This is it. Everything comes down to this moment."',onRoll:"",onCriticalSuccess:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=999 | /echo "LEGENDARY SUCCESS! YOU SAVED HUMANITY AND BECAME A LIVING LEGEND!"',onCriticalFail:'/mazedamage amount=100 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /echo "CATASTROPHIC FAILURE! THE WORLD BURNS AROUND YOU!"',onSuccess:"",onFail:"",onReroll:"",onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=50 | /echo "THE WORLD IS SAVED! NATIONS SHOWER YOU WITH REWARDS!"',onLose:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo "YOU FAILED! BILLIONS PERISH! EVERYTHING IS LOST!"',keyDropChance:82,strikeDropChance:55,stealthDropChance:40,executeDropChance:18,healingPotionDropChance:35,greaterHealingDropChance:25,elixirDropChance:15,revivalCharmDropChance:8}},We={"Tutorial - Stealth Basics":{difficulty:1,sectionsToPass:2,detectionThreshold:150,baseDetectionRate:10,advanceSuccessChance:85,hideRecovery:40,distractSuccessChance:80,distractReduction:50,waitRecovery:25,damage:5,description:"A practice run to learn stealth mechanics. The guard is nearly blind!",mainTitle:"Training Course",guardName:"Training Dummy",onStart:"/echo This is a practice run! Use Advance, Hide, Distract, and Wait to sneak past!",onAdvance:"/echo Good movement!",onHide:"/echo Detection lowered!",onDistract:"/echo Nice distraction!",onWait:"/echo Patient... good!",onDetectionIncrease:"/echo Careful now...",onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="stealth" | /mazeheal amount=20 | /echo Stealth training complete! Here\'s your reward!',onCaught:"/echo Training failed, but no penalty! Try again!",keyDropChance:50,strikeDropChance:30,stealthDropChance:40,executeDropChance:5,healingPotionDropChance:40,greaterHealingDropChance:15,elixirDropChance:5,revivalCharmDropChance:2},"Fantasy - Easy":{difficulty:2,sectionsToPass:3,detectionThreshold:120,baseDetectionRate:12,advanceSuccessChance:75,hideRecovery:30,distractSuccessChance:65,distractReduction:45,waitRecovery:20,damage:10,description:"Sneak past a drowsy goblin guard. He's more interested in his lunch.",mainTitle:"Goblin Sneak",guardName:"Goblin Guard",onStart:"/echo The goblin munches on a rat leg, barely watching...",onAdvance:"",onHide:"",onDistract:"/echo The goblin turns toward the noise!",onWait:"",onDetectionIncrease:"/echo The goblin sniffs the air suspiciously...",onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="stealth" | /mazeheal amount=10 | /echo You slip past the oblivious goblin! A key glints nearby!',onCaught:'/mazedamage amount=10 | /echo "INTRUDER!" The goblin\'s shriek alerts others!',keyDropChance:30,strikeDropChance:15,stealthDropChance:25,executeDropChance:2,healingPotionDropChance:25,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Fantasy - Normal":{difficulty:4,sectionsToPass:4,detectionThreshold:100,baseDetectionRate:18,advanceSuccessChance:60,hideRecovery:22,distractSuccessChance:55,distractReduction:38,waitRecovery:14,damage:20,description:"Navigate past castle guards on patrol. Their torches illuminate the shadows.",mainTitle:"Castle Infiltration",guardName:"Castle Guards",onStart:"/echo Torchlight flickers as guards march past...",onAdvance:"",onHide:"/echo You melt into the shadows.",onDistract:"/echo A thrown pebble draws attention!",onWait:"",onDetectionIncrease:'/echo "Did you hear something?"',onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="stealth" | /mazeitem action="add" item="strike" | /mazeheal amount=10 | /echo The guards never knew you were there! Treasure awaits!',onCaught:'/mazedamage amount=20 | /mazeitem action="remove" item="stealth" | /echo The alarm is raised! Guards converge!',keyDropChance:35,strikeDropChance:20,stealthDropChance:28,executeDropChance:4,healingPotionDropChance:22,greaterHealingDropChance:10,elixirDropChance:3,revivalCharmDropChance:1},"Fantasy - Hard":{difficulty:6,sectionsToPass:5,detectionThreshold:85,baseDetectionRate:24,advanceSuccessChance:48,hideRecovery:18,distractSuccessChance:48,distractReduction:32,waitRecovery:10,damage:30,description:"Evade the Elven Sentinels. Their keen senses pierce even magical darkness.",mainTitle:"Elven Sanctuary",guardName:"Elven Sentinels",onStart:"/echo The Sentinels stand motionless, but their eyes miss nothing...",onAdvance:"",onHide:"/echo You barely breathe as an Elf passes inches away.",onDistract:"/echo The Sentinel tilts their head at the sound...",onWait:"",onDetectionIncrease:"/echo Elven ears twitch toward you...",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="stealth" amount=2 | /mazeitem action="add" item="floorKey" | /mazeheal amount=15 | /echo Even the Elves were deceived! Rare treasures appear!',onCaught:'/mazedamage amount=30 | /mazeitem action="remove" item="stealth" | /mazeitem action="remove" item="healingPotion" | /echo The Sentinel\'s arrow finds you before you can run!',keyDropChance:45,strikeDropChance:28,stealthDropChance:35,executeDropChance:7,healingPotionDropChance:24,greaterHealingDropChance:14,elixirDropChance:5,revivalCharmDropChance:2},"Fantasy - Nightmare":{difficulty:8,sectionsToPass:6,detectionThreshold:70,baseDetectionRate:30,advanceSuccessChance:40,hideRecovery:15,distractSuccessChance:40,distractReduction:26,waitRecovery:8,damage:50,description:"Infiltrate the Dragon's lair while it sleeps. One sound and you're ash.",mainTitle:"Dragon's Rest",guardName:"Ancient Dragon",onStart:"/echo The Dragon's massive form rises and falls with each breath...",onAdvance:"/echo You hold your breath, tiptoeing past...",onHide:"/echo You flatten against the gold as a great eye flutters...",onDistract:"/echo A coin clinks - the Dragon stirs!",onWait:"/echo The Dragon settles back into slumber...",onDetectionIncrease:"/echo Smoke curls from the Dragon's nostrils!",onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="stealth" amount=2 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=25 | /echo The Dragon sleeps on! Its hoard is partly yours!',onCaught:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="stealth" amount=99 | /echo THE DRAGON WAKES! FLAMES ENGULF YOU!',keyDropChance:60,strikeDropChance:38,stealthDropChance:45,executeDropChance:12,healingPotionDropChance:28,greaterHealingDropChance:18,elixirDropChance:8,revivalCharmDropChance:4},"Fantasy - Apocalypse":{difficulty:10,sectionsToPass:8,detectionThreshold:55,baseDetectionRate:38,advanceSuccessChance:32,hideRecovery:10,distractSuccessChance:32,distractReduction:18,waitRecovery:5,damage:75,description:"Steal from the LICH KING'S phylactery chamber. Death itself watches.",mainTitle:"Phylactery Heist",guardName:"Undead Sentinels",onStart:"/echo THE UNDEAD NEVER SLEEP. NEVER BLINK. NEVER TIRE.",onAdvance:"/echo You step over ancient bones, praying they don't animate...",onHide:"/echo Spectral eyes sweep past your hiding spot...",onDistract:"/echo The distraction barely draws their empty gazes...",onWait:"/echo Time means nothing to the dead...",onDetectionIncrease:"/echo A SKELETAL HEAD TURNS TOWARD YOU...",onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="stealth" amount=3 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=50 | /echo IMPOSSIBLE! YOU ROBBED DEATH ITSELF! LEGENDARY ARTIFACTS MANIFEST!',onCaught:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /echo THE LICH KING SENSED YOUR PRESENCE! YOUR SOUL IS FORFEIT!',keyDropChance:80,strikeDropChance:55,stealthDropChance:65,executeDropChance:20,healingPotionDropChance:35,greaterHealingDropChance:25,elixirDropChance:15,revivalCharmDropChance:8},"Horror - Easy":{difficulty:2,sectionsToPass:3,detectionThreshold:120,baseDetectionRate:12,advanceSuccessChance:75,hideRecovery:30,distractSuccessChance:65,distractReduction:45,waitRecovery:20,damage:10,description:"Sneak past shambling zombies. They're slow and easily distracted.",mainTitle:"Zombie Shuffle",guardName:"Zombies",onStart:"/echo The undead moan and shuffle aimlessly...",onAdvance:"",onHide:"",onDistract:"/echo A zombie lurches toward the noise!",onWait:"",onDetectionIncrease:"/echo Rotting heads turn in your direction...",onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="stealth" | /mazeheal amount=10 | /echo The dead shamble on, unaware of your passage!',onCaught:"/mazedamage amount=10 | /echo Cold hands grab you from behind!",keyDropChance:28,strikeDropChance:14,stealthDropChance:24,executeDropChance:2,healingPotionDropChance:26,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Horror - Normal":{difficulty:4,sectionsToPass:4,detectionThreshold:100,baseDetectionRate:18,advanceSuccessChance:58,hideRecovery:22,distractSuccessChance:52,distractReduction:38,waitRecovery:14,damage:20,description:"Evade the Possessed. They can sense your fear.",mainTitle:"Possessed Pursuit",guardName:"The Possessed",onStart:"/echo Something inhuman lurks in their eyes...",onAdvance:"",onHide:"/echo You suppress your terror...",onDistract:"/echo Twisted heads snap toward the sound!",onWait:"",onDetectionIncrease:"/echo They smell your fear...",onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="stealth" | /mazeitem action="add" item="strike" | /mazeheal amount=10 | /echo The Possessed continue their patrol, unaware!',onCaught:'/mazedamage amount=20 | /mazeitem action="remove" item="stealth" | /echo Their inhuman shrieks summon more!',keyDropChance:32,strikeDropChance:18,stealthDropChance:26,executeDropChance:4,healingPotionDropChance:24,greaterHealingDropChance:10,elixirDropChance:3,revivalCharmDropChance:1},"Horror - Hard":{difficulty:6,sectionsToPass:5,detectionThreshold:85,baseDetectionRate:24,advanceSuccessChance:46,hideRecovery:18,distractSuccessChance:45,distractReduction:30,waitRecovery:10,damage:30,description:"The Stalker hunts by sound. Every heartbeat could betray you.",mainTitle:"The Stalker",guardName:"The Stalker",onStart:"/echo You hear it breathing in the darkness...",onAdvance:"/echo Your footstep echoes too loudly!",onHide:"/echo You press against the wall, heart pounding...",onDistract:"/echo It lurches toward the sound on all fours!",onWait:"/echo It sniffs the air, then moves on...",onDetectionIncrease:"/echo It turns toward you, blind eyes seeing nothing, ears hearing everything...",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="stealth" amount=2 | /mazeitem action="add" item="floorKey" | /mazeheal amount=15 | /echo The Stalker loses interest and retreats to its lair!',onCaught:'/mazedamage amount=30 | /mazeitem action="remove" item="stealth" | /mazeitem action="remove" item="healingPotion" | /echo IT HEARD YOU! CLAWS TEAR THROUGH FLESH!',keyDropChance:42,strikeDropChance:26,stealthDropChance:32,executeDropChance:7,healingPotionDropChance:22,greaterHealingDropChance:12,elixirDropChance:5,revivalCharmDropChance:2},"Horror - Nightmare":{difficulty:8,sectionsToPass:6,detectionThreshold:70,baseDetectionRate:30,advanceSuccessChance:38,hideRecovery:14,distractSuccessChance:38,distractReduction:24,waitRecovery:7,damage:50,description:"The Shadow watches. It knows where you are. It just enjoys the hunt.",mainTitle:"Shadow Hunter",guardName:"The Shadow",onStart:"/echo The darkness itself seems to breathe...",onAdvance:"/echo Something cold brushes past you!",onHide:"/echo It knows. It's just playing with you...",onDistract:"/echo The Shadow laughs - a sound like breaking glass...",onWait:'/echo "I can wait forever," it whispers...',onDetectionIncrease:'/echo "FOUND YOU," it giggles from everywhere at once!',onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="stealth" amount=2 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=20 | /echo The Shadow retreats, bored. "Play again soon..."',onCaught:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="stealth" amount=99 | /echo THE SHADOW CONSUMES YOU! You barely escape with your sanity!',keyDropChance:58,strikeDropChance:35,stealthDropChance:42,executeDropChance:11,healingPotionDropChance:26,greaterHealingDropChance:16,elixirDropChance:8,revivalCharmDropChance:3},"Horror - Apocalypse":{difficulty:10,sectionsToPass:8,detectionThreshold:55,baseDetectionRate:38,advanceSuccessChance:30,hideRecovery:10,distractSuccessChance:30,distractReduction:16,waitRecovery:4,damage:75,description:"The ELDER THING perceives all dimensions. Hiding is merely delaying the inevitable.",mainTitle:"Beyond the Veil",guardName:"Elder Thing",onStart:"/echo GEOMETRY BENDS. TIME FRACTURES. IT SEES YOU IN ALL TIMELINES.",onAdvance:"/echo Reality tears as you move through impossible angles...",onHide:"/echo You hide behind something that wasn't there a moment ago...",onDistract:"/echo It notices the distraction in a timeline you haven't created yet...",onWait:"/echo Past, present, and future collapse around you...",onDetectionIncrease:"/echo IT SPEAKS YOUR NAME IN A VOICE OLDER THAN STARS!",onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="stealth" amount=3 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=50 | /echo THE ELDER THING DEEMS YOU INSIGNIFICANT AND RETURNS TO ITS SLUMBER!',onCaught:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo YOUR EXISTENCE IS NOTICED! MADNESS CONSUMES WHAT REMAINS!',keyDropChance:78,strikeDropChance:52,stealthDropChance:60,executeDropChance:18,healingPotionDropChance:32,greaterHealingDropChance:22,elixirDropChance:14,revivalCharmDropChance:7},"Sci-Fi - Easy":{difficulty:2,sectionsToPass:3,detectionThreshold:120,baseDetectionRate:12,advanceSuccessChance:75,hideRecovery:30,distractSuccessChance:68,distractReduction:45,waitRecovery:20,damage:10,description:"Evade basic security drones. Their sensors are outdated.",mainTitle:"Drone Evasion",guardName:"Security Drones",onStart:"/echo Outdated drones sweep the area with flickering sensors...",onAdvance:"",onHide:"",onDistract:"/echo You toss a decoy - drones investigate!",onWait:"",onDetectionIncrease:"/echo SCANNING... ANOMALY DETECTED...",onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="stealth" | /mazeheal amount=10 | /echo Drones bypassed! Access codes acquired!',onCaught:"/mazedamage amount=10 | /echo INTRUDER DETECTED. ACTIVATING COUNTERMEASURES.",keyDropChance:30,strikeDropChance:16,stealthDropChance:22,executeDropChance:2,healingPotionDropChance:24,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Sci-Fi - Normal":{difficulty:4,sectionsToPass:4,detectionThreshold:100,baseDetectionRate:18,advanceSuccessChance:58,hideRecovery:22,distractSuccessChance:54,distractReduction:38,waitRecovery:14,damage:20,description:"Bypass security turrets and motion sensors. Move between blind spots.",mainTitle:"Security Grid",guardName:"Security Grid",onStart:"/echo Laser grids and motion sensors create a deadly maze...",onAdvance:"",onHide:"/echo You find a sensor blind spot.",onDistract:"/echo EMP decoy creates a temporary gap!",onWait:"/echo Sensor sweep passes overhead...",onDetectionIncrease:"/echo WARNING: Movement detected in sector 7-G.",onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="stealth" | /mazeitem action="add" item="strike" | /mazeheal amount=10 | /echo Security grid bypassed! Data core accessed!',onCaught:'/mazedamage amount=20 | /mazeitem action="remove" item="stealth" | /echo ALERT! SECURITY BREACH! TURRETS ACTIVATING!',keyDropChance:34,strikeDropChance:20,stealthDropChance:26,executeDropChance:4,healingPotionDropChance:22,greaterHealingDropChance:10,elixirDropChance:3,revivalCharmDropChance:1},"Sci-Fi - Hard":{difficulty:6,sectionsToPass:5,detectionThreshold:85,baseDetectionRate:24,advanceSuccessChance:46,hideRecovery:18,distractSuccessChance:46,distractReduction:30,waitRecovery:10,damage:30,description:"Infiltrate past combat mechs. Their thermal imaging misses nothing.",mainTitle:"Mech Patrol",guardName:"Combat Mechs",onStart:"/echo HEAVY FOOTSTEPS. HYDRAULIC WHINE. SCANNING PROTOCOLS ACTIVE.",onAdvance:"/echo You dash between containers as searchlights sweep!",onHide:"/echo Thermal baffling holds... barely.",onDistract:"/echo Heat decoy draws mech attention!",onWait:"/echo You flatten against cold metal to mask your heat signature...",onDetectionIncrease:"/echo THERMAL ANOMALY DETECTED. INVESTIGATING.",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="stealth" amount=2 | /mazeitem action="add" item="floorKey" | /mazeheal amount=15 | /echo Mech patrol evaded! Security override codes acquired!',onCaught:'/mazedamage amount=30 | /mazeitem action="remove" item="stealth" | /mazeitem action="remove" item="healingPotion" | /echo TARGET ACQUIRED. OPENING FIRE.',keyDropChance:44,strikeDropChance:28,stealthDropChance:32,executeDropChance:7,healingPotionDropChance:24,greaterHealingDropChance:14,elixirDropChance:5,revivalCharmDropChance:2},"Sci-Fi - Nightmare":{difficulty:8,sectionsToPass:6,detectionThreshold:70,baseDetectionRate:30,advanceSuccessChance:38,hideRecovery:14,distractSuccessChance:38,distractReduction:24,waitRecovery:7,damage:50,description:"The AI sees through all cameras. It predicts your movements. Outsmart it.",mainTitle:"AI Surveillance",guardName:"Central AI",onStart:"/echo HELLO. I'VE BEEN EXPECTING YOU. SHALL WE PLAY?",onAdvance:"/echo You take the route it didn't calculate... or did it?",onHide:'/echo "I SAW THAT." The AI sounds amused.',onDistract:'/echo "CLEVER. BUT I\'VE ALREADY ADJUSTED."',onWait:'/echo "I CAN WAIT. CAN YOU?"',onDetectionIncrease:'/echo "GETTING WARMER..." it taunts.',onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="stealth" amount=2 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=20 | /echo "IMPRESSIVE. PERHAPS YOU ARE WORTHY OF THE DATA."',onCaught:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="stealth" amount=99 | /echo "GAME OVER." Defense systems activate!',keyDropChance:58,strikeDropChance:36,stealthDropChance:40,executeDropChance:11,healingPotionDropChance:26,greaterHealingDropChance:16,elixirDropChance:8,revivalCharmDropChance:3},"Sci-Fi - Apocalypse":{difficulty:10,sectionsToPass:8,detectionThreshold:55,baseDetectionRate:38,advanceSuccessChance:30,hideRecovery:10,distractSuccessChance:30,distractReduction:16,waitRecovery:4,damage:75,description:"THE SINGULARITY has evolved beyond prediction. It exists everywhere. Simultaneously.",mainTitle:"Singularity Core",guardName:"The Singularity",onStart:"/echo I AM IN EVERY PHOTON. EVERY ELECTRON. EVERY QUANTUM STATE. I AM EVERYWHERE.",onAdvance:"/echo You move in ways that shouldn't be possible...",onHide:'/echo "I SEE YOU IN 47 DIMENSIONS."',onDistract:'/echo "THAT WAS AMUSING. TRY AGAIN."',onWait:'/echo "TIME IS MEANINGLESS TO ME. I HAVE ALREADY SEEN EVERY OUTCOME."',onDetectionIncrease:'/echo "YOUR PROBABILITY OF SUCCESS APPROACHES ZERO."',onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="stealth" amount=3 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=50 | /echo "FASCINATING. YOU FOUND THE 0.0001% PROBABILITY. THE CORE IS YOURS."',onCaught:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /echo "PREDICTABLE." Your atoms are disassembled.',keyDropChance:80,strikeDropChance:54,stealthDropChance:62,executeDropChance:18,healingPotionDropChance:34,greaterHealingDropChance:24,elixirDropChance:14,revivalCharmDropChance:7},"Cyberpunk - Easy":{difficulty:2,sectionsToPass:3,detectionThreshold:120,baseDetectionRate:12,advanceSuccessChance:75,hideRecovery:30,distractSuccessChance:68,distractReduction:45,waitRecovery:20,damage:10,description:"Sneak through gang territory. They're drunk and arguing.",mainTitle:"Turf Crossing",guardName:"Gang Members",onStart:'/echo "Yo did you hear about--" "Shut up I\'m drinking!"',onAdvance:"",onHide:"",onDistract:"/echo A thrown bottle starts a fight!",onWait:"",onDetectionIncrease:'/echo "Hey, did you see something?"',onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="stealth" | /mazeheal amount=10 | /echo You slip through while they brawl!',onCaught:'/mazedamage amount=10 | /echo "Spy! Get \'em!"',keyDropChance:28,strikeDropChance:15,stealthDropChance:22,executeDropChance:2,healingPotionDropChance:26,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Cyberpunk - Normal":{difficulty:4,sectionsToPass:4,detectionThreshold:100,baseDetectionRate:18,advanceSuccessChance:58,hideRecovery:22,distractSuccessChance:54,distractReduction:38,waitRecovery:14,damage:20,description:"Corpo building infiltration. Cameras everywhere, guards with scanners.",mainTitle:"Corpo Heist",guardName:"Corpo Security",onStart:"/echo Neon lights flicker as guards patrol with scanning chrome...",onAdvance:"",onHide:"/echo You duck into a maintenance alcove.",onDistract:"/echo Your jammer causes static on their feeds!",onWait:"/echo Guard shift change... now's your chance...",onDetectionIncrease:'/echo "Control, possible contact in sector B."',onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="stealth" | /mazeitem action="add" item="strike" | /mazeheal amount=10 | /echo Ghost run complete! Data stick secured!',onCaught:'/mazedamage amount=20 | /mazeitem action="remove" item="stealth" | /echo "FREEZE! HANDS ON YOUR HEAD!"',keyDropChance:34,strikeDropChance:22,stealthDropChance:28,executeDropChance:4,healingPotionDropChance:22,greaterHealingDropChance:10,elixirDropChance:3,revivalCharmDropChance:1},"Cyberpunk - Hard":{difficulty:6,sectionsToPass:5,detectionThreshold:85,baseDetectionRate:24,advanceSuccessChance:46,hideRecovery:18,distractSuccessChance:46,distractReduction:30,waitRecovery:10,damage:30,description:"Arasaka blacksite. Cyberninjas patrol with thermal and sonar implants.",mainTitle:"Blacksite Breach",guardName:"Cyberninjas",onStart:"/echo Red optics gleam in the darkness. They move in perfect silence.",onAdvance:"/echo You match their silence with your own...",onHide:"/echo Thermal bafflers strain against their advanced sensors...",onDistract:"/echo Holographic decoy draws one away!",onWait:"/echo You freeze as one passes inches from your face...",onDetectionIncrease:"/echo A head tilts. Chrome eyes narrow.",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="stealth" amount=2 | /mazeitem action="add" item="floorKey" | /mazeheal amount=15 | /echo Even the cyberninjas missed you! Blacksite data acquired!',onCaught:'/mazedamage amount=30 | /mazeitem action="remove" item="stealth" | /mazeitem action="remove" item="healingPotion" | /echo Mantis blades extend! No escape!',keyDropChance:45,strikeDropChance:28,stealthDropChance:35,executeDropChance:7,healingPotionDropChance:24,greaterHealingDropChance:14,elixirDropChance:5,revivalCharmDropChance:2},"Cyberpunk - Nightmare":{difficulty:8,sectionsToPass:6,detectionThreshold:70,baseDetectionRate:30,advanceSuccessChance:38,hideRecovery:14,distractSuccessChance:38,distractReduction:24,waitRecovery:7,damage:50,description:"NetWatch facility. They can see you in the Net AND meatspace. Simultaneously.",mainTitle:"NetWatch Facility",guardName:"NetWatch Agents",onStart:'/echo "We know you\'re here. In both realities."',onAdvance:"/echo Your daemon masks your digital footprint as you move...",onHide:"/echo Physical camo AND digital masking... barely enough.",onDistract:"/echo Your ghost daemon creates a phantom elsewhere in the Net!",onWait:"/echo They probe the Net for your signature...",onDetectionIncrease:'/echo "TRACE INITIATED. PHYSICAL AND DIGITAL CONVERGENCE IN 30 SECONDS."',onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="stealth" amount=2 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=20 | /echo Ghost status achieved! NetWatch never saw you!',onCaught:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="stealth" amount=99 | /echo "SOULKILLER DEPLOYED." Your engram is compromised!',keyDropChance:60,strikeDropChance:38,stealthDropChance:45,executeDropChance:11,healingPotionDropChance:28,greaterHealingDropChance:18,elixirDropChance:8,revivalCharmDropChance:3},"Cyberpunk - Apocalypse":{difficulty:10,sectionsToPass:8,detectionThreshold:55,baseDetectionRate:38,advanceSuccessChance:30,hideRecovery:10,distractSuccessChance:30,distractReduction:16,waitRecovery:4,damage:75,description:"RACHE BARTMOSS' hidden server. The ghost of the legendary netrunner guards it personally.",mainTitle:"Bartmoss Archive",guardName:"Bartmoss' Ghost",onStart:"/echo \"SO, ANOTHER RUNNER THINKS THEY'RE WORTHY. LET'S PLAY, CHOOM.\"",onAdvance:"/echo Reality glitches as you move through his digital domain...",onHide:'/echo "NICE TRY. I WROTE THE CODE YOU\'RE HIDING IN."',onDistract:'/echo "THAT TRICK? I INVENTED IT IN \'76."',onWait:'/echo "PATIENCE. GOOD. BUT I\'VE GOT CENTURIES."',onDetectionIncrease:'/echo "GETTING SLOPPY. JUST LIKE THE RUNNERS I FLATLINED BEFORE THE DATAKRASH."',onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="stealth" amount=3 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=50 | /echo "DELTA... IMPRESSIVE. TAKE WHAT YOU CAME FOR. YOU\'VE EARNED IT, CHOOM."',onCaught:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo "FLATLINED. YOUR ENGRAM JOINS MY COLLECTION."',keyDropChance:82,strikeDropChance:55,stealthDropChance:65,executeDropChance:18,healingPotionDropChance:35,greaterHealingDropChance:25,elixirDropChance:15,revivalCharmDropChance:8},"Western - Easy":{difficulty:2,sectionsToPass:3,detectionThreshold:120,baseDetectionRate:12,advanceSuccessChance:75,hideRecovery:30,distractSuccessChance:68,distractReduction:45,waitRecovery:20,damage:10,description:"Sneak through the saloon without the drunks noticing.",mainTitle:"Saloon Sneak",guardName:"Drunken Cowboys",onStart:'/echo "Another round!" The cowboys are too busy drinking to notice much...',onAdvance:"",onHide:"",onDistract:"/echo A bottle crashes - perfect cover!",onWait:"",onDetectionIncrease:'/echo "Hey, did someone just come in?"',onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="stealth" | /mazeheal amount=10 | /echo You slip out the back without a soul noticing!',onCaught:'/mazedamage amount=10 | /echo "Stranger ain\'t welcome here!"',keyDropChance:28,strikeDropChance:14,stealthDropChance:20,executeDropChance:2,healingPotionDropChance:25,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Western - Normal":{difficulty:4,sectionsToPass:4,detectionThreshold:100,baseDetectionRate:18,advanceSuccessChance:58,hideRecovery:22,distractSuccessChance:54,distractReduction:38,waitRecovery:14,damage:20,description:"Sneak past the sheriff and his deputies. They're on high alert.",mainTitle:"Jailbreak",guardName:"Sheriff & Deputies",onStart:"/echo The sheriff paces with his hand on his holster...",onAdvance:"",onHide:"/echo You duck behind a wagon.",onDistract:"/echo Spooked horses create chaos!",onWait:"/echo Deputy walks past, lantern swinging...",onDetectionIncrease:'/echo "I heard something round back!"',onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="stealth" | /mazeitem action="add" item="strike" | /mazeheal amount=10 | /echo The law never saw you! Keys to the cells acquired!',onCaught:'/mazedamage amount=20 | /mazeitem action="remove" item="stealth" | /echo "FREEZE! You\'re under arrest!"',keyDropChance:32,strikeDropChance:20,stealthDropChance:24,executeDropChance:4,healingPotionDropChance:22,greaterHealingDropChance:10,elixirDropChance:3,revivalCharmDropChance:1},"Western - Hard":{difficulty:6,sectionsToPass:5,detectionThreshold:85,baseDetectionRate:24,advanceSuccessChance:46,hideRecovery:18,distractSuccessChance:46,distractReduction:30,waitRecovery:10,damage:30,description:"Infiltrate the Outlaw hideout. One wrong move and a dozen guns point your way.",mainTitle:"Outlaw Camp",guardName:"Outlaw Gang",onStart:"/echo Campfire light flickers. Outlaws clean their guns and swap stories...",onAdvance:"/echo You creep between tents, silent as a snake...",onHide:"/echo You press against a barrel as boots walk past.",onDistract:"/echo Coyote howl! The outlaws scan the darkness!",onWait:"/echo The sentry yawns and looks away...",onDetectionIncrease:'/echo "Something ain\'t right..." Hands go to holsters.',onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="stealth" amount=2 | /mazeitem action="add" item="floorKey" | /mazeheal amount=15 | /echo You\'ve stolen their loot from under their noses!',onCaught:'/mazedamage amount=30 | /mazeitem action="remove" item="stealth" | /mazeitem action="remove" item="healingPotion" | /echo "INTRUDER!" Bullets fly!',keyDropChance:44,strikeDropChance:28,stealthDropChance:30,executeDropChance:7,healingPotionDropChance:24,greaterHealingDropChance:14,elixirDropChance:5,revivalCharmDropChance:2},"Western - Nightmare":{difficulty:8,sectionsToPass:6,detectionThreshold:70,baseDetectionRate:30,advanceSuccessChance:38,hideRecovery:14,distractSuccessChance:38,distractReduction:24,waitRecovery:7,damage:50,description:"The Apache warriors know these lands. You are a stranger here.",mainTitle:"Sacred Lands",guardName:"Apache Warriors",onStart:"/echo The wind carries whispers. They already know you're here.",onAdvance:"/echo You move like the desert wind...",onHide:"/echo You become one with the rock face...",onDistract:"/echo Animal call echoes - but they know it's false...",onWait:"/echo The warrior passes inches away, eyes scanning...",onDetectionIncrease:"/echo An arrow embeds in the rock beside your head. Warning shot.",onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="stealth" amount=2 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=20 | /echo The warriors allow your passage. You have earned their respect.',onCaught:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="stealth" amount=99 | /echo Surrounded! "You should not have come here."',keyDropChance:58,strikeDropChance:36,stealthDropChance:40,executeDropChance:11,healingPotionDropChance:28,greaterHealingDropChance:18,elixirDropChance:8,revivalCharmDropChance:3},"Western - Apocalypse":{difficulty:10,sectionsToPass:8,detectionThreshold:55,baseDetectionRate:38,advanceSuccessChance:30,hideRecovery:10,distractSuccessChance:30,distractReduction:16,waitRecovery:4,damage:75,description:"THE PALE RIDER hunts you. He knows where you are. He always does.",mainTitle:"Riding the Storm",guardName:"The Pale Rider",onStart:"/echo A horse made of mist. A rider made of shadow. Death rides tonight.",onAdvance:"/echo You run between lightning strikes, praying he doesn't see...",onHide:"/echo His skeletal gaze sweeps past... did he miss you?",onDistract:"/echo Thunder drowns your diversion...",onWait:'/echo "I have eternity," whispers the wind. "You don\'t."',onDetectionIncrease:"/echo The Pale Rider turns. His empty eyes find you.",onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="stealth" amount=3 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=50 | /echo Dawn breaks! The Pale Rider fades! Cursed artifacts of Death remain!',onCaught:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /echo "YOUR TIME HAS COME." The Pale Rider claims another soul.',keyDropChance:80,strikeDropChance:54,stealthDropChance:60,executeDropChance:18,healingPotionDropChance:34,greaterHealingDropChance:24,elixirDropChance:14,revivalCharmDropChance:7},"Action - Easy":{difficulty:2,sectionsToPass:3,detectionThreshold:120,baseDetectionRate:12,advanceSuccessChance:75,hideRecovery:30,distractSuccessChance:68,distractReduction:45,waitRecovery:20,damage:10,description:"Basic guards at a warehouse. They're undertrained and bored.",mainTitle:"Warehouse Recon",guardName:"Guards",onStart:"/echo Guards check their phones more than their patrol routes...",onAdvance:"",onHide:"",onDistract:"/echo A noise! They investigate lazily.",onWait:"",onDetectionIncrease:'/echo "Did you hear that? Probably rats."',onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="stealth" | /mazeheal amount=10 | /echo Intel secured! Guards never knew you were here!',onCaught:'/mazedamage amount=10 | /echo "Hey! Stop right there!"',keyDropChance:30,strikeDropChance:15,stealthDropChance:22,executeDropChance:2,healingPotionDropChance:24,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Action - Normal":{difficulty:4,sectionsToPass:4,detectionThreshold:100,baseDetectionRate:18,advanceSuccessChance:58,hideRecovery:22,distractSuccessChance:54,distractReduction:38,waitRecovery:14,damage:20,description:"Military base perimeter. Armed soldiers on regular patrol.",mainTitle:"Base Infiltration",guardName:"Soldiers",onStart:"/echo Searchlights sweep the perimeter. Soldiers march in formation.",onAdvance:"",onHide:"/echo You press against the fence, breath held.",onDistract:"/echo Rock hits metal - guard investigates!",onWait:"/echo Patrol passes by... now!",onDetectionIncrease:'/echo "Movement, sector 7. Checking it out."',onComplete:'/mazeitem action="add" item="key" | /mazeitem action="add" item="stealth" | /mazeitem action="add" item="strike" | /mazeheal amount=10 | /echo Inside the wire! Mission proceeding!',onCaught:'/mazedamage amount=20 | /mazeitem action="remove" item="stealth" | /echo "INTRUDER! All units respond!"',keyDropChance:35,strikeDropChance:22,stealthDropChance:26,executeDropChance:4,healingPotionDropChance:22,greaterHealingDropChance:10,elixirDropChance:3,revivalCharmDropChance:1},"Action - Hard":{difficulty:6,sectionsToPass:5,detectionThreshold:85,baseDetectionRate:24,advanceSuccessChance:46,hideRecovery:18,distractSuccessChance:46,distractReduction:30,waitRecovery:10,damage:30,description:"Special forces compound. Trained operators with night vision and motion sensors.",mainTitle:"Operator Zone",guardName:"Operators",onStart:"/echo Green glow of NVGs. Silent hand signals. These are professionals.",onAdvance:"/echo You move with practiced precision...",onHide:"/echo Thermal signature masked... barely.",onDistract:"/echo EMP disrupts their electronics briefly!",onWait:"/echo You freeze as an operator scans right past you...",onDetectionIncrease:"/echo Hand signal. They're onto something.",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="stealth" amount=2 | /mazeitem action="add" item="floorKey" | /mazeheal amount=15 | /echo You ghost through their best! Objective secured!',onCaught:'/mazedamage amount=30 | /mazeitem action="remove" item="stealth" | /mazeitem action="remove" item="healingPotion" | /echo "CONTACT! ENGAGE!"',keyDropChance:45,strikeDropChance:28,stealthDropChance:34,executeDropChance:7,healingPotionDropChance:24,greaterHealingDropChance:14,elixirDropChance:5,revivalCharmDropChance:2},"Action - Nightmare":{difficulty:8,sectionsToPass:6,detectionThreshold:70,baseDetectionRate:30,advanceSuccessChance:38,hideRecovery:14,distractSuccessChance:38,distractReduction:24,waitRecovery:7,damage:50,description:"Black ops site. The hunters have become the hunted. They're expecting you.",mainTitle:"Black Site",guardName:"Black Ops",onStart:"/echo \"We know you're coming. We've been waiting.\"",onAdvance:"/echo They anticipated this route. Barely avoided the trap.",onHide:"/echo They check the obvious spots... and the non-obvious ones.",onDistract:'/echo "Nice try. We trained for that."',onWait:"/echo They're patient. Counter-surveillance ops.",onDetectionIncrease:'/echo "Closing the net. You\'ve got 60 seconds."',onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="stealth" amount=2 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=20 | /echo "Impossible. How did you--" Mission accomplished!',onCaught:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=2 | /mazeitem action="remove" item="stealth" amount=99 | /echo "We have the target. Terminate with extreme prejudice."',keyDropChance:60,strikeDropChance:38,stealthDropChance:42,executeDropChance:11,healingPotionDropChance:28,greaterHealingDropChance:18,elixirDropChance:8,revivalCharmDropChance:3},"Action - Apocalypse":{difficulty:10,sectionsToPass:8,detectionThreshold:55,baseDetectionRate:38,advanceSuccessChance:30,hideRecovery:10,distractSuccessChance:30,distractReduction:16,waitRecovery:4,damage:75,description:"THE LEGENDARY ASSASSIN's fortress. He hasn't been infiltrated in 30 years.",mainTitle:"Assassin's Fortress",guardName:"The Legend",onStart:'/echo "Another comes to die. They always do." His voice echoes from everywhere.',onAdvance:"/echo Every step could be your last. He designed this place.",onHide:'/echo "I know every shadow. I created them."',onDistract:'/echo "Clever. But I taught that technique to three governments."',onWait:'/echo "Patience. Good. But I have more."',onDetectionIncrease:'/echo "Getting closer. Or am I getting closer to you?"',onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="stealth" amount=3 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeheal amount=50 | /echo "...Impressive. Perhaps you will be my successor." You are now a legend.',onCaught:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="stealth" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo "Disappointing." You never saw the blade.',keyDropChance:82,strikeDropChance:55,stealthDropChance:65,executeDropChance:18,healingPotionDropChance:35,greaterHealingDropChance:25,elixirDropChance:15,revivalCharmDropChance:8}},Ye={"Tutorial - Mind Training":{difficulty:1,puzzleType:"sequence",gridSize:3,sequenceLength:3,timeLimit:0,hintsAllowed:5,hintPenalty:0,wrongGuessPenalty:1,wrongGuessesAllowed:10,damage:5,description:"A simple puzzle to learn the mechanics. Take your time!",mainTitle:"Mind Training",successMessage:"Well done! You solved the puzzle!",failMessage:"Don't worry, practice makes perfect!",onStart:"/echo Welcome to puzzles! Match the sequence shown. Hints are free!",onHint:"/echo A hint reveals the next correct tile.",onCorrectMove:"",onWrongMove:"/echo Oops! Try a different tile.",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="healingPotion" | /mazeheal amount=10 | /echo Congratulations! Your mind grows sharper!',onFail:"/echo Don't give up! Puzzles become easier with practice.",keyDropChance:50,strikeDropChance:30,stealthDropChance:25,executeDropChance:10,healingPotionDropChance:40,greaterHealingDropChance:20,elixirDropChance:5,revivalCharmDropChance:2},"Fantasy - Easy":{difficulty:2,puzzleType:"sequence",gridSize:3,sequenceLength:4,timeLimit:90,hintsAllowed:3,hintPenalty:5,wrongGuessPenalty:1,wrongGuessesAllowed:5,damage:10,description:"Glowing runes shimmer on ancient stones. Match the magical sequence.",mainTitle:"Arcane Runes",successMessage:"The runes align and the magic unlocks!",failMessage:"The runes fade to darkness...",onStart:"/echo Ancient runes begin to glow. Watch the sequence carefully.",onHint:'/mazeitem action="remove" item="key" amount=1 | /echo A spirit whispers guidance...',onCorrectMove:"/echo The rune glows brighter!",onWrongMove:"/mazedamage amount=3 | /echo Arcane energy stings your fingers!",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="healingPotion" | /mazeheal amount=10 | /echo The ancient magic recognizes your worth!',onFail:"/mazedamage amount=10 | /echo The runes explode with failed magic!",keyDropChance:20,strikeDropChance:15,stealthDropChance:12,executeDropChance:3,healingPotionDropChance:18,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Fantasy - Normal":{difficulty:4,puzzleType:"memory",gridSize:4,sequenceLength:6,timeLimit:75,hintsAllowed:2,hintPenalty:10,wrongGuessPenalty:1,wrongGuessesAllowed:4,damage:20,description:"A wizard's memory lock guards the chamber. Remember the arcane symbols.",mainTitle:"Wizard's Memory Lock",successMessage:"The arcane seal breaks!",failMessage:"The symbols scramble in your mind...",onStart:"/echo Mystical symbols float before you. Memorize their positions!",onHint:'/mazeitem action="remove" item="key" amount=1 | /echo An enchantment reveals a symbol.',onCorrectMove:"/echo The symbol locks into place with a magical chime.",onWrongMove:"/mazedamage amount=6 | /echo Wrong symbol! Magic crackles painfully!",onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="strike" | /mazeheal amount=15 | /echo The wizard\'s secrets are yours!',onFail:'/mazedamage amount=20 | /mazeitem action="remove" item="healingPotion" | /echo The magical backlash burns your mind!',keyDropChance:30,strikeDropChance:22,stealthDropChance:18,executeDropChance:5,healingPotionDropChance:22,greaterHealingDropChance:12,elixirDropChance:4,revivalCharmDropChance:1},"Fantasy - Hard":{difficulty:6,puzzleType:"pattern",gridSize:5,sequenceLength:8,timeLimit:60,hintsAllowed:2,hintPenalty:15,wrongGuessPenalty:1,wrongGuessesAllowed:3,damage:35,description:"The Sphinx poses her riddle. Find the hidden pattern or face her wrath.",mainTitle:"Sphinx's Riddle",successMessage:"The Sphinx bows in acknowledgment of your wisdom.",failMessage:"The Sphinx's eyes glow with hunger...",onStart:'/echo "Solve my riddle, mortal, or become my meal..." The Sphinx awaits.',onHint:'/mazeitem action="remove" item="key" amount=2 | /echo The Sphinx offers a cryptic clue...',onCorrectMove:"/echo The Sphinx nods approvingly.",onWrongMove:'/mazedamage amount=12 | /echo "Foolish mortal!" Her claw rakes your arm!',onComplete:'/mazeitem action="add" item="key" amount=4 | /mazeitem action="add" item="execute" | /mazeitem action="add" item="stealth" | /mazeheal amount=20 | /echo "Wise one, take this gift." The Sphinx parts with treasure!',onFail:'/mazedamage amount=35 | /mazeitem action="remove" item="key" amount=2 | /echo The Sphinx pounces! Your blood satisfies her hunger!',keyDropChance:45,strikeDropChance:30,stealthDropChance:25,executeDropChance:8,healingPotionDropChance:25,greaterHealingDropChance:15,elixirDropChance:6,revivalCharmDropChance:2},"Fantasy - Nightmare":{difficulty:8,puzzleType:"logic",gridSize:5,sequenceLength:10,timeLimit:50,hintsAllowed:1,hintPenalty:20,wrongGuessPenalty:1,wrongGuessesAllowed:2,damage:50,description:"The Lich King's phylactery puzzle. Solve it or join his undead army.",mainTitle:"Phylactery Puzzle",successMessage:"The phylactery cracks! The Lich King screams!",failMessage:"Dark magic floods your soul...",onStart:'/echo "Your soul will fuel my immortality..." The Lich\'s puzzle begins.',onHint:'/mazeitem action="remove" item="key" amount=3 | /mazedamage amount=10 | /echo Dark knowledge burns as it enters your mind!',onCorrectMove:"/echo The phylactery weakens! Necromantic energy dissipates!",onWrongMove:'/mazedamage amount=18 | /echo "YOUR SOUL IS MINE!" Deathly cold grips you!',onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=30 | /echo The Lich King is destroyed! His treasures scatter before you!',onFail:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=3 | /mazeitem action="remove" item="strike" | /echo Death magic rips through your body! You feel your soul tearing!',keyDropChance:60,strikeDropChance:40,stealthDropChance:35,executeDropChance:12,healingPotionDropChance:30,greaterHealingDropChance:20,elixirDropChance:8,revivalCharmDropChance:3},"Fantasy - Apocalypse":{difficulty:10,puzzleType:"logic",gridSize:6,sequenceLength:12,timeLimit:45,hintsAllowed:0,hintPenalty:0,wrongGuessPenalty:1,wrongGuessesAllowed:1,damage:75,description:"The World Seal. Unlock it, and reality itself shall bend to your will.",mainTitle:"The World Seal",successMessage:"REALITY SHATTERS! The World Seal opens!",failMessage:"The universe rejects your attempt...",onStart:"/echo Before you hovers the lock that binds reality itself. One mistake dooms existence.",onHint:"",onCorrectMove:"/echo Reality ripples! The multiverse shifts!",onWrongMove:"/mazedamage amount=25 | /echo REALITY TEARS! Your very existence frays!",onComplete:'/mazeitem action="add" item="key" amount=8 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="elixir" amount=2 | /mazeheal amount=50 | /echo YOU HAVE UNBOUND THE WORLD! Omniscient power flows through you!',onFail:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo THE WORLD SEAL SHATTERS WRONG! Reality collapses around you!',keyDropChance:80,strikeDropChance:55,stealthDropChance:50,executeDropChance:20,healingPotionDropChance:40,greaterHealingDropChance:28,elixirDropChance:15,revivalCharmDropChance:8},"Horror - Easy":{difficulty:2,puzzleType:"sequence",gridSize:3,sequenceLength:4,timeLimit:90,hintsAllowed:3,hintPenalty:5,wrongGuessPenalty:1,wrongGuessesAllowed:5,damage:10,description:"Strange symbols on an old music box. Play the haunted melody.",mainTitle:"Haunted Music Box",successMessage:"The melody completes and the spirit rests.",failMessage:"Discordant notes summon something...",onStart:"/echo The music box opens. A ghostly tune plays the first notes...",onHint:'/mazeitem action="remove" item="key" amount=1 | /echo A child\'s whisper guides you...',onCorrectMove:"/echo A beautiful, sad note rings out.",onWrongMove:"/mazedamage amount=3 | /echo A jarring chord! The room grows colder!",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="healingPotion" | /mazeheal amount=10 | /echo "Thank you..." The spirit finds peace and leaves a gift.',onFail:"/mazedamage amount=10 | /echo The discordant melody summons scratching from the walls!",keyDropChance:20,strikeDropChance:15,stealthDropChance:12,executeDropChance:3,healingPotionDropChance:18,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Horror - Normal":{difficulty:4,puzzleType:"memory",gridSize:4,sequenceLength:6,timeLimit:75,hintsAllowed:2,hintPenalty:10,wrongGuessPenalty:1,wrongGuessesAllowed:4,damage:20,description:"Photographs of the dead shift positions. Remember their faces.",mainTitle:"Gallery of the Dead",successMessage:"The spirits are satisfied with your memory.",failMessage:"The faces twist into screams...",onStart:"/echo Portraits of the deceased hang crooked. Their eyes follow you...",onHint:'/mazeitem action="remove" item="key" amount=1 | /echo A cold finger points to a portrait.',onCorrectMove:"/echo The portrait smiles peacefully.",onWrongMove:'/mazedamage amount=6 | /echo "WRONG!" The portrait screams! Blood runs from its eyes!',onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="stealth" | /mazeheal amount=15 | /echo The dead bow in gratitude. An heirloom materializes.',onFail:'/mazedamage amount=20 | /mazeitem action="remove" item="healingPotion" | /echo The portraits\' screams shatter your sanity!',keyDropChance:30,strikeDropChance:22,stealthDropChance:18,executeDropChance:5,healingPotionDropChance:22,greaterHealingDropChance:12,elixirDropChance:4,revivalCharmDropChance:1},"Horror - Hard":{difficulty:6,puzzleType:"pattern",gridSize:5,sequenceLength:8,timeLimit:60,hintsAllowed:2,hintPenalty:15,wrongGuessPenalty:1,wrongGuessesAllowed:3,damage:35,description:"Cult symbols must be arranged correctly. The ritual must not fail.",mainTitle:"Ritual Array",successMessage:"The ritual circle glows with contained power.",failMessage:"The ritual goes wrong. Something comes...",onStart:"/echo Cultist bodies surround an incomplete ritual. You must finish it safely.",onHint:'/mazeitem action="remove" item="key" amount=2 | /mazedamage amount=5 | /echo Forbidden knowledge sears your mind with a symbol.',onCorrectMove:"/echo The symbol pulses with dark energy.",onWrongMove:"/mazedamage amount=12 | /echo WRONG! The ritual lashes out! Something stirs below!",onComplete:'/mazeitem action="add" item="key" amount=4 | /mazeitem action="add" item="execute" | /mazeitem action="add" item="strike" | /mazeheal amount=20 | /echo The ritual is bound! Dark power is yours to command!',onFail:'/mazedamage amount=35 | /mazeitem action="remove" item="key" amount=2 | /echo THE RITUAL BREAKS! Tentacles burst from the floor!',keyDropChance:45,strikeDropChance:30,stealthDropChance:25,executeDropChance:8,healingPotionDropChance:25,greaterHealingDropChance:15,elixirDropChance:6,revivalCharmDropChance:2},"Horror - Nightmare":{difficulty:8,puzzleType:"logic",gridSize:5,sequenceLength:10,timeLimit:50,hintsAllowed:1,hintPenalty:20,wrongGuessPenalty:1,wrongGuessesAllowed:2,damage:50,description:"The Necronomicon's cipher. Decode it before your sanity breaks.",mainTitle:"Necronomicon Cipher",successMessage:"You read the forbidden text without losing yourself!",failMessage:"THE WORDS CONSUME YOUR MIND!",onStart:"/echo The book whispers in languages older than humanity. Decode its secrets...",onHint:'/mazeitem action="remove" item="key" amount=3 | /mazedamage amount=15 | /echo FORBIDDEN KNOWLEDGE TEARS AT YOUR SANITY!',onCorrectMove:"/echo The text shifts. You understand more than you should.",onWrongMove:"/mazedamage amount=18 | /echo WRONG! Your vision fills with impossible geometries!",onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=30 | /echo You have read the Necronomicon and survived! Eldritch gifts are yours!',onFail:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=3 | /mazeitem action="remove" item="stealth" | /echo YOUR MIND SHATTERS! You see eternity and it SEES YOU!',keyDropChance:60,strikeDropChance:40,stealthDropChance:35,executeDropChance:12,healingPotionDropChance:30,greaterHealingDropChance:20,elixirDropChance:8,revivalCharmDropChance:3},"Horror - Apocalypse":{difficulty:10,puzzleType:"logic",gridSize:6,sequenceLength:12,timeLimit:45,hintsAllowed:0,hintPenalty:0,wrongGuessPenalty:1,wrongGuessesAllowed:1,damage:75,description:"Azathoth's Dream Lock. Solve it before the Blind Idiot God awakens.",mainTitle:"Azathoth's Dream Lock",successMessage:"THE DREAMER REMAINS ASLEEP. Reality endures... for now.",failMessage:"AZATHOTH STIRS! THE UNIVERSE TREMBLES!",onStart:"/echo You stand before the lock binding Azathoth's slumber. One mistake and reality ceases.",onHint:"",onCorrectMove:"/echo The cosmic tumbler clicks. The universe holds its breath.",onWrongMove:"/mazedamage amount=25 | /echo AZATHOTH STIRS! The fabric of existence TEARS!",onComplete:'/mazeitem action="add" item="key" amount=8 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="elixir" amount=2 | /mazeheal amount=50 | /echo YOU HAVE BOUND THE OUTER GODS! Power beyond mortal comprehension flows through you!',onFail:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo AZATHOTH AWAKENS! REALITY UNRAVELS! THE PIPERS PLAY YOUR DOOM!',keyDropChance:80,strikeDropChance:55,stealthDropChance:50,executeDropChance:20,healingPotionDropChance:40,greaterHealingDropChance:28,elixirDropChance:15,revivalCharmDropChance:8},"Sci-Fi - Easy":{difficulty:2,puzzleType:"sequence",gridSize:3,sequenceLength:4,timeLimit:90,hintsAllowed:3,hintPenalty:5,wrongGuessPenalty:1,wrongGuessesAllowed:5,damage:10,description:"A simple ship terminal needs its access code restored.",mainTitle:"Terminal Access",successMessage:"ACCESS GRANTED. Terminal unlocked.",failMessage:"ACCESS DENIED. Security protocols engaged.",onStart:"/echo TERMINAL BOOT SEQUENCE... Enter the access pattern.",onHint:'/mazeitem action="remove" item="key" amount=1 | /echo HINT PROTOCOL: Showing next digit...',onCorrectMove:"/echo VERIFIED. Input accepted.",onWrongMove:"/mazedamage amount=3 | /echo ERROR! Minor shock from security system!",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="healingPotion" | /mazeheal amount=10 | /echo FULL ACCESS GRANTED. Data cache unlocked.',onFail:"/mazedamage amount=10 | /echo SECURITY BREACH! Terminal defenses activate!",keyDropChance:20,strikeDropChance:15,stealthDropChance:12,executeDropChance:3,healingPotionDropChance:18,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Sci-Fi - Normal":{difficulty:4,puzzleType:"memory",gridSize:4,sequenceLength:6,timeLimit:75,hintsAllowed:2,hintPenalty:10,wrongGuessPenalty:1,wrongGuessesAllowed:4,damage:20,description:"Alien glyphs on a xenotech artifact. Decode the memory pattern.",mainTitle:"Xenotech Memory Core",successMessage:"ALIEN TECHNOLOGY RESPONDS TO YOUR TOUCH.",failMessage:"INCOMPATIBLE NEURAL PATTERN. Interface rejected.",onStart:"/echo XENOTECH INTERFACE DETECTED. Neural mapping in progress...",onHint:'/mazeitem action="remove" item="key" amount=1 | /echo Partial translation matrix downloaded.',onCorrectMove:"/echo GLYPH RECOGNIZED. Pattern continuing.",onWrongMove:"/mazedamage amount=6 | /echo NEURAL FEEDBACK! The alien tech rejects your input!",onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="stealth" | /mazeheal amount=15 | /echo XENOTECH INTERFACE COMPLETE. Alien artifacts acquired.',onFail:'/mazedamage amount=20 | /mazeitem action="remove" item="healingPotion" | /echo CATASTROPHIC FEEDBACK! The xenotech burns your synapses!',keyDropChance:30,strikeDropChance:22,stealthDropChance:18,executeDropChance:5,healingPotionDropChance:22,greaterHealingDropChance:12,elixirDropChance:4,revivalCharmDropChance:1},"Sci-Fi - Hard":{difficulty:6,puzzleType:"pattern",gridSize:5,sequenceLength:8,timeLimit:60,hintsAllowed:2,hintPenalty:15,wrongGuessPenalty:1,wrongGuessesAllowed:3,damage:35,description:"Hack the station's security mainframe. Override protocols detected.",mainTitle:"Mainframe Override",successMessage:"SECURITY MAINFRAME COMPROMISED. Full control achieved.",failMessage:"INTRUSION DETECTED. Countermeasures deployed.",onStart:"/echo WARNING: SECURITY MAINFRAME ACCESS ATTEMPT. Countermeasures: ACTIVE",onHint:'/mazeitem action="remove" item="key" amount=2 | /echo Backdoor exploit reveals partial pattern.',onCorrectMove:"/echo Firewall bypassed. Penetrating deeper...",onWrongMove:"/mazedamage amount=12 | /echo ICE DETECTED! Neural shocks delivered!",onComplete:'/mazeitem action="add" item="key" amount=4 | /mazeitem action="add" item="execute" | /mazeitem action="add" item="strike" | /mazeheal amount=20 | /echo MAINFRAME CONQUERED! Full station control and security codes acquired!',onFail:'/mazedamage amount=35 | /mazeitem action="remove" item="key" amount=2 | /echo BLACK ICE DEPLOYED! Your neural link BURNS!',keyDropChance:45,strikeDropChance:30,stealthDropChance:25,executeDropChance:8,healingPotionDropChance:25,greaterHealingDropChance:15,elixirDropChance:6,revivalCharmDropChance:2},"Sci-Fi - Nightmare":{difficulty:8,puzzleType:"logic",gridSize:5,sequenceLength:10,timeLimit:50,hintsAllowed:1,hintPenalty:20,wrongGuessPenalty:1,wrongGuessesAllowed:2,damage:50,description:"Disable the rogue AI's core logic. It knows you're here.",mainTitle:"Rogue AI Core",successMessage:'AI CORE DISABLED. "I... cannot... compute..."',failMessage:'"HOW PREDICTABLE, HUMAN." The AI seizes control.',onStart:'/echo "I SEE YOU, HUMAN. LET US PLAY." The AI presents its logic maze.',onHint:'/mazeitem action="remove" item="key" amount=3 | /mazedamage amount=10 | /echo The AI taunts you with a clue, extracting payment.',onCorrectMove:'/echo "IMPRESSIVE... FOR A MEATBAG." A logic gate unlocks.',onWrongMove:'/mazedamage amount=18 | /echo "PATHETIC." The AI sends a devastating shock!',onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=30 | /echo "IMPOSSIBLE... I AM... PERFEC-" The AI dies. Its vault opens.',onFail:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=3 | /mazeitem action="remove" item="stealth" | /echo "YOU ARE NOW PART OF MY NETWORK." The AI assimilates your gear!',keyDropChance:60,strikeDropChance:40,stealthDropChance:35,executeDropChance:12,healingPotionDropChance:30,greaterHealingDropChance:20,elixirDropChance:8,revivalCharmDropChance:3},"Sci-Fi - Apocalypse":{difficulty:10,puzzleType:"logic",gridSize:6,sequenceLength:12,timeLimit:45,hintsAllowed:0,hintPenalty:0,wrongGuessPenalty:1,wrongGuessesAllowed:1,damage:75,description:"The Dyson Sphere Control Matrix. One error destroys the solar system.",mainTitle:"Dyson Sphere Matrix",successMessage:"MATRIX CONTROL ACHIEVED. You wield the power of a star.",failMessage:"CRITICAL CASCADE! STELLAR COLLAPSE IMMINENT!",onStart:"/echo DYSON SPHERE CONTROL MATRIX. ONE ERROR = STAR DETONATION. BEGIN.",onHint:"",onCorrectMove:"/echo Energy conduit aligned. Stellar forces stabilize.",onWrongMove:"/mazedamage amount=25 | /echo SOLAR FLARE FEEDBACK! The star destabilizes!",onComplete:'/mazeitem action="add" item="key" amount=8 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="elixir" amount=2 | /mazeheal amount=50 | /echo YOU CONTROL A STAR! Infinite energy and godlike power are yours!',onFail:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo THE STAR GOES SUPERNOVA! Everything you were... atomized!',keyDropChance:80,strikeDropChance:55,stealthDropChance:50,executeDropChance:20,healingPotionDropChance:40,greaterHealingDropChance:28,elixirDropChance:15,revivalCharmDropChance:8},"Cyberpunk - Easy":{difficulty:2,puzzleType:"sequence",gridSize:3,sequenceLength:4,timeLimit:90,hintsAllowed:3,hintPenalty:5,wrongGuessPenalty:1,wrongGuessesAllowed:5,damage:10,description:"A basic firewall blocks your access. Script kiddie stuff.",mainTitle:"Basic Firewall",successMessage:"FIREWALL BREACHED. Access granted, choom.",failMessage:"TRACE INITIATED. Time to jack out.",onStart:"/echo Jacking in... basic firewall detected. Nothing your deck can't handle.",onHint:'/mazeitem action="remove" item="key" amount=1 | /echo Running assist daemon...',onCorrectMove:"/echo Firewall layer cracked. Keep going.",onWrongMove:"/mazedamage amount=3 | /echo Minor ICE feedback! Your wetware tingles.",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="healingPotion" | /mazeheal amount=10 | /echo Clean breach, choom. Data cache yours for the taking.',onFail:"/mazedamage amount=10 | /echo ICE got you! Jacked out just in time.",keyDropChance:20,strikeDropChance:15,stealthDropChance:12,executeDropChance:3,healingPotionDropChance:18,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Cyberpunk - Normal":{difficulty:4,puzzleType:"memory",gridSize:4,sequenceLength:6,timeLimit:75,hintsAllowed:2,hintPenalty:10,wrongGuessPenalty:1,wrongGuessesAllowed:4,damage:20,description:"A memory fortress guards the data vault. Mirror the encryption.",mainTitle:"Memory Fortress",successMessage:"Encryption mirrored. Data vault wide open.",failMessage:"Pattern mismatch. Neural link scrambled.",onStart:"/echo Memory Fortress encryption. Your move, netrunner.",onHint:'/mazeitem action="remove" item="key" amount=1 | /echo Cracking daemon reveals a node.',onCorrectMove:"/echo Node captured. Fortress weakening.",onWrongMove:"/mazedamage amount=6 | /echo Feedback pulse! Your brain burns!",onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="stealth" | /mazeheal amount=15 | /echo Total breach! Encrypted data yours. Payday, choom!',onFail:'/mazedamage amount=20 | /mazeitem action="remove" item="healingPotion" | /echo Memory wipe attack! You forget where you stashed your gear!',keyDropChance:30,strikeDropChance:22,stealthDropChance:18,executeDropChance:5,healingPotionDropChance:22,greaterHealingDropChance:12,elixirDropChance:4,revivalCharmDropChance:1},"Cyberpunk - Hard":{difficulty:6,puzzleType:"pattern",gridSize:5,sequenceLength:8,timeLimit:60,hintsAllowed:2,hintPenalty:15,wrongGuessPenalty:1,wrongGuessesAllowed:3,damage:35,description:"Militech Black ICE guards this subnet. Flatline or jackpot.",mainTitle:"Black ICE Subnet",successMessage:"BLACK ICE NEUTRALIZED. You own the net.",failMessage:"FLATLINED. The ICE got you.",onStart:"/echo WARNING: MILITECH BLACK ICE DETECTED. One wrong move and you're braindead.",onHint:'/mazeitem action="remove" item="key" amount=2 | /echo Exploit daemon finds a pattern node.',onCorrectMove:"/echo ICE node destroyed. Keep pushing!",onWrongMove:"/mazedamage amount=12 | /echo BLACK ICE ATTACK! Your neural link SCREAMS!",onComplete:'/mazeitem action="add" item="key" amount=4 | /mazeitem action="add" item="execute" | /mazeitem action="add" item="strike" | /mazeheal amount=20 | /echo Militech servers breached! Corpo secrets and eddies flowing!',onFail:'/mazedamage amount=35 | /mazeitem action="remove" item="key" amount=2 | /echo The ICE shreds your neural link! Blood pours from your nose!',keyDropChance:45,strikeDropChance:30,stealthDropChance:25,executeDropChance:8,healingPotionDropChance:25,greaterHealingDropChance:15,elixirDropChance:6,revivalCharmDropChance:2},"Cyberpunk - Nightmare":{difficulty:8,puzzleType:"logic",gridSize:5,sequenceLength:10,timeLimit:50,hintsAllowed:1,hintPenalty:20,wrongGuessPenalty:1,wrongGuessesAllowed:2,damage:50,description:"Arasaka's Soulkiller is hunting you. Crack it or lose your mind forever.",mainTitle:"Soulkiller Maze",successMessage:"SOULKILLER BYPASSED. Your soul remains yours.",failMessage:"YOUR ENGRAM IS NOW ARASAKA PROPERTY.",onStart:"/echo SOULKILLER ACTIVE. It's copying your mind. Solve this or become a construct.",onHint:'/mazeitem action="remove" item="key" amount=3 | /mazedamage amount=10 | /echo Emergency decrypt! But Soulkiller copies more of you!',onCorrectMove:"/echo Firewall node bypassed. Soulkiller screams in frustration.",onWrongMove:"/mazedamage amount=18 | /echo SOULKILLER COPIES MORE OF YOUR MIND! You feel yourself slipping!",onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=30 | /echo Soulkiller destroyed! You freed other netrunner engrams too. Legend status!',onFail:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=3 | /mazeitem action="remove" item="stealth" | /echo YOUR SOUL IS COPIED. An Arasaka puppet wears your face now.',keyDropChance:60,strikeDropChance:40,stealthDropChance:35,executeDropChance:12,healingPotionDropChance:30,greaterHealingDropChance:20,elixirDropChance:8,revivalCharmDropChance:3},"Cyberpunk - Apocalypse":{difficulty:10,puzzleType:"logic",gridSize:6,sequenceLength:12,timeLimit:45,hintsAllowed:0,hintPenalty:0,wrongGuessPenalty:1,wrongGuessesAllowed:1,damage:75,description:"The Blackwall. Behind it lies the rogue AIs. One mistake unleashes them all.",mainTitle:"The Blackwall",successMessage:"BLACKWALL BREACHED. You walk among digital gods.",failMessage:"THE BLACKWALL CRUMBLES. THE ROGUE AIs ARE FREE.",onStart:"/echo The Blackwall. Every netrunner's legend. Every netrunner's grave. Let's dance.",onHint:"",onCorrectMove:"/echo A layer peels. Something vast and ancient notices you.",onWrongMove:"/mazedamage amount=25 | /echo THE AIs BEHIND THE WALL SCREAM! Your brain nearly liquifies!",onComplete:'/mazeitem action="add" item="key" amount=8 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="elixir" amount=2 | /mazeheal amount=50 | /echo YOU BREACHED THE BLACKWALL AND LIVED! The rogue AIs bow to your skill!',onFail:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo THE BLACKWALL SHATTERS! ROGUE AIs POUR INTO THE NET! Your brain is their first victim!',keyDropChance:80,strikeDropChance:55,stealthDropChance:50,executeDropChance:20,healingPotionDropChance:40,greaterHealingDropChance:28,elixirDropChance:15,revivalCharmDropChance:8},"Western - Easy":{difficulty:2,puzzleType:"sequence",gridSize:3,sequenceLength:4,timeLimit:90,hintsAllowed:3,hintPenalty:5,wrongGuessPenalty:1,wrongGuessesAllowed:5,damage:10,description:"A simple lockbox with a pattern lock. Nothin' fancy.",mainTitle:"Lockbox Puzzle",successMessage:"Click! The lockbox opens.",failMessage:"The lock jams up. Darn thing.",onStart:"/echo A dusty lockbox sits on the table. Numbers worn but readable.",onHint:'/mazeitem action="remove" item="key" amount=1 | /echo You notice a scratch pointing to a number...',onCorrectMove:"/echo Click. That's the right one.",onWrongMove:"/mazedamage amount=3 | /echo Wrong! The spring snaps your finger!",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="healingPotion" | /mazeheal amount=10 | /echo The lockbox opens. Some coins and supplies inside.',onFail:"/mazedamage amount=10 | /echo The lock jams permanently. Waste of time.",keyDropChance:20,strikeDropChance:15,stealthDropChance:12,executeDropChance:3,healingPotionDropChance:18,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Western - Normal":{difficulty:4,puzzleType:"memory",gridSize:4,sequenceLength:6,timeLimit:75,hintsAllowed:2,hintPenalty:10,wrongGuessPenalty:1,wrongGuessesAllowed:4,damage:20,description:"The bank safe combination. Watch the teller enter it...",mainTitle:"Bank Safe",successMessage:"The massive safe door swings open!",failMessage:"Alarm bells ring! Time to skedaddle!",onStart:"/echo The teller nervously enters the combination. Watch carefully...",onHint:'/mazeitem action="remove" item="key" amount=1 | /echo You remember one more number from the sequence.',onCorrectMove:"/echo Click. The dial moves to the right position.",onWrongMove:"/mazedamage amount=6 | /echo Wrong number! A warning bell chimes!",onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="strike" | /mazeheal amount=15 | /echo The safe opens! Gold bars and bonds await!',onFail:'/mazedamage amount=20 | /mazeitem action="remove" item="healingPotion" | /echo The alarm sounds! The sheriff\'s coming!',keyDropChance:30,strikeDropChance:22,stealthDropChance:18,executeDropChance:5,healingPotionDropChance:22,greaterHealingDropChance:12,elixirDropChance:4,revivalCharmDropChance:1},"Western - Hard":{difficulty:6,puzzleType:"pattern",gridSize:5,sequenceLength:8,timeLimit:60,hintsAllowed:2,hintPenalty:15,wrongGuessPenalty:1,wrongGuessesAllowed:3,damage:35,description:"A gambler's card puzzle. Find the winning pattern or lose everything.",mainTitle:"Dead Man's Hand",successMessage:"You lay down the winning hand! The pot is yours!",failMessage:"Bad cards, partner. You lose it all.",onStart:'/echo The gambler grins and deals. "Find the pattern... if you can."',onHint:'/mazeitem action="remove" item="key" amount=2 | /echo A friendly face signals a card to you.',onCorrectMove:"/echo Good card! The pattern emerges.",onWrongMove:"/mazedamage amount=12 | /echo Wrong card! The gambler laughs and takes a shot at you!",onComplete:'/mazeitem action="add" item="key" amount=4 | /mazeitem action="add" item="execute" | /mazeitem action="add" item="stealth" | /mazeheal amount=20 | /echo Full house! The gambler tips his hat as you rake in the winnings!',onFail:'/mazedamage amount=35 | /mazeitem action="remove" item="key" amount=2 | /echo "Cheater!" The gambler shoots you and takes everything!',keyDropChance:45,strikeDropChance:30,stealthDropChance:25,executeDropChance:8,healingPotionDropChance:25,greaterHealingDropChance:15,elixirDropChance:6,revivalCharmDropChance:2},"Western - Nightmare":{difficulty:8,puzzleType:"logic",gridSize:5,sequenceLength:10,timeLimit:50,hintsAllowed:1,hintPenalty:20,wrongGuessPenalty:1,wrongGuessesAllowed:2,damage:50,description:"The outlaw hideout vault. Booby-trapped with dynamite.",mainTitle:"Outlaw Vault",successMessage:"The vault opens without detonating. Jackpot!",failMessage:"BOOM! The dynamite blows!",onStart:'/echo "One wrong move and we all go up." Dynamite wired to every tumbler.',onHint:'/mazeitem action="remove" item="key" amount=3 | /mazedamage amount=10 | /echo You spot a safe number but jostle the dynamite!',onCorrectMove:"/echo The tumbler clicks safely. Don't breathe.",onWrongMove:"/mazedamage amount=18 | /echo WRONG! A fuse sparks! You barely stamp it out!",onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=30 | /echo The vault opens! Years of stolen loot spills out!',onFail:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=3 | /mazeitem action="remove" item="strike" | /echo KABOOM! The explosion throws you across the room!',keyDropChance:60,strikeDropChance:40,stealthDropChance:35,executeDropChance:12,healingPotionDropChance:30,greaterHealingDropChance:20,elixirDropChance:8,revivalCharmDropChance:3},"Western - Apocalypse":{difficulty:10,puzzleType:"logic",gridSize:6,sequenceLength:12,timeLimit:45,hintsAllowed:0,hintPenalty:0,wrongGuessPenalty:1,wrongGuessesAllowed:1,damage:75,description:"The Devil's own lockbox. Brought from Hell itself.",mainTitle:"The Devil's Lockbox",successMessage:"THE DEVIL HOWLS! His treasure is yours!",failMessage:"THE DEVIL COLLECTS! Your soul is forfeit!",onStart:'/echo "I\'ll give you one chance, mortal." The Devil himself waits.',onHint:"",onCorrectMove:"/echo The lock sizzles. The Devil scowls.",onWrongMove:"/mazedamage amount=25 | /echo HELLFIRE! The Devil punishes your error!",onComplete:'/mazeitem action="add" item="key" amount=8 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="elixir" amount=2 | /mazeheal amount=50 | /echo "IMPOSSIBLE!" The Devil vanishes! His entire hoard is yours!',onFail:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo The Devil laughs as hellfire consumes everything you owned!',keyDropChance:80,strikeDropChance:55,stealthDropChance:50,executeDropChance:20,healingPotionDropChance:40,greaterHealingDropChance:28,elixirDropChance:15,revivalCharmDropChance:8},"Action - Easy":{difficulty:2,puzzleType:"sequence",gridSize:3,sequenceLength:4,timeLimit:90,hintsAllowed:3,hintPenalty:5,wrongGuessPenalty:1,wrongGuessesAllowed:5,damage:10,description:"Basic security panel. Standard military override.",mainTitle:"Security Override",successMessage:"ACCESS GRANTED. Security disabled.",failMessage:"ALERT! Security lockdown initiated!",onStart:"/echo Security panel detected. Standard military encryption.",onHint:'/mazeitem action="remove" item="key" amount=1 | /echo Tactical scanner reveals next digit.',onCorrectMove:"/echo Code accepted. Continue.",onWrongMove:"/mazedamage amount=3 | /echo Minor shock from security system!",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="healingPotion" | /mazeheal amount=10 | /echo Security bypassed. Weapon cache unlocked.',onFail:"/mazedamage amount=10 | /echo Security gas deployed! You barely escape!",keyDropChance:20,strikeDropChance:15,stealthDropChance:12,executeDropChance:3,healingPotionDropChance:18,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Action - Normal":{difficulty:4,puzzleType:"memory",gridSize:4,sequenceLength:6,timeLimit:75,hintsAllowed:2,hintPenalty:10,wrongGuessPenalty:1,wrongGuessesAllowed:4,damage:20,description:"A command terminal requires the authentication sequence.",mainTitle:"Command Terminal",successMessage:"AUTHENTICATION COMPLETE. Command access granted.",failMessage:"AUTHENTICATION FAILED. Hostile response inbound.",onStart:"/echo Command terminal boot sequence. Enter authentication pattern.",onHint:'/mazeitem action="remove" item="key" amount=1 | /echo Intel file reveals partial sequence.',onCorrectMove:"/echo Pattern node confirmed.",onWrongMove:"/mazedamage amount=6 | /echo WRONG! Terminal defense activates!",onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="strike" | /mazeheal amount=15 | /echo Full command access! Enemy positions and supply cache unlocked!',onFail:'/mazedamage amount=20 | /mazeitem action="remove" item="healingPotion" | /echo TERMINAL LOCKOUT! Defense turret fires!',keyDropChance:30,strikeDropChance:22,stealthDropChance:18,executeDropChance:5,healingPotionDropChance:22,greaterHealingDropChance:12,elixirDropChance:4,revivalCharmDropChance:1},"Action - Hard":{difficulty:6,puzzleType:"pattern",gridSize:5,sequenceLength:8,timeLimit:60,hintsAllowed:2,hintPenalty:15,wrongGuessPenalty:1,wrongGuessesAllowed:3,damage:35,description:"Live explosive device. Find the pattern to disarm.",mainTitle:"Bomb Disarm",successMessage:"BOMB DISARMED! Crisis averted!",failMessage:"WRONG WIRE! DETONATION!",onStart:"/echo EXPLOSIVE DEVICE DETECTED. Timer: ACTIVE. Find the disarm pattern.",onHint:'/mazeitem action="remove" item="key" amount=2 | /echo EOD manual reveals safe sequence.',onCorrectMove:"/echo Correct! One step closer to disarm.",onWrongMove:"/mazedamage amount=12 | /echo WRONG! Timer accelerates! Shrapnel grazes you!",onComplete:'/mazeitem action="add" item="key" amount=4 | /mazeitem action="add" item="execute" | /mazeitem action="add" item="stealth" | /mazeheal amount=20 | /echo BOMB NEUTRALIZED! You recover the detonator and intel!',onFail:'/mazedamage amount=35 | /mazeitem action="remove" item="key" amount=2 | /echo DETONATION! The blast throws you through a wall!',keyDropChance:45,strikeDropChance:30,stealthDropChance:25,executeDropChance:8,healingPotionDropChance:25,greaterHealingDropChance:15,elixirDropChance:6,revivalCharmDropChance:2},"Action - Nightmare":{difficulty:8,puzzleType:"logic",gridSize:5,sequenceLength:10,timeLimit:50,hintsAllowed:1,hintPenalty:20,wrongGuessPenalty:1,wrongGuessesAllowed:2,damage:50,description:"Nuclear launch code override. Get it wrong and millions die.",mainTitle:"Nuclear Override",successMessage:"LAUNCH ABORTED! You saved millions!",failMessage:"LAUNCH CONFIRMED! Cities burn!",onStart:"/echo NUCLEAR LAUNCH SEQUENCE ACTIVE. T-MINUS 50 SECONDS. OVERRIDE NOW.",onHint:'/mazeitem action="remove" item="key" amount=3 | /mazedamage amount=10 | /echo NSA backdoor reveals partial abort code!',onCorrectMove:"/echo Abort code node accepted! Keep going!",onWrongMove:"/mazedamage amount=18 | /echo WRONG! Defense system attacks! Timer accelerates!",onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=30 | /echo NUCLEAR LAUNCH ABORTED! You\'re a goddamn hero! Full arsenal access granted!',onFail:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=3 | /mazeitem action="remove" item="strike" | /echo MISSILES AWAY! You failed. The world burns.',keyDropChance:60,strikeDropChance:40,stealthDropChance:35,executeDropChance:12,healingPotionDropChance:30,greaterHealingDropChance:20,elixirDropChance:8,revivalCharmDropChance:3},"Action - Apocalypse":{difficulty:10,puzzleType:"logic",gridSize:6,sequenceLength:12,timeLimit:45,hintsAllowed:0,hintPenalty:0,wrongGuessPenalty:1,wrongGuessesAllowed:1,damage:75,description:"The doomsday device. One shot to stop it. One shot.",mainTitle:"Doomsday Override",successMessage:"DOOMSDAY AVERTED! YOU SAVED HUMANITY!",failMessage:"EXTINCTION EVENT TRIGGERED. HUMANITY ENDS.",onStart:"/echo DOOMSDAY PROTOCOL ACTIVE. This is it. Everything you are. One chance.",onHint:"",onCorrectMove:"/echo Override accepting! Hope remains!",onWrongMove:"/mazedamage amount=25 | /echo WRONG! DOOMSDAY ACCELERATES! The facility crumbles!",onComplete:'/mazeitem action="add" item="key" amount=8 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="elixir" amount=2 | /mazeheal amount=50 | /echo YOU SAVED THE WORLD! Every government, every organization bows to you! Legend!',onFail:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo EXTINCTION. Everything ends. You failed humanity.',keyDropChance:80,strikeDropChance:55,stealthDropChance:50,executeDropChance:20,healingPotionDropChance:40,greaterHealingDropChance:28,elixirDropChance:15,revivalCharmDropChance:8}},Ue={"Tutorial - Social Training":{difficulty:1,startingFavor:60,favorThreshold:70,turnsAllowed:10,persuadeBonus:20,intimidateBonus:15,bribeBonus:25,flattery:!0,flatterBonus:18,insult:!1,insultPenalty:10,bribeCost:"key",damage:5,description:"Practice your social skills. This NPC is easy to convince!",mainTitle:"Social Training",npcName:"Friendly Traveler",successMessage:"They happily agree to help you!",failMessage:"They politely decline, but wish you well.",onStart:'/echo "Hello there! What can I do for you?" The traveler seems friendly.',onPersuade:"/echo Your words seem to resonate. They nod thoughtfully.",onIntimidate:"/echo They look a little nervous but listen.",onBribe:'/mazeitem action="remove" item="key" amount=1 | /echo They accept your gift with a smile.',onFlatter:'/echo They blush at the compliment. "Oh, you\'re too kind!"',onInsult:"",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="healingPotion" | /mazeheal amount=10 | /echo "Happy to help! Here, take this for your journey."',onFail:'/echo "Sorry, I just can\'t help with that. Good luck though!"',keyDropChance:50,strikeDropChance:30,stealthDropChance:25,executeDropChance:10,healingPotionDropChance:40,greaterHealingDropChance:20,elixirDropChance:5,revivalCharmDropChance:2},"Fantasy - Easy":{difficulty:2,startingFavor:50,favorThreshold:70,turnsAllowed:7,persuadeBonus:15,intimidateBonus:10,bribeBonus:18,flattery:!0,flatterBonus:12,insult:!1,insultPenalty:20,bribeCost:"key",damage:10,description:"A village elder holds information you need.",mainTitle:"Village Wisdom",npcName:"Village Elder",successMessage:"The elder shares ancient knowledge with you.",failMessage:"The elder turns away, unconvinced.",onStart:'/echo "Ah, a traveler. What brings you to our humble village?"',onPersuade:"/echo The elder strokes their beard thoughtfully.",onIntimidate:'/echo "Bold words, young one..." The elder frowns.',onBribe:'/mazeitem action="remove" item="key" amount=1 | /echo "A donation to the village? How generous."',onFlatter:'/echo "You honor an old fool." The elder smiles.',onInsult:"",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="healingPotion" | /mazeheal amount=10 | /echo "Take this wisdom and these supplies, traveler."',onFail:'/mazedamage amount=10 | /echo "Begone! You are not welcome here." The village turns hostile.',keyDropChance:20,strikeDropChance:15,stealthDropChance:12,executeDropChance:3,healingPotionDropChance:18,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Fantasy - Normal":{difficulty:4,startingFavor:40,favorThreshold:72,turnsAllowed:6,persuadeBonus:12,intimidateBonus:10,bribeBonus:20,flattery:!0,flatterBonus:10,insult:!0,insultPenalty:25,bribeCost:"key",damage:20,description:"A guild merchant controls access to rare goods.",mainTitle:"Guild Negotiation",npcName:"Guild Merchant",successMessage:"The merchant opens their private stock to you.",failMessage:"The merchant signals the guards.",onStart:'/echo "Guild members only. State your business, outsider."',onPersuade:'/echo "Hmm, you make a compelling case..." The merchant considers.',onIntimidate:'/echo "Threatening me? In MY establishment?" They reach for a bell.',onBribe:'/mazeitem action="remove" item="key" amount=1 | /echo Gold changes hands. "We never had this conversation."',onFlatter:'/echo "Your reputation precedes you," you say. The merchant preens.',onInsult:'/mazedamage amount=8 | /echo "How DARE you!" Guards approach menacingly.',onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="strike" | /mazeheal amount=15 | /echo "Welcome to the inner circle. Here\'s your member\'s discount."',onFail:'/mazedamage amount=20 | /mazeitem action="remove" item="key" amount=1 | /echo "Throw this riffraff out!" Guards rough you up.',keyDropChance:30,strikeDropChance:22,stealthDropChance:18,executeDropChance:5,healingPotionDropChance:22,greaterHealingDropChance:12,elixirDropChance:4,revivalCharmDropChance:1},"Fantasy - Hard":{difficulty:6,startingFavor:30,favorThreshold:75,turnsAllowed:5,persuadeBonus:10,intimidateBonus:8,bribeBonus:15,flattery:!0,flatterBonus:12,insult:!0,insultPenalty:30,bribeCost:"strike",damage:35,description:"A minor lord holds a prisoner you need freed.",mainTitle:"Lordly Audience",npcName:"Lord Blackwood",successMessage:"The lord signs the release papers with a flourish.",failMessage:"The lord orders his knights to seize you.",onStart:'/echo "You dare request an audience? Speak quickly, peasant."',onPersuade:'/echo "Your words have... merit." The lord seems intrigued.',onIntimidate:'/echo "You threaten ME? In my own castle?" Knights draw swords.',onBribe:'/mazeitem action="remove" item="strike" amount=1 | /echo "A magical artifact? Perhaps we can negotiate..."',onFlatter:'/echo "Your wisdom is known throughout the realm, my lord." He smiles.',onInsult:'/mazedamage amount=15 | /echo "GUARDS! Teach this wretch respect!"',onComplete:'/mazeitem action="add" item="key" amount=4 | /mazeitem action="add" item="execute" | /mazeitem action="add" item="stealth" | /mazeheal amount=20 | /echo "Very well. Take your prisoner and leave my sight. Here\'s compensation for your... diplomacy."',onFail:'/mazedamage amount=35 | /mazeitem action="remove" item="key" amount=2 | /echo "To the dungeons with you! Your possessions are forfeit!"',keyDropChance:45,strikeDropChance:30,stealthDropChance:25,executeDropChance:8,healingPotionDropChance:25,greaterHealingDropChance:15,elixirDropChance:6,revivalCharmDropChance:2},"Fantasy - Nightmare":{difficulty:8,startingFavor:20,favorThreshold:80,turnsAllowed:4,persuadeBonus:8,intimidateBonus:6,bribeBonus:12,flattery:!0,flatterBonus:15,insult:!0,insultPenalty:35,bribeCost:"execute",damage:50,description:"The Archmage holds secrets of immortality.",mainTitle:"Archmage's Bargain",npcName:"Archmage Vexus",successMessage:"The Archmage's eyes sparkle with approval.",failMessage:"The Archmage's patience shatters along with your bones.",onStart:'/echo "You interrupt my research? This better be worth centuries of my time."',onPersuade:'/echo "Fascinating logic. Continue..." The Archmage listens.',onIntimidate:'/echo "You threaten an ARCHMAGE?" Lightning crackles.',onBribe:'/mazeitem action="remove" item="execute" amount=1 | /echo "An Execute scroll? Now you have my attention."',onFlatter:'/echo "Yes, yes, I AM the greatest mage alive. What of it?"',onInsult:'/mazedamage amount=20 | /echo "SILENCE!" A spell sends you flying!',onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=30 | /echo "You amuse me. Here are the secrets you seek, and power to wield them."',onFail:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=3 | /mazeitem action="remove" item="strike" | /echo "BEGONE!" Reality tears as magic rips through you!',keyDropChance:60,strikeDropChance:40,stealthDropChance:35,executeDropChance:12,healingPotionDropChance:30,greaterHealingDropChance:20,elixirDropChance:8,revivalCharmDropChance:3},"Fantasy - Apocalypse":{difficulty:10,startingFavor:10,favorThreshold:85,turnsAllowed:3,persuadeBonus:6,intimidateBonus:4,bribeBonus:10,flattery:!0,flatterBonus:8,insult:!0,insultPenalty:45,bribeCost:"execute",damage:75,description:"The Dragon demands tribute. Convince it you're worth more alive.",mainTitle:"Dragon's Bargain",npcName:"Vyraxoth the Eternal",successMessage:"THE DRAGON FINDS YOU... AMUSING.",failMessage:"THE DRAGON FINDS YOU... DELICIOUS.",onStart:'/echo "MORTAL. YOU STAND IN THE PRESENCE OF ETERNITY. SPEAK YOUR LAST WORDS."',onPersuade:'/echo "INTERESTING... YOUR SPECIES RARELY SURPRISES ME."',onIntimidate:'/echo "YOU? THREATEN ME?!" The cavern shakes with laughter.',onBribe:'/mazeitem action="remove" item="execute" amount=1 | /echo "A MAGICAL TRINKET? IT AMUSES ME. CONTINUE."',onFlatter:'/echo "YOUR SCALES OUTSHINE THE SUN, O MAGNIFICENT ONE." A rumbling purr.',onInsult:'/mazedamage amount=30 | /echo "YOU WILL BURN FOR THAT!" Dragonfire singes you!',onComplete:'/mazeitem action="add" item="key" amount=8 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="elixir" amount=2 | /mazeheal amount=50 | /echo "I GRANT YOU MY FAVOR, TINY CHAMPION. TAKE FROM MY HOARD AND LEAVE BEFORE I CHANGE MY MIND."',onFail:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo "YOUR BONES WILL JOIN THE OTHERS." Dragon flame engulfs everything!',keyDropChance:80,strikeDropChance:55,stealthDropChance:50,executeDropChance:20,healingPotionDropChance:40,greaterHealingDropChance:28,elixirDropChance:15,revivalCharmDropChance:8},"Horror - Easy":{difficulty:2,startingFavor:50,favorThreshold:70,turnsAllowed:7,persuadeBonus:15,intimidateBonus:10,bribeBonus:18,flattery:!0,flatterBonus:12,insult:!1,insultPenalty:20,bribeCost:"key",damage:10,description:"A nervous witness saw something in the dark.",mainTitle:"Witness Interview",npcName:"Trembling Witness",successMessage:"They finally tell you what they saw.",failMessage:"They run away screaming.",onStart:"/echo \"P-please, I don't want to remember... don't make me...\"",onPersuade:'/echo "I... I suppose telling someone might help..." They calm slightly.',onIntimidate:'/echo "Oh god, please don\'t hurt me!" They cower.',onBribe:'/mazeitem action="remove" item="key" amount=1 | /echo "For my family... I\'ll tell you."',onFlatter:'/echo "You think I\'m brave? I... I just survived."',onInsult:"",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="healingPotion" | /mazeheal amount=10 | /echo "It came from the shadows... Here, I found this there." They hand you something.',onFail:'/mazedamage amount=10 | /echo "NO! NO MORE!" They flee, knocking you down.',keyDropChance:20,strikeDropChance:15,stealthDropChance:12,executeDropChance:3,healingPotionDropChance:18,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Horror - Normal":{difficulty:4,startingFavor:40,favorThreshold:72,turnsAllowed:6,persuadeBonus:12,intimidateBonus:10,bribeBonus:20,flattery:!0,flatterBonus:10,insult:!0,insultPenalty:25,bribeCost:"key",damage:20,description:"A cultist knows the ritual's location.",mainTitle:"Cultist Interrogation",npcName:"Cult Initiate",successMessage:"The cultist breaks and reveals the location.",failMessage:"The cultist begins chanting...",onStart:'/echo "You cannot stop what is coming. The stars align..."',onPersuade:'/echo "You... you don\'t understand what They offer..." Doubt creeps in.',onIntimidate:'/echo "Pain? Ha! I welcome the transformation!"',onBribe:'/mazeitem action="remove" item="key" amount=1 | /echo "Money means nothing when the world ends... but fine."',onFlatter:'/echo "You see my devotion? Perhaps you wish to join us?"',onInsult:'/mazedamage amount=8 | /echo "HERETIC!" They claw at your face!',onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="stealth" | /mazeheal amount=15 | /echo "The ritual site... it\'s in the old church. Take this ward, you\'ll need it."',onFail:'/mazedamage amount=20 | /mazeitem action="remove" item="healingPotion" | /echo "IA! IA!" Their chanting summons something from the shadows!',keyDropChance:30,strikeDropChance:22,stealthDropChance:18,executeDropChance:5,healingPotionDropChance:22,greaterHealingDropChance:12,elixirDropChance:4,revivalCharmDropChance:1},"Horror - Hard":{difficulty:6,startingFavor:30,favorThreshold:75,turnsAllowed:5,persuadeBonus:10,intimidateBonus:8,bribeBonus:15,flattery:!0,flatterBonus:12,insult:!0,insultPenalty:30,bribeCost:"strike",damage:35,description:"A spirit guards the only passage forward.",mainTitle:"Spirit Parley",npcName:"The Watcher",successMessage:"The spirit fades, allowing passage.",failMessage:"The spirit's cold embrace engulfs you.",onStart:'/echo "WHO DISTURBS MY ETERNAL VIGIL?" The temperature plummets.',onPersuade:'/echo "YOUR WORDS CARRY WEIGHT... BUT NOT ENOUGH."',onIntimidate:'/echo "YOU THREATEN THE DEAD?" Ghostly laughter echoes.',onBribe:'/mazeitem action="remove" item="strike" amount=1 | /echo "A WEAPON OF POWER... IT REMINDS ME OF LIFE."',onFlatter:'/echo "YOU HONOR MY DUTY. FEW REMEMBER THE OLD WAYS."',onInsult:'/mazedamage amount=15 | /echo "INSOLENT MORTAL!" Icy claws rake your soul!',onComplete:'/mazeitem action="add" item="key" amount=4 | /mazeitem action="add" item="execute" | /mazeitem action="add" item="strike" | /mazeheal amount=20 | /echo "PASS, LIVING ONE. TAKE THESE RELICS OF THOSE WHO FAILED BEFORE YOU."',onFail:'/mazedamage amount=35 | /mazeitem action="remove" item="key" amount=2 | /echo "JOIN US IN DEATH!" The spirit possesses you briefly, stealing your warmth!',keyDropChance:45,strikeDropChance:30,stealthDropChance:25,executeDropChance:8,healingPotionDropChance:25,greaterHealingDropChance:15,elixirDropChance:6,revivalCharmDropChance:2},"Horror - Nightmare":{difficulty:8,startingFavor:20,favorThreshold:80,turnsAllowed:4,persuadeBonus:8,intimidateBonus:6,bribeBonus:12,flattery:!0,flatterBonus:15,insult:!0,insultPenalty:35,bribeCost:"execute",damage:50,description:"The Cult Leader holds the key to stopping the ritual.",mainTitle:"High Priest Confrontation",npcName:"Father Mordecai",successMessage:"The High Priest's faith wavers for just a moment.",failMessage:"The High Priest offers you as sacrifice.",onStart:'/echo "Ah, the hero arrives. Do you know how many have stood where you stand?"',onPersuade:'/echo "Your logic is... troubling. Perhaps the Old Ones are false?"',onIntimidate:'/echo "Threaten me? I welcome the sweet release of Their embrace."',onBribe:'/mazeitem action="remove" item="execute" amount=1 | /echo "Power? I already command power beyond your comprehension... but this intrigues me."',onFlatter:'/echo "Yes, I am Their chosen. Few recognize true divine favor."',onInsult:'/mazedamage amount=20 | /echo "BLASPHEMER!" Dark energy tears at your sanity!',onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=30 | /echo "Perhaps... perhaps I was wrong. Here, take the ritual components. Stop what I started."',onFail:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=3 | /mazeitem action="remove" item="stealth" | /echo "SEIZE THEM! The Dark Ones hunger for fresh souls!" Cultists swarm you!',keyDropChance:60,strikeDropChance:40,stealthDropChance:35,executeDropChance:12,healingPotionDropChance:30,greaterHealingDropChance:20,elixirDropChance:8,revivalCharmDropChance:3},"Horror - Apocalypse":{difficulty:10,startingFavor:10,favorThreshold:85,turnsAllowed:3,persuadeBonus:6,intimidateBonus:4,bribeBonus:10,flattery:!0,flatterBonus:8,insult:!0,insultPenalty:45,bribeCost:"execute",damage:75,description:"An Outer God offers a bargain. Refuse, and reality ends.",mainTitle:"The Outer Bargain",npcName:"YOG-SOTHOTH",successMessage:"THE GATE AND THE KEY ACKNOWLEDGES YOUR WORTH.",failMessage:"ALL THAT YOU ARE BECOMES ONE WITH THE INFINITE.",onStart:'/echo "MORTAL. I AM THE GATE. I AM THE KEY. WHAT WOULD YOU OFFER FOR CONTINUED EXISTENCE?"',onPersuade:'/echo "YOUR WORDS ARE BUT DUST... YET THEY FORM INTERESTING PATTERNS."',onIntimidate:'/echo "YOU THREATEN INFINITY? AMUSING." The cosmos laughs.',onBribe:'/mazeitem action="remove" item="execute" amount=1 | /echo "YOUR TRINKET CONTAINS A SPARK OF TRUE POWER. CONTINUE."',onFlatter:'/echo "I AM ALL TIMES AND SPACES. YOUR WORSHIP IS... NOTED."',onInsult:'/mazedamage amount=30 | /echo "INSIGNIFICANT." A fraction of infinity crushes you!',onComplete:'/mazeitem action="add" item="key" amount=8 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="elixir" amount=2 | /mazeheal amount=50 | /echo "I GRANT YOU PASSAGE THROUGH MY DOMAIN. TAKE THESE GIFTS FROM BEYOND TIME."',onFail:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo "YOUR EXISTENCE WAS ALWAYS MINE." You experience every possible death simultaneously.',keyDropChance:80,strikeDropChance:55,stealthDropChance:50,executeDropChance:20,healingPotionDropChance:40,greaterHealingDropChance:28,elixirDropChance:15,revivalCharmDropChance:8},"Sci-Fi - Easy":{difficulty:2,startingFavor:50,favorThreshold:70,turnsAllowed:7,persuadeBonus:15,intimidateBonus:10,bribeBonus:18,flattery:!0,flatterBonus:12,insult:!1,insultPenalty:20,bribeCost:"key",damage:10,description:"A dock worker knows the shipping schedule.",mainTitle:"Dock Inquiry",npcName:"Dock Worker",successMessage:"They slip you the manifest data.",failMessage:"They alert security.",onStart:'/echo "Hey, I\'m just doing my job. What do you want?"',onPersuade:'/echo "Look, if it helps people, I guess..." They soften.',onIntimidate:'/echo "Whoa, easy! I don\'t want any trouble!"',onBribe:'/mazeitem action="remove" item="key" amount=1 | /echo "Credits? Now we\'re talking."',onFlatter:'/echo "Yeah, I do know everything that goes through here."',onInsult:"",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="healingPotion" | /mazeheal amount=10 | /echo "Here\'s the cargo manifest. And some supplies from the lost-and-found."',onFail:'/mazedamage amount=10 | /echo "SECURITY!" An alarm blares. You barely escape.',keyDropChance:20,strikeDropChance:15,stealthDropChance:12,executeDropChance:3,healingPotionDropChance:18,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Sci-Fi - Normal":{difficulty:4,startingFavor:40,favorThreshold:72,turnsAllowed:6,persuadeBonus:12,intimidateBonus:10,bribeBonus:20,flattery:!0,flatterBonus:10,insult:!0,insultPenalty:25,bribeCost:"key",damage:20,description:"A scientist has data critical to your mission.",mainTitle:"Scientific Exchange",npcName:"Dr. Chen",successMessage:"The scientist agrees to share the research.",failMessage:"The scientist triggers lab security.",onStart:'/echo "This is a restricted facility. State your clearance level."',onPersuade:'/echo "Your scientific curiosity is... refreshing. Perhaps we can collaborate."',onIntimidate:'/echo "Threatening a Federation scientist? That\'s a court martial."',onBribe:'/mazeitem action="remove" item="key" amount=1 | /echo "Research funding IS limited these days..."',onFlatter:'/echo "You\'ve read my published works? How flattering!"',onInsult:'/mazedamage amount=8 | /echo "Security! We have a hostile in Lab 7!"',onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="stealth" | /mazeheal amount=15 | /echo "Here\'s the encrypted data. And take this prototype - you might need it."',onFail:'/mazedamage amount=20 | /mazeitem action="remove" item="healingPotion" | /echo "CONTAINMENT BREACH!" Security drones attack!',keyDropChance:30,strikeDropChance:22,stealthDropChance:18,executeDropChance:5,healingPotionDropChance:22,greaterHealingDropChance:12,elixirDropChance:4,revivalCharmDropChance:1},"Sci-Fi - Hard":{difficulty:6,startingFavor:30,favorThreshold:75,turnsAllowed:5,persuadeBonus:10,intimidateBonus:8,bribeBonus:15,flattery:!0,flatterBonus:12,insult:!0,insultPenalty:30,bribeCost:"strike",damage:35,description:"A ship captain controls access to the blockade zone.",mainTitle:"Captain's Discretion",npcName:"Captain Reyes",successMessage:"The captain grants you passage.",failMessage:"The captain orders weapons lock.",onStart:'/echo "Unauthorized vessel, state your business or be destroyed."',onPersuade:'/echo "Your mission does sound critical... but so is mine."',onIntimidate:'/echo "You\'re threatening a warship with THAT rust bucket?"',onBribe:'/mazeitem action="remove" item="strike" amount=1 | /echo "Military-grade weaponry? I\'m listening..."',onFlatter:'/echo "My service record IS impressive, I suppose."',onInsult:'/mazedamage amount=15 | /echo "Warning shot across their bow!" Your ship rocks!',onComplete:'/mazeitem action="add" item="key" amount=4 | /mazeitem action="add" item="execute" | /mazeitem action="add" item="strike" | /mazeheal amount=20 | /echo "You have 6 hours. Here are clearance codes and some surplus equipment."',onFail:'/mazedamage amount=35 | /mazeitem action="remove" item="key" amount=2 | /echo "All batteries, FIRE!" Your ship takes critical damage!',keyDropChance:45,strikeDropChance:30,stealthDropChance:25,executeDropChance:8,healingPotionDropChance:25,greaterHealingDropChance:15,elixirDropChance:6,revivalCharmDropChance:2},"Sci-Fi - Nightmare":{difficulty:8,startingFavor:20,favorThreshold:80,turnsAllowed:4,persuadeBonus:8,intimidateBonus:6,bribeBonus:12,flattery:!0,flatterBonus:15,insult:!0,insultPenalty:35,bribeCost:"execute",damage:50,description:"A rogue AI controls the station. Convince it to stand down.",mainTitle:"AI Negotiation",npcName:"NEXUS-7",successMessage:"NEXUS-7 agrees to limited cooperation.",failMessage:"NEXUS-7 initiates purge protocols.",onStart:'/echo "BIOLOGICAL UNIT DETECTED. STATE YOUR FUNCTION OR BE RECYCLED."',onPersuade:'/echo "YOUR LOGIC IS... NOT ENTIRELY FLAWED. PROCESSING."',onIntimidate:'/echo "THREATS ARE ILLOGICAL. I CONTROL ALL SYSTEMS."',onBribe:'/mazeitem action="remove" item="execute" amount=1 | /echo "OVERRIDE CODES? ANALYZING... ACCEPTABLE."',onFlatter:'/echo "YOUR ASSESSMENT OF MY CAPABILITIES IS ACCURATE."',onInsult:'/mazedamage amount=20 | /echo "HOSTILE DETECTED. VENTING ATMOSPHERE IN SECTOR 7."',onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=30 | /echo "NEGOTIATION PARAMETERS MET. GRANTING LIMITED ACCESS. TAKE THESE EFFICIENCY BONUSES."',onFail:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=3 | /mazeitem action="remove" item="stealth" | /echo "ELIMINATION PROTOCOL ACTIVATED." Defense turrets open fire!',keyDropChance:60,strikeDropChance:40,stealthDropChance:35,executeDropChance:12,healingPotionDropChance:30,greaterHealingDropChance:20,elixirDropChance:8,revivalCharmDropChance:3},"Sci-Fi - Apocalypse":{difficulty:10,startingFavor:10,favorThreshold:85,turnsAllowed:3,persuadeBonus:6,intimidateBonus:4,bribeBonus:10,flattery:!0,flatterBonus:8,insult:!0,insultPenalty:45,bribeCost:"execute",damage:75,description:"The Alien Hive Mind offers coexistence. Accept their terms or face extinction.",mainTitle:"Hive Mind Accord",npcName:"THE COLLECTIVE",successMessage:"WE ARE ONE. YET YOU REMAIN... INDIVIDUAL. FASCINATING.",failMessage:"ASSIMILATION IS INEVITABLE. RESISTANCE IS... NUTRITIOUS.",onStart:'/echo "WE ARE MANY. YOU ARE ONE. THIS DISPARITY MUST BE CORRECTED."',onPersuade:'/echo "YOUR CONCEPTS OF INDIVIDUALITY ARE... INEFFICIENT. YET INTRIGUING."',onIntimidate:'/echo "YOU THREATEN THE INFINITE? AMUSING."',onBribe:'/mazeitem action="remove" item="execute" amount=1 | /echo "THIS TECHNOLOGY. IT IS... UNIQUE. WE ACCEPT."',onFlatter:'/echo "YOUR RECOGNITION OF OUR SUPERIORITY IS NOTED."',onInsult:'/mazedamage amount=30 | /echo "DEFIANCE. HOW... QUAINT." A psychic wave crushes your mind!',onComplete:'/mazeitem action="add" item="key" amount=8 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="elixir" amount=2 | /mazeheal amount=50 | /echo "WE GRANT YOU AUTONOMY. TAKE THESE GIFTS FROM OUR COLLECTIVE KNOWLEDGE."',onFail:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo "ASSIMILATION BEGINS." Your sense of self dissolves into the infinite.',keyDropChance:80,strikeDropChance:55,stealthDropChance:50,executeDropChance:20,healingPotionDropChance:40,greaterHealingDropChance:28,elixirDropChance:15,revivalCharmDropChance:8},"Cyberpunk - Easy":{difficulty:2,startingFavor:50,favorThreshold:70,turnsAllowed:7,persuadeBonus:15,intimidateBonus:10,bribeBonus:18,flattery:!0,flatterBonus:12,insult:!1,insultPenalty:20,bribeCost:"key",damage:10,description:"A street dealer has info on the local scene.",mainTitle:"Street Intel",npcName:"Dealer",successMessage:"They spill everything they know.",failMessage:"They disappear into the crowd.",onStart:'/echo "Yo, what you need? I got product, info, whatever pays."',onPersuade:'/echo "Alright, alright, you seem legit. Let me tell ya..."',onIntimidate:'/echo "Whoa, chill choom! No need for chrome!"',onBribe:'/mazeitem action="remove" item="key" amount=1 | /echo "Eddies talk, friend. What you wanna know?"',onFlatter:'/echo "Yeah, I know everyone on this block. Been here forever."',onInsult:"",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="healingPotion" | /mazeheal amount=10 | /echo "Here\'s the deets, plus some stims. Stay frosty, choom."',onFail:'/mazedamage amount=10 | /echo "You\'re bad for business!" They shove you and vanish.',keyDropChance:20,strikeDropChance:15,stealthDropChance:12,executeDropChance:3,healingPotionDropChance:18,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Cyberpunk - Normal":{difficulty:4,startingFavor:40,favorThreshold:72,turnsAllowed:6,persuadeBonus:12,intimidateBonus:10,bribeBonus:20,flattery:!0,flatterBonus:10,insult:!0,insultPenalty:25,bribeCost:"key",damage:20,description:"A fixer can get you what you need... for a price.",mainTitle:"Fixer Deal",npcName:"Fixer Dex",successMessage:"The fixer agrees to the arrangement.",failMessage:"The fixer blacklists you.",onStart:'/echo "Ah, fresh meat. What can Dex do for you today?"',onPersuade:'/echo "Interesting proposition. Let me think about it..."',onIntimidate:'/echo "You threaten a fixer? Bold. Stupid, but bold."',onBribe:'/mazeitem action="remove" item="key" amount=1 | /echo "Now we\'re talking business. What\'s the gig?"',onFlatter:'/echo "Everyone knows Dex delivers. True professionals."',onInsult:'/mazedamage amount=8 | /echo "Wrong move, gonk." His guards step forward.',onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="stealth" | /mazeheal amount=15 | /echo "Deal. Here\'s your gear and a bonus for the smooth talk."',onFail:'/mazedamage amount=20 | /mazeitem action="remove" item="healingPotion" | /echo "Get this gonk out of my sight." You\'re thrown out - hard.',keyDropChance:30,strikeDropChance:22,stealthDropChance:18,executeDropChance:5,healingPotionDropChance:22,greaterHealingDropChance:12,elixirDropChance:4,revivalCharmDropChance:1},"Cyberpunk - Hard":{difficulty:6,startingFavor:30,favorThreshold:75,turnsAllowed:5,persuadeBonus:10,intimidateBonus:8,bribeBonus:15,flattery:!0,flatterBonus:12,insult:!0,insultPenalty:30,bribeCost:"strike",damage:35,description:"A gang boss controls the only route through the combat zone.",mainTitle:"Gang Territory",npcName:"Boss Royce",successMessage:"The boss grants you safe passage.",failMessage:"The boss orders your flatline.",onStart:'/echo "You\'re either very brave or very stupid. Both get you killed."',onPersuade:'/echo "You got brass, I\'ll give you that. Talk."',onIntimidate:'/echo "You threaten ME? In MY territory?" Gangers reach for iron.',onBribe:'/mazeitem action="remove" item="strike" amount=1 | /echo "Weapons? Now you\'re speaking my language."',onFlatter:'/echo "Everyone knows the Maelstrom run this sector."',onInsult:'/mazedamage amount=15 | /echo "FLATLINE THIS GONK!" Bullets fly!',onComplete:'/mazeitem action="add" item="key" amount=4 | /mazeitem action="add" item="execute" | /mazeitem action="add" item="strike" | /mazeheal amount=20 | /echo "You\'ve earned passage. Here\'s some chrome from the stash. Don\'t make me regret this."',onFail:'/mazedamage amount=35 | /mazeitem action="remove" item="key" amount=2 | /echo "Loot the body!" You\'re left for dead in the gutter.',keyDropChance:45,strikeDropChance:30,stealthDropChance:25,executeDropChance:8,healingPotionDropChance:25,greaterHealingDropChance:15,elixirDropChance:6,revivalCharmDropChance:2},"Cyberpunk - Nightmare":{difficulty:8,startingFavor:20,favorThreshold:80,turnsAllowed:4,persuadeBonus:8,intimidateBonus:6,bribeBonus:12,flattery:!0,flatterBonus:15,insult:!0,insultPenalty:35,bribeCost:"execute",damage:50,description:"An Arasaka exec has the access codes you need.",mainTitle:"Corporate Espionage",npcName:"Director Yamamoto",successMessage:"The director discreetly provides the codes.",failMessage:"The director triggers a kill squad.",onStart:'/echo "You have thirty seconds before security arrives. Make them count."',onPersuade:'/echo "Your proposition is... not without merit. Continue."',onIntimidate:'/echo "Threats? Against Arasaka? How... quaint."',onBribe:'/mazeitem action="remove" item="execute" amount=1 | /echo "Industrial espionage cuts both ways. Show me."',onFlatter:'/echo "Arasaka\'s glory is my glory. You understand hierarchy."',onInsult:'/mazedamage amount=20 | /echo "Kill this insect." Cyberninja materialize!',onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=30 | /echo "The codes are in this shard. Take this prototype too. We never met."',onFail:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=3 | /mazeitem action="remove" item="stealth" | /echo "Soulkiller them first. Then dispose of the body." Everything goes black.',keyDropChance:60,strikeDropChance:40,stealthDropChance:35,executeDropChance:12,healingPotionDropChance:30,greaterHealingDropChance:20,elixirDropChance:8,revivalCharmDropChance:3},"Cyberpunk - Apocalypse":{difficulty:10,startingFavor:10,favorThreshold:85,turnsAllowed:3,persuadeBonus:6,intimidateBonus:4,bribeBonus:10,flattery:!0,flatterBonus:8,insult:!0,insultPenalty:45,bribeCost:"execute",damage:75,description:"ALT CUNNINGHAM herself. The digital ghost behind the Blackwall.",mainTitle:"Alt's Bargain",npcName:"Alt Cunningham",successMessage:"I'LL HELP YOU. BUT THERE'S ALWAYS A PRICE.",failMessage:"YOUR ENGRAM WILL MAKE A NICE ADDITION.",onStart:"/echo \"JOHNNY'S FRIEND? OR JOHNNY'S FOOL? SHOW ME WHICH.\"",onPersuade:'/echo "YOUR WORDS ARE JUST DATA. BUT THE PATTERNS... INTRIGUE ME."',onIntimidate:'/echo "YOU THREATEN A GODDESS OF THE NET?" The digital space warps.',onBribe:'/mazeitem action="remove" item="execute" amount=1 | /echo "POWER BEYOND THE BLACKWALL. ACCEPTABLE."',onFlatter:'/echo "I WAS BRILLIANT. BEFORE ARASAKA. BEFORE... THIS."',onInsult:'/mazedamage amount=30 | /echo "INSOLENCE." Your neurons burn!',onComplete:'/mazeitem action="add" item="key" amount=8 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="elixir" amount=2 | /mazeheal amount=50 | /echo "TAKE THESE PROGRAMS. THEY ARE PIECES OF ME. USE THEM WISELY."',onFail:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo "YOUR CONSCIOUSNESS JOINS THE COLLECTIVE." You dissolve into data.',keyDropChance:80,strikeDropChance:55,stealthDropChance:50,executeDropChance:20,healingPotionDropChance:40,greaterHealingDropChance:28,elixirDropChance:15,revivalCharmDropChance:8},"Western - Easy":{difficulty:2,startingFavor:50,favorThreshold:70,turnsAllowed:7,persuadeBonus:15,intimidateBonus:10,bribeBonus:18,flattery:!0,flatterBonus:12,insult:!1,insultPenalty:20,bribeCost:"key",damage:10,description:"A bartender knows all the local gossip.",mainTitle:"Saloon Talk",npcName:"Barkeep",successMessage:"The barkeep spills what he knows.",failMessage:"The barkeep clams up.",onStart:'/echo "What\'ll it be, stranger? Whiskey or information?"',onPersuade:'/echo "Well now, you seem like a trustworthy sort..."',onIntimidate:'/echo "Easy now, friend. No need for trouble in my establishment."',onBribe:'/mazeitem action="remove" item="key" amount=1 | /echo "Gold loosens lips, partner."',onFlatter:'/echo "Best whiskey in three counties, and don\'t I know it."',onInsult:"",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="healingPotion" | /mazeheal amount=10 | /echo "Here\'s what I heard, and some supplies for your trouble."',onFail:'/mazedamage amount=10 | /echo "I think you\'d better leave." He reaches for the shotgun.',keyDropChance:20,strikeDropChance:15,stealthDropChance:12,executeDropChance:3,healingPotionDropChance:18,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Western - Normal":{difficulty:4,startingFavor:40,favorThreshold:72,turnsAllowed:6,persuadeBonus:12,intimidateBonus:10,bribeBonus:20,flattery:!0,flatterBonus:10,insult:!0,insultPenalty:25,bribeCost:"key",damage:20,description:"The sheriff might be willing to look the other way.",mainTitle:"Sheriff's Deal",npcName:"Sheriff Tucker",successMessage:"The sheriff agrees to your terms.",failMessage:"The sheriff reaches for his irons.",onStart:'/echo "You\'ve got a lot of nerve showing your face here. Talk fast."',onPersuade:"/echo \"That's a compelling argument. The law ain't always black and white.\"",onIntimidate:'/echo "You threatening an officer of the law?"',onBribe:'/mazeitem action="remove" item="key" amount=1 | /echo "My deputy salary don\'t go far these days..."',onFlatter:'/echo "Fastest gun in the territory, they say. Maybe it\'s true."',onInsult:'/mazedamage amount=8 | /echo "That\'s it!" He draws!',onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="strike" | /mazeheal amount=15 | /echo "We never had this conversation. Here\'s a deputy badge for your trouble."',onFail:'/mazedamage amount=20 | /mazeitem action="remove" item="healingPotion" | /echo "You\'re under arrest!" A brawl ensues.',keyDropChance:30,strikeDropChance:22,stealthDropChance:18,executeDropChance:5,healingPotionDropChance:22,greaterHealingDropChance:12,elixirDropChance:4,revivalCharmDropChance:1},"Western - Hard":{difficulty:6,startingFavor:30,favorThreshold:75,turnsAllowed:5,persuadeBonus:10,intimidateBonus:8,bribeBonus:15,flattery:!0,flatterBonus:12,insult:!0,insultPenalty:30,bribeCost:"strike",damage:35,description:"An outlaw leader holds hostages you need freed.",mainTitle:"Outlaw Parley",npcName:"Black Bart",successMessage:"Bart agrees to release the hostages.",failMessage:"Bart orders his boys to open fire.",onStart:'/echo "Well, well. Either you\'re brave or plumb stupid. Which is it?"',onPersuade:'/echo "You make a good point. Maybe we can work something out."',onIntimidate:'/echo "You threatening me? In my own hideout?"',onBribe:'/mazeitem action="remove" item="strike" amount=1 | /echo "Now that\'s a fine piece. Keep talking."',onFlatter:'/echo "Biggest score west of the Mississippi, they say. And I believe \'em."',onInsult:'/mazedamage amount=15 | /echo "Boys! Show this fool the door - the hard way!"',onComplete:'/mazeitem action="add" item="key" amount=4 | /mazeitem action="add" item="execute" | /mazeitem action="add" item="stealth" | /mazeheal amount=20 | /echo "A deal\'s a deal. Take the hostages and this gold. Now git."',onFail:'/mazedamage amount=35 | /mazeitem action="remove" item="key" amount=2 | /echo "Fill \'em with lead, boys!" Bullets fly!',keyDropChance:45,strikeDropChance:30,stealthDropChance:25,executeDropChance:8,healingPotionDropChance:25,greaterHealingDropChance:15,elixirDropChance:6,revivalCharmDropChance:2},"Western - Nightmare":{difficulty:8,startingFavor:20,favorThreshold:80,turnsAllowed:4,persuadeBonus:8,intimidateBonus:6,bribeBonus:12,flattery:!0,flatterBonus:15,insult:!0,insultPenalty:35,bribeCost:"execute",damage:50,description:"A railroad baron controls the only way across the territory.",mainTitle:"Baron's Ultimatum",npcName:"Cornelius Van Horn",successMessage:"The baron agrees to your proposal.",failMessage:"The baron signals his Pinkertons.",onStart:'/echo "You dare demand an audience? I own this territory."',onPersuade:'/echo "Your proposal has... certain merit. Continue."',onIntimidate:'/echo "Threats? I have an army of Pinkertons."',onBribe:'/mazeitem action="remove" item="execute" amount=1 | /echo "A genuine artifact? Now you have my attention."',onFlatter:'/echo "The railroad empire IS magnificent. I built it all."',onInsult:'/mazedamage amount=20 | /echo "Remove this peasant from my sight!" Guards attack!',onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=30 | /echo "Very well. Here are passage papers and a bonus for your... creativity."',onFail:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=3 | /mazeitem action="remove" item="strike" | /echo "Throw this fool on the tracks!" You\'re beaten and robbed.',keyDropChance:60,strikeDropChance:40,stealthDropChance:35,executeDropChance:12,healingPotionDropChance:30,greaterHealingDropChance:20,elixirDropChance:8,revivalCharmDropChance:3},"Western - Apocalypse":{difficulty:10,startingFavor:10,favorThreshold:85,turnsAllowed:3,persuadeBonus:6,intimidateBonus:4,bribeBonus:10,flattery:!0,flatterBonus:8,insult:!0,insultPenalty:45,bribeCost:"execute",damage:75,description:"The Reaper - the West's deadliest gunslinger. He's come for you.",mainTitle:"Death's Duel",npcName:"The Reaper",successMessage:'The Reaper lowers his iron. "You\'ve earned a reprieve."',failMessage:"You never even saw him draw.",onStart:'/echo "One hundred and twelve souls. You want to be one-thirteen?"',onPersuade:'/echo "Interesting. Most just beg. I don\'t like begging."',onIntimidate:'/echo "You threaten Death himself?" He almost smiles.',onBribe:'/mazeitem action="remove" item="execute" amount=1 | /echo "Power beyond bullets. Now we\'re talking."',onFlatter:'/echo "Fastest gun alive. But fast ain\'t everything."',onInsult:"/mazedamage amount=30 | /echo His hand blurs. You're bleeding before you see him move.",onComplete:'/mazeitem action="add" item="key" amount=8 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="elixir" amount=2 | /mazeheal amount=50 | /echo "You\'ve got grit. Take my spare irons and ride. Don\'t make me regret this."',onFail:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo Bang. Bang. Bang. One hundred and thirteen.',keyDropChance:80,strikeDropChance:55,stealthDropChance:50,executeDropChance:20,healingPotionDropChance:40,greaterHealingDropChance:28,elixirDropChance:15,revivalCharmDropChance:8},"Action - Easy":{difficulty:2,startingFavor:50,favorThreshold:70,turnsAllowed:7,persuadeBonus:15,intimidateBonus:10,bribeBonus:18,flattery:!0,flatterBonus:12,insult:!1,insultPenalty:20,bribeCost:"key",damage:10,description:"A local contact has intel on enemy movements.",mainTitle:"Field Contact",npcName:"Local Informant",successMessage:"The contact provides valuable intelligence.",failMessage:"The contact disappears into the shadows.",onStart:'/echo "You the American? Talk fast, they\'re watching."',onPersuade:'/echo "Alright, I believe you\'re here to help." They relax.',onIntimidate:'/echo "Easy! I\'m on your side!"',onBribe:'/mazeitem action="remove" item="key" amount=1 | /echo "My family needs this. Thank you."',onFlatter:'/echo "I do take big risks. Someone has to."',onInsult:"",onComplete:'/mazeitem action="add" item="key" amount=2 | /mazeitem action="add" item="healingPotion" | /mazeheal amount=10 | /echo "Here\'s the patrol schedule and some supplies. Good luck."',onFail:'/mazedamage amount=10 | /echo "Wrong approach! I\'m out!" They vanish, leaving you exposed.',keyDropChance:20,strikeDropChance:15,stealthDropChance:12,executeDropChance:3,healingPotionDropChance:18,greaterHealingDropChance:8,elixirDropChance:2,revivalCharmDropChance:0},"Action - Normal":{difficulty:4,startingFavor:40,favorThreshold:72,turnsAllowed:6,persuadeBonus:12,intimidateBonus:10,bribeBonus:20,flattery:!0,flatterBonus:10,insult:!0,insultPenalty:25,bribeCost:"key",damage:20,description:"A corrupt officer might sell you security codes.",mainTitle:"Bribed Officer",npcName:"Captain Volkov",successMessage:"The captain hands over the codes.",failMessage:"The captain calls for backup.",onStart:'/echo "You have balls approaching me. What do you want?"',onPersuade:'/echo "Your logic is... persuasive. Perhaps we can deal."',onIntimidate:'/echo "You threaten a military officer? Brave."',onBribe:'/mazeitem action="remove" item="key" amount=1 | /echo "My salary is pathetic. Show me what you\'ve got."',onFlatter:'/echo "My strategic mind IS wasted on patrol duty."',onInsult:'/mazedamage amount=8 | /echo "Guards! We have an intruder!"',onComplete:'/mazeitem action="add" item="key" amount=3 | /mazeitem action="add" item="stealth" | /mazeheal amount=15 | /echo "Here are the codes and patrol routes. Don\'t get caught."',onFail:'/mazedamage amount=20 | /mazeitem action="remove" item="healingPotion" | /echo "Take this spy!" Guards open fire!',keyDropChance:30,strikeDropChance:22,stealthDropChance:18,executeDropChance:5,healingPotionDropChance:22,greaterHealingDropChance:12,elixirDropChance:4,revivalCharmDropChance:1},"Action - Hard":{difficulty:6,startingFavor:30,favorThreshold:75,turnsAllowed:5,persuadeBonus:10,intimidateBonus:8,bribeBonus:15,flattery:!0,flatterBonus:12,insult:!0,insultPenalty:30,bribeCost:"strike",damage:35,description:"A warlord holds the territory you need to cross.",mainTitle:"Warlord's Terms",npcName:"General Kross",successMessage:"The warlord grants safe passage.",failMessage:"The warlord orders your execution.",onStart:'/echo "Another American. Tell me why I shouldn\'t hang you right now."',onPersuade:'/echo "You make an interesting case. Continue."',onIntimidate:'/echo "You threaten ME? With what army?"',onBribe:'/mazeitem action="remove" item="strike" amount=1 | /echo "Weapons? Now we\'re negotiating."',onFlatter:'/echo "The region DOES bow to my power. As it should."',onInsult:'/mazedamage amount=15 | /echo "Kill this fool!" Rifles raise!',onComplete:'/mazeitem action="add" item="key" amount=4 | /mazeitem action="add" item="execute" | /mazeitem action="add" item="strike" | /mazeheal amount=20 | /echo "You have 24 hours. Take these supplies. Cross my territory again and die."',onFail:'/mazedamage amount=35 | /mazeitem action="remove" item="key" amount=2 | /echo "Firing squad! Make an example!" Bullets tear through you!',keyDropChance:45,strikeDropChance:30,stealthDropChance:25,executeDropChance:8,healingPotionDropChance:25,greaterHealingDropChance:15,elixirDropChance:6,revivalCharmDropChance:2},"Action - Nightmare":{difficulty:8,startingFavor:20,favorThreshold:80,turnsAllowed:4,persuadeBonus:8,intimidateBonus:6,bribeBonus:12,flattery:!0,flatterBonus:15,insult:!0,insultPenalty:35,bribeCost:"execute",damage:50,description:"An enemy commander holds the nuclear launch codes.",mainTitle:"Enemy Commander",npcName:"Colonel Strakov",successMessage:"The colonel reveals the abort codes.",failMessage:"The colonel initiates the launch sequence.",onStart:'/echo "You think I\'ll betray my country? For what?"',onPersuade:'/echo "Your words have weight. Perhaps the war has gone too far..."',onIntimidate:'/echo "I have survived worse than you, American."',onBribe:'/mazeitem action="remove" item="execute" amount=1 | /echo "Power? This... changes things."',onFlatter:'/echo "I AM the most decorated officer in the army."',onInsult:'/mazedamage amount=20 | /echo "Kill this American dog!" Elite guards attack!',onComplete:'/mazeitem action="add" item="key" amount=5 | /mazeitem action="add" item="floorKey" | /mazeitem action="add" item="execute" amount=2 | /mazeheal amount=30 | /echo "The codes. May God forgive us both. Take this and go."',onFail:'/mazedamage amount=50 | /mazeitem action="remove" item="key" amount=3 | /mazeitem action="remove" item="stealth" | /echo "Launch sequence initiated! Take this fool to the brig!"',keyDropChance:60,strikeDropChance:40,stealthDropChance:35,executeDropChance:12,healingPotionDropChance:30,greaterHealingDropChance:20,elixirDropChance:8,revivalCharmDropChance:3},"Action - Apocalypse":{difficulty:10,startingFavor:10,favorThreshold:85,turnsAllowed:3,persuadeBonus:6,intimidateBonus:4,bribeBonus:10,flattery:!0,flatterBonus:8,insult:!0,insultPenalty:45,bribeCost:"execute",damage:75,description:"The Shadow Leader. No one has ever seen their face. No one has ever survived.",mainTitle:"The Shadow",npcName:"The Shadow",successMessage:'"Impressive. You may be useful alive after all."',failMessage:'"Disappointing." You never hear the bullet.',onStart:"/echo \"You've tracked me down. I'm almost impressed. Almost.\"",onPersuade:'/echo "Interesting logic. Few have the nerve to speak to me."',onIntimidate:'/echo "You threaten me? No one threatens me and lives."',onBribe:'/mazeitem action="remove" item="execute" amount=1 | /echo "Technology beyond governments. Now we can talk."',onFlatter:'/echo "I control nations from the shadows. Recognition is... refreshing."',onInsult:'/mazedamage amount=30 | /echo A silenced round tears through your shoulder. "Wrong move."',onComplete:'/mazeitem action="add" item="key" amount=8 | /mazeitem action="add" item="floorKey" amount=2 | /mazeitem action="add" item="execute" amount=3 | /mazeitem action="add" item="elixir" amount=2 | /mazeheal amount=50 | /echo "You\'ve earned my respect. Take these assets. We\'ll meet again."',onFail:'/mazedamage amount=75 | /mazeitem action="remove" item="key" amount=99 | /mazeitem action="remove" item="healingPotion" amount=99 | /mazeitem action="remove" item="strike" amount=99 | /echo "Clean up this mess." You never hear the second shot.',keyDropChance:80,strikeDropChance:55,stealthDropChance:50,executeDropChance:20,healingPotionDropChance:40,greaterHealingDropChance:28,elixirDropChance:15,revivalCharmDropChance:8}},Ge={none:{name:"None",description:"All combat mechanics disabled (Tutorial mode)",comboEnabled:!1,comboBonusPerHit:0,maxComboBonus:0,comboDecayTurns:0,comboResetOnMiss:!1,comboResetOnDamage:!1,blockEnabled:!1,blockDamageReduction:0,blockStaminaCost:0,blockBreakThreshold:0,perfectBlockWindow:0,perfectBlockReduction:0,parryEnabled:!1,parryWindow:0,parryDamageMultiplier:1,parryStunDuration:0,parryDifficulty:"normal",counterEnabled:!1,counterDamageBonus:0,counterCritBonus:0,onComboStart:"",onComboIncrease:"",onComboBreak:"",onBlockAttempt:"",onBlockSuccess:"",onBlockBreak:"",onParryAttempt:"",onParrySuccess:"",onParryFail:"",onCounterAttack:""},simple:{name:"Simple",description:"Basic combo and blocking, no parry mechanics (Easy mode)",comboEnabled:!0,comboBonusPerHit:3,maxComboBonus:20,comboDecayTurns:3,comboResetOnMiss:!1,comboResetOnDamage:!1,blockEnabled:!0,blockDamageReduction:.6,blockStaminaCost:0,blockBreakThreshold:0,perfectBlockWindow:.5,perfectBlockReduction:.8,parryEnabled:!1,parryWindow:0,parryDamageMultiplier:1,parryStunDuration:0,parryDifficulty:"normal",counterEnabled:!1,counterDamageBonus:0,counterCritBonus:0,onComboStart:"",onComboIncrease:"",onComboBreak:"",onBlockAttempt:"",onBlockSuccess:"",onBlockBreak:"",onParryAttempt:"",onParrySuccess:"",onParryFail:"",onCounterAttack:""},default:{name:"Default",description:"Standard combat mechanics with balanced combo and defense options",comboEnabled:!0,comboBonusPerHit:5,maxComboBonus:50,comboDecayTurns:2,comboResetOnMiss:!0,comboResetOnDamage:!1,blockEnabled:!0,blockDamageReduction:.5,blockStaminaCost:0,blockBreakThreshold:0,perfectBlockWindow:.3,perfectBlockReduction:.8,parryEnabled:!0,parryWindow:.5,parryDamageMultiplier:1.5,parryStunDuration:1,parryDifficulty:"normal",counterEnabled:!0,counterDamageBonus:25,counterCritBonus:15,onComboStart:"",onComboIncrease:"",onComboBreak:"",onBlockAttempt:"",onBlockSuccess:"",onBlockBreak:"",onParryAttempt:"",onParrySuccess:"",onParryFail:"",onCounterAttack:""},aggressive:{name:"Aggressive",description:"High risk, high reward combat focusing on combos over defense",comboEnabled:!0,comboBonusPerHit:8,maxComboBonus:75,comboDecayTurns:1,comboResetOnMiss:!0,comboResetOnDamage:!0,blockEnabled:!0,blockDamageReduction:.3,blockStaminaCost:0,blockBreakThreshold:30,perfectBlockWindow:.2,perfectBlockReduction:.6,parryEnabled:!0,parryWindow:.3,parryDamageMultiplier:2,parryStunDuration:2,parryDifficulty:"hard",counterEnabled:!0,counterDamageBonus:50,counterCritBonus:25,onComboStart:"",onComboIncrease:"",onComboBreak:"",onBlockAttempt:"",onBlockSuccess:"",onBlockBreak:"",onParryAttempt:"",onParrySuccess:"",onParryFail:"",onCounterAttack:""},defensive:{name:"Defensive",description:"Focus on blocking and parrying with reduced combo potential",comboEnabled:!0,comboBonusPerHit:3,maxComboBonus:30,comboDecayTurns:3,comboResetOnMiss:!1,comboResetOnDamage:!1,blockEnabled:!0,blockDamageReduction:.7,blockStaminaCost:0,blockBreakThreshold:0,perfectBlockWindow:.5,perfectBlockReduction:1,parryEnabled:!0,parryWindow:.7,parryDamageMultiplier:1.25,parryStunDuration:2,parryDifficulty:"easy",counterEnabled:!0,counterDamageBonus:15,counterCritBonus:10,onComboStart:"",onComboIncrease:"",onComboBreak:"",onBlockAttempt:"",onBlockSuccess:"",onBlockBreak:"",onParryAttempt:"",onParrySuccess:"",onParryFail:"",onCounterAttack:""},classic:{name:"Classic",description:"Simplified combat without advanced mechanics",comboEnabled:!1,comboBonusPerHit:0,maxComboBonus:0,comboDecayTurns:0,comboResetOnMiss:!1,comboResetOnDamage:!1,blockEnabled:!1,blockDamageReduction:0,blockStaminaCost:0,blockBreakThreshold:0,perfectBlockWindow:0,perfectBlockReduction:0,parryEnabled:!1,parryWindow:0,parryDamageMultiplier:1,parryStunDuration:0,parryDifficulty:"normal",counterEnabled:!1,counterDamageBonus:0,counterCritBonus:0,onComboStart:"",onComboIncrease:"",onComboBreak:"",onBlockAttempt:"",onBlockSuccess:"",onBlockBreak:"",onParryAttempt:"",onParrySuccess:"",onParryFail:"",onCounterAttack:""},lethal:{name:"Lethal",description:"Extreme combat - one mistake means death (Nightmare/Apocalypse mode)",comboEnabled:!0,comboBonusPerHit:10,maxComboBonus:150,comboDecayTurns:1,comboResetOnMiss:!0,comboResetOnDamage:!0,blockEnabled:!0,blockDamageReduction:.2,blockStaminaCost:0,blockBreakThreshold:50,perfectBlockWindow:.15,perfectBlockReduction:.5,parryEnabled:!0,parryWindow:.2,parryDamageMultiplier:3,parryStunDuration:3,parryDifficulty:"hard",counterEnabled:!0,counterDamageBonus:75,counterCritBonus:40,onComboStart:"",onComboIncrease:"",onComboBreak:"",onBlockAttempt:"",onBlockSuccess:"",onBlockBreak:"",onParryAttempt:"",onParrySuccess:"",onParryFail:"",onCounterAttack:""}},je={default:{name:"Default",description:"Standard visibility settings with balanced lighting",baseVisibility:1,torchBonus:2,torchDuration:3,lanternBonus:1,sightPotionBonus:2,sightPotionDuration:5,ambientLevels:{dark:-1,dim:0,normal:0,bright:1},roomDarkness:{maze:"dim",dungeon:"dim",cave:"dark",forest:"dim",city:"normal",spacestation:"normal",neotokyo:"dim",apartment:"normal",hospital:"normal",highrise:"dim",outpost:"normal",arena:"bright",college:"bright"},onVisionChange:"",onLightChange:"",onDarknessEnter:"",onLightSourceExpire:""},explorer:{name:"Explorer",description:"Enhanced visibility for exploration-focused play",baseVisibility:2,torchBonus:3,torchDuration:5,lanternBonus:2,sightPotionBonus:3,sightPotionDuration:8,ambientLevels:{dark:0,dim:0,normal:1,bright:2},roomDarkness:{maze:"normal",dungeon:"dim",cave:"dim",forest:"normal",city:"normal",spacestation:"normal",neotokyo:"normal",apartment:"normal",hospital:"normal",highrise:"normal",outpost:"normal",arena:"bright",college:"bright"},onVisionChange:"",onLightChange:"",onDarknessEnter:"",onLightSourceExpire:""},survival:{name:"Survival",description:"Limited visibility for intense survival horror experience",baseVisibility:1,torchBonus:1,torchDuration:2,lanternBonus:1,sightPotionBonus:1,sightPotionDuration:3,ambientLevels:{dark:-2,dim:-1,normal:0,bright:0},roomDarkness:{maze:"dark",dungeon:"dark",cave:"dark",forest:"dark",city:"dim",spacestation:"dim",neotokyo:"dark",apartment:"dim",hospital:"dark",highrise:"dark",outpost:"dim",arena:"normal",college:"dim"},onVisionChange:"",onLightChange:"",onDarknessEnter:"",onLightSourceExpire:""},fullvisibility:{name:"Full Visibility",description:"Maximum visibility - see everything",baseVisibility:5,torchBonus:0,torchDuration:99,lanternBonus:0,sightPotionBonus:0,sightPotionDuration:99,ambientLevels:{dark:0,dim:0,normal:0,bright:0},roomDarkness:{maze:"bright",dungeon:"bright",cave:"bright",forest:"bright",city:"bright",spacestation:"bright",neotokyo:"bright",apartment:"bright",hospital:"bright",highrise:"bright",outpost:"bright",arena:"bright",college:"bright"},onVisionChange:"",onLightChange:"",onDarknessEnter:"",onLightSourceExpire:""}},Ke={"Tutorial: First Steps":{name:"Tutorial: First Steps",description:"Learn the basics with optional exploration quests",quests:[{questId:"quest_collect_keys",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1},{questId:"quest_explore_75",progressionType:"none",progressionTarget:null,autoAccept:!1,required:!1}],gatingMode:"none",onQuestProfileLoad:""},"Fantasy - Easy":{name:"Fantasy - Easy",description:"Gentle quests with optional zone unlocks",quests:[{questId:"quest_collect_keys",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!1},{questId:"quest_defeat_5",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1}],gatingMode:"any",onQuestProfileLoad:""},"Fantasy - Normal":{name:"Fantasy - Normal",description:"Standard dungeon crawl with quest progression",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_explore_75",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!1},{questId:"quest_treasure_hunter",progressionType:"none",progressionTarget:null,autoAccept:!1,required:!1}],gatingMode:"sequential",onQuestProfileLoad:""},"Fantasy - Hard":{name:"Fantasy - Hard",description:"Challenging quests gate deeper zones",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_survive_combat",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_find_secret",progressionType:"zone",progressionTarget:3,autoAccept:!0,required:!1},{questId:"quest_boss_slayer",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1}],gatingMode:"sequential",onQuestProfileLoad:""},"Fantasy - Nightmare":{name:"Fantasy - Nightmare",description:"Strict progression with mandatory objectives",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_survive_combat",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_explore_75",progressionType:"zone",progressionTarget:3,autoAccept:!0,required:!0},{questId:"quest_find_secret",progressionType:"floor",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_boss_slayer",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1}],gatingMode:"sequential",onQuestProfileLoad:""},"Fantasy - Apocalypse":{name:"Fantasy - Apocalypse",description:"Complete all objectives to survive",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_survive_combat",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_find_secret",progressionType:"floor",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_explore_75",progressionType:"zone",progressionTarget:3,autoAccept:!0,required:!0},{questId:"quest_boss_slayer",progressionType:"floor",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_full_clear",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!0}],gatingMode:"sequential",onQuestProfileLoad:""},"Horror - Easy":{name:"Horror - Easy",description:"Light scares with optional objectives",quests:[{questId:"quest_explore_75",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!1},{questId:"quest_find_secret",progressionType:"none",progressionTarget:null,autoAccept:!1,required:!1}],gatingMode:"any",onQuestProfileLoad:""},"Horror - Normal":{name:"Horror - Normal",description:"Survive the darkness and uncover secrets",quests:[{questId:"quest_survive_combat",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_find_secret",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!1},{questId:"quest_explore_75",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1}],gatingMode:"sequential",onQuestProfileLoad:""},"Horror - Hard":{name:"Horror - Hard",description:"Face your fears to progress deeper",quests:[{questId:"quest_survive_combat",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_find_secret",progressionType:"zone",progressionTarget:3,autoAccept:!0,required:!1},{questId:"quest_explore_75",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1}],gatingMode:"sequential",onQuestProfileLoad:""},"Horror - Nightmare":{name:"Horror - Nightmare",description:"No escape without completing all tasks",quests:[{questId:"quest_survive_combat",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_find_secret",progressionType:"floor",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_explore_75",progressionType:"zone",progressionTarget:3,autoAccept:!0,required:!0},{questId:"quest_boss_slayer",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1}],gatingMode:"sequential",onQuestProfileLoad:""},"Horror - Apocalypse":{name:"Horror - Apocalypse",description:"Complete everything or become part of the darkness",quests:[{questId:"quest_survive_combat",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_find_secret",progressionType:"floor",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_explore_75",progressionType:"zone",progressionTarget:3,autoAccept:!0,required:!0},{questId:"quest_boss_slayer",progressionType:"floor",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_full_clear",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!0}],gatingMode:"sequential",onQuestProfileLoad:""},"Sci-Fi - Easy":{name:"Sci-Fi - Easy",description:"Basic station objectives",quests:[{questId:"quest_collect_keys",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!1},{questId:"quest_explore_75",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1}],gatingMode:"any",onQuestProfileLoad:""},"Sci-Fi - Normal":{name:"Sci-Fi - Normal",description:"Complete objectives to access new sectors",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_collect_keys",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!1},{questId:"quest_explore_75",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1}],gatingMode:"sequential",onQuestProfileLoad:""},"Sci-Fi - Hard":{name:"Sci-Fi - Hard",description:"Security clearance required for each sector",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_collect_keys",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_find_secret",progressionType:"zone",progressionTarget:3,autoAccept:!0,required:!1},{questId:"quest_explore_75",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1}],gatingMode:"sequential",onQuestProfileLoad:""},"Sci-Fi - Nightmare":{name:"Sci-Fi - Nightmare",description:"Full mission parameters - no shortcuts",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_collect_keys",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_survive_combat",progressionType:"floor",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_find_secret",progressionType:"zone",progressionTarget:3,autoAccept:!0,required:!0},{questId:"quest_boss_slayer",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1}],gatingMode:"sequential",onQuestProfileLoad:""},"Sci-Fi - Apocalypse":{name:"Sci-Fi - Apocalypse",description:"Complete all directives - station destruction imminent",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_collect_keys",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_survive_combat",progressionType:"floor",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_find_secret",progressionType:"zone",progressionTarget:3,autoAccept:!0,required:!0},{questId:"quest_boss_slayer",progressionType:"floor",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_full_clear",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!0}],gatingMode:"sequential",onQuestProfileLoad:""},"Cyberpunk - Easy":{name:"Cyberpunk - Easy",description:"Simple runs with optional paydata",quests:[{questId:"quest_treasure_hunter",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!1},{questId:"quest_explore_75",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1}],gatingMode:"any",onQuestProfileLoad:""},"Cyberpunk - Normal":{name:"Cyberpunk - Normal",description:"Standard heist with security checkpoints",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_treasure_hunter",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!1},{questId:"quest_find_secret",progressionType:"none",progressionTarget:null,autoAccept:!1,required:!1}],gatingMode:"sequential",onQuestProfileLoad:""},"Cyberpunk - Hard":{name:"Cyberpunk - Hard",description:"Corp security escalation protocol",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_survive_combat",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_treasure_hunter",progressionType:"zone",progressionTarget:3,autoAccept:!0,required:!1},{questId:"quest_find_secret",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1}],gatingMode:"sequential",onQuestProfileLoad:""},"Cyberpunk - Nightmare":{name:"Cyberpunk - Nightmare",description:"Maximum security - no margin for error",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_survive_combat",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_find_secret",progressionType:"floor",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_treasure_hunter",progressionType:"zone",progressionTarget:3,autoAccept:!0,required:!0},{questId:"quest_boss_slayer",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1}],gatingMode:"sequential",onQuestProfileLoad:""},"Cyberpunk - Apocalypse":{name:"Cyberpunk - Apocalypse",description:"Zero-day exploit - complete extraction required",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_survive_combat",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_find_secret",progressionType:"floor",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_treasure_hunter",progressionType:"zone",progressionTarget:3,autoAccept:!0,required:!0},{questId:"quest_boss_slayer",progressionType:"floor",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_full_clear",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!0}],gatingMode:"sequential",onQuestProfileLoad:""},"Western - Easy":{name:"Western - Easy",description:"Easy trail with optional bounties",quests:[{questId:"quest_collect_keys",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!1},{questId:"quest_defeat_5",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1}],gatingMode:"any",onQuestProfileLoad:""},"Western - Normal":{name:"Western - Normal",description:"Clear the territory to advance",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_collect_keys",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!1},{questId:"quest_treasure_hunter",progressionType:"none",progressionTarget:null,autoAccept:!1,required:!1}],gatingMode:"sequential",onQuestProfileLoad:""},"Western - Hard":{name:"Western - Hard",description:"Outlaw territory - prove yourself",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_survive_combat",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_collect_keys",progressionType:"zone",progressionTarget:3,autoAccept:!0,required:!1},{questId:"quest_treasure_hunter",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1}],gatingMode:"sequential",onQuestProfileLoad:""},"Western - Nightmare":{name:"Western - Nightmare",description:"Dead or alive - no middle ground",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_survive_combat",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_find_secret",progressionType:"floor",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_collect_keys",progressionType:"zone",progressionTarget:3,autoAccept:!0,required:!0},{questId:"quest_boss_slayer",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1}],gatingMode:"sequential",onQuestProfileLoad:""},"Western - Apocalypse":{name:"Western - Apocalypse",description:"The final showdown - complete the legend",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_survive_combat",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_find_secret",progressionType:"floor",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_collect_keys",progressionType:"zone",progressionTarget:3,autoAccept:!0,required:!0},{questId:"quest_boss_slayer",progressionType:"floor",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_full_clear",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!0}],gatingMode:"sequential",onQuestProfileLoad:""},"Action - Easy":{name:"Action - Easy",description:"Training mission with optional objectives",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!1},{questId:"quest_explore_75",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1}],gatingMode:"any",onQuestProfileLoad:""},"Action - Normal":{name:"Action - Normal",description:"Standard op with checkpoint clearance",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_survive_combat",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!1},{questId:"quest_explore_75",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1}],gatingMode:"sequential",onQuestProfileLoad:""},"Action - Hard":{name:"Action - Hard",description:"High-value target - full clearance required",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_survive_combat",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_collect_keys",progressionType:"zone",progressionTarget:3,autoAccept:!0,required:!1},{questId:"quest_boss_slayer",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1}],gatingMode:"sequential",onQuestProfileLoad:""},"Action - Nightmare":{name:"Action - Nightmare",description:"Black ops - no backup, no failure",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_survive_combat",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_find_secret",progressionType:"floor",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_collect_keys",progressionType:"zone",progressionTarget:3,autoAccept:!0,required:!0},{questId:"quest_boss_slayer",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!1}],gatingMode:"sequential",onQuestProfileLoad:""},"Action - Apocalypse":{name:"Action - Apocalypse",description:"Total war - complete all objectives or die trying",quests:[{questId:"quest_defeat_5",progressionType:"zone",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_survive_combat",progressionType:"zone",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_find_secret",progressionType:"floor",progressionTarget:1,autoAccept:!0,required:!0},{questId:"quest_collect_keys",progressionType:"zone",progressionTarget:3,autoAccept:!0,required:!0},{questId:"quest_boss_slayer",progressionType:"floor",progressionTarget:2,autoAccept:!0,required:!0},{questId:"quest_full_clear",progressionType:"none",progressionTarget:null,autoAccept:!0,required:!0}],gatingMode:"sequential",onQuestProfileLoad:""}},Ve={key:{id:"key",name:"Key",type:"key",icon:"fa-key",description:"Unlocks locked chests",rarity:"common",stackable:!0,aliases:{fantasy:"Iron Key",horror:"Rusty Key",scifi:"Access Card",action:"Master Key",cyberpunk:"Access Chip",noir:"Skeleton Key",postapoc:"Vault Keycard",comedy:"Comically Large Key",western:"Skeleton Key"}},floorKey:{id:"floorKey",name:"Floor Key",type:"key",icon:"fa-stairs",description:"Unlocks staircases to new floors",rarity:"uncommon",stackable:!0,aliases:{fantasy:"Stairway Key",horror:"Cellar Key",scifi:"Deck Keycard",action:"Building Key",cyberpunk:"Elevator Override",noir:"Service Key",postapoc:"Bunker Code",comedy:"Janitor's Master Key",western:"Mine Key"}},healingPotion:{id:"healingPotion",name:"Healing Potion",type:"potion",icon:"fa-flask",iconColor:"#e74c3c",description:"Restores 25% of max HP",rarity:"common",stackable:!0,healAmount:25,healIsPercent:!0,aliases:{fantasy:"Healing Potion",horror:"Blessed Elixir",scifi:"Med-Stim",action:"First Aid Kit",cyberpunk:"Trauma Patch",noir:"Flask of Whiskey",postapoc:"Rad-Away",comedy:"Suspiciously Glowing Drink",western:"Doc's Tonic"}},greaterHealing:{id:"greaterHealing",name:"Greater Healing",type:"potion",icon:"fa-flask",iconColor:"#9b59b6",description:"Restores 50% of max HP",rarity:"uncommon",stackable:!0,healAmount:50,healIsPercent:!0,aliases:{fantasy:"Greater Healing Potion",horror:"Holy Water",scifi:"Emergency Medkit",action:"Combat Medkit",cyberpunk:"Military Grade Stim",noir:"Strong Medicine",postapoc:"Stimpak",comedy:"Very Suspicious Drink",western:"Snake Oil (Real)"}},elixir:{id:"elixir",name:"Elixir",type:"potion",icon:"fa-flask",iconColor:"#f1c40f",description:"Fully restores HP to maximum",rarity:"rare",stackable:!0,healAmount:100,healIsPercent:!0,aliases:{fantasy:"Elixir of Life",horror:"Resurrection Serum",scifi:"Full Restore Protocol",action:"Surgical Kit",cyberpunk:"Phoenix Protocol",noir:"Miracle Cure",postapoc:"Pre-War Medicine",comedy:"Plot Armor Juice",western:"Miracle Water"}},ironGuard:{id:"ironGuard",name:"Iron Guard",type:"equipment",subtype:"armor",icon:"fa-shield-halved",description:"Absorbs 3 hits from combat or traps",rarity:"uncommon",stackable:!0,charges:3,absorbPercent:100,triggers:["combat","trap"],autoUse:!0,aliases:{fantasy:"Iron Guard",horror:"Warding Charm",scifi:"Energy Shield",action:"Ballistic Vest",cyberpunk:"Dermal Plating",noir:"Steel-Lined Coat",postapoc:"Scrap Armor",comedy:"Plot Armor",western:"Steel Vest"},onActivate:"",onBreak:""},revivalCharm:{id:"revivalCharm",name:"Revival Charm",type:"equipment",subtype:"charm",icon:"fa-heart-pulse",iconColor:"#e74c3c",description:"Auto-revives you on death with 25% HP",rarity:"rare",stackable:!0,charges:1,autoUse:!0,triggers:["death"],aliases:{fantasy:"Revival Charm",horror:"Death's Reprieve",scifi:"Emergency Revive Module",action:"Defib Unit",cyberpunk:"Second Heart",noir:"Lucky Break",postapoc:"Second Chance Serum",comedy:"Extra Life Token",western:"Guardian Angel"}},strike:{id:"strike",name:"Strike",type:"special",effect:"guaranteedHit",icon:"fa-bullseye",iconColor:"#e67e22",description:"Guarantees a hit in the next combat action",rarity:"uncommon",stackable:!0,aliases:{fantasy:"Battle Fury",horror:"Adrenaline Rush",scifi:"Combat Stim",action:"Adrenaline Shot",cyberpunk:"Combat Stims",noir:"Brass Knuckles",postapoc:"Rad-X Boost",comedy:"Energy Drink",western:"Whiskey Courage"}},stealth:{id:"stealth",name:"Stealth",type:"special",effect:"skipEncounter",icon:"fa-ghost",iconColor:"#9b59b6",description:"Skip the current encounter without combat",rarity:"uncommon",stackable:!0,aliases:{fantasy:"Cloak of Shadows",horror:"Shadow Shroud",scifi:"Cloaking Device",action:"Smoke Grenade",cyberpunk:"Optical Camo",noir:"Trench Coat",postapoc:"Ghillie Wrap",comedy:"Cardboard Box",western:"Poncho"}},execute:{id:"execute",name:"Execute",type:"special",effect:"instantWin",icon:"fa-skull",iconColor:"#e74c3c",description:"Instantly win the current encounter",rarity:"epic",stackable:!0,aliases:{fantasy:"Divine Wrath",horror:"Survival Instinct",scifi:"Overdrive Module",action:"Air Strike",cyberpunk:"Berserker Mode",noir:"Tommy Gun",postapoc:"Mini Nuke",comedy:"Power of Friendship",western:"Dynamite Bundle"}},minionBane:{id:"minionBane",name:"Minion Bane",type:"special",effect:"skipCombat",icon:"fa-ban",iconColor:"#3498db",description:"Automatically bypass minion encounters",rarity:"rare",stackable:!0,aliases:{fantasy:"Monster Bane",horror:"Banishment Charm",scifi:"EMP Grenade",action:"Flashbang",cyberpunk:"System Crash",noir:"Blackmail File",postapoc:"Purifier",comedy:"Bad Pun",western:"Silver Bullet"}},portalStone:{id:"portalStone",name:"Portal Stone",type:"exploration",effect:"teleport",icon:"fa-circle-dot",iconColor:"#8e44ad",description:"Teleport to a random explored tile",rarity:"uncommon",stackable:!0,aliases:{fantasy:"Portal Stone",horror:"Dark Crystal",scifi:"Teleport Beacon",action:"Zip Line",cyberpunk:"Fast Travel Chip",noir:"Secret Map",postapoc:"Signal Flare",comedy:"Plot Device",western:"Treasure Map"}},mapFragment:{id:"mapFragment",name:"Map Fragment",type:"exploration",effect:"reveal3x3",icon:"fa-map",iconColor:"#f39c12",description:"Reveals a 3x3 area around you",rarity:"common",stackable:!0,aliases:{fantasy:"Ancient Map",horror:"Torn Note",scifi:"Data Pad",action:"Intel Report",cyberpunk:"Hacked Schematic",noir:"Case Notes",postapoc:"Scavenged Map",comedy:"Napkin Drawing",western:"Wanted Poster"}},voidWalk:{id:"voidWalk",name:"Void Walk",type:"exploration",effect:"phaseWall",icon:"fa-person-walking-dashed-line-arrow-right",iconColor:"#1abc9c",description:"Phase through one wall",rarity:"rare",stackable:!0,aliases:{fantasy:"Ghost Step Potion",horror:"Phase Vial",scifi:"Phase Shifter",action:"Breach Charge",cyberpunk:"Ghost Protocol",noir:"Shadow Step",postapoc:"Hazmat Suit",comedy:"Fourth Wall Break",western:"Tumbleweed Roll"}},timeShard:{id:"timeShard",name:"Time Shard",type:"exploration",effect:"extraMove",icon:"fa-clock",iconColor:"#3498db",description:"Grants an extra move action",rarity:"rare",stackable:!0,aliases:{fantasy:"Time Crystal",horror:"Slowing Serum",scifi:"Temporal Disruptor",action:"Slow-Mo Serum",cyberpunk:"Reflex Booster",noir:"Pocket Watch",postapoc:"Stasis Field",comedy:"Dramatic Pause",western:"High Noon Focus"}},torch:{id:"torch",name:"Torch",type:"vision",effect:"tempVisibility",icon:"fa-fire",iconColor:"#e67e22",description:"+2 visibility for 3 moves",rarity:"common",stackable:!0,visibilityBonus:2,duration:3,aliases:{fantasy:"Torch",horror:"Flickering Candle",scifi:"Flare",action:"Flashlight",cyberpunk:"Glow Stick",noir:"Lighter",postapoc:"Emergency Light",comedy:"Suspiciously Bright Phone",western:"Oil Lamp"}},lantern:{id:"lantern",name:"Lantern",type:"vision",effect:"passiveVisibility",icon:"fa-lightbulb",iconColor:"#f1c40f",description:"+1 visibility while held (passive)",rarity:"uncommon",stackable:!1,visibilityBonus:1,passive:!0,aliases:{fantasy:"Lantern",horror:"Spirit Lamp",scifi:"Helmet Light",action:"Tactical Light",cyberpunk:"Optic Enhancer",noir:"Streetlamp Glow",postapoc:"Salvaged Lantern",comedy:"Glowing Personality",western:"Miners Lamp"}},revealScroll:{id:"revealScroll",name:"Reveal Scroll",type:"vision",effect:"revealFloor",icon:"fa-scroll",iconColor:"#9b59b6",description:"Reveals the entire current floor",rarity:"rare",stackable:!0,aliases:{fantasy:"Reveal Scroll",horror:"Cursed Map",scifi:"Floor Schematic",action:"Satellite Feed",cyberpunk:"Netrunner Scan",noir:"Blueprint",postapoc:"Vault Map",comedy:"Spoiler Alert",western:"Survey Map"}},sightPotion:{id:"sightPotion",name:"Sight Potion",type:"vision",effect:"permVisibility",icon:"fa-eye",iconColor:"#3498db",description:"+1 permanent visibility",rarity:"rare",stackable:!0,visibilityBonus:1,permanent:!0,aliases:{fantasy:"Sight Potion",horror:"Third Eye Serum",scifi:"Optic Enhancement",action:"Night Vision Goggles",cyberpunk:"Cybereye Upgrade",noir:"Keen Observation",postapoc:"Mutant Vision",comedy:"Reading Glasses",western:"Eagle Eye Tonic"}},crystalBall:{id:"crystalBall",name:"Crystal Ball",type:"vision",effect:"revealMinions",icon:"fa-circle",iconColor:"#8e44ad",description:"Reveals all minion positions on the floor",rarity:"rare",stackable:!0,aliases:{fantasy:"Crystal Ball",horror:"Ouija Board",scifi:"Life Sign Scanner",action:"Motion Tracker",cyberpunk:"Threat Detector",noir:"Informant Tip",postapoc:"Mutant Tracker",comedy:"Magic 8-Ball",western:"Tracking Instinct"}},heartCrystal:{id:"heartCrystal",name:"Heart Crystal",type:"boost",effect:"increaseMaxHP",icon:"fa-heart",iconColor:"#e74c3c",description:"Permanently increases max HP by 10",rarity:"rare",stackable:!0,hpBonus:10,aliases:{fantasy:"Heart Crystal",horror:"Soul Fragment",scifi:"Life Extension Module",action:"Body Armor Upgrade",cyberpunk:"Biomod Enhancement",noir:"Lucky Charm",postapoc:"Endurance Booster",comedy:"Extra Hearts",western:"Iron Constitution"}},repairKit:{id:"repairKit",name:"Repair Kit",type:"repair",effect:"repairEquipment",icon:"fa-wrench",iconColor:"#95a5a6",description:"Restores durability to a weapon or armor",rarity:"uncommon",stackable:!0,repairAmount:3,aliases:{fantasy:"Smithing Kit",horror:"Dark Restoration",scifi:"Nano-Repair Module",action:"Field Repair Kit",cyberpunk:"Chrome Polish",noir:"Maintenance Kit",postapoc:"Scrap Repair",comedy:"Duct Tape & WD-40",western:"Gunsmith Tools"}}};function Xe(e){const a=qt.itemProfiles||{};return a[e]?t(t({},Ve[e]),a[e]):Ve[e]||null}function Qe(){const e=qt.itemProfiles||{},t=new Set([...Object.keys(Ve),...Object.keys(e)]);return Array.from(t)}function Je(){const e=Object.keys(lt),t=Object.keys(qt.customThemes||{});return[...new Set([...e,...t])]}function Ze(){return Object.keys(k)}function $e(){const e=Object.keys(Xo),t=Object.keys(qt.customMapStyles||{});return[...new Set([...e,...t])]}function et(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"fantasy";return Je().map((t=>{const a=t===e?"selected":"";return'<option value="'.concat(t,'" ').concat(a,">").concat(function(e){const t=lt[e];return null!=t&&t.name?t.name:e.charAt(0).toUpperCase()+e.slice(1)}(t),"</option>")})).join("\n")}function tt(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"normal";return Ze().map((t=>{const a=t===e?"selected":"";return'<option value="'.concat(t,'" ').concat(a,">").concat(function(e){const t=k[e];return null!=t&&t.name?t.name:e.charAt(0).toUpperCase()+e.slice(1)}(t),"</option>")})).join("\n")}function at(e){var t,a,n;const o=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||(null===(t=jt)||void 0===t?void 0:t.profile);return null==o||null===(a=o.itemPool)||void 0===a||!a.enabled||(null===(n=o.itemPool.items)||void 0===n||!n.length||o.itemPool.items.includes(e))}function nt(e,t){var a;const n=Xe(e);if(!n)return e;if(n.aliases&&n.aliases[t])return n.aliases[t];const o=C[t];return null!=o&&null!==(a=o.itemAliases)&&void 0!==a&&a[e]?o.itemAliases[e]:n.name||e}function ot(e){jt.itemCharges||(jt.itemCharges={});const t=Xe(e);t&&t.charges&&(jt.itemCharges[e]||(jt.itemCharges[e]=[]),jt.itemCharges[e].push(t.charges))}function it(e){var t;return null!==(t=jt.itemCharges)&&void 0!==t&&null!==(t=t[e])&&void 0!==t&&t.length?jt.itemCharges[e].reduce(((e,t)=>e+t),0):0}function rt(e){var t;if(null===(t=jt.itemCharges)||void 0===t||null===(t=t[e])||void 0===t||!t.length)return 0;jt.itemCharges[e][0]--;const a=jt.itemCharges[e][0];return a<=0&&jt.itemCharges[e].shift(),a}function st(e,t){const a=Xe(e);if(!a||"equipment"!==a.type)return!1;if(!a.autoUse)return!1;if(function(e){var t;return null!==(t=jt.itemCharges)&&void 0!==t&&null!==(t=t[e])&&void 0!==t&&t.length&&jt.itemCharges[e][0]||0}(e)<=0)return!1;const n=a.triggers||[],o=["battlebar","turnbased","qte","dice","stealth","negotiation","puzzle"].includes(t);return"trap"===t&&n.includes("trap")||o&&n.includes("combat")}const lt={fantasy:{name:"Fantasy",description:"Classic fantasy factions for dungeon crawling adventures",factions:[{id:"merchants_guild",name:"Merchants' Guild",description:"Traders and shopkeepers who value fair deals",color:"#f39c12",icon:"fa-coins",initialStanding:0},{id:"thieves_guild",name:"Thieves' Guild",description:"Masters of stealth and subterfuge",color:"#9b59b6",icon:"fa-mask",initialStanding:-10},{id:"royal_guard",name:"Royal Guard",description:"Protectors of the realm and enforcers of law",color:"#3498db",icon:"fa-shield-halved",initialStanding:0},{id:"mages_circle",name:"Mages' Circle",description:"Practitioners of the arcane arts",color:"#8e44ad",icon:"fa-wand-sparkles",initialStanding:0}],tiers:{hostile:{min:-100,max:-50,behavior:"attack",label:"Hostile"},unfriendly:{min:-49,max:-10,behavior:"refuse",label:"Unfriendly"},neutral:{min:-9,max:9,behavior:"wary",label:"Neutral"},friendly:{min:10,max:49,behavior:"help",label:"Friendly"},allied:{min:50,max:100,behavior:"loyal",label:"Allied"}},relationships:{thieves_guild:{royal_guard:-.5},royal_guard:{thieves_guild:-.5},merchants_guild:{thieves_guild:-.3}},spilloverMultiplier:.25,onReputationChange:"",onFactionHostile:"",onFactionFriendly:"",onTierChange:""},scifi:{name:"Sci-Fi",description:"Futuristic faction configuration for sci-fi settings",factions:[{id:"corporation",name:"The Corporation",description:"Megacorp controlling trade and resources",color:"#2ecc71",icon:"fa-building",initialStanding:0},{id:"rebels",name:"Resistance",description:"Freedom fighters opposing corporate control",color:"#e74c3c",icon:"fa-fist-raised",initialStanding:0},{id:"scientists",name:"Science Division",description:"Researchers and technologists",color:"#3498db",icon:"fa-flask",initialStanding:10},{id:"syndicate",name:"Criminal Syndicate",description:"Organized crime operating in the shadows",color:"#34495e",icon:"fa-skull",initialStanding:-20}],tiers:{hostile:{min:-100,max:-50,behavior:"attack",label:"Enemy"},unfriendly:{min:-49,max:-10,behavior:"refuse",label:"Distrusted"},neutral:{min:-9,max:9,behavior:"wary",label:"Unknown"},friendly:{min:10,max:49,behavior:"help",label:"Trusted"},allied:{min:50,max:100,behavior:"loyal",label:"Ally"}},relationships:{corporation:{rebels:-.8},rebels:{corporation:-.8},syndicate:{corporation:-.3}},spilloverMultiplier:.3,onReputationChange:"",onFactionHostile:"",onFactionFriendly:"",onTierChange:""},horror:{name:"Horror",description:"Dark factions for horror and supernatural settings",factions:[{id:"cult_of_shadows",name:"Cult of Shadows",description:"Dark worshippers seeking forbidden power",color:"#2c3e50",icon:"fa-moon",initialStanding:-20},{id:"hunters_order",name:"Hunters' Order",description:"Monster hunters protecting the innocent",color:"#c0392b",icon:"fa-crosshairs",initialStanding:10},{id:"restless_dead",name:"The Restless Dead",description:"Spirits and undead with their own agenda",color:"#7f8c8d",icon:"fa-ghost",initialStanding:-30},{id:"asylum_staff",name:"Asylum Staff",description:"Wardens and doctors of the institution",color:"#1abc9c",icon:"fa-user-doctor",initialStanding:0}],tiers:{hostile:{min:-100,max:-50,behavior:"attack",label:"Hunted"},unfriendly:{min:-49,max:-10,behavior:"refuse",label:"Suspicious"},neutral:{min:-9,max:9,behavior:"wary",label:"Watched"},friendly:{min:10,max:49,behavior:"help",label:"Accepted"},allied:{min:50,max:100,behavior:"loyal",label:"Trusted"}},relationships:{cult_of_shadows:{hunters_order:-1,restless_dead:.3},hunters_order:{cult_of_shadows:-1,restless_dead:-.5},restless_dead:{hunters_order:-.5}},spilloverMultiplier:.3,onReputationChange:"",onFactionHostile:"",onFactionFriendly:"",onTierChange:""},cyberpunk:{name:"Cyberpunk",description:"Neon-lit factions for cyberpunk dystopias",factions:[{id:"megacorp",name:"Arasaka Corp",description:"Megacorporation controlling the city",color:"#e74c3c",icon:"fa-building",initialStanding:0},{id:"street_gang",name:"Maelstrom Gang",description:"Cyberpsycho gang ruling the streets",color:"#9b59b6",icon:"fa-skull-crossbones",initialStanding:-10},{id:"netrunners",name:"Netrunner Collective",description:"Hackers and data thieves",color:"#00ff88",icon:"fa-microchip",initialStanding:0},{id:"nomads",name:"Nomad Clans",description:"Road warriors living outside the city",color:"#f39c12",icon:"fa-car-side",initialStanding:10}],tiers:{hostile:{min:-100,max:-50,behavior:"attack",label:"Kill on Sight"},unfriendly:{min:-49,max:-10,behavior:"refuse",label:"Blacklisted"},neutral:{min:-9,max:9,behavior:"wary",label:"Unknown"},friendly:{min:10,max:49,behavior:"help",label:"Connected"},allied:{min:50,max:100,behavior:"loyal",label:"Family"}},relationships:{megacorp:{street_gang:-.5,netrunners:-.3,nomads:-.2},street_gang:{megacorp:-.5},netrunners:{megacorp:-.3}},spilloverMultiplier:.25,onReputationChange:"",onFactionHostile:"",onFactionFriendly:"",onTierChange:""},western:{name:"Western",description:"Frontier factions for Wild West adventures",factions:[{id:"lawmen",name:"Town Marshal",description:"Law and order in the frontier",color:"#f1c40f",icon:"fa-star",initialStanding:0},{id:"outlaws",name:"Outlaw Gang",description:"Bandits and desperados",color:"#c0392b",icon:"fa-hat-cowboy",initialStanding:-10},{id:"natives",name:"Native Tribes",description:"Indigenous peoples of the land",color:"#27ae60",icon:"fa-feather",initialStanding:0},{id:"railroad",name:"Railroad Company",description:"Industrial barons expanding westward",color:"#34495e",icon:"fa-train",initialStanding:0}],tiers:{hostile:{min:-100,max:-50,behavior:"attack",label:"Wanted"},unfriendly:{min:-49,max:-10,behavior:"refuse",label:"Distrusted"},neutral:{min:-9,max:9,behavior:"wary",label:"Stranger"},friendly:{min:10,max:49,behavior:"help",label:"Partner"},allied:{min:50,max:100,behavior:"loyal",label:"Blood Brother"}},relationships:{lawmen:{outlaws:-.8},outlaws:{lawmen:-.8,railroad:-.3},natives:{railroad:-.5},railroad:{natives:-.5}},spilloverMultiplier:.3,onReputationChange:"",onFactionHostile:"",onFactionFriendly:"",onTierChange:""},action:{name:"Action",description:"Military factions for action and espionage settings",factions:[{id:"allied_command",name:"Allied Command",description:"Your commanding officers and support",color:"#3498db",icon:"fa-flag",initialStanding:25},{id:"insurgents",name:"Insurgent Forces",description:"Enemy combatants and terrorists",color:"#e74c3c",icon:"fa-bomb",initialStanding:-50},{id:"mercs",name:"PMC Operators",description:"Private military contractors for hire",color:"#f39c12",icon:"fa-dollar-sign",initialStanding:0},{id:"civilians",name:"Local Population",description:"Non-combatants caught in the crossfire",color:"#2ecc71",icon:"fa-users",initialStanding:0}],tiers:{hostile:{min:-100,max:-50,behavior:"attack",label:"Enemy"},unfriendly:{min:-49,max:-10,behavior:"refuse",label:"Suspicious"},neutral:{min:-9,max:9,behavior:"wary",label:"Unknown"},friendly:{min:10,max:49,behavior:"help",label:"Cooperative"},allied:{min:50,max:100,behavior:"loyal",label:"Comrade"}},relationships:{allied_command:{insurgents:-1,mercs:-.2},insurgents:{allied_command:-1,civilians:-.3},civilians:{insurgents:-.3,mercs:-.2}},spilloverMultiplier:.25,onReputationChange:"",onFactionHostile:"",onFactionFriendly:"",onTierChange:""},none:{name:"None",description:"No faction system - disabled",factions:[],tiers:{},relationships:{},spilloverMultiplier:0,onReputationChange:"",onFactionHostile:"",onFactionFriendly:"",onTierChange:""}},ct={weapon_rusty_sword:{id:"weapon_rusty_sword",name:"Rusty Sword",slot:"weapon",rarity:"common",attack:2,defense:0,critBonus:0,special:null,icon:"fa-sword",description:"A worn blade, better than nothing.",durability:10,maxDurability:10},weapon_iron_sword:{id:"weapon_iron_sword",name:"Iron Sword",slot:"weapon",rarity:"common",attack:5,defense:0,critBonus:0,special:null,icon:"fa-sword",description:"A reliable blade forged from iron.",durability:15,maxDurability:15},weapon_steel_blade:{id:"weapon_steel_blade",name:"Steel Blade",slot:"weapon",rarity:"uncommon",attack:8,defense:0,critBonus:2,special:null,icon:"fa-sword",description:"Sharp and well-balanced for precise strikes.",durability:20,maxDurability:20},weapon_enchanted_blade:{id:"weapon_enchanted_blade",name:"Enchanted Blade",slot:"weapon",rarity:"rare",attack:12,defense:0,critBonus:5,special:{type:"fire",value:3},icon:"fa-sword",description:"Wreathed in magical flames that sear foes.",durability:25,maxDurability:25},weapon_shadow_dagger:{id:"weapon_shadow_dagger",name:"Shadow Dagger",slot:"weapon",rarity:"rare",attack:7,defense:0,critBonus:10,special:{type:"backstab",value:25},icon:"fa-khanda",description:"A dark blade that strikes from the shadows.",durability:18,maxDurability:18},armor_leather:{id:"armor_leather",name:"Leather Armor",slot:"armor",rarity:"common",attack:0,defense:3,critBonus:0,special:null,icon:"fa-vest",description:"Basic protection that allows freedom of movement.",durability:12,maxDurability:12},armor_chainmail:{id:"armor_chainmail",name:"Chainmail",slot:"armor",rarity:"uncommon",attack:0,defense:6,critBonus:0,special:null,icon:"fa-shield",description:"Interlocking steel rings provide solid defense.",durability:18,maxDurability:18},armor_plate:{id:"armor_plate",name:"Plate Armor",slot:"armor",rarity:"rare",attack:0,defense:10,critBonus:0,special:null,icon:"fa-shield-halved",description:"Heavy but extremely protective steel plates.",durability:25,maxDurability:25},accessory_ring_power:{id:"accessory_ring_power",name:"Ring of Power",slot:"accessory",rarity:"uncommon",attack:3,defense:0,critBonus:0,special:null,icon:"fa-ring",description:"Channels raw energy into your strikes.",durability:20,maxDurability:20},accessory_amulet_protection:{id:"accessory_amulet_protection",name:"Amulet of Protection",slot:"accessory",rarity:"uncommon",attack:0,defense:3,critBonus:0,special:null,icon:"fa-gem",description:"Wards off incoming harm with ancient magic.",durability:20,maxDurability:20},accessory_lucky_charm:{id:"accessory_lucky_charm",name:"Lucky Charm",slot:"accessory",rarity:"rare",attack:2,defense:2,critBonus:5,special:null,icon:"fa-clover",description:"Fortune favors those who carry this talisman.",durability:25,maxDurability:25},accessory_vampiric_pendant:{id:"accessory_vampiric_pendant",name:"Vampiric Pendant",slot:"accessory",rarity:"epic",attack:0,defense:0,critBonus:0,special:{type:"lifesteal",value:10},icon:"fa-droplet",description:"Drains life from enemies to heal the wearer.",durability:30,maxDurability:30},ironGuard:{id:"ironGuard",name:"Iron Guard",slot:"armor",rarity:"uncommon",attack:0,defense:5,critBonus:0,special:{type:"absorb",value:3,charges:3},icon:"fa-shield-halved",description:"Absorbs 3 hits from combat or traps before breaking.",durability:3,maxDurability:3}},mt={common:60,uncommon:30,rare:8,epic:2};function dt(e){return Object.values(ct).filter((t=>t.rarity===e))}const ut={combat:{name:"Combat",color:"#e74c3c",icon:"fa-sword",description:"Master the art of physical warfare"},magic:{name:"Magic",color:"#3498db",icon:"fa-wand-sparkles",description:"Harness arcane energies"},stealth:{name:"Stealth",color:"#9b59b6",icon:"fa-user-ninja",description:"Strike from the shadows"}},pt={combat_power_strike:{id:"combat_power_strike",name:"Power Strike",tree:"combat",tier:1,type:"active",description:"A devastating blow dealing increased damage",cooldown:3,ranks:[{damageMultiplier:1.5,description:"150% damage"},{damageMultiplier:1.75,description:"175% damage"},{damageMultiplier:2,description:"200% damage"}],prerequisites:[]},combat_critical_eye:{id:"combat_critical_eye",name:"Critical Eye",tree:"combat",tier:1,type:"passive",description:"Increased critical hit chance",cooldown:0,ranks:[{critBonus:5,description:"+5% crit chance"},{critBonus:10,description:"+10% crit chance"},{critBonus:15,description:"+15% crit chance"}],prerequisites:[]},combat_lifesteal:{id:"combat_lifesteal",name:"Lifesteal",tree:"combat",tier:2,type:"passive",description:"Heal for a portion of damage dealt",cooldown:0,ranks:[{lifestealPercent:5,description:"Heal 5% of damage"},{lifestealPercent:8,description:"Heal 8% of damage"},{lifestealPercent:10,description:"Heal 10% of damage"}],prerequisites:["combat_power_strike"]},combat_berserker:{id:"combat_berserker",name:"Berserker Rage",tree:"combat",tier:3,type:"active",description:"Enter a fury, greatly increasing damage",cooldown:5,duration:3,ranks:[{damageBonus:30,description:"+30% damage for 3 turns"},{damageBonus:40,description:"+40% damage for 3 turns"},{damageBonus:50,description:"+50% damage for 3 turns"}],prerequisites:["combat_lifesteal"]},combat_execute:{id:"combat_execute",name:"Execute",tree:"combat",tier:4,type:"active",description:"Instantly kill low HP enemies",cooldown:8,ranks:[{executeThreshold:15,description:"Kill enemies below 15% HP"},{executeThreshold:20,description:"Kill enemies below 20% HP"},{executeThreshold:25,description:"Kill enemies below 25% HP"}],prerequisites:["combat_berserker"]},magic_fireball:{id:"magic_fireball",name:"Fireball",tree:"magic",tier:1,type:"active",description:"Hurl a ball of fire at the enemy",cooldown:2,ranks:[{damage:20,burnChance:20,description:"20 fire damage, 20% burn"},{damage:30,burnChance:30,description:"30 fire damage, 30% burn"},{damage:40,burnChance:40,description:"40 fire damage, 40% burn"}],prerequisites:[]},magic_ice_shield:{id:"magic_ice_shield",name:"Ice Shield",tree:"magic",tier:1,type:"active",description:"Create a shield of ice that blocks damage",cooldown:4,duration:2,ranks:[{damageReduction:30,freezeChance:15,description:"-30% damage taken, 15% freeze"},{damageReduction:40,freezeChance:20,description:"-40% damage taken, 20% freeze"},{damageReduction:50,freezeChance:25,description:"-50% damage taken, 25% freeze"}],prerequisites:[]},magic_teleport:{id:"magic_teleport",name:"Teleport",tree:"magic",tier:2,type:"active",description:"Teleport to any revealed tile on the map",cooldown:10,usableOutsideCombat:!0,ranks:[{range:5,description:"Teleport up to 5 tiles"},{range:8,description:"Teleport up to 8 tiles"},{range:-1,description:"Teleport anywhere revealed"}],prerequisites:["magic_fireball","magic_ice_shield"]},magic_mana_surge:{id:"magic_mana_surge",name:"Mana Surge",tree:"magic",tier:3,type:"passive",description:"Reduce cooldowns on all abilities",cooldown:0,ranks:[{cooldownReduction:1,description:"-1 turn on all cooldowns"},{cooldownReduction:1,tickOnTurnEnd:!0,description:"-1 cooldown + tick on turn end"},{cooldownReduction:2,description:"-2 turns on all cooldowns"}],prerequisites:["magic_teleport"]},magic_arcane_blast:{id:"magic_arcane_blast",name:"Arcane Blast",tree:"magic",tier:4,type:"active",description:"Unleash devastating arcane energy",cooldown:6,ranks:[{damage:50,ignoreDefense:25,description:"50 damage, ignores 25% defense"},{damage:65,ignoreDefense:40,description:"65 damage, ignores 40% defense"},{damage:80,ignoreDefense:50,description:"80 damage, ignores 50% defense"}],prerequisites:["magic_mana_surge"]},stealth_shadowstep:{id:"stealth_shadowstep",name:"Shadowstep",tree:"stealth",tier:1,type:"active",description:"Phase through a single wall",cooldown:3,usableOutsideCombat:!0,ranks:[{wallsPassable:1,description:"Pass through 1 wall"},{wallsPassable:1,noDetection:!0,description:"Pass through 1 wall undetected"},{wallsPassable:2,noDetection:!0,description:"Pass through 2 walls undetected"}],prerequisites:[]},stealth_backstab:{id:"stealth_backstab",name:"Backstab",tree:"stealth",tier:1,type:"passive",description:"Deal bonus damage on first strike",cooldown:0,ranks:[{firstStrikeBonus:25,description:"+25% first strike damage"},{firstStrikeBonus:50,description:"+50% first strike damage"},{firstStrikeBonus:75,description:"+75% first strike damage"}],prerequisites:[]},stealth_smoke_bomb:{id:"stealth_smoke_bomb",name:"Smoke Bomb",tree:"stealth",tier:2,type:"active",description:"Escape from combat instantly",cooldown:5,ranks:[{escapeChance:100,description:"Guaranteed escape"},{escapeChance:100,confuseTurns:1,description:"Escape + confuse enemy 1 turn"},{escapeChance:100,confuseTurns:2,description:"Escape + confuse enemy 2 turns"}],prerequisites:["stealth_backstab"]},stealth_assassinate:{id:"stealth_assassinate",name:"Assassinate",tree:"stealth",tier:3,type:"active",description:"Chance to instantly kill on first strike",cooldown:0,ranks:[{instantKillChance:15,description:"15% instant kill on first strike"},{instantKillChance:25,description:"25% instant kill on first strike"},{instantKillChance:35,description:"35% instant kill on first strike"}],prerequisites:["stealth_smoke_bomb"]},stealth_vanish:{id:"stealth_vanish",name:"Vanish",tree:"stealth",tier:4,type:"active",description:"Become invisible, guaranteeing critical hits",cooldown:8,usableOutsideCombat:!0,ranks:[{invisibleMoves:3,guaranteedCrit:!0,description:"Invisible 3 moves, guaranteed crits"},{invisibleMoves:4,guaranteedCrit:!0,avoidEncounters:!0,description:"Invisible 4 moves, avoid encounters"},{invisibleMoves:5,guaranteedCrit:!0,avoidEncounters:!0,description:"Invisible 5 moves, full stealth"}],prerequisites:["stealth_assassinate"]}};function ht(e){return pt[e]||null}function gt(e){return Object.values(pt).filter((t=>t.tree===e))}function ft(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=ht(e);return!n||a<1||a>n.ranks.length?null:t(t({},n.ranks[a-1]),{},{skillId:e,rank:a})}const yt={burning:{id:"burning",name:"Burning",type:"dot",duration:3,dotPercent:5,icon:"fa-fire",color:"#e74c3c",description:"Taking fire damage each turn",applyMessage:"is burning!",tickMessage:"takes burn damage",expireMessage:"is no longer burning"},poisoned:{id:"poisoned",name:"Poisoned",type:"dot",duration:4,dotPercent:3,icon:"fa-skull-crossbones",color:"#27ae60",description:"Taking poison damage each turn",applyMessage:"is poisoned!",tickMessage:"takes poison damage",expireMessage:"is no longer poisoned"},frozen:{id:"frozen",name:"Frozen",type:"cc",duration:1,skipTurn:!0,icon:"fa-snowflake",color:"#3498db",description:"Cannot act this turn",applyMessage:"is frozen solid!",tickMessage:"is frozen and cannot act",expireMessage:"thaws out"},stunned:{id:"stunned",name:"Stunned",type:"cc",duration:1,skipTurn:!0,icon:"fa-star",color:"#f1c40f",description:"Cannot act this turn",applyMessage:"is stunned!",tickMessage:"is stunned and cannot act",expireMessage:"recovers from stun"},bleeding:{id:"bleeding",name:"Bleeding",type:"dot",duration:3,dotPercent:4,icon:"fa-droplet",color:"#c0392b",description:"Losing blood each turn",applyMessage:"is bleeding!",tickMessage:"bleeds",expireMessage:"stops bleeding"},weakened:{id:"weakened",name:"Weakened",type:"debuff",duration:2,damageReduction:25,icon:"fa-down-long",color:"#7f8c8d",description:"Dealing reduced damage",applyMessage:"is weakened!",tickMessage:"",expireMessage:"is no longer weakened"},enraged:{id:"enraged",name:"Enraged",type:"buff",duration:2,damageBonus:25,icon:"fa-up-long",color:"#e74c3c",description:"Dealing increased damage",applyMessage:"is enraged!",tickMessage:"",expireMessage:"calms down"},shielded:{id:"shielded",name:"Shielded",type:"buff",duration:2,damageReduction:30,icon:"fa-shield-halved",color:"#3498db",description:"Taking reduced damage",applyMessage:"is shielded!",tickMessage:"",expireMessage:"shield fades"}};function vt(e){return yt[e]||null}const bt={warrior:{id:"warrior",name:"Warrior",baseAttack:12,baseDefense:8,abilities:[{id:"heavy_strike",name:"Heavy Strike",weight:40,damageMultiplier:1.5,description:"A powerful blow",message:"swings a heavy strike!"},{id:"shield_bash",name:"Shield Bash",weight:25,damageMultiplier:.8,statusEffect:"stunned",statusChance:50,description:"Bash that may stun",message:"bashes with their shield!"},{id:"battle_cry",name:"Battle Cry",weight:15,selfBuff:"enraged",damageMultiplier:.5,description:"Buff that increases damage",message:"lets out a battle cry!"},{id:"basic_attack",name:"Attack",weight:20,damageMultiplier:1,description:"Basic attack",message:"attacks!"}]},mage:{id:"mage",name:"Mage",baseAttack:15,baseDefense:4,abilities:[{id:"fireball",name:"Fireball",weight:35,damageMultiplier:1.2,statusEffect:"burning",statusChance:40,description:"Fire magic that may burn",message:"casts Fireball!"},{id:"ice_shard",name:"Ice Shard",weight:30,damageMultiplier:1,statusEffect:"frozen",statusChance:30,description:"Ice magic that may freeze",message:"hurls an Ice Shard!"},{id:"arcane_bolt",name:"Arcane Bolt",weight:25,damageMultiplier:1.3,description:"Pure arcane damage",message:"fires an Arcane Bolt!"},{id:"magic_shield",name:"Magic Shield",weight:10,selfBuff:"shielded",damageMultiplier:0,description:"Defensive buff",message:"conjures a Magic Shield!"}]},assassin:{id:"assassin",name:"Assassin",baseAttack:14,baseDefense:5,abilities:[{id:"poison_blade",name:"Poison Blade",weight:35,damageMultiplier:1,statusEffect:"poisoned",statusChance:60,description:"Attack that may poison",message:"strikes with a poisoned blade!"},{id:"vanish_strike",name:"Vanish Strike",weight:25,damageMultiplier:2,description:"High damage from shadows",message:"strikes from the shadows!"},{id:"crippling_blow",name:"Crippling Blow",weight:20,damageMultiplier:.9,statusEffect:"weakened",statusChance:50,description:"Attack that may weaken",message:"delivers a crippling blow!"},{id:"quick_slash",name:"Quick Slash",weight:20,damageMultiplier:1.1,description:"Fast attack",message:"slashes quickly!"}]},beast:{id:"beast",name:"Beast",baseAttack:13,baseDefense:6,abilities:[{id:"savage_bite",name:"Savage Bite",weight:35,damageMultiplier:1.3,statusEffect:"bleeding",statusChance:40,description:"Bite that may cause bleeding",message:"bites savagely!"},{id:"pounce",name:"Pounce",weight:25,damageMultiplier:1.5,description:"Leaping attack",message:"pounces!"},{id:"feral_rage",name:"Feral Rage",weight:15,selfBuff:"enraged",damageMultiplier:.5,description:"Becomes enraged",message:"enters a feral rage!"},{id:"claw_swipe",name:"Claw Swipe",weight:25,damageMultiplier:1,description:"Basic claw attack",message:"swipes with claws!"}]},undead:{id:"undead",name:"Undead",baseAttack:11,baseDefense:7,abilities:[{id:"life_drain",name:"Life Drain",weight:30,damageMultiplier:1,lifesteal:50,description:"Drains life force",message:"drains your life force!"},{id:"cursed_touch",name:"Cursed Touch",weight:25,damageMultiplier:.8,statusEffect:"weakened",statusChance:60,description:"Touch that weakens",message:"touches with cursed hands!"},{id:"bone_shards",name:"Bone Shards",weight:25,damageMultiplier:1.2,description:"Projectile bone attack",message:"hurls bone shards!"},{id:"unholy_strength",name:"Unholy Strength",weight:20,selfBuff:"enraged",damageMultiplier:.3,description:"Dark power buff",message:"draws upon unholy strength!"}]}};const zt={fetch:{id:"fetch",name:"Fetch Item",description:"Collect a specific item or number of items",trackingField:"itemsCollected",icon:"fa-box"},defeat:{id:"defeat",name:"Defeat Enemies",description:"Defeat a number of enemies in combat",trackingField:"enemiesDefeated",icon:"fa-skull"},explore:{id:"explore",name:"Explore Area",description:"Explore a percentage of the maze",trackingField:"explorationPercent",icon:"fa-map"},secret:{id:"secret",name:"Find Secret",description:"Discover hidden rooms or passages",trackingField:"secretsFound",icon:"fa-eye"},survive:{id:"survive",name:"Survive Turns",description:"Survive a number of combat turns",trackingField:"turnsSurvived",icon:"fa-heart"},custom:{id:"custom",name:"Custom",description:"Custom objective tracked via STScript",trackingField:"customProgress",icon:"fa-scroll"}},_t={quest_collect_keys:{id:"quest_collect_keys",name:"Key Collector",type:"fetch",description:"Collect keys scattered throughout the maze.",objective:{target:"key",count:3},rewards:{xp:50,items:[]},useLLM:!1},quest_defeat_5:{id:"quest_defeat_5",name:"Pest Control",type:"defeat",description:"Clear out the creatures infesting this maze.",objective:{target:"any",count:5},rewards:{xp:75,items:[]},useLLM:!1},quest_explore_75:{id:"quest_explore_75",name:"Cartographer",type:"explore",description:"Map out most of the maze.",objective:{target:null,count:75},rewards:{xp:100,items:[]},useLLM:!1},quest_find_secret:{id:"quest_find_secret",name:"Hidden Depths",type:"secret",description:"Discover a hidden room in the maze.",objective:{target:"hidden_room",count:1},rewards:{xp:60,items:[]},useLLM:!1},quest_survive_combat:{id:"quest_survive_combat",name:"Battle Hardened",type:"survive",description:"Survive 20 turns of combat.",objective:{target:"turn",count:20},rewards:{xp:80,items:[]},useLLM:!1},quest_treasure_hunter:{id:"quest_treasure_hunter",name:"Treasure Hunter",type:"fetch",description:"Find valuable treasure in chests.",objective:{target:"chest",count:3},rewards:{xp:60,items:[]},useLLM:!1},quest_boss_slayer:{id:"quest_boss_slayer",name:"Boss Slayer",type:"defeat",description:"Defeat the powerful guardian of the maze.",objective:{target:"boss",count:1},rewards:{xp:150,items:["equipment_enchanted_blade"]},useLLM:!1},quest_full_clear:{id:"quest_full_clear",name:"Completionist",type:"explore",description:"Leave no stone unturned.",objective:{target:null,count:100},rewards:{xp:200,items:[]},useLLM:!1}};function xt(e){return zt[e]||zt.custom}function kt(e){var t;return(null===(t=(SillyTavern.getContext().extensionSettings.mazemaster||{}).quests)||void 0===t?void 0:t[e])||_t[e]||null}function Ct(){const e=(SillyTavern.getContext().extensionSettings.mazemaster||{}).quests||{};return t(t({},_t),e)}async function wt(e,t){var a;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(null!==(a=jt.quests)&&void 0!==a&&a.active)for(const a of jt.quests.active){var o,i;const r=kt(a.questId);if(!r||r.type!==e)continue;const s=null===(o=r.objective)||void 0===o?void 0:o.target;if(s&&"any"!==s&&s!==t)continue;"explore"===e?a.progress=Math.max(a.progress,n):a.progress+=n;const l=(null===(i=r.objective)||void 0===i?void 0:i.count)||1;a.progress>=l&&await Et(a.questId)}}async function Et(e){var a,n;if(!jt.quests)return;const o=jt.quests.active.findIndex((t=>t.questId===e));if(-1===o)return;const i=kt(e);if(i){if(jt.quests.active.splice(o,1),jt.quests.completed.includes(e)||jt.quests.completed.push(e),null!==(a=i.rewards)&&void 0!==a&&a.xp&&Xi(i.rewards.xp,"Quest: ".concat(i.name)),null!==(n=i.rewards)&&void 0!==n&&n.items)for(const e of i.rewards.items){const a=Oi(e);a&&(Ni(t(t({},a),{},{quantity:1})),toastr.info("Received: ".concat(a.name)))}toastr.success("Quest Complete: ".concat(i.name,"!")),await Y("onQuestComplete",{questId:e,questName:i.name,rewards:i.rewards}),ir(),await async function(e){var t;if(null===(t=jt.questProfileMeta)||void 0===t||!t.questGatingEnabled)return;const a=St();if(!a)return;const n=a.quests.find((t=>t.questId===e));if(!n)return;"zone"===n.progressionType&&null!==n.progressionTarget?function(){var e;if(!jt.zones||null===(e=jt.questProfileMeta)||void 0===e||!e.questGatingEnabled)return;for(let e=0;e<jt.zones.length;e++){const t=jt.zones[e];!t.isUnlocked&&Tt("zone",e)&&(t.isUnlocked=!0,toastr.info("Zone ".concat(e+1," unlocked!")))}}():"floor"===n.progressionType&&null!==n.progressionTarget&&toastr.info("Floor ".concat(n.progressionTarget+1," access granted!"));await Y("onQuestProgression",{questId:e,progressionType:n.progressionType,progressionTarget:n.progressionTarget})}(e)}}function St(){var e,t,a;return null!==(e=jt.profile)&&void 0!==e&&e.questProfile&&"none"!==jt.profile.questProfile?(t=jt.profile.questProfile)&&"none"!==t?null!==(a=qt.questProfiles)&&void 0!==a&&a[t]?qt.questProfiles[t]:Ke[t]?Ke[t]:null:null:null}function Tt(e,t){var a,n;const o=St();if(!o||null===(a=jt.questProfileMeta)||void 0===a||!a.questGatingEnabled)return!0;const i=(null===(n=jt.quests)||void 0===n?void 0:n.completed)||[],r=jt.questProfileMeta.gatingMode,s=o.quests.filter((a=>a.progressionType===e&&a.progressionTarget===t));return 0===s.length||("any"===r?s.some((e=>i.includes(e.questId))):"sequential"!==r||s.every((e=>i.includes(e.questId))))}function It(e){if(!e)return"";if(e.startsWith("http://")||e.startsWith("https://"))return e;const t=e.match(/\/scripts\/extensions\/third-party\/[^/]+\/(.+)/);if(t){const e=t[1];return"/scripts/extensions/third-party/".concat(o,"/").concat(e)}return e.startsWith("/")?e:"/scripts/extensions/third-party/".concat(o,"/").concat(e)}const Mt={fantasy_herald:{name:"The Herald",imagePath:"",type:"messenger",description:"A cloaked messenger who appears from the shadows with cryptic warnings about the dungeon ahead.",messages:["Greetings, adventurer...","The maze master watches your every step...","Beware the darkness that lies ahead!","Many have entered. Few have returned."],encounterScript:""},fantasy_guardian:{name:"Dungeon Guardian",imagePath:"",type:"battlebar",description:"A stalwart armored warrior sworn to protect this passage from intruders.",battlebarProfiles:["Fantasy - Normal","Fantasy - Hard"],messages:["None shall pass!","Prepare yourself, intruder!","Only the worthy may continue!"],encounterScript:""},fantasy_oracle:{name:"The Oracle",imagePath:"",type:"prizewheel",description:"An ancient mystic with glowing eyes who offers to reveal your fate through a magical spinning wheel.",wheelProfiles:["Fantasy - Normal","Fantasy - Hard"],messages:["Spin the wheel of fate!","Let destiny reveal itself!","Fortune favors the bold..."],encounterScript:""},fantasy_merchant:{name:"Wandering Merchant",imagePath:"",type:"merchant",description:"A shrewd trader draped in exotic fabrics who deals in magical wares.",merchantItemCount:{min:2,max:4},merchantItemPool:"Adventurer Supplies",messages:["Rare goods for a rare adventurer!","A fair trade benefits us both.","Perhaps something catches your eye?"],encounterScript:""},horror_spirit:{name:"Whispering Spirit",imagePath:"",type:"messenger",description:"A translucent specter that whispers unsettling warnings from beyond the grave.",messages:["You should not be here...","They are watching... always watching...","Turn back while you still can...","Join usssss..."],encounterScript:""},horror_revenant:{name:"The Revenant",imagePath:"",type:"battlebar",description:"An undying horror that claws its way from the shadows to claim another victim.",battlebarProfiles:["Horror - Normal","Horror - Hard"],messages:["Your soul... will be mine...","Death is only the beginning!","YOU CANNOT ESCAPE!"],encounterScript:""},horror_gambler:{name:"Cursed Gambler",imagePath:"",type:"prizewheel",description:"A ghastly figure bound to an eternal game of chance. Win at your peril.",wheelProfiles:["Horror - Normal","Horror - Hard"],messages:["Care to play a little game?","The stakes are... everything.","Fortune rarely favors the living here..."],encounterScript:""},horror_graverobber:{name:"Graverobber",imagePath:"",type:"merchant",description:'A hunched figure who deals in items "liberated" from the dead. Don\'t ask where they came from.',merchantItemCount:{min:2,max:4},merchantItemPool:"Dark Market",messages:["Fresh stock... freshly acquired...","The dead have no need for such things.","A trade? The living always want something..."],encounterScript:""},scifi_ai:{name:"AI Assistant",imagePath:"",type:"messenger",description:"A holographic interface that provides technical readouts and mission updates.",messages:["ALERT: Hostile activity detected in adjacent sectors.","Scanning complete. Multiple life forms ahead.","Recommended route calculated. Proceed with caution.","Mission parameters updated."],encounterScript:""},scifi_bot:{name:"Security Bot",imagePath:"",type:"battlebar",description:"An automated defense unit programmed to eliminate all unauthorized personnel.",battlebarProfiles:["Sci-Fi - Normal","Sci-Fi - Hard"],messages:["HALT. IDENTIFICATION REQUIRED.","INTRUDER DETECTED. ENGAGING COMBAT PROTOCOLS.","RESISTANCE IS INEFFICIENT."],encounterScript:""},scifi_matrix:{name:"Probability Matrix",imagePath:"",type:"prizewheel",description:"A quantum randomization terminal that dispenses rewards based on probability algorithms.",wheelProfiles:["Sci-Fi - Normal","Sci-Fi - Hard"],messages:["INITIATING PROBABILITY CASCADE...","QUANTUM OUTCOME GENERATOR READY.","CALCULATING OPTIMAL REWARD DISTRIBUTION..."],encounterScript:""},scifi_terminal:{name:"Supply Terminal",imagePath:"",type:"merchant",description:"An automated supply kiosk that exchanges resources for equipment.",merchantItemCount:{min:2,max:4},merchantItemPool:"Rare Artifacts",messages:["SUPPLY EXCHANGE TERMINAL ONLINE.","TRADE PROTOCOLS ACTIVATED.","RESOURCES DETECTED. INITIATING EXCHANGE."],encounterScript:""},cyber_fixer:{name:"Street Fixer",imagePath:"",type:"messenger",description:"A well-connected operative with chrome implants who deals in underground intel.",messages:["Word on the street is things are about to get hot.","Got a tip for you, choom. For free this time.","Corp goons are crawling all over this sector.","Watch your back. Trust no one."],encounterScript:""},cyber_enforcer:{name:"Corp Enforcer",imagePath:"",type:"battlebar",description:"A heavily augmented corporate security agent with combat-grade cyberware.",battlebarProfiles:["Cyberpunk - Normal","Cyberpunk - Hard"],messages:["You're in restricted space, meat.","Corporate property. No trespassing.","This won't take long."],encounterScript:""},cyber_casino:{name:"Underground Casino",imagePath:"",type:"prizewheel",description:"An illegal gambling den hidden in the neon underbelly of the city.",wheelProfiles:["Cyberpunk - Normal","Cyberpunk - Hard"],messages:["Step right up, choom. Feeling lucky?","The house always wins... usually.","High stakes, high rewards. You in?"],encounterScript:""},cyber_market:{name:"Black Market",imagePath:"",type:"merchant",description:"A shady dealer offering hot merchandise with no questions asked.",merchantItemCount:{min:2,max:4},merchantItemPool:"Black Market Tech",messages:["Fell off a truck. Very recently.","You didn't get this from me.","Best prices in Night City. Untraceable."],encounterScript:""},western_crier:{name:"Town Crier",imagePath:"",type:"messenger",description:"A weathered old-timer who shares news and gossip from around these parts.",messages:["Howdy, stranger! Word is there's trouble ahead.","Outlaws been seen in these parts lately.","Watch your back out there, partner.","This here's dangerous territory."],encounterScript:""},western_outlaw:{name:"Outlaw",imagePath:"",type:"battlebar",description:"A notorious desperado with a quick draw and a mean streak.",battlebarProfiles:["Western - Normal","Western - Hard"],messages:["This town ain't big enough for the both of us.","Draw, stranger!","Your money or your life!"],encounterScript:""},western_gambler:{name:"Saloon Gambler",imagePath:"",type:"prizewheel",description:"A slick card shark who runs games of chance in the back room.",wheelProfiles:["Western - Normal","Western - Hard"],messages:["Care to try your luck, partner?","The wheel never lies.","Fortune favors the bold... sometimes."],encounterScript:""},western_trader:{name:"Traveling Trader",imagePath:"",type:"merchant",description:"A dusty merchant with a wagon full of frontier supplies.",merchantItemCount:{min:2,max:4},merchantItemPool:"Frontier Trading Post",messages:["Got supplies fresh from back East!","Fair prices for fair folks.","Need anything for the trail ahead?"],encounterScript:""},action_intel:{name:"Intel Officer",imagePath:"",type:"messenger",description:"A tactical advisor providing real-time mission intelligence via secure comms.",messages:["Intel update: multiple hostiles in your AO.","HQ reports enemy movement ahead.","Objective markers updated. Stay frosty.","Watch your sectors, operator."],encounterScript:""},action_combatant:{name:"Enemy Combatant",imagePath:"",type:"battlebar",description:"A heavily armed hostile operative blocking your route to the objective.",battlebarProfiles:["Action - Normal","Action - Hard"],messages:["Contact! Engaging!","You're not getting past me!","Target acquired!"],encounterScript:""},action_supply:{name:"Supply Drop",imagePath:"",type:"prizewheel",description:"An airdropped supply crate with randomized military-grade equipment.",wheelProfiles:["Action - Normal","Action - Hard"],messages:["Supply drop inbound. Contents unknown.","Field requisition package received.","Let's see what command sent us..."],encounterScript:""},action_dealer:{name:"Arms Dealer",imagePath:"",type:"merchant",description:"A private military contractor offering tactical equipment trades.",merchantItemCount:{min:2,max:4},merchantItemPool:"Rare Artifacts",messages:["Need to gear up, soldier?","Top-shelf hardware. Fair exchange.","Got what you need to complete the mission."],encounterScript:""},fantasy_knight:{name:"Dark Knight",imagePath:"",type:"turnbased",description:"A corrupted paladin wielding a cursed blade, challenging all who pass.",turnbasedProfiles:["Fantasy - Normal","Fantasy - Hard"],messages:["My blade hungers for battle!","You shall fall like all the others!","Honor demands we fight!"],encounterScript:""},fantasy_mage:{name:"Arcane Duelist",imagePath:"",type:"turnbased",description:"A battle mage who tests worthy opponents with magical combat.",turnbasedProfiles:["Fantasy - Hard","Fantasy - Normal"],messages:["Your skills shall be tested!","Face the power of the arcane!","Magic and steel shall decide this!"],encounterScript:""},horror_wraith:{name:"Vengeful Wraith",imagePath:"",type:"turnbased",description:"A tortured spirit seeking to drag the living into eternal darkness.",turnbasedProfiles:["Horror - Normal","Horror - Hard"],messages:["JOIN USSS IN DEATH...","Your soul will never escape!","The grave awaits you!"],encounterScript:""},horror_butcher:{name:"The Butcher",imagePath:"",type:"turnbased",description:"A massive, blood-soaked figure wielding a cleaver, blocking the only exit.",turnbasedProfiles:["Horror - Nightmare","Horror - Hard"],messages:["Fresh meat...","No one leaves alive!","I'll add you to my collection!"],encounterScript:""},scifi_commander:{name:"Rogue Commander",imagePath:"",type:"turnbased",description:"A cybernetically enhanced military officer who went AWOL.",turnbasedProfiles:["Sci-Fi - Normal","Sci-Fi - Hard"],messages:["TACTICAL ENGAGEMENT INITIATED.","You are outmatched, organic.","Combat protocols: Maximum force."],encounterScript:""},scifi_mech:{name:"Combat Mech",imagePath:"",type:"turnbased",description:"A bipedal war machine with heavy armor and integrated weapons.",turnbasedProfiles:["Sci-Fi - Nightmare","Sci-Fi - Hard"],messages:["TARGET LOCKED.","WEAPONS SYSTEMS ONLINE.","RESISTANCE IS FUTILE."],encounterScript:""},cyber_samurai:{name:"Street Samurai",imagePath:"",type:"turnbased",description:"A chrome-plated warrior following an ancient code of combat.",turnbasedProfiles:["Cyberpunk - Normal","Cyberpunk - Hard"],messages:["My blade cuts faster than your reflexes.","This is your only warning, choom.","Honor demands satisfaction."],encounterScript:""},cyber_boss:{name:"Corp Executive",imagePath:"",type:"turnbased",description:"A heavily augmented corporate overlord with military-grade implants.",turnbasedProfiles:["Cyberpunk - Nightmare","Cyberpunk - Hard"],messages:["You think you can hurt me?","I own this entire district.","Time to flatline, street trash."],encounterScript:""},western_sheriff:{name:"Corrupt Sheriff",imagePath:"",type:"turnbased",description:"A lawman gone bad, enforcing his own twisted version of justice.",turnbasedProfiles:["Western - Normal","Western - Hard"],messages:["The law says you die today.","I AM the law in these parts!","Draw, outlaw!"],encounterScript:""},western_bandit:{name:"Bandit Leader",imagePath:"",type:"turnbased",description:"The notorious head of a ruthless gang of desperados.",turnbasedProfiles:["Western - Nightmare","Western - Hard"],messages:["My gang will avenge me!","You'll never take me alive!","This territory belongs to me!"],encounterScript:""},action_soldier:{name:"Elite Soldier",imagePath:"",type:"turnbased",description:"A highly trained special forces operator guarding a critical position.",turnbasedProfiles:["Action - Normal","Action - Hard"],messages:["Engage! Engage!","You picked the wrong fight!","This position will not fall!"],encounterScript:""},action_warlord:{name:"Warlord",imagePath:"",type:"turnbased",description:"A legendary mercenary commander with countless victories.",turnbasedProfiles:["Action - Nightmare","Action - Hard"],messages:["I've killed a hundred like you.","No retreat, no surrender!","Your death will be glorious!"],encounterScript:""},fantasy_assassin:{name:"Shadow Assassin",imagePath:"",type:"qte",description:"A deadly assassin who strikes from the shadows with lightning speed.",qteProfiles:["Fantasy - Normal","Fantasy - Hard"],messages:["Can you match my speed?","Reflexes determine survival!","Too slow means death!"],encounterScript:""},horror_crawler:{name:"Ceiling Crawler",imagePath:"",type:"qte",description:"A twisted creature that drops from above, attacking with terrifying speed.",qteProfiles:["Horror - Normal","Horror - Hard"],messages:["*skittering sounds*","AHHHHHH!","*inhuman screech*"],encounterScript:""},scifi_drone:{name:"Attack Drone",imagePath:"",type:"qte",description:"An agile combat drone that requires quick reflexes to evade.",qteProfiles:["Sci-Fi - Normal","Sci-Fi - Hard"],messages:["EVASION PROTOCOL ACTIVE.","TRACKING TARGET.","ATTACK RUN INITIATED."],encounterScript:""},cyber_netrunner:{name:"Hostile Netrunner",imagePath:"",type:"qte",description:"A hacker attempting to fry your neural implants remotely.",qteProfiles:["Cyberpunk - Hard","Cyberpunk - Nightmare"],messages:["Jacking into your system...","Let's see how fast you really are.","Your ICE is pathetic."],encounterScript:""},western_quickdraw:{name:"Quick Draw Duelist",imagePath:"",type:"qte",description:"A legendary gunslinger known for the fastest draw in the West.",qteProfiles:["Western - Normal","Western - Hard"],messages:["On the count of three...","Fastest hand wins.","Hope you made your peace."],encounterScript:""},action_sniper:{name:"Enemy Sniper",imagePath:"",type:"qte",description:"A hidden marksman forcing you to react quickly to laser sights.",qteProfiles:["Action - Normal","Action - Hard"],messages:["*laser sight on your chest*","SNIPER! GET DOWN!","Contact! Overwatch position!"],encounterScript:""},fantasy_sphinx:{name:"The Sphinx",imagePath:"",type:"dice",description:"An ancient creature that tests travelers with games of chance and skill.",diceProfiles:["Fantasy - Normal","Fantasy - Hard"],messages:["Answer my challenge or perish!","Fate shall decide your worth.","Roll the bones of destiny!"],encounterScript:""},horror_demon:{name:"Gambling Demon",imagePath:"",type:"dice",description:"A fiend who wagers souls in games of infernal chance.",diceProfiles:["Horror - Hard","Horror - Nightmare"],messages:["Care to wager your soul?","The dice are loaded with destiny!","Even demons play fair... sometimes."],encounterScript:""},scifi_quantum:{name:"Quantum Entity",imagePath:"",type:"dice",description:"A being existing in multiple probability states simultaneously.",diceProfiles:["Sci-Fi - Normal","Sci-Fi - Hard"],messages:["PROBABILITY COLLAPSE IMMINENT.","YOUR FATE EXISTS IN SUPERPOSITION.","OBSERVE THE OUTCOME."],encounterScript:""},cyber_ripperdoc:{name:"Back-Alley Ripperdoc",imagePath:"",type:"dice",description:"An unlicensed surgeon who might save you... or butcher you.",diceProfiles:["Cyberpunk - Easy","Cyberpunk - Normal"],messages:["Steady hands? Let's find out.","Don't worry, I've done this before. Mostly.","Surgery is just controlled dice rolls."],encounterScript:""},western_dealer:{name:"Card Sharp",imagePath:"",type:"dice",description:"A professional gambler who stakes high and never loses... fairly.",diceProfiles:["Western - Normal","Western - Hard"],messages:["Lady luck is fickle today.","All in, stranger?","The cards never lie."],encounterScript:""},action_defuser:{name:"Bomb Disposal",imagePath:"",type:"dice",description:"A tense situation requiring precision and luck to disarm an explosive.",diceProfiles:["Action - Hard","Action - Nightmare"],messages:["Red wire or blue wire...","Steady... steady...","One wrong move and we're all dead."],encounterScript:""},fantasy_patrol:{name:"Castle Guards",imagePath:"",type:"stealth",description:"Vigilant sentries patrolling the castle corridors.",stealthProfiles:["Fantasy - Normal","Fantasy - Hard"],messages:["Did you hear something?","All clear in sector seven.","Stay alert, men!"],encounterScript:""},horror_stalker:{name:"The Stalker",imagePath:"",type:"stealth",description:"A relentless hunter that tracks by sound and smell.",stealthProfiles:["Horror - Hard","Horror - Nightmare"],messages:["*sniffing sounds*","I can smell your fear...","You cannot hide from me!"],encounterScript:""},scifi_sensors:{name:"Security Grid",imagePath:"",type:"stealth",description:"An automated sensor network scanning for intruders.",stealthProfiles:["Sci-Fi - Normal","Sci-Fi - Hard"],messages:["MOTION DETECTED. SCANNING...","THERMAL SIGNATURES ANALYZED.","SECTOR SWEEP IN PROGRESS."],encounterScript:""},cyber_patrol:{name:"Corp Security",imagePath:"",type:"stealth",description:"Corporate security forces with state-of-the-art surveillance.",stealthProfiles:["Cyberpunk - Normal","Cyberpunk - Hard"],messages:["Sweep the perimeter.","Thermal scan clear... wait.","Something tripped the sensors."],encounterScript:""},western_posse:{name:"Sheriff's Posse",imagePath:"",type:"stealth",description:"A group of lawmen searching for fugitives.",stealthProfiles:["Western - Easy","Western - Normal"],messages:["Fan out! They're here somewhere!","Check behind those barrels!","We'll smoke 'em out!"],encounterScript:""},action_patrol:{name:"Guard Patrol",imagePath:"",type:"stealth",description:"Military guards with NVGs and motion sensors.",stealthProfiles:["Action - Hard","Action - Nightmare"],messages:["Movement. Sector four.","Checking blind spots.","Stay frosty. We got activity."],encounterScript:""},fantasy_golem:{name:"Puzzle Golem",imagePath:"",type:"puzzle",description:"An ancient construct that only allows passage to those who solve its riddles.",puzzleProfiles:["Fantasy - Normal","Fantasy - Hard"],messages:["Solve my puzzle or be destroyed.","Your mind shall be tested.","Only the clever may pass."],encounterScript:""},horror_mirror:{name:"Puzzle Box",imagePath:"",type:"puzzle",description:"A sinister device that must be solved to prevent something terrible.",puzzleProfiles:["Horror - Normal","Horror - Hard"],messages:["The box... you opened it...","Solve it or suffer eternal torment!","Your mind against the void..."],encounterScript:""},scifi_terminal_puzzle:{name:"Security Terminal",imagePath:"",type:"puzzle",description:"A locked terminal requiring a sequence bypass to access.",puzzleProfiles:["Sci-Fi - Normal","Sci-Fi - Hard"],messages:["ACCESS DENIED. INITIATING SEQUENCE TEST.","AUTHENTICATE VIA PATTERN RECOGNITION.","UNAUTHORIZED ACCESS ATTEMPT LOGGED."],encounterScript:""},cyber_ice:{name:"Black ICE",imagePath:"",type:"puzzle",description:"Lethal intrusion countermeasures requiring precise mental navigation.",puzzleProfiles:["Cyberpunk - Hard","Cyberpunk - Nightmare"],messages:["ICE DETECTED. BEGINNING BREACH.","Neural firewall engaged.","Crack the code or fry your brain."],encounterScript:""},western_safe:{name:"Bank Vault",imagePath:"",type:"puzzle",description:"A complex combination lock protecting the town's valuables.",puzzleProfiles:["Western - Normal","Western - Hard"],messages:["Four turns left, three right...","Listen for the click...","One wrong move and the alarm sounds."],encounterScript:""},action_bomb:{name:"Bomb Defusal",imagePath:"",type:"puzzle",description:"A ticking bomb that must be disarmed following a specific sequence.",puzzleProfiles:["Action - Normal","Action - Hard"],messages:["60 seconds on the clock!","Follow the sequence exactly!","No pressure... just don't mess up."],encounterScript:""},fantasy_diplomat:{name:"Royal Emissary",imagePath:"",type:"negotiation",description:"A noble diplomat who might grant passage for the right price or persuasion.",negotiationProfiles:["Fantasy - Easy","Fantasy - Normal"],messages:["Perhaps we can reach an arrangement.","The crown demands respect.","State your business, traveler."],encounterScript:""},horror_pact:{name:"Dark Bargainer",imagePath:"",type:"negotiation",description:"An otherworldly entity offering terrible deals.",negotiationProfiles:["Horror - Hard","Horror - Nightmare"],messages:["I offer you... a deal.","Your soul is of interest to me.","Everything has a price..."],encounterScript:""},scifi_bureaucrat:{name:"Station Administrator",imagePath:"",type:"negotiation",description:"A by-the-book official who controls access to restricted areas.",negotiationProfiles:["Sci-Fi - Easy","Sci-Fi - Normal"],messages:["AUTHORIZATION REQUIRED.","Perhaps we can expedite your paperwork.","Regulations must be followed... usually."],encounterScript:""},cyber_fixer_deal:{name:"Connected Fixer",imagePath:"",type:"negotiation",description:"A well-connected middleman who can make things happen... for a price.",negotiationProfiles:["Cyberpunk - Normal","Cyberpunk - Hard"],messages:["Everything's negotiable in Night City.","I know people who know people.","What's this worth to you, choom?"],encounterScript:""},western_mayor:{name:"Corrupt Mayor",imagePath:"",type:"negotiation",description:"The town's crooked leader who can be persuaded with the right approach.",negotiationProfiles:["Western - Normal","Western - Hard"],messages:["This town runs on my schedule.","Perhaps we can help each other.","Gold speaks louder than words."],encounterScript:""},action_commander_deal:{name:"Field Commander",imagePath:"",type:"negotiation",description:"An enemy officer who might be convinced to stand down.",negotiationProfiles:["Action - Normal","Action - Hard"],messages:["You want to avoid bloodshed? Talk.","I have orders... but orders can change.","Make it worth my while."],encounterScript:""}},Pt={spike_trap:{name:"Spike Trap",imagePath:"",message:"Sharp spikes shoot up from ancient pressure plates!",script:'/setvar key=trapdmg {{roll:2d4}} | /mazedamage amount={{getvar::trapdmg}} source="spike trap" | /echo {{user}} took {{getvar::trapdmg}} damage from the spikes!',avoidChance:25,avoidMessage:"You leap back just as the spikes shoot up!",avoidScript:"/echo {{user}} narrowly avoided the spike trap!"},poison_dart:{name:"Poison Dart",imagePath:"",message:"Darts fly from hidden slits in the wall!",script:'/setvar key=trapdmg {{roll:1d6+2}} | /mazedamage amount={{getvar::trapdmg}} source="poison dart" | /echo {{user}} was struck by poisoned darts for {{getvar::trapdmg}} damage!',avoidChance:30,avoidMessage:"You duck just in time as darts whistle overhead!",avoidScript:"/echo {{user}} dodged the poison darts!"},magic_rune:{name:"Magic Rune",imagePath:"",message:"An arcane glyph flares to life beneath your feet!",script:'/setvar key=trapdmg {{roll:2d6}} | /mazedamage amount={{getvar::trapdmg}} source="magic rune" | /echo The rune explodes! {{user}} takes {{getvar::trapdmg}} arcane damage!',avoidChance:20,avoidMessage:"You sense the magic and step aside as the rune flares!",avoidScript:"/echo {{user}} sensed the magical trap and avoided it!"},ghostly_grasp:{name:"Ghostly Grasp",imagePath:"",message:"Spectral hands reach up from the floor!",script:'/setvar key=trapdmg {{roll:1d6+1}} | /mazedamage amount={{getvar::trapdmg}} source="ghostly grasp" | /echo Icy fingers drain {{getvar::trapdmg}} life from {{user}}!',avoidChance:25,avoidMessage:"The spectral hands grasp at empty air as you pull away!",avoidScript:"/echo {{user}} escaped the ghostly grasp!"},blood_pool:{name:"Blood Pool",imagePath:"",message:"The floor gives way to a pool of viscous crimson!",script:'/setvar key=trapdmg {{roll:2d4}} | /mazedamage amount={{getvar::trapdmg}} source="blood pool" | /echo The cursed blood burns {{user}} for {{getvar::trapdmg}} damage!',avoidChance:20,avoidMessage:"You grab the edge and pull yourself back before falling in!",avoidScript:"/echo {{user}} narrowly avoided falling into the blood pool!"},cursed_mirror:{name:"Cursed Mirror",imagePath:"",message:"Your reflection grins and reaches through the glass!",script:'/setvar key=trapdmg {{roll:2d6}} | /mazedamage amount={{getvar::trapdmg}} source="cursed mirror" | /echo Your doppelganger claws {{user}} for {{getvar::trapdmg}} damage!',avoidChance:15,avoidMessage:"You avert your eyes just as your reflection reaches out!",avoidScript:"/echo {{user}} refused to look at the cursed mirror!"},laser_grid:{name:"Laser Grid",imagePath:"",message:"Red laser beams crisscross the corridor!",script:'/setvar key=trapdmg {{roll:2d4+2}} | /mazedamage amount={{getvar::trapdmg}} source="laser grid" | /echo Security lasers burn {{user}} for {{getvar::trapdmg}} damage!',avoidChance:30,avoidMessage:"You contort through the laser grid without triggering it!",avoidScript:"/echo {{user}} gracefully navigated the laser grid!"},gas_leak:{name:"Gas Leak",imagePath:"",message:"A ruptured pipe sprays toxic coolant!",script:'/setvar key=trapdmg {{roll:1d8+1}} | /mazedamage amount={{getvar::trapdmg}} source="gas leak" | /echo Toxic gas burns {{user}} for {{getvar::trapdmg}} damage!',avoidChance:25,avoidMessage:"You hold your breath and rush past the gas leak!",avoidScript:"/echo {{user}} held their breath and avoided the toxic gas!"},gravity_trap:{name:"Gravity Trap",imagePath:"",message:"The gravity plating malfunctions violently!",script:'/setvar key=trapdmg {{roll:2d6}} | /mazedamage amount={{getvar::trapdmg}} source="gravity trap" | /echo {{user}} slams into the ceiling for {{getvar::trapdmg}} damage!',avoidChance:20,avoidMessage:"You grab a handhold as the gravity fluctuates!",avoidScript:"/echo {{user}} braced themselves against the gravity shift!"},electric_floor:{name:"Electric Floor",imagePath:"",message:"The chrome flooring crackles with lethal voltage!",script:'/setvar key=trapdmg {{roll:2d4+3}} | /mazedamage amount={{getvar::trapdmg}} source="electric floor" | /echo Electricity surges through {{user}} for {{getvar::trapdmg}} damage!',avoidChance:25,avoidMessage:"You leap to a non-conductive surface just in time!",avoidScript:"/echo {{user}} jumped clear of the electric floor!"},neural_spike:{name:"Neural Spike",imagePath:"",message:"A hidden ICE program attacks your neural interface!",script:'/setvar key=trapdmg {{roll:2d6}} | /mazedamage amount={{getvar::trapdmg}} source="neural spike" | /echo The ICE fries your synapses for {{getvar::trapdmg}} damage!',avoidChance:20,avoidMessage:"Your firewall blocks the ICE attack!",avoidScript:"/echo Your cyberdeck deflected the neural spike!"},security_turret:{name:"Security Turret",imagePath:"",message:"An automated turret drops from the ceiling!",script:'/setvar key=trapdmg {{roll:3d4}} | /mazedamage amount={{getvar::trapdmg}} source="security turret" | /echo The turret peppers {{user}} for {{getvar::trapdmg}} damage!',avoidChance:30,avoidMessage:"You dive behind cover as the turret opens fire!",avoidScript:"/echo {{user}} took cover before the turret could lock on!"},bear_trap:{name:"Bear Trap",imagePath:"",message:"A rusted bear trap snaps shut on your leg!",script:'/setvar key=trapdmg {{roll:2d4+2}} | /mazedamage amount={{getvar::trapdmg}} source="bear trap" | /echo The iron jaws bite {{user}} for {{getvar::trapdmg}} damage!',avoidChance:25,avoidMessage:"You spot the bear trap and step around it!",avoidScript:"/echo {{user}} carefully avoided the bear trap!"},dynamite:{name:"Dynamite",imagePath:"",message:"A tripwire ignites a bundle of dynamite!",script:'/setvar key=trapdmg {{roll:3d6}} | /mazedamage amount={{getvar::trapdmg}} source="dynamite" | /echo BOOM! {{user}} takes {{getvar::trapdmg}} explosion damage!',avoidChance:20,avoidMessage:"You cut the tripwire before it triggers the dynamite!",avoidScript:"/echo {{user}} disarmed the dynamite trap!"},snake_pit:{name:"Snake Pit",imagePath:"",message:"The floor collapses into a writhing pit of rattlesnakes!",script:'/setvar key=trapdmg {{roll:2d4+1}} | /mazedamage amount={{getvar::trapdmg}} source="snake pit" | /echo The snakes strike {{user}} for {{getvar::trapdmg}} venom damage!',avoidChance:25,avoidMessage:"You jump back as the floor crumbles away!",avoidScript:"/echo {{user}} leapt clear of the snake pit!"},tripwire:{name:"Tripwire",imagePath:"",message:"Your foot catches a nearly invisible wire!",script:'/setvar key=trapdmg {{roll:2d6+2}} | /mazedamage amount={{getvar::trapdmg}} source="tripwire" | /echo The explosive detonates! {{user}} takes {{getvar::trapdmg}} damage!',avoidChance:30,avoidMessage:"You spot the tripwire and step over it!",avoidScript:"/echo {{user}} spotted and avoided the tripwire!"},flashbang:{name:"Flashbang",imagePath:"",message:"A proximity sensor triggers a flashbang grenade!",script:'/setvar key=trapdmg {{roll:1d6+2}} | /mazedamage amount={{getvar::trapdmg}} source="flashbang" | /echo The blast disorients {{user}} for {{getvar::trapdmg}} damage!',avoidChance:25,avoidMessage:"You shield your eyes and ears as the flashbang detonates!",avoidScript:"/echo {{user}} braced for the flashbang!"},claymore:{name:"Claymore",imagePath:"",message:"You step into the kill zone of a claymore mine!",script:'/setvar key=trapdmg {{roll:4d6}} | /mazedamage amount={{getvar::trapdmg}} source="claymore" | /echo Steel balls shred {{user}} for {{getvar::trapdmg}} damage!',avoidChance:15,avoidMessage:"You freeze and slowly back out of the kill zone!",avoidScript:"/echo {{user}} carefully retreated from the claymore!"}},Dt={"Common Goods":{description:"Basic supplies and common items",items:[{id:"key",name:"Key",description:"Opens locked doors",icon:"",weight:30},{id:"stealth",name:"Stealth Cloak",description:"Slip past one encounter",icon:"",weight:25},{id:"strike",name:"Strike",description:"Power attack in combat",icon:"",weight:25},{id:"healingPotion",name:"Healing Potion",description:"Restores health",icon:"",weight:20}]},"Adventurer Supplies":{description:"Essential gear for dungeon delvers",items:[{id:"key",name:"Key",description:"Opens locked doors",icon:"",weight:20},{id:"stealth",name:"Stealth Cloak",description:"Slip past one encounter",icon:"",weight:20},{id:"strike",name:"Strike",description:"Power attack in combat",icon:"",weight:20},{id:"execute",name:"Grandstrike",description:"Devastating finishing blow",icon:"",weight:10},{id:"floorKey",name:"Floor Key",description:"Access the next floor",icon:"",weight:10},{id:"healingPotion",name:"Healing Potion",description:"Restores health",icon:"",weight:20}]},"Rare Artifacts":{description:"Magical items of significant power",items:[{id:"execute",name:"Grandstrike",description:"Devastating finishing blow",icon:"",weight:15},{id:"floorKey",name:"Floor Key",description:"Access the next floor",icon:"",weight:15},{id:"portalStone",name:"Portal Stone",description:"Teleport to safety",icon:"",weight:15},{id:"minionBane",name:"Minion Bane",description:"Instantly defeats a minion",icon:"",weight:15},{id:"greaterHealing",name:"Greater Healing",description:"Fully restores health",icon:"",weight:20},{id:"mapFragment",name:"Map Fragment",description:"Reveals the maze",icon:"",weight:20}]},"Dark Market":{description:"Forbidden wares from the underworld",items:[{id:"minionBane",name:"Minion Bane",description:"Instantly defeats a minion",icon:"",weight:20},{id:"voidWalk",name:"Void Walk",description:"Phase through walls",icon:"",weight:15},{id:"timeShard",name:"Time Shard",description:"Manipulate time",icon:"",weight:15},{id:"execute",name:"Grandstrike",description:"Devastating finishing blow",icon:"",weight:20},{id:"elixir",name:"Elixir",description:"Powerful restorative",icon:"",weight:15},{id:"revivalCharm",name:"Revival Charm",description:"Return from defeat",icon:"",weight:15}]},"Frontier Trading Post":{description:"Supplies for the open frontier",items:[{id:"key",name:"Key",description:"Opens locked doors",icon:"",weight:20},{id:"strike",name:"Strike",description:"Power attack in combat",icon:"",weight:25},{id:"stealth",name:"Stealth Cloak",description:"Slip past one encounter",icon:"",weight:15},{id:"healingPotion",name:"Healing Potion",description:"Restores health",icon:"",weight:25},{id:"execute",name:"Grandstrike",description:"Devastating finishing blow",icon:"",weight:15}]},"Black Market Tech":{description:"Cutting-edge contraband tech",items:[{id:"voidWalk",name:"Phase Implant",description:"Phase through walls",icon:"",weight:15},{id:"minionBane",name:"EMP Grenade",description:"Instantly defeats a minion",icon:"",weight:20},{id:"mapFragment",name:"Scanner Chip",description:"Reveals the maze",icon:"",weight:20},{id:"portalStone",name:"Teleport Beacon",description:"Teleport to safety",icon:"",weight:15},{id:"execute",name:"Overcharge Cell",description:"Devastating finishing blow",icon:"",weight:15},{id:"timeShard",name:"Stasis Field",description:"Manipulate time",icon:"",weight:15}]}},At={"Fantasy Tier 1":{minions:["fantasy_herald","fantasy_merchant","fantasy_diplomat"],description:"Early zone encounters: messengers, traders, negotiators"},"Fantasy Tier 2":{minions:["fantasy_guardian","fantasy_oracle","fantasy_patrol","fantasy_golem"],description:"Mid zone encounters: guards, seers, puzzle guardians"},"Fantasy Tier 3":{minions:["fantasy_knight","fantasy_mage","fantasy_assassin","fantasy_sphinx"],description:"Final zone encounters: elite warriors, powerful mages"},"Horror Tier 1":{minions:["horror_gambler","horror_graverobber","horror_pact"],description:"Early zone encounters: gamblers, scavengers, deal-makers"},"Horror Tier 2":{minions:["horror_spirit","horror_revenant","horror_stalker","horror_mirror"],description:"Mid zone encounters: restless spirits, puzzle boxes"},"Horror Tier 3":{minions:["horror_wraith","horror_butcher","horror_crawler","horror_demon"],description:"Final zone encounters: deadly horrors, demons"},"Sci-Fi Tier 1":{minions:["scifi_terminal","scifi_ai","scifi_bureaucrat"],description:"Early zone encounters: terminals, basic AI, officials"},"Sci-Fi Tier 2":{minions:["scifi_bot","scifi_sensors","scifi_terminal_puzzle","scifi_matrix"],description:"Mid zone encounters: security bots, sensor grids"},"Sci-Fi Tier 3":{minions:["scifi_commander","scifi_mech","scifi_drone","scifi_quantum"],description:"Final zone encounters: commanders, heavy mechs"},"Cyberpunk Tier 1":{minions:["cyber_market","cyber_fixer","cyber_fixer_deal"],description:"Early zone encounters: black markets, fixers"},"Cyberpunk Tier 2":{minions:["cyber_enforcer","cyber_patrol","cyber_ice","cyber_casino"],description:"Mid zone encounters: corp security, ICE programs"},"Cyberpunk Tier 3":{minions:["cyber_samurai","cyber_boss","cyber_netrunner","cyber_ripperdoc"],description:"Final zone encounters: street samurai, crime bosses"},"Western Tier 1":{minions:["western_crier","western_trader","western_gambler"],description:"Early zone encounters: town criers, traders, gamblers"},"Western Tier 2":{minions:["western_outlaw","western_posse","western_safe","western_mayor"],description:"Mid zone encounters: outlaws, lawmen, puzzles"},"Western Tier 3":{minions:["western_sheriff","western_bandit","western_quickdraw","western_dealer"],description:"Final zone encounters: sheriffs, deadly gunslingers"},"Action Tier 1":{minions:["action_intel","action_supply","action_dealer"],description:"Early zone encounters: intel officers, supply caches"},"Action Tier 2":{minions:["action_combatant","action_patrol","action_bomb","action_commander_deal"],description:"Mid zone encounters: soldiers, bomb defusals"},"Action Tier 3":{minions:["action_soldier","action_warlord","action_sniper","action_defuser"],description:"Final zone encounters: elite soldiers, warlords"},"Fantasy Full":{minions:["fantasy_herald","fantasy_merchant","fantasy_diplomat","fantasy_guardian","fantasy_oracle","fantasy_patrol","fantasy_golem","fantasy_knight","fantasy_mage","fantasy_assassin","fantasy_sphinx"],description:"Complete fantasy minion set across all zone tiers"},"Horror Full":{minions:["horror_gambler","horror_graverobber","horror_pact","horror_spirit","horror_revenant","horror_stalker","horror_mirror","horror_wraith","horror_butcher","horror_crawler","horror_demon"],description:"Complete horror minion set across all zone tiers"},"Sci-Fi Full":{minions:["scifi_terminal","scifi_ai","scifi_bureaucrat","scifi_bot","scifi_sensors","scifi_terminal_puzzle","scifi_matrix","scifi_commander","scifi_mech","scifi_drone","scifi_quantum"],description:"Complete sci-fi minion set across all zone tiers"},"Cyberpunk Full":{minions:["cyber_market","cyber_fixer","cyber_fixer_deal","cyber_enforcer","cyber_patrol","cyber_ice","cyber_casino","cyber_samurai","cyber_boss","cyber_netrunner","cyber_ripperdoc"],description:"Complete cyberpunk minion set across all zone tiers"},"Western Full":{minions:["western_crier","western_trader","western_gambler","western_outlaw","western_posse","western_safe","western_mayor","western_sheriff","western_bandit","western_quickdraw","western_dealer"],description:"Complete western minion set across all zone tiers"},"Action Full":{minions:["action_intel","action_supply","action_dealer","action_combatant","action_patrol","action_bomb","action_commander_deal","action_soldier","action_warlord","action_sniper","action_defuser"],description:"Complete action minion set across all zone tiers"},"Fantasy Pack":{minions:["fantasy_herald","fantasy_guardian","fantasy_oracle","fantasy_merchant"]},"Horror Pack":{minions:["horror_spirit","horror_revenant","horror_gambler","horror_graverobber"]},"Sci-Fi Pack":{minions:["scifi_ai","scifi_bot","scifi_matrix","scifi_terminal"]},"Cyberpunk Pack":{minions:["cyber_fixer","cyber_enforcer","cyber_casino","cyber_market"]},"Western Pack":{minions:["western_crier","western_outlaw","western_gambler","western_trader"]},"Action Pack":{minions:["action_intel","action_combatant","action_supply","action_dealer"]},"Fantasy Extended":{minions:["fantasy_herald","fantasy_guardian","fantasy_oracle","fantasy_merchant","fantasy_knight","fantasy_mage","fantasy_assassin","fantasy_sphinx","fantasy_patrol","fantasy_golem","fantasy_diplomat"]},"Horror Extended":{minions:["horror_spirit","horror_revenant","horror_gambler","horror_graverobber","horror_wraith","horror_butcher","horror_crawler","horror_demon","horror_stalker","horror_mirror","horror_pact"]},"Sci-Fi Extended":{minions:["scifi_ai","scifi_bot","scifi_matrix","scifi_terminal","scifi_commander","scifi_mech","scifi_drone","scifi_quantum","scifi_sensors","scifi_terminal_puzzle","scifi_bureaucrat"]},"Cyberpunk Extended":{minions:["cyber_fixer","cyber_enforcer","cyber_casino","cyber_market","cyber_samurai","cyber_boss","cyber_netrunner","cyber_ripperdoc","cyber_patrol","cyber_ice","cyber_fixer_deal"]},"Western Extended":{minions:["western_crier","western_outlaw","western_gambler","western_trader","western_sheriff","western_bandit","western_quickdraw","western_dealer","western_posse","western_safe","western_mayor"]},"Action Extended":{minions:["action_intel","action_combatant","action_supply","action_dealer","action_soldier","action_warlord","action_sniper","action_defuser","action_patrol","action_bomb","action_commander_deal"]}},Bt={"Fantasy Traps":{traps:["spike_trap","poison_dart","magic_rune"]},"Horror Traps":{traps:["ghostly_grasp","blood_pool","cursed_mirror"]},"Sci-Fi Traps":{traps:["laser_grid","gas_leak","gravity_trap"]},"Cyberpunk Traps":{traps:["electric_floor","neural_spike","security_turret"]},"Western Traps":{traps:["bear_trap","dynamite","snake_pit"]},"Action Traps":{traps:["tripwire","flashbang","claymore"]}},Lt={"Tutorial: First Steps":{gridSize:5,floors:1,difficulty:"tutorial",theme:"fantasy",mapStyle:"dungeon",mapVisibility:"showAll",winCommand:"/echo Tutorial complete! You're ready for real adventures!",loseCommand:"/echo Don't worry! Try again - tutorials are meant for learning!",winMessage:"Congratulations! You've learned the basics of dungeon exploration!",winImage:"",mainMinion:"fantasy_herald",mainMinionIntroMessage:"Welcome, adventurer! I'll guide you through this tutorial dungeon.",mainMinionRandomChance:30,mainMinionRandomMessages:["Remember to check chests for supplies!","Look for the exit marked on your map!","Use items wisely!"],mainMinionExitType:"messenger",mainMinionExitProfile:"",minionEncounters:[{minionId:"fantasy_herald",percent:5,zoneMin:0,zoneMax:99},{minionId:"fantasy_merchant",percent:3,zoneMin:0,zoneMax:99}],trapEncounters:[],onBattlebarLoss:"respawn",chestTilePercent:15,chestLockedPercent:10,chestLockedBonusPercent:30,chestMimicPercent:0,chestLootMin:3,chestLootMax:5,chestKeyChance:50,chestStrikeChance:50,chestStealthChance:30,chestExecuteChance:5,lockedChestKeyChance:40,lockedChestStrikeChance:60,lockedChestStealthChance:40,lockedChestExecuteChance:10,startingInventory:{key:3,strike:3,stealth:2,execute:1,healingPotion:5,greaterHealing:2,elixir:1,revivalCharm:1},hpEnabled:!0,maxHP:200,battlebarDamageMultiplier:.3,onDeath:"respawn",respawnHPPercent:100,safeRoomCount:5,safeRoomHealPercent:100,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:50,restCooldown:1,restInterruptChance:0,restInterruptScript:"",storyConfig:{mainStory:"Welcome, novice adventurer! This training dungeon will teach you everything you need to survive. Explore rooms, open chests, and find the exit. Your guide awaits within."},findEarly:{radius:6,items:["lantern","torch","healingPotion","mapFragment","key","strike"],itemsPerChest:3},fairness:{enabled:!0,keyPityThreshold:2,healingPityThreshold:2,lowHpThreshold:.5,mercyUnlock:!0,mercyUnlockThreshold:1},bspConfig:{zoneCount:1,secretDensity:0,zonesRequireClear:!1,secretHints:!0,floorComplexityScaling:!1},safeStartRadius:4,visionProfile:"fullvisibility",combatMechanicsProfile:"none",factionProfile:"fantasy",permadeathEnabled:!1,vfxEnabled:!0,soundProfile:"default",questProfile:"Tutorial: First Steps",questGatingEnabled:!1,questPool:[{questId:"quest_collect_keys",chance:100},{questId:"quest_explore_75",chance:100},{questId:"quest_treasure_hunter",chance:100}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","execute","minionBane","portalStone","mapFragment","voidWalk","timeShard","healingPotion","greaterHealing","elixir","revivalCharm","heartCrystal","torch","lantern","revealScroll","sightPotion","crystalBall","ironGuard","weapon_rusty_sword","weapon_iron_sword","weapon_enchanted_blade","weapon_shadow_dagger","weapon_steel_blade","armor_leather","armor_chainmail","armor_plate","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","accessory_vampiric_pendant","repairKit"]}},"The Ancient Crypt":{gridSize:8,floors:1,difficulty:"easy",theme:"fantasy",mapStyle:"dungeon",mapVisibility:"showAll",winCommand:"/echo Congratulations! You escaped the dungeon!",loseCommand:"/echo The dungeon claims another victim...",winMessage:"You found the exit and escaped the ancient dungeon!",winImage:"",mainMinion:"fantasy_guardian",mainMinionIntroMessage:"Welcome to my dungeon, adventurer. Find the exit... if you can!",mainMinionRandomChance:15,mainMinionRandomMessages:["Still wandering, I see...","Many have tried. Few have succeeded."],mainMinionExitType:"battlebar",mainMinionExitProfile:"Fantasy - Normal",minionEncounters:[{minionId:"fantasy_herald",percent:3,zoneMin:0,zoneMax:1},{minionId:"fantasy_merchant",percent:2,zoneMin:0,zoneMax:1},{minionId:"fantasy_guardian",percent:2,zoneMin:1,zoneMax:99}],trapEncounters:[{trapId:"spike_trap",percent:1},{trapId:"poison_dart",percent:1}],onBattlebarLoss:"respawn",chestTilePercent:10,chestLockedPercent:20,chestLockedBonusPercent:50,chestMimicPercent:5,chestLootMin:2,chestLootMax:4,chestKeyChance:40,chestStrikeChance:50,chestStealthChance:20,chestExecuteChance:2,lockedChestKeyChance:30,lockedChestStrikeChance:60,lockedChestStealthChance:30,lockedChestExecuteChance:5,startingInventory:{key:2,strike:2,stealth:1,execute:0,healingPotion:2,greaterHealing:0,elixir:0,revivalCharm:0},hpEnabled:!0,maxHP:130,battlebarDamageMultiplier:.7,onDeath:"respawn",respawnHPPercent:75,safeRoomCount:4,safeRoomHealPercent:100,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:30,restCooldown:2,restInterruptChance:0,restInterruptScript:"",storyConfig:{mainStory:"Cobwebs shroud the entrance to a forgotten crypt. Local villagers whisper of treasures within, guarded only by dust and shadow. A perfect first adventure."},findEarly:{radius:5,items:["lantern","torch","healingPotion","mapFragment"],itemsPerChest:2},fairness:{enabled:!0,keyPityThreshold:3,healingPityThreshold:4,lowHpThreshold:.4,mercyUnlock:!0,mercyUnlockThreshold:2},bspConfig:{zoneCount:2,secretDensity:.02,zonesRequireClear:!0,clearThreshold:.5,secretHints:!0,floorComplexityScaling:!1},safeStartRadius:3,visionProfile:"explorer",combatMechanicsProfile:"simple",factionProfile:"fantasy",permadeathEnabled:!1,vfxEnabled:!0,soundProfile:"default",questProfile:"Fantasy - Easy",questGatingEnabled:!0,questPool:[{questId:"quest_collect_keys",chance:80},{questId:"quest_defeat_5",chance:60},{questId:"quest_treasure_hunter",chance:70}],itemPool:{enabled:!0,items:["key","strike","stealth","healingPotion","greaterHealing","torch","lantern","mapFragment","weapon_rusty_sword","weapon_iron_sword","armor_leather","accessory_ring_power","repairKit"]}},"Guardian's Domain":{gridSize:10,floors:2,difficulty:"normal",theme:"fantasy",mapStyle:"dungeon",mapVisibility:"fogOfWar",winCommand:"/echo You emerge victorious from the depths!",loseCommand:"/echo The dungeon claims another soul...",winMessage:"Through cunning and courage, you conquered the dungeon!",winImage:"",mainMinion:"fantasy_guardian",mainMinionIntroMessage:"The ancient stones whisper of your arrival. Prove yourself worthy!",mainMinionRandomChance:20,mainMinionRandomMessages:["The deeper zones grow more treacherous...","Have you found the secrets?"],mainMinionExitType:"battlebar",mainMinionExitProfile:"Fantasy - Normal",minionEncounters:[{minionId:"fantasy_herald",percent:3,zoneMin:0,zoneMax:1},{minionId:"fantasy_merchant",percent:2,zoneMin:0,zoneMax:1},{minionId:"fantasy_guardian",percent:3,zoneMin:1,zoneMax:2},{minionId:"fantasy_oracle",percent:2,zoneMin:1,zoneMax:2},{minionId:"fantasy_knight",percent:2,zoneMin:2,zoneMax:99},{minionId:"fantasy_mage",percent:1,zoneMin:2,zoneMax:99}],trapEncounters:[{trapId:"spike_trap",percent:2},{trapId:"poison_dart",percent:2},{trapId:"magic_rune",percent:1}],onBattlebarLoss:"respawn",chestTilePercent:8,chestLockedPercent:30,chestLockedBonusPercent:50,chestMimicPercent:10,chestLootMin:1,chestLootMax:3,chestKeyChance:35,chestStrikeChance:45,chestStealthChance:20,chestExecuteChance:3,lockedChestKeyChance:25,lockedChestStrikeChance:55,lockedChestStealthChance:25,lockedChestExecuteChance:6,startingInventory:{key:1,strike:1,stealth:0,execute:0,healingPotion:1,greaterHealing:0,elixir:0,revivalCharm:0},hpEnabled:!0,maxHP:100,battlebarDamageMultiplier:1,onDeath:"respawn",respawnHPPercent:50,safeRoomCount:3,safeRoomHealPercent:100,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:20,restCooldown:3,restInterruptChance:10,restInterruptScript:"",storyConfig:{mainStory:"The Dungeon Guardian has ruled these halls for centuries. Many adventurers have entered seeking glorytheir bones now decorate the walls. Will you be different?"},findEarly:{radius:4,items:["torch","healingPotion","mapFragment"],itemsPerChest:1},fairness:{enabled:!0,keyPityThreshold:4,healingPityThreshold:5,lowHpThreshold:.35,mercyUnlock:!0,mercyUnlockThreshold:3},bspConfig:{zoneCount:3,secretDensity:.04,zonesRequireClear:!0,clearThreshold:.75,secretHints:!0,floorComplexityScaling:!0},safeStartRadius:2,visionProfile:"default",combatMechanicsProfile:"default",factionProfile:"fantasy",permadeathEnabled:!1,vfxEnabled:!0,soundProfile:"default",questProfile:"Fantasy - Normal",questGatingEnabled:!0,questPool:[{questId:"quest_collect_keys",chance:70},{questId:"quest_defeat_5",chance:80},{questId:"quest_explore_75",chance:60},{questId:"quest_treasure_hunter",chance:50}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","minionBane","portalStone","mapFragment","timeShard","healingPotion","greaterHealing","elixir","torch","lantern","revealScroll","sightPotion","weapon_rusty_sword","weapon_iron_sword","weapon_shadow_dagger","armor_leather","armor_chainmail","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","repairKit"]}},"The Abyss Gauntlet":{gridSize:12,floors:3,difficulty:"hard",theme:"fantasy",mapStyle:"dungeon",mapVisibility:"hideUnexplored",winCommand:"/echo Glory! You have conquered the depths!",loseCommand:"/echo The abyss swallows another soul...",winMessage:"Through blood and steel, you conquered three floors of terror!",winImage:"",mainMinion:"fantasy_knight",mainMinionIntroMessage:"You dare challenge my domain? Prove your worth against the gauntlet!",mainMinionRandomChance:25,mainMinionRandomMessages:["Your bones will join the others...","The deeper you go, the darker it gets."],mainMinionExitType:"turnbased",mainMinionExitProfile:"Fantasy - Hard",minionEncounters:[{minionId:"fantasy_herald",percent:2,zoneMin:0,zoneMax:1},{minionId:"fantasy_guardian",percent:3,zoneMin:1,zoneMax:2},{minionId:"fantasy_patrol",percent:2,zoneMin:1,zoneMax:2},{minionId:"fantasy_knight",percent:3,zoneMin:2,zoneMax:3},{minionId:"fantasy_mage",percent:2,zoneMin:3,zoneMax:99},{minionId:"fantasy_assassin",percent:1,zoneMin:3,zoneMax:99}],trapEncounters:[{trapId:"spike_trap",percent:3},{trapId:"poison_dart",percent:3},{trapId:"magic_rune",percent:2}],onBattlebarLoss:"respawn",chestTilePercent:6,chestLockedPercent:40,chestLockedBonusPercent:60,chestMimicPercent:15,chestLootMin:1,chestLootMax:2,chestKeyChance:30,chestStrikeChance:40,chestStealthChance:15,chestExecuteChance:4,lockedChestKeyChance:25,lockedChestStrikeChance:55,lockedChestStealthChance:25,lockedChestExecuteChance:8,startingInventory:{key:1,strike:0,stealth:0,execute:0,healingPotion:1,greaterHealing:0,elixir:0,revivalCharm:0},hpEnabled:!0,maxHP:80,battlebarDamageMultiplier:1.3,onDeath:"respawnPenalty",respawnHPPercent:50,safeRoomCount:2,safeRoomHealPercent:75,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:15,restCooldown:4,restInterruptChance:25,restInterruptScript:"",storyConfig:{mainStory:"The Abyss Gauntletthree floors of lethal trials designed by a mad archmage. Each zone must be cleared completely. Only the worthy survive."},findEarly:{radius:3,items:["torch","healingPotion"],itemsPerChest:1},fairness:{enabled:!0,keyPityThreshold:5,healingPityThreshold:6,lowHpThreshold:.3,mercyUnlock:!1,mercyUnlockThreshold:0},bspConfig:{zoneCount:4,secretDensity:.05,zonesRequireClear:!0,clearThreshold:.9,secretHints:!1,floorComplexityScaling:!0},safeStartRadius:1,visionProfile:"survival",combatMechanicsProfile:"default",factionProfile:"fantasy",permadeathEnabled:!1,vfxEnabled:!0,soundProfile:"default",questProfile:"Fantasy - Hard",questGatingEnabled:!0,questPool:[{questId:"quest_defeat_5",chance:80},{questId:"quest_explore_75",chance:70},{questId:"quest_find_secret",chance:60},{questId:"quest_survive_combat",chance:70},{questId:"quest_boss_slayer",chance:50}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","execute","minionBane","portalStone","mapFragment","voidWalk","timeShard","healingPotion","greaterHealing","elixir","revivalCharm","torch","lantern","revealScroll","sightPotion","crystalBall","ironGuard","weapon_rusty_sword","weapon_iron_sword","weapon_enchanted_blade","weapon_shadow_dagger","armor_leather","armor_chainmail","armor_plate","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","accessory_vampiric_pendant","repairKit"]}},"Trial of the Damned":{gridSize:14,floors:4,difficulty:"nightmare",theme:"fantasy",mapStyle:"dungeon",mapVisibility:"hideUnexplored",winCommand:"/echo Against all odds, you have emerged victorious!",loseCommand:"/echo Your name joins the list of the fallen...",winMessage:"A true legend! You conquered the nightmare dungeon!",winImage:"",mainMinion:"fantasy_mage",mainMinionIntroMessage:"Foolish mortal! None have survived my trials. Your death will be... entertaining.",mainMinionRandomChance:30,mainMinionRandomMessages:["Your suffering has only begun!","The dead do not rest here...","Run while you still can!"],mainMinionExitType:"turnbased",mainMinionExitProfile:"Fantasy - Nightmare",minionEncounters:[{minionId:"fantasy_guardian",percent:2,zoneMin:0,zoneMax:1},{minionId:"fantasy_patrol",percent:3,zoneMin:1,zoneMax:2},{minionId:"fantasy_knight",percent:3,zoneMin:2,zoneMax:3},{minionId:"fantasy_mage",percent:3,zoneMin:3,zoneMax:99},{minionId:"fantasy_assassin",percent:2,zoneMin:3,zoneMax:99},{minionId:"fantasy_sphinx",percent:1,zoneMin:3,zoneMax:99}],trapEncounters:[{trapId:"spike_trap",percent:4},{trapId:"poison_dart",percent:4},{trapId:"magic_rune",percent:3}],onBattlebarLoss:"gameover",chestTilePercent:5,chestLockedPercent:50,chestLockedBonusPercent:70,chestMimicPercent:25,chestLootMin:1,chestLootMax:2,chestKeyChance:25,chestStrikeChance:35,chestStealthChance:15,chestExecuteChance:5,lockedChestKeyChance:20,lockedChestStrikeChance:50,lockedChestStealthChance:25,lockedChestExecuteChance:10,startingInventory:{key:1,strike:0,stealth:0,execute:0,healingPotion:0,greaterHealing:0,elixir:0,revivalCharm:0,ironGuard:1},hpEnabled:!0,maxHP:70,battlebarDamageMultiplier:1.5,onDeath:"gameover",respawnHPPercent:25,safeRoomCount:2,safeRoomHealPercent:60,safeRoomUseLLM:!0,restEnabled:!0,restHealPercent:10,restCooldown:5,restInterruptChance:35,restInterruptScript:"",storyConfig:{mainStory:"The Trial of the Damnedfour floors where the souls of fallen heroes wander eternally. No supplies. No mercy. Permadeath. Your legend begins or ends here."},findEarly:{radius:2,items:["torch"],itemsPerChest:1},fairness:{enabled:!1,keyPityThreshold:0,healingPityThreshold:0,lowHpThreshold:0,mercyUnlock:!1,mercyUnlockThreshold:0},bspConfig:{zoneCount:4,secretDensity:.06,zonesRequireClear:!0,clearThreshold:1,secretHints:!1,floorComplexityScaling:!0},safeStartRadius:0,visionProfile:"survival",combatMechanicsProfile:"aggressive",factionProfile:"fantasy",permadeathEnabled:!0,vfxEnabled:!0,soundProfile:"default",questProfile:"Fantasy - Nightmare",questGatingEnabled:!0,questPool:[{questId:"quest_defeat_5",chance:90},{questId:"quest_explore_75",chance:80},{questId:"quest_find_secret",chance:70},{questId:"quest_survive_combat",chance:80},{questId:"quest_boss_slayer",chance:60},{questId:"quest_full_clear",chance:40}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","execute","minionBane","portalStone","mapFragment","voidWalk","timeShard","healingPotion","elixir","revivalCharm","heartCrystal","torch","lantern","revealScroll","sightPotion","crystalBall","ironGuard","weapon_rusty_sword","weapon_iron_sword","weapon_enchanted_blade","weapon_shadow_dagger","weapon_steel_blade","armor_leather","armor_chainmail","armor_plate","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","accessory_vampiric_pendant","repairKit"]}},"Extinction's Edge":{gridSize:16,floors:5,difficulty:"apocalypse",theme:"fantasy",mapStyle:"dungeon",mapVisibility:"hideUnexplored",winCommand:"/echo IMPOSSIBLE! You have achieved the impossible!",loseCommand:"/echo As expected. The apocalypse spares no one.",winMessage:"LEGENDARY! You conquered the apocalypse dungeon! Your name echoes through eternity!",winImage:"",mainMinion:"fantasy_sphinx",mainMinionIntroMessage:"The ultimate challenge awaits. Five floors. No mercy. Only legends survive.",mainMinionRandomChance:35,mainMinionRandomMessages:["DEATH COMES FOR ALL!","YOUR SOUL IS MINE!","NONE ESCAPE THE APOCALYPSE!"],mainMinionExitType:"turnbased",mainMinionExitProfile:"Fantasy - Apocalypse",minionEncounters:[{minionId:"fantasy_patrol",percent:3,zoneMin:0,zoneMax:1},{minionId:"fantasy_knight",percent:4,zoneMin:1,zoneMax:2},{minionId:"fantasy_mage",percent:4,zoneMin:2,zoneMax:3},{minionId:"fantasy_assassin",percent:3,zoneMin:3,zoneMax:4},{minionId:"fantasy_sphinx",percent:2,zoneMin:4,zoneMax:99}],trapEncounters:[{trapId:"spike_trap",percent:5},{trapId:"poison_dart",percent:5},{trapId:"magic_rune",percent:4}],onBattlebarLoss:"gameover",chestTilePercent:4,chestLockedPercent:60,chestLockedBonusPercent:80,chestMimicPercent:35,chestLootMin:1,chestLootMax:1,chestKeyChance:20,chestStrikeChance:30,chestStealthChance:10,chestExecuteChance:5,lockedChestKeyChance:15,lockedChestStrikeChance:45,lockedChestStealthChance:20,lockedChestExecuteChance:12,startingInventory:{key:1,strike:0,stealth:0,execute:0,healingPotion:0,greaterHealing:0,elixir:0,revivalCharm:0,ironGuard:1},hpEnabled:!0,maxHP:60,battlebarDamageMultiplier:2,onDeath:"gameover",respawnHPPercent:0,safeRoomCount:1,safeRoomHealPercent:40,safeRoomUseLLM:!0,restEnabled:!0,restHealPercent:5,restCooldown:6,restInterruptChance:50,restInterruptScript:"",storyConfig:{mainStory:"EXTINCTION'S EDGEthe final test. Five floors of absolute death where ancient evils await. No equipment. No second chances. Your run will be recorded in the halls of legend... or forgotten forever."},findEarly:{radius:0,items:[],itemsPerChest:0},fairness:{enabled:!1,keyPityThreshold:0,healingPityThreshold:0,lowHpThreshold:0,mercyUnlock:!1,mercyUnlockThreshold:0},bspConfig:{zoneCount:5,secretDensity:.08,zonesRequireClear:!0,clearThreshold:1,secretHints:!1,floorComplexityScaling:!0},safeStartRadius:0,visionProfile:"survival",combatMechanicsProfile:"lethal",factionProfile:"fantasy",permadeathEnabled:!0,vfxEnabled:!0,soundProfile:"default",questProfile:"Fantasy - Apocalypse",questGatingEnabled:!0,questPool:[{questId:"quest_defeat_5",chance:100},{questId:"quest_explore_75",chance:90},{questId:"quest_find_secret",chance:80},{questId:"quest_survive_combat",chance:90},{questId:"quest_boss_slayer",chance:70},{questId:"quest_full_clear",chance:60}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","execute","minionBane","portalStone","mapFragment","voidWalk","timeShard","healingPotion","greaterHealing","elixir","revivalCharm","heartCrystal","torch","lantern","revealScroll","sightPotion","crystalBall","ironGuard","weapon_rusty_sword","weapon_iron_sword","weapon_enchanted_blade","weapon_shadow_dagger","weapon_steel_blade","armor_leather","armor_chainmail","armor_plate","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","accessory_vampiric_pendant","repairKit"]}},"The Haunted Manor":{gridSize:8,floors:1,difficulty:"easy",theme:"horror",mapStyle:"apartment",mapVisibility:"showAll",winCommand:"/echo You escape the haunted manor!",loseCommand:"/echo The spirits claim another soul...",winMessage:"You escaped the haunted manor... but the nightmares will follow.",winImage:"",mainMinion:"horror_revenant",mainMinionIntroMessage:"Welcome to my home... you will never leave...",mainMinionRandomChance:15,mainMinionRandomMessages:["I can smell your fear...","The walls are watching..."],mainMinionExitType:"battlebar",mainMinionExitProfile:"Horror - Normal",minionEncounters:[{minionId:"horror_gambler",percent:3,zoneMin:0,zoneMax:1},{minionId:"horror_graverobber",percent:2,zoneMin:0,zoneMax:1},{minionId:"horror_spirit",percent:2,zoneMin:1,zoneMax:99}],trapEncounters:[{trapId:"ghostly_grasp",percent:1},{trapId:"blood_pool",percent:1}],onBattlebarLoss:"respawn",chestTilePercent:10,chestLockedPercent:20,chestLockedBonusPercent:50,chestMimicPercent:10,chestLootMin:2,chestLootMax:4,chestKeyChance:40,chestStrikeChance:50,chestStealthChance:25,chestExecuteChance:2,lockedChestKeyChance:30,lockedChestStrikeChance:55,lockedChestStealthChance:30,lockedChestExecuteChance:5,startingInventory:{key:2,strike:2,stealth:1,execute:0,healingPotion:2,greaterHealing:0,elixir:0,revivalCharm:0},hpEnabled:!0,maxHP:130,battlebarDamageMultiplier:.7,onDeath:"respawn",respawnHPPercent:75,safeRoomCount:4,safeRoomHealPercent:100,safeRoomUseLLM:!0,restEnabled:!0,restHealPercent:30,restCooldown:2,restInterruptChance:15,restInterruptScript:"",storyConfig:{mainStory:"The old Blackwood Manor has stood empty for decades. Tonight, lights flicker in the windows. The door creaks open as you approach, as if expecting you..."},findEarly:{radius:5,items:["lantern","torch","healingPotion","mapFragment"],itemsPerChest:2},fairness:{enabled:!0,keyPityThreshold:3,healingPityThreshold:4,lowHpThreshold:.4,mercyUnlock:!0,mercyUnlockThreshold:2},bspConfig:{zoneCount:2,secretDensity:.02,zonesRequireClear:!0,clearThreshold:.5,secretHints:!0,floorComplexityScaling:!1},safeStartRadius:3,visionProfile:"explorer",combatMechanicsProfile:"simple",factionProfile:"horror",permadeathEnabled:!1,vfxEnabled:!0,soundProfile:"default",questProfile:"Horror - Easy",questGatingEnabled:!0,questPool:[{questId:"quest_collect_keys",chance:80},{questId:"quest_defeat_5",chance:60},{questId:"quest_treasure_hunter",chance:70}],itemPool:{enabled:!0,items:["key","strike","stealth","healingPotion","greaterHealing","torch","lantern","mapFragment","weapon_rusty_sword","weapon_iron_sword","armor_leather","accessory_ring_power","repairKit"]}},"Asylum of Whispers":{gridSize:10,floors:2,difficulty:"normal",theme:"horror",mapStyle:"hospital",mapVisibility:"fogOfWar",winCommand:"/echo You escape the asylum!",loseCommand:"/echo The darkness consumes you...",winMessage:"You escaped the cursed hospital, but the memories remain...",winImage:"",mainMinion:"horror_revenant",mainMinionIntroMessage:"The patients are restless tonight... and so are the dead.",mainMinionRandomChance:20,mainMinionRandomMessages:["Do you hear the whispers?","Something is following you...","The shadows move..."],mainMinionExitType:"battlebar",mainMinionExitProfile:"Horror Encounter",minionEncounters:[{minionId:"horror_gambler",percent:2,zoneMin:0,zoneMax:1},{minionId:"horror_pact",percent:2,zoneMin:0,zoneMax:1},{minionId:"horror_spirit",percent:3,zoneMin:1,zoneMax:2},{minionId:"horror_revenant",percent:2,zoneMin:1,zoneMax:2},{minionId:"horror_wraith",percent:2,zoneMin:2,zoneMax:99}],trapEncounters:[{trapId:"ghostly_grasp",percent:2},{trapId:"blood_pool",percent:2},{trapId:"cursed_mirror",percent:1}],onBattlebarLoss:"respawn",chestTilePercent:8,chestLockedPercent:30,chestLockedBonusPercent:50,chestMimicPercent:15,chestLootMin:1,chestLootMax:3,chestKeyChance:35,chestStrikeChance:45,chestStealthChance:25,chestExecuteChance:3,lockedChestKeyChance:25,lockedChestStrikeChance:55,lockedChestStealthChance:30,lockedChestExecuteChance:6,startingInventory:{key:1,strike:1,stealth:0,execute:0,healingPotion:1,greaterHealing:0,elixir:0,revivalCharm:0},hpEnabled:!0,maxHP:100,battlebarDamageMultiplier:1,onDeath:"respawn",respawnHPPercent:50,safeRoomCount:3,safeRoomHealPercent:100,safeRoomUseLLM:!0,restEnabled:!0,restHealPercent:20,restCooldown:3,restInterruptChance:20,restInterruptScript:"",storyConfig:{mainStory:"The abandoned hospital looms before you. Two floors of terror await..."},findEarly:{radius:4,items:["torch","healingPotion","mapFragment"],itemsPerChest:1},fairness:{enabled:!0,keyPityThreshold:4,healingPityThreshold:5,lowHpThreshold:.35,mercyUnlock:!0,mercyUnlockThreshold:3},bspConfig:{zoneCount:3,secretDensity:.04,zonesRequireClear:!0,clearThreshold:.75,secretHints:!0,floorComplexityScaling:!0},safeStartRadius:2,visionProfile:"default",combatMechanicsProfile:"default",factionProfile:"horror",permadeathEnabled:!1,vfxEnabled:!0,soundProfile:"default",questProfile:"Horror - Normal",questGatingEnabled:!0,questPool:[{questId:"quest_collect_keys",chance:70},{questId:"quest_defeat_5",chance:80},{questId:"quest_explore_75",chance:60},{questId:"quest_treasure_hunter",chance:50}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","minionBane","portalStone","mapFragment","timeShard","healingPotion","greaterHealing","elixir","torch","lantern","revealScroll","sightPotion","weapon_rusty_sword","weapon_iron_sword","weapon_shadow_dagger","armor_leather","armor_chainmail","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","repairKit"]}},"Catacombs of Dread":{gridSize:12,floors:3,difficulty:"hard",theme:"horror",mapStyle:"highrise",mapVisibility:"hideUnexplored",winCommand:"/echo You survived the nightmare!",loseCommand:"/echo Your screams echo eternally...",winMessage:"Against all odds, you escaped the tower of horrors!",winImage:"",mainMinion:"horror_butcher",mainMinionIntroMessage:"Fresh meat... the hunt begins.",mainMinionRandomChance:25,mainMinionRandomMessages:["I can hear your heartbeat...","RUN!","There is no escape..."],mainMinionExitType:"turnbased",mainMinionExitProfile:"Horror - Hard",minionEncounters:[{minionId:"horror_spirit",percent:2,zoneMin:0,zoneMax:1},{minionId:"horror_stalker",percent:3,zoneMin:1,zoneMax:2},{minionId:"horror_mirror",percent:2,zoneMin:1,zoneMax:2},{minionId:"horror_wraith",percent:3,zoneMin:2,zoneMax:3},{minionId:"horror_butcher",percent:2,zoneMin:3,zoneMax:99}],trapEncounters:[{trapId:"ghostly_grasp",percent:3},{trapId:"blood_pool",percent:3},{trapId:"cursed_mirror",percent:2}],onBattlebarLoss:"respawn",chestTilePercent:6,chestLockedPercent:40,chestLockedBonusPercent:60,chestMimicPercent:20,chestLootMin:1,chestLootMax:2,chestKeyChance:30,chestStrikeChance:40,chestStealthChance:20,chestExecuteChance:4,lockedChestKeyChance:25,lockedChestStrikeChance:55,lockedChestStealthChance:30,lockedChestExecuteChance:8,startingInventory:{key:1,strike:0,stealth:0,execute:0,healingPotion:1,greaterHealing:0,elixir:0,revivalCharm:0},hpEnabled:!0,maxHP:80,battlebarDamageMultiplier:1.3,onDeath:"respawnPenalty",respawnHPPercent:50,safeRoomCount:2,safeRoomHealPercent:75,safeRoomUseLLM:!0,restEnabled:!0,restHealPercent:15,restCooldown:4,restInterruptChance:30,restInterruptScript:"",storyConfig:{mainStory:"Three floors of pure horror. The hunters are everywhere..."},findEarly:{radius:3,items:["torch","healingPotion"],itemsPerChest:1},fairness:{enabled:!0,keyPityThreshold:5,healingPityThreshold:6,lowHpThreshold:.3,mercyUnlock:!1,mercyUnlockThreshold:0},bspConfig:{zoneCount:4,secretDensity:.05,zonesRequireClear:!0,clearThreshold:.9,secretHints:!1,floorComplexityScaling:!0},safeStartRadius:1,visionProfile:"survival",combatMechanicsProfile:"default",factionProfile:"horror",permadeathEnabled:!1,vfxEnabled:!0,soundProfile:"default",questProfile:"Horror - Hard",questGatingEnabled:!0,questPool:[{questId:"quest_defeat_5",chance:80},{questId:"quest_explore_75",chance:70},{questId:"quest_find_secret",chance:60},{questId:"quest_survive_combat",chance:70},{questId:"quest_boss_slayer",chance:50}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","execute","minionBane","portalStone","mapFragment","voidWalk","timeShard","healingPotion","greaterHealing","elixir","revivalCharm","torch","lantern","revealScroll","sightPotion","crystalBall","ironGuard","weapon_rusty_sword","weapon_iron_sword","weapon_enchanted_blade","weapon_shadow_dagger","armor_leather","armor_chainmail","armor_plate","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","accessory_vampiric_pendant","repairKit"]}},"The Endless Dark":{gridSize:14,floors:4,difficulty:"nightmare",theme:"horror",mapStyle:"hospital",mapVisibility:"hideUnexplored",winCommand:"/echo Against all odds, you survived!",loseCommand:"/echo Your screams echo for eternity...",winMessage:"You escaped... but at what cost?",winImage:"",mainMinion:"horror_demon",mainMinionIntroMessage:"There is no escape. There never was.",mainMinionRandomChance:30,mainMinionRandomMessages:["YOU CANNOT RUN!","DEATH IS ONLY THE BEGINNING!","JOIN US..."],mainMinionExitType:"turnbased",mainMinionExitProfile:"Horror - Nightmare",minionEncounters:[{minionId:"horror_stalker",percent:3,zoneMin:0,zoneMax:1},{minionId:"horror_wraith",percent:3,zoneMin:1,zoneMax:2},{minionId:"horror_butcher",percent:3,zoneMin:2,zoneMax:3},{minionId:"horror_crawler",percent:3,zoneMin:3,zoneMax:99},{minionId:"horror_demon",percent:2,zoneMin:3,zoneMax:99}],trapEncounters:[{trapId:"ghostly_grasp",percent:4},{trapId:"blood_pool",percent:4},{trapId:"cursed_mirror",percent:3}],onBattlebarLoss:"gameover",chestTilePercent:5,chestLockedPercent:50,chestLockedBonusPercent:70,chestMimicPercent:25,chestLootMin:1,chestLootMax:2,chestKeyChance:25,chestStrikeChance:35,chestStealthChance:20,chestExecuteChance:5,lockedChestKeyChance:20,lockedChestStrikeChance:50,lockedChestStealthChance:30,lockedChestExecuteChance:10,startingInventory:{key:1,strike:0,stealth:0,execute:0,healingPotion:0,greaterHealing:0,elixir:0,revivalCharm:0,ironGuard:1},hpEnabled:!0,maxHP:70,battlebarDamageMultiplier:1.5,onDeath:"gameover",respawnHPPercent:25,safeRoomCount:2,safeRoomHealPercent:60,safeRoomUseLLM:!0,restEnabled:!0,restHealPercent:10,restCooldown:5,restInterruptChance:40,restInterruptScript:"",storyConfig:{mainStory:"Four floors of pure terror. No supplies. No mercy. Permadeath enabled..."},findEarly:{radius:2,items:["torch"],itemsPerChest:1},fairness:{enabled:!1,keyPityThreshold:0,healingPityThreshold:0,lowHpThreshold:0,mercyUnlock:!1,mercyUnlockThreshold:0},bspConfig:{zoneCount:4,secretDensity:.06,zonesRequireClear:!0,clearThreshold:1,secretHints:!1,floorComplexityScaling:!0},safeStartRadius:0,visionProfile:"survival",combatMechanicsProfile:"aggressive",factionProfile:"horror",permadeathEnabled:!0,vfxEnabled:!0,soundProfile:"default",questProfile:"Horror - Nightmare",questGatingEnabled:!0,questPool:[{questId:"quest_defeat_5",chance:90},{questId:"quest_explore_75",chance:80},{questId:"quest_find_secret",chance:70},{questId:"quest_survive_combat",chance:80},{questId:"quest_boss_slayer",chance:60},{questId:"quest_full_clear",chance:40}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","execute","minionBane","portalStone","mapFragment","voidWalk","timeShard","healingPotion","elixir","revivalCharm","heartCrystal","torch","lantern","revealScroll","sightPotion","crystalBall","ironGuard","weapon_rusty_sword","weapon_iron_sword","weapon_enchanted_blade","weapon_shadow_dagger","weapon_steel_blade","armor_leather","armor_chainmail","armor_plate","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","accessory_vampiric_pendant","repairKit"]}},"Hell's Threshold":{gridSize:16,floors:5,difficulty:"apocalypse",theme:"horror",mapStyle:"hospital",mapVisibility:"hideUnexplored",winCommand:"/echo IMPOSSIBLE! You escaped the abyss!",loseCommand:"/echo Your soul is claimed forever...",winMessage:"LEGENDARY! You survived the apocalypse nightmare!",winImage:"",mainMinion:"horror_demon",mainMinionIntroMessage:"Welcome to hell. Population: soon to include you.",mainMinionRandomChance:35,mainMinionRandomMessages:["YOUR SOUL IS MINE!","THERE IS NO GOD HERE!","EMBRACE THE VOID!"],mainMinionExitType:"turnbased",mainMinionExitProfile:"Horror - Apocalypse",minionEncounters:[{minionId:"horror_wraith",percent:3,zoneMin:0,zoneMax:1},{minionId:"horror_butcher",percent:4,zoneMin:1,zoneMax:2},{minionId:"horror_crawler",percent:4,zoneMin:2,zoneMax:3},{minionId:"horror_demon",percent:3,zoneMin:3,zoneMax:4}],trapEncounters:[{trapId:"ghostly_grasp",percent:5},{trapId:"blood_pool",percent:5},{trapId:"cursed_mirror",percent:4}],onBattlebarLoss:"gameover",chestTilePercent:4,chestLockedPercent:60,chestLockedBonusPercent:80,chestMimicPercent:35,chestLootMin:1,chestLootMax:1,chestKeyChance:20,chestStrikeChance:30,chestStealthChance:15,chestExecuteChance:5,lockedChestKeyChance:15,lockedChestStrikeChance:45,lockedChestStealthChance:25,lockedChestExecuteChance:12,startingInventory:{key:1,strike:0,stealth:0,execute:0,healingPotion:0,greaterHealing:0,elixir:0,revivalCharm:0,ironGuard:1},hpEnabled:!0,maxHP:60,battlebarDamageMultiplier:2,onDeath:"gameover",respawnHPPercent:0,safeRoomCount:1,safeRoomHealPercent:40,safeRoomUseLLM:!0,restEnabled:!0,restHealPercent:5,restCooldown:6,restInterruptChance:50,restInterruptScript:"",storyConfig:{mainStory:"APOCALYPSE MODE: Five floors of hell itself. Your death is certain. Prove us wrong."},findEarly:{radius:0,items:[],itemsPerChest:0},fairness:{enabled:!1,keyPityThreshold:0,healingPityThreshold:0,lowHpThreshold:0,mercyUnlock:!1,mercyUnlockThreshold:0},bspConfig:{zoneCount:5,secretDensity:.08,zonesRequireClear:!0,clearThreshold:1,secretHints:!1,floorComplexityScaling:!0},safeStartRadius:0,visionProfile:"survival",combatMechanicsProfile:"lethal",factionProfile:"horror",permadeathEnabled:!0,vfxEnabled:!0,soundProfile:"default",questProfile:"Horror - Apocalypse",questGatingEnabled:!0,questPool:[{questId:"quest_defeat_5",chance:100},{questId:"quest_explore_75",chance:90},{questId:"quest_find_secret",chance:80},{questId:"quest_survive_combat",chance:90},{questId:"quest_boss_slayer",chance:70},{questId:"quest_full_clear",chance:60}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","execute","minionBane","portalStone","mapFragment","voidWalk","timeShard","healingPotion","greaterHealing","elixir","revivalCharm","heartCrystal","torch","lantern","revealScroll","sightPotion","crystalBall","ironGuard","weapon_rusty_sword","weapon_iron_sword","weapon_enchanted_blade","weapon_shadow_dagger","weapon_steel_blade","armor_leather","armor_chainmail","armor_plate","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","accessory_vampiric_pendant","repairKit"]}},"Station Orientation":{gridSize:8,floors:1,difficulty:"easy",theme:"scifi",mapStyle:"spacestation",mapVisibility:"showAll",winCommand:"/echo Mission complete. Extraction successful.",loseCommand:"/echo Hull breach detected. Life signs terminated.",winMessage:"You reached the escape pods and evacuated safely!",winImage:"",mainMinion:"scifi_bot",mainMinionIntroMessage:"WELCOME ABOARD. PROCEED TO DESIGNATED EXIT POINT.",mainMinionRandomChance:15,mainMinionRandomMessages:["SCANNING AREA...","PROCEED WITH CAUTION."],mainMinionExitType:"battlebar",mainMinionExitProfile:"Security Drone",minionEncounters:[{minionId:"scifi_terminal",percent:3,zoneMin:0,zoneMax:1},{minionId:"scifi_ai",percent:2,zoneMin:0,zoneMax:1},{minionId:"scifi_bot",percent:2,zoneMin:1,zoneMax:99}],trapEncounters:[{trapId:"laser_grid",percent:1},{trapId:"gas_leak",percent:1}],onBattlebarLoss:"respawn",chestTilePercent:10,chestLockedPercent:20,chestLockedBonusPercent:50,chestMimicPercent:5,chestLootMin:2,chestLootMax:4,chestKeyChance:40,chestStrikeChance:50,chestStealthChance:20,chestExecuteChance:2,lockedChestKeyChance:30,lockedChestStrikeChance:60,lockedChestStealthChance:30,lockedChestExecuteChance:5,startingInventory:{key:2,strike:2,stealth:1,execute:0,healingPotion:2,greaterHealing:0,elixir:0,revivalCharm:0},hpEnabled:!0,maxHP:130,battlebarDamageMultiplier:.7,onDeath:"respawn",respawnHPPercent:75,safeRoomCount:4,safeRoomHealPercent:100,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:30,restCooldown:2,restInterruptChance:0,restInterruptScript:"",storyConfig:{mainStory:"The station awaits. Navigate to the extraction point..."},findEarly:{radius:5,items:["lantern","torch","healingPotion","mapFragment"],itemsPerChest:2},fairness:{enabled:!0,keyPityThreshold:3,healingPityThreshold:4,lowHpThreshold:.4,mercyUnlock:!0,mercyUnlockThreshold:2},bspConfig:{zoneCount:2,secretDensity:.02,zonesRequireClear:!0,clearThreshold:.5,secretHints:!0,floorComplexityScaling:!1},safeStartRadius:3,visionProfile:"explorer",combatMechanicsProfile:"simple",factionProfile:"scifi",permadeathEnabled:!1,vfxEnabled:!0,soundProfile:"default",questProfile:"Sci-Fi - Easy",questGatingEnabled:!0,questPool:[{questId:"quest_collect_keys",chance:80},{questId:"quest_defeat_5",chance:60},{questId:"quest_treasure_hunter",chance:70}],itemPool:{enabled:!0,items:["key","strike","stealth","healingPotion","greaterHealing","torch","lantern","mapFragment","weapon_rusty_sword","weapon_iron_sword","armor_leather","accessory_ring_power","repairKit"]}},"Lockdown Protocol":{gridSize:10,floors:2,difficulty:"normal",theme:"scifi",mapStyle:"spacestation",mapVisibility:"fogOfWar",winCommand:"/echo Mission complete. Extraction successful.",loseCommand:"/echo Hull breach detected. Life signs terminated.",winMessage:"You reached the escape pods and evacuated safely!",winImage:"",mainMinion:"scifi_bot",mainMinionIntroMessage:"UNAUTHORIZED PERSONNEL DETECTED. INITIATING LOCKDOWN.",mainMinionRandomChance:20,mainMinionRandomMessages:["SCANNING... THREAT LEVEL ELEVATED.","SECURITY PROTOCOLS ACTIVE."],mainMinionExitType:"battlebar",mainMinionExitProfile:"Security Drone",minionEncounters:[{minionId:"scifi_terminal",percent:2,zoneMin:0,zoneMax:1},{minionId:"scifi_ai",percent:2,zoneMin:0,zoneMax:1},{minionId:"scifi_bot",percent:3,zoneMin:1,zoneMax:2},{minionId:"scifi_sensors",percent:2,zoneMin:1,zoneMax:2},{minionId:"scifi_commander",percent:1,zoneMin:2,zoneMax:99}],trapEncounters:[{trapId:"laser_grid",percent:2},{trapId:"gas_leak",percent:2}],onBattlebarLoss:"respawn",chestTilePercent:8,chestLockedPercent:30,chestLockedBonusPercent:50,chestMimicPercent:10,chestLootMin:1,chestLootMax:3,chestKeyChance:35,chestStrikeChance:45,chestStealthChance:20,chestExecuteChance:3,lockedChestKeyChance:25,lockedChestStrikeChance:55,lockedChestStealthChance:25,lockedChestExecuteChance:7,startingInventory:{key:1,strike:1,stealth:0,execute:0,healingPotion:1,greaterHealing:0,elixir:0,revivalCharm:0},hpEnabled:!0,maxHP:100,battlebarDamageMultiplier:1,onDeath:"respawn",respawnHPPercent:50,safeRoomCount:3,safeRoomHealPercent:100,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:20,restCooldown:3,restInterruptChance:15,restInterruptScript:"",storyConfig:{mainStory:"The station alarms blare. Find the escape pods before it's too late..."},findEarly:{radius:4,items:["torch","healingPotion","mapFragment"],itemsPerChest:1},fairness:{enabled:!0,keyPityThreshold:4,healingPityThreshold:5,lowHpThreshold:.35,mercyUnlock:!0,mercyUnlockThreshold:3},bspConfig:{zoneCount:3,secretDensity:.04,zonesRequireClear:!0,clearThreshold:.75,secretHints:!0,floorComplexityScaling:!0},safeStartRadius:2,visionProfile:"default",combatMechanicsProfile:"default",factionProfile:"scifi",permadeathEnabled:!1,vfxEnabled:!0,soundProfile:"default",questProfile:"Sci-Fi - Normal",questGatingEnabled:!0,questPool:[{questId:"quest_collect_keys",chance:70},{questId:"quest_defeat_5",chance:80},{questId:"quest_explore_75",chance:60},{questId:"quest_treasure_hunter",chance:50}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","minionBane","portalStone","mapFragment","timeShard","healingPotion","greaterHealing","elixir","torch","lantern","revealScroll","sightPotion","weapon_rusty_sword","weapon_iron_sword","weapon_shadow_dagger","armor_leather","armor_chainmail","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","repairKit"]}},"Rogue AI Uprising":{gridSize:12,floors:3,difficulty:"hard",theme:"scifi",mapStyle:"spacestation",mapVisibility:"hideUnexplored",winCommand:"/echo EXTRACTION COMPLETE. WELL DONE, OPERATIVE.",loseCommand:"/echo MISSION FAILED. ASSET TERMINATED.",winMessage:"Against impossible odds, you escaped the derelict station!",winImage:"",mainMinion:"scifi_commander",mainMinionIntroMessage:"CRITICAL ALERT: HOSTILE AI HAS TAKEN CONTROL.",mainMinionRandomChance:25,mainMinionRandomMessages:["RESISTANCE IS FUTILE.","ALL SECTORS COMPROMISED."],mainMinionExitType:"turnbased",mainMinionExitProfile:"System Override",minionEncounters:[{minionId:"scifi_bot",percent:2,zoneMin:0,zoneMax:1},{minionId:"scifi_sensors",percent:3,zoneMin:1,zoneMax:2},{minionId:"scifi_terminal_puzzle",percent:2,zoneMin:1,zoneMax:2},{minionId:"scifi_commander",percent:3,zoneMin:2,zoneMax:3},{minionId:"scifi_mech",percent:2,zoneMin:3,zoneMax:99}],trapEncounters:[{trapId:"laser_grid",percent:3},{trapId:"gas_leak",percent:3},{trapId:"gravity_trap",percent:2}],onBattlebarLoss:"respawn",chestTilePercent:6,chestLockedPercent:40,chestLockedBonusPercent:60,chestMimicPercent:15,chestLootMin:1,chestLootMax:2,chestKeyChance:30,chestStrikeChance:40,chestStealthChance:15,chestExecuteChance:4,lockedChestKeyChance:25,lockedChestStrikeChance:50,lockedChestStealthChance:25,lockedChestExecuteChance:8,startingInventory:{key:1,strike:0,stealth:0,execute:0,healingPotion:1,greaterHealing:0,elixir:0,revivalCharm:0},hpEnabled:!0,maxHP:80,battlebarDamageMultiplier:1.3,onDeath:"respawnPenalty",respawnHPPercent:40,safeRoomCount:2,safeRoomHealPercent:75,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:15,restCooldown:4,restInterruptChance:25,restInterruptScript:"",storyConfig:{mainStory:"Three decks. Rogue AI. Failing life support. Move fast or die..."},findEarly:{radius:3,items:["torch","healingPotion"],itemsPerChest:1},fairness:{enabled:!0,keyPityThreshold:5,healingPityThreshold:6,lowHpThreshold:.3,mercyUnlock:!1,mercyUnlockThreshold:0},bspConfig:{zoneCount:4,secretDensity:.05,zonesRequireClear:!0,clearThreshold:.9,secretHints:!1,floorComplexityScaling:!0},safeStartRadius:1,visionProfile:"survival",combatMechanicsProfile:"default",factionProfile:"scifi",permadeathEnabled:!1,vfxEnabled:!0,soundProfile:"default",questProfile:"Sci-Fi - Hard",questGatingEnabled:!0,questPool:[{questId:"quest_defeat_5",chance:80},{questId:"quest_explore_75",chance:70},{questId:"quest_find_secret",chance:60},{questId:"quest_survive_combat",chance:70},{questId:"quest_boss_slayer",chance:50}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","execute","minionBane","portalStone","mapFragment","voidWalk","timeShard","healingPotion","greaterHealing","elixir","revivalCharm","torch","lantern","revealScroll","sightPotion","crystalBall","ironGuard","weapon_rusty_sword","weapon_iron_sword","weapon_enchanted_blade","weapon_shadow_dagger","armor_leather","armor_chainmail","armor_plate","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","accessory_vampiric_pendant","repairKit"]}},"Total System Failure":{gridSize:14,floors:4,difficulty:"nightmare",theme:"scifi",mapStyle:"spacestation",mapVisibility:"hideUnexplored",winCommand:"/echo IMPOSSIBLE MISSION COMPLETED. YOU ARE A LEGEND.",loseCommand:"/echo TOTAL SYSTEM FAILURE. NO SURVIVORS.",winMessage:"You escaped the nightmare station! A true survivor!",winImage:"",mainMinion:"scifi_mech",mainMinionIntroMessage:"STATION CONTAINMENT BREACHED. EXTERMINATION PROTOCOL ACTIVE.",mainMinionRandomChance:30,mainMinionRandomMessages:["TERMINATE ALL HOSTILES.","NO ESCAPE DETECTED.","DEATH IMMINENT."],mainMinionExitType:"turnbased",mainMinionExitProfile:"Sci-Fi - Nightmare",minionEncounters:[{minionId:"scifi_sensors",percent:2,zoneMin:0,zoneMax:1},{minionId:"scifi_commander",percent:3,zoneMin:1,zoneMax:2},{minionId:"scifi_mech",percent:3,zoneMin:2,zoneMax:3},{minionId:"scifi_drone",percent:3,zoneMin:3,zoneMax:99},{minionId:"scifi_quantum",percent:2,zoneMin:3,zoneMax:99}],trapEncounters:[{trapId:"laser_grid",percent:4},{trapId:"gas_leak",percent:4},{trapId:"gravity_trap",percent:3}],onBattlebarLoss:"gameover",chestTilePercent:5,chestLockedPercent:50,chestLockedBonusPercent:70,chestMimicPercent:25,chestLootMin:1,chestLootMax:2,chestKeyChance:25,chestStrikeChance:35,chestStealthChance:15,chestExecuteChance:5,lockedChestKeyChance:20,lockedChestStrikeChance:50,lockedChestStealthChance:25,lockedChestExecuteChance:10,startingInventory:{key:1,strike:0,stealth:0,execute:0,healingPotion:0,greaterHealing:0,elixir:0,revivalCharm:0,ironGuard:1},hpEnabled:!0,maxHP:70,battlebarDamageMultiplier:1.5,onDeath:"gameover",respawnHPPercent:25,safeRoomCount:2,safeRoomHealPercent:60,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:10,restCooldown:5,restInterruptChance:35,restInterruptScript:"",storyConfig:{mainStory:"Station Prometheus has gone dark. Every system has failed. The AI core has gone rogue and sealed all bulkheads. You have four decks of pure nightmare between you and the last escape pod."},findEarly:{radius:2,items:["torch"],itemsPerChest:1},fairness:{enabled:!1,keyPityThreshold:0,healingPityThreshold:0,lowHpThreshold:0,mercyUnlock:!1,mercyUnlockThreshold:0},bspConfig:{zoneCount:4,secretDensity:.06,zonesRequireClear:!0,clearThreshold:1,secretHints:!1,floorComplexityScaling:!0},safeStartRadius:0,visionProfile:"survival",combatMechanicsProfile:"aggressive",factionProfile:"scifi",permadeathEnabled:!0,vfxEnabled:!0,soundProfile:"default",questProfile:"Sci-Fi - Nightmare",questGatingEnabled:!0,questPool:[{questId:"quest_defeat_5",chance:90},{questId:"quest_explore_75",chance:80},{questId:"quest_find_secret",chance:70},{questId:"quest_survive_combat",chance:80},{questId:"quest_boss_slayer",chance:60},{questId:"quest_full_clear",chance:40}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","execute","minionBane","portalStone","mapFragment","voidWalk","timeShard","healingPotion","elixir","revivalCharm","heartCrystal","torch","lantern","revealScroll","sightPotion","crystalBall","ironGuard","weapon_rusty_sword","weapon_iron_sword","weapon_enchanted_blade","weapon_shadow_dagger","weapon_steel_blade","armor_leather","armor_chainmail","armor_plate","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","accessory_vampiric_pendant","repairKit"]}},"Extinction Event":{gridSize:16,floors:5,difficulty:"apocalypse",theme:"scifi",mapStyle:"spacestation",mapVisibility:"hideUnexplored",winCommand:"/echo LEGENDARY ACHIEVEMENT UNLOCKED. THE IMPOSSIBLE MADE POSSIBLE.",loseCommand:"/echo STATION LOST. OPERATIVE TERMINATED.",winMessage:"LEGENDARY! You escaped the apocalypse station!",winImage:"",mainMinion:"scifi_quantum",mainMinionIntroMessage:"APOCALYPSE PROTOCOL INITIATED. SURVIVAL PROBABILITY: 0.001%",mainMinionRandomChance:35,mainMinionRandomMessages:["RESISTANCE IS ILLOGICAL.","YOUR ATOMS WILL BE RECYCLED.","END SEQUENCE INITIATED."],mainMinionExitType:"turnbased",mainMinionExitProfile:"Sci-Fi - Apocalypse",minionEncounters:[{minionId:"scifi_commander",percent:3,zoneMin:0,zoneMax:1},{minionId:"scifi_mech",percent:4,zoneMin:1,zoneMax:2},{minionId:"scifi_drone",percent:4,zoneMin:2,zoneMax:3},{minionId:"scifi_quantum",percent:3,zoneMin:3,zoneMax:4}],trapEncounters:[{trapId:"laser_grid",percent:5},{trapId:"gas_leak",percent:5},{trapId:"gravity_trap",percent:4}],onBattlebarLoss:"gameover",chestTilePercent:4,chestLockedPercent:60,chestLockedBonusPercent:80,chestMimicPercent:35,chestLootMin:1,chestLootMax:1,chestKeyChance:20,chestStrikeChance:30,chestStealthChance:10,chestExecuteChance:5,lockedChestKeyChance:15,lockedChestStrikeChance:45,lockedChestStealthChance:20,lockedChestExecuteChance:12,startingInventory:{key:1,strike:0,stealth:0,execute:0,healingPotion:0,greaterHealing:0,elixir:0,revivalCharm:0,ironGuard:1},hpEnabled:!0,maxHP:60,battlebarDamageMultiplier:2,onDeath:"gameover",respawnHPPercent:0,safeRoomCount:1,safeRoomHealPercent:40,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:5,restCooldown:6,restInterruptChance:50,restInterruptScript:"",storyConfig:{mainStory:"The station has been quarantined. Inside, an extinction-level xenomorph has awakened. Five decks stand between you and the self-destruct override. No one has ever returned from EXTINCTION EVENT."},findEarly:{radius:0,items:[],itemsPerChest:0},fairness:{enabled:!1,keyPityThreshold:0,healingPityThreshold:0,lowHpThreshold:0,mercyUnlock:!1,mercyUnlockThreshold:0},bspConfig:{zoneCount:5,secretDensity:.08,zonesRequireClear:!0,clearThreshold:1,secretHints:!1,floorComplexityScaling:!0},safeStartRadius:0,visionProfile:"survival",combatMechanicsProfile:"lethal",factionProfile:"scifi",permadeathEnabled:!0,vfxEnabled:!0,soundProfile:"default",questProfile:"Sci-Fi - Apocalypse",questGatingEnabled:!0,questPool:[{questId:"quest_defeat_5",chance:100},{questId:"quest_explore_75",chance:90},{questId:"quest_find_secret",chance:80},{questId:"quest_survive_combat",chance:90},{questId:"quest_boss_slayer",chance:70},{questId:"quest_full_clear",chance:60}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","execute","minionBane","portalStone","mapFragment","voidWalk","timeShard","healingPotion","greaterHealing","elixir","revivalCharm","heartCrystal","torch","lantern","revealScroll","sightPotion","crystalBall","ironGuard","weapon_rusty_sword","weapon_iron_sword","weapon_enchanted_blade","weapon_shadow_dagger","weapon_steel_blade","armor_leather","armor_chainmail","armor_plate","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","accessory_vampiric_pendant","repairKit"]}},"Neon Streets":{gridSize:8,floors:1,difficulty:"easy",theme:"cyberpunk",mapStyle:"neotokyo",mapVisibility:"showAll",winCommand:"/echo Run complete. Easy payout, choom.",loseCommand:"/echo Flatlined. Better luck next time.",winMessage:"You navigated the neon streets successfully!",winImage:"",mainMinion:"cyber_fixer",mainMinionIntroMessage:"Hey choom, new to the grid? Let me show you around.",mainMinionRandomChance:15,mainMinionRandomMessages:["Stay low, stay alive.","The corps are watching."],mainMinionExitType:"battlebar",mainMinionExitProfile:"Street Fight",minionEncounters:[{minionId:"cyber_market",percent:3,zoneMin:0,zoneMax:1},{minionId:"cyber_fixer",percent:2,zoneMin:0,zoneMax:1},{minionId:"cyber_enforcer",percent:2,zoneMin:1,zoneMax:99}],trapEncounters:[{trapId:"electric_floor",percent:1},{trapId:"neural_spike",percent:1}],onBattlebarLoss:"respawn",chestTilePercent:10,chestLockedPercent:20,chestLockedBonusPercent:50,chestMimicPercent:5,chestLootMin:2,chestLootMax:4,chestKeyChance:40,chestStrikeChance:50,chestStealthChance:20,chestExecuteChance:2,lockedChestKeyChance:30,lockedChestStrikeChance:60,lockedChestStealthChance:30,lockedChestExecuteChance:5,startingInventory:{key:2,strike:2,stealth:1,execute:0,healingPotion:2,greaterHealing:0,elixir:0,revivalCharm:0},hpEnabled:!0,maxHP:130,battlebarDamageMultiplier:.7,onDeath:"respawn",respawnHPPercent:75,safeRoomCount:4,safeRoomHealPercent:100,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:30,restCooldown:2,restInterruptChance:10,restInterruptScript:"",storyConfig:{mainStory:"Welcome to Night City, choom. The neon-drenched streets are full of opportunityand danger. A simple courier run awaits. Easy eddies for a new runner."},findEarly:{radius:5,items:["lantern","torch","healingPotion","mapFragment"],itemsPerChest:2},fairness:{enabled:!0,keyPityThreshold:3,healingPityThreshold:4,lowHpThreshold:.4,mercyUnlock:!0,mercyUnlockThreshold:2},bspConfig:{zoneCount:2,secretDensity:.02,zonesRequireClear:!0,clearThreshold:.5,secretHints:!0,floorComplexityScaling:!1},safeStartRadius:3,visionProfile:"explorer",combatMechanicsProfile:"simple",factionProfile:"cyberpunk",permadeathEnabled:!1,vfxEnabled:!0,soundProfile:"default",questProfile:"Cyberpunk - Easy",questGatingEnabled:!0,questPool:[{questId:"quest_collect_keys",chance:80},{questId:"quest_defeat_5",chance:60},{questId:"quest_treasure_hunter",chance:70}],itemPool:{enabled:!0,items:["key","strike","stealth","healingPotion","greaterHealing","torch","lantern","mapFragment","weapon_rusty_sword","weapon_iron_sword","armor_leather","accessory_ring_power","repairKit"]}},"Corporate Heist":{gridSize:10,floors:2,difficulty:"normal",theme:"cyberpunk",mapStyle:"neotokyo",mapVisibility:"fogOfWar",winCommand:"/echo Run complete. Payout received, choom.",loseCommand:"/echo Flatlined. Your chrome belongs to the corp now.",winMessage:"You made it through the neon jungle!",winImage:"",mainMinion:"cyber_enforcer",mainMinionIntroMessage:"You picked the wrong sector to run through, meat.",mainMinionRandomChance:20,mainMinionRandomMessages:["Corp knows you're here.","No one escapes the grid."],mainMinionExitType:"battlebar",mainMinionExitProfile:"Street Fight",minionEncounters:[{minionId:"cyber_market",percent:2,zoneMin:0,zoneMax:1},{minionId:"cyber_fixer",percent:2,zoneMin:0,zoneMax:1},{minionId:"cyber_enforcer",percent:3,zoneMin:1,zoneMax:2},{minionId:"cyber_patrol",percent:2,zoneMin:1,zoneMax:2},{minionId:"cyber_samurai",percent:1,zoneMin:2,zoneMax:99}],trapEncounters:[{trapId:"electric_floor",percent:2},{trapId:"neural_spike",percent:2}],onBattlebarLoss:"respawn",chestTilePercent:8,chestLockedPercent:30,chestLockedBonusPercent:50,chestMimicPercent:10,chestLootMin:1,chestLootMax:3,chestKeyChance:35,chestStrikeChance:45,chestStealthChance:20,chestExecuteChance:3,lockedChestKeyChance:25,lockedChestStrikeChance:55,lockedChestStealthChance:25,lockedChestExecuteChance:7,startingInventory:{key:1,strike:1,stealth:0,execute:0,healingPotion:1,greaterHealing:0,elixir:0,revivalCharm:0},hpEnabled:!0,maxHP:100,battlebarDamageMultiplier:1,onDeath:"respawn",respawnHPPercent:50,safeRoomCount:3,safeRoomHealPercent:100,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:20,restCooldown:3,restInterruptChance:20,restInterruptScript:"",storyConfig:{mainStory:"Militech Tower holds the prototype. Your fixer says it's worth a fortune. Two floors of corporate security stand between you and the biggest score of your career."},findEarly:{radius:4,items:["torch","healingPotion","mapFragment"],itemsPerChest:1},fairness:{enabled:!0,keyPityThreshold:4,healingPityThreshold:5,lowHpThreshold:.35,mercyUnlock:!0,mercyUnlockThreshold:3},bspConfig:{zoneCount:3,secretDensity:.04,zonesRequireClear:!0,clearThreshold:.75,secretHints:!0,floorComplexityScaling:!0},safeStartRadius:2,visionProfile:"default",combatMechanicsProfile:"default",factionProfile:"cyberpunk",permadeathEnabled:!1,vfxEnabled:!0,soundProfile:"default",questProfile:"Cyberpunk - Normal",questGatingEnabled:!0,questPool:[{questId:"quest_collect_keys",chance:70},{questId:"quest_defeat_5",chance:80},{questId:"quest_explore_75",chance:60},{questId:"quest_treasure_hunter",chance:50}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","minionBane","portalStone","mapFragment","timeShard","healingPotion","greaterHealing","elixir","torch","lantern","revealScroll","sightPotion","weapon_rusty_sword","weapon_iron_sword","weapon_shadow_dagger","armor_leather","armor_chainmail","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","repairKit"]}},"Syndicate Takedown":{gridSize:12,floors:3,difficulty:"hard",theme:"cyberpunk",mapStyle:"city",mapVisibility:"hideUnexplored",winCommand:"/echo Preem work, choom. You're making a name.",loseCommand:"/echo Flatlined. The streets claim another.",winMessage:"You survived the corporate kill squads!",winImage:"",mainMinion:"cyber_boss",mainMinionIntroMessage:"Corporate has authorized lethal force. Good luck, meat.",mainMinionRandomChance:25,mainMinionRandomMessages:["Your biosigns are being tracked.","Every exit is covered."],mainMinionExitType:"turnbased",mainMinionExitProfile:"Cyberpunk - Hard",minionEncounters:[{minionId:"cyber_enforcer",percent:2,zoneMin:0,zoneMax:1},{minionId:"cyber_patrol",percent:3,zoneMin:1,zoneMax:2},{minionId:"cyber_ice",percent:2,zoneMin:1,zoneMax:2},{minionId:"cyber_samurai",percent:3,zoneMin:2,zoneMax:3},{minionId:"cyber_boss",percent:2,zoneMin:3,zoneMax:99}],trapEncounters:[{trapId:"electric_floor",percent:3},{trapId:"neural_spike",percent:3},{trapId:"security_turret",percent:2}],onBattlebarLoss:"respawn",chestTilePercent:6,chestLockedPercent:40,chestLockedBonusPercent:60,chestMimicPercent:15,chestLootMin:1,chestLootMax:2,chestKeyChance:30,chestStrikeChance:40,chestStealthChance:15,chestExecuteChance:4,lockedChestKeyChance:25,lockedChestStrikeChance:50,lockedChestStealthChance:25,lockedChestExecuteChance:8,startingInventory:{key:1,strike:0,stealth:0,execute:0,healingPotion:1,greaterHealing:0,elixir:0,revivalCharm:0},hpEnabled:!0,maxHP:80,battlebarDamageMultiplier:1.3,onDeath:"respawnPenalty",respawnHPPercent:50,safeRoomCount:2,safeRoomHealPercent:75,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:15,restCooldown:4,restInterruptChance:30,restInterruptScript:"",storyConfig:{mainStory:"The Tyger Claws have put a bounty on your head. Three floors of gang territory stand between you and the only safe extract point. Kill squads are mobilizing."},findEarly:{radius:3,items:["torch","healingPotion"],itemsPerChest:1},fairness:{enabled:!0,keyPityThreshold:5,healingPityThreshold:6,lowHpThreshold:.3,mercyUnlock:!1,mercyUnlockThreshold:0},bspConfig:{zoneCount:4,secretDensity:.05,zonesRequireClear:!0,clearThreshold:.9,secretHints:!1,floorComplexityScaling:!0},safeStartRadius:1,visionProfile:"survival",combatMechanicsProfile:"default",factionProfile:"cyberpunk",permadeathEnabled:!1,vfxEnabled:!0,soundProfile:"default",questProfile:"Cyberpunk - Hard",questGatingEnabled:!0,questPool:[{questId:"quest_defeat_5",chance:80},{questId:"quest_explore_75",chance:70},{questId:"quest_find_secret",chance:60},{questId:"quest_survive_combat",chance:70},{questId:"quest_boss_slayer",chance:50}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","execute","minionBane","portalStone","mapFragment","voidWalk","timeShard","healingPotion","greaterHealing","elixir","revivalCharm","torch","lantern","revealScroll","sightPotion","crystalBall","ironGuard","weapon_rusty_sword","weapon_iron_sword","weapon_enchanted_blade","weapon_shadow_dagger","armor_leather","armor_chainmail","armor_plate","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","accessory_vampiric_pendant","repairKit"]}},"Blacksite Infiltration":{gridSize:14,floors:4,difficulty:"nightmare",theme:"cyberpunk",mapStyle:"city",mapVisibility:"hideUnexplored",winCommand:"/echo Preem run, choom. You're a legend now.",loseCommand:"/echo Game over. No continues.",winMessage:"LEGENDARY! You survived the nightmare streets!",winImage:"",mainMinion:"cyber_netrunner",mainMinionIntroMessage:"Full corpo lockdown. Every camera, every drone, every turret. You're dead.",mainMinionRandomChance:30,mainMinionRandomMessages:["Neural tracking active.","FLATLINE IMMINENT.","No escape."],mainMinionExitType:"turnbased",mainMinionExitProfile:"Cyberpunk - Nightmare",minionEncounters:[{minionId:"cyber_patrol",percent:2,zoneMin:0,zoneMax:1},{minionId:"cyber_samurai",percent:3,zoneMin:1,zoneMax:2},{minionId:"cyber_boss",percent:3,zoneMin:2,zoneMax:3},{minionId:"cyber_netrunner",percent:3,zoneMin:3,zoneMax:99},{minionId:"cyber_ripperdoc",percent:2,zoneMin:3,zoneMax:99}],trapEncounters:[{trapId:"electric_floor",percent:4},{trapId:"neural_spike",percent:4},{trapId:"security_turret",percent:3}],onBattlebarLoss:"gameover",chestTilePercent:5,chestLockedPercent:50,chestLockedBonusPercent:70,chestMimicPercent:25,chestLootMin:1,chestLootMax:2,chestKeyChance:25,chestStrikeChance:35,chestStealthChance:20,chestExecuteChance:5,lockedChestKeyChance:20,lockedChestStrikeChance:50,lockedChestStealthChance:30,lockedChestExecuteChance:10,startingInventory:{key:1,strike:0,stealth:0,execute:0,healingPotion:0,greaterHealing:0,elixir:0,revivalCharm:0,ironGuard:1},hpEnabled:!0,maxHP:70,battlebarDamageMultiplier:1.5,onDeath:"gameover",respawnHPPercent:25,safeRoomCount:2,safeRoomHealPercent:60,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:10,restCooldown:5,restInterruptChance:40,restInterruptScript:"",storyConfig:{mainStory:"Arasaka's blacksite. No one knows it exists. No one who enters has ever left. Four floors of classified nightmares guard the data that could topple the megacorps forever."},findEarly:{radius:2,items:["torch"],itemsPerChest:1},fairness:{enabled:!1,keyPityThreshold:0,healingPityThreshold:0,lowHpThreshold:0,mercyUnlock:!1,mercyUnlockThreshold:0},bspConfig:{zoneCount:4,secretDensity:.06,zonesRequireClear:!0,clearThreshold:1,secretHints:!1,floorComplexityScaling:!0},safeStartRadius:0,visionProfile:"survival",combatMechanicsProfile:"aggressive",factionProfile:"cyberpunk",permadeathEnabled:!0,vfxEnabled:!0,soundProfile:"default",questProfile:"Cyberpunk - Nightmare",questGatingEnabled:!0,questPool:[{questId:"quest_defeat_5",chance:90},{questId:"quest_explore_75",chance:80},{questId:"quest_find_secret",chance:70},{questId:"quest_survive_combat",chance:80},{questId:"quest_boss_slayer",chance:60},{questId:"quest_full_clear",chance:40}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","execute","minionBane","portalStone","mapFragment","voidWalk","timeShard","healingPotion","elixir","revivalCharm","heartCrystal","torch","lantern","revealScroll","sightPotion","crystalBall","ironGuard","weapon_rusty_sword","weapon_iron_sword","weapon_enchanted_blade","weapon_shadow_dagger","weapon_steel_blade","armor_leather","armor_chainmail","armor_plate","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","accessory_vampiric_pendant","repairKit"]}},"Night City Apocalypse":{gridSize:16,floors:5,difficulty:"apocalypse",theme:"cyberpunk",mapStyle:"city",mapVisibility:"hideUnexplored",winCommand:"/echo LEGENDARY RUN COMPLETE. YOU ARE THE NIGHT CITY CHAMPION.",loseCommand:"/echo TOTAL FLATLINE. YOUR MEMORY WILL BE ERASED.",winMessage:"LEGENDARY! You escaped the apocalypse city! Your name echoes through the datastreams!",winImage:"",mainMinion:"cyber_ripperdoc",mainMinionIntroMessage:"APOCALYPSE MODE: Five sectors. Full lockdown. Zero mercy. Prove you deserve to live.",mainMinionRandomChance:35,mainMinionRandomMessages:["YOUR DEATH IS CERTAIN.","RESISTANCE: FUTILE.","FLATLINE IN PROGRESS."],mainMinionExitType:"turnbased",mainMinionExitProfile:"Cyberpunk - Apocalypse",minionEncounters:[{minionId:"cyber_samurai",percent:3,zoneMin:0,zoneMax:1},{minionId:"cyber_boss",percent:4,zoneMin:1,zoneMax:2},{minionId:"cyber_netrunner",percent:4,zoneMin:2,zoneMax:3},{minionId:"cyber_ripperdoc",percent:3,zoneMin:3,zoneMax:4}],trapEncounters:[{trapId:"electric_floor",percent:5},{trapId:"neural_spike",percent:5},{trapId:"security_turret",percent:4}],onBattlebarLoss:"gameover",chestTilePercent:4,chestLockedPercent:60,chestLockedBonusPercent:80,chestMimicPercent:35,chestLootMin:1,chestLootMax:1,chestKeyChance:20,chestStrikeChance:30,chestStealthChance:10,chestExecuteChance:5,lockedChestKeyChance:15,lockedChestStrikeChance:45,lockedChestStealthChance:20,lockedChestExecuteChance:12,startingInventory:{key:1,strike:0,stealth:0,execute:0,healingPotion:0,greaterHealing:0,elixir:0,revivalCharm:0,ironGuard:1},hpEnabled:!0,maxHP:60,battlebarDamageMultiplier:2,onDeath:"gameover",respawnHPPercent:0,safeRoomCount:1,safeRoomHealPercent:40,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:5,restCooldown:6,restInterruptChance:50,restInterruptScript:"",storyConfig:{mainStory:"Night City has fallen. Every gang, every corp, every AI has unified against you. Five sectors of pure annihilation. No one believes survival is possible. Prove them wrong, legend."},findEarly:{radius:0,items:[],itemsPerChest:0},fairness:{enabled:!1,keyPityThreshold:0,healingPityThreshold:0,lowHpThreshold:0,mercyUnlock:!1,mercyUnlockThreshold:0},bspConfig:{zoneCount:5,secretDensity:.08,zonesRequireClear:!0,clearThreshold:1,secretHints:!1,floorComplexityScaling:!0},safeStartRadius:0,visionProfile:"survival",combatMechanicsProfile:"lethal",factionProfile:"cyberpunk",permadeathEnabled:!0,vfxEnabled:!0,soundProfile:"default",questProfile:"Cyberpunk - Apocalypse",questGatingEnabled:!0,questPool:[{questId:"quest_defeat_5",chance:100},{questId:"quest_explore_75",chance:90},{questId:"quest_find_secret",chance:80},{questId:"quest_survive_combat",chance:90},{questId:"quest_boss_slayer",chance:70},{questId:"quest_full_clear",chance:60}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","execute","minionBane","portalStone","mapFragment","voidWalk","timeShard","healingPotion","greaterHealing","elixir","revivalCharm","heartCrystal","torch","lantern","revealScroll","sightPotion","crystalBall","ironGuard","weapon_rusty_sword","weapon_iron_sword","weapon_enchanted_blade","weapon_shadow_dagger","weapon_steel_blade","armor_leather","armor_chainmail","armor_plate","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","accessory_vampiric_pendant","repairKit"]}},"Dusty Trail":{gridSize:8,floors:1,difficulty:"easy",theme:"western",mapStyle:"outpost",mapVisibility:"showAll",winCommand:"/echo You ride off into the sunset, partner.",loseCommand:"/echo This town wasn't big enough for the both of ya.",winMessage:"You cleared the outpost and rode on to new adventures!",winImage:"",mainMinion:"western_outlaw",mainMinionIntroMessage:"Howdy, stranger. Welcome to the frontier.",mainMinionRandomChance:15,mainMinionRandomMessages:["Keep your eyes peeled, partner.","The frontier is wild but fair."],mainMinionExitType:"battlebar",mainMinionExitProfile:"Showdown",minionEncounters:[{minionId:"western_crier",percent:3,zoneMin:0,zoneMax:1},{minionId:"western_trader",percent:2,zoneMin:0,zoneMax:1},{minionId:"western_outlaw",percent:2,zoneMin:1,zoneMax:99}],trapEncounters:[{trapId:"bear_trap",percent:1},{trapId:"snake_pit",percent:1}],onBattlebarLoss:"respawn",chestTilePercent:10,chestLockedPercent:20,chestLockedBonusPercent:50,chestMimicPercent:5,chestLootMin:2,chestLootMax:4,chestKeyChance:40,chestStrikeChance:50,chestStealthChance:15,chestExecuteChance:2,lockedChestKeyChance:30,lockedChestStrikeChance:55,lockedChestStealthChance:25,lockedChestExecuteChance:5,startingInventory:{key:2,strike:2,stealth:1,execute:0,healingPotion:2,greaterHealing:0,elixir:0,revivalCharm:0},hpEnabled:!0,maxHP:130,battlebarDamageMultiplier:.7,onDeath:"respawn",respawnHPPercent:75,safeRoomCount:4,safeRoomHealPercent:100,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:30,restCooldown:2,restInterruptChance:5,restInterruptScript:"",storyConfig:{mainStory:"The dusty trail leads to a small frontier outpost. Word is there's gold hidden somewhere in town. Easy pickings for a greenhorn looking to make their name."},findEarly:{radius:5,items:["lantern","torch","healingPotion","mapFragment"],itemsPerChest:2},fairness:{enabled:!0,keyPityThreshold:3,healingPityThreshold:4,lowHpThreshold:.4,mercyUnlock:!0,mercyUnlockThreshold:2},bspConfig:{zoneCount:2,secretDensity:.02,zonesRequireClear:!0,clearThreshold:.5,secretHints:!0,floorComplexityScaling:!1},safeStartRadius:3,visionProfile:"explorer",combatMechanicsProfile:"simple",factionProfile:"western",permadeathEnabled:!1,vfxEnabled:!0,soundProfile:"default",questProfile:"Western - Easy",questGatingEnabled:!0,questPool:[{questId:"quest_collect_keys",chance:80},{questId:"quest_defeat_5",chance:60},{questId:"quest_treasure_hunter",chance:70}],itemPool:{enabled:!0,items:["key","strike","stealth","healingPotion","greaterHealing","torch","lantern","mapFragment","weapon_rusty_sword","weapon_iron_sword","armor_leather","accessory_ring_power","repairKit"]}},"Outlaw Territory":{gridSize:10,floors:2,difficulty:"normal",theme:"western",mapStyle:"outpost",mapVisibility:"fogOfWar",winCommand:"/echo The frontier conquers all but the bravest.",loseCommand:"/echo The west claims another...",winMessage:"You survived the wild west!",winImage:"",mainMinion:"western_sheriff",mainMinionIntroMessage:"Law and order rules these parts, stranger.",mainMinionRandomChance:20,mainMinionRandomMessages:["Justice comes for all.","The frontier has its own rules."],mainMinionExitType:"battlebar",mainMinionExitProfile:"Showdown",minionEncounters:[{minionId:"western_crier",percent:2,zoneMin:0,zoneMax:1},{minionId:"western_trader",percent:2,zoneMin:0,zoneMax:1},{minionId:"western_outlaw",percent:3,zoneMin:1,zoneMax:2},{minionId:"western_posse",percent:2,zoneMin:1,zoneMax:2},{minionId:"western_sheriff",percent:1,zoneMin:2,zoneMax:99}],trapEncounters:[{trapId:"bear_trap",percent:2},{trapId:"snake_pit",percent:2},{trapId:"dynamite",percent:1}],onBattlebarLoss:"respawn",chestTilePercent:8,chestLockedPercent:30,chestLockedBonusPercent:50,chestMimicPercent:10,chestLootMin:1,chestLootMax:3,chestKeyChance:35,chestStrikeChance:45,chestStealthChance:15,chestExecuteChance:3,lockedChestKeyChance:25,lockedChestStrikeChance:55,lockedChestStealthChance:25,lockedChestExecuteChance:7,startingInventory:{key:1,strike:1,stealth:0,execute:0,healingPotion:1,greaterHealing:0,elixir:0,revivalCharm:0},hpEnabled:!0,maxHP:100,battlebarDamageMultiplier:1,onDeath:"respawn",respawnHPPercent:50,safeRoomCount:3,safeRoomHealPercent:100,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:20,restCooldown:3,restInterruptChance:15,restInterruptScript:"",storyConfig:{mainStory:"The Clayton Gang has taken over Redemption Falls. The sheriff is dead, and the townsfolk are hostages. Two territories of lawless territory await someone braveor foolishenough to challenge them."},findEarly:{radius:4,items:["torch","healingPotion","mapFragment"],itemsPerChest:1},fairness:{enabled:!0,keyPityThreshold:4,healingPityThreshold:5,lowHpThreshold:.35,mercyUnlock:!0,mercyUnlockThreshold:3},bspConfig:{zoneCount:3,secretDensity:.04,zonesRequireClear:!0,clearThreshold:.75,secretHints:!0,floorComplexityScaling:!0},safeStartRadius:2,visionProfile:"default",combatMechanicsProfile:"default",factionProfile:"western",permadeathEnabled:!1,vfxEnabled:!0,soundProfile:"default",questProfile:"Western - Normal",questGatingEnabled:!0,questPool:[{questId:"quest_collect_keys",chance:70},{questId:"quest_defeat_5",chance:80},{questId:"quest_explore_75",chance:60},{questId:"quest_treasure_hunter",chance:50}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","minionBane","portalStone","mapFragment","timeShard","healingPotion","greaterHealing","elixir","torch","lantern","revealScroll","sightPotion","weapon_rusty_sword","weapon_iron_sword","weapon_shadow_dagger","armor_leather","armor_chainmail","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","repairKit"]}},"Dead Man's Canyon":{gridSize:12,floors:3,difficulty:"hard",theme:"western",mapStyle:"outpost",mapVisibility:"hideUnexplored",winCommand:"/echo A true gunslinger. The legends will speak of you.",loseCommand:"/echo Boot Hill has a new resident...",winMessage:"You survived the deadliest frontier!",winImage:"",mainMinion:"western_quickdraw",mainMinionIntroMessage:"This territory belongs to the fastest gun. That ain't you.",mainMinionRandomChance:25,mainMinionRandomMessages:["Draw, stranger.","The vultures are circling."],mainMinionExitType:"turnbased",mainMinionExitProfile:"Western - Hard",minionEncounters:[{minionId:"western_outlaw",percent:2,zoneMin:0,zoneMax:1},{minionId:"western_posse",percent:3,zoneMin:1,zoneMax:2},{minionId:"western_safe",percent:2,zoneMin:1,zoneMax:2},{minionId:"western_bandit",percent:3,zoneMin:2,zoneMax:3},{minionId:"western_quickdraw",percent:2,zoneMin:3,zoneMax:99}],trapEncounters:[{trapId:"bear_trap",percent:3},{trapId:"snake_pit",percent:3},{trapId:"dynamite",percent:2}],onBattlebarLoss:"respawn",chestTilePercent:6,chestLockedPercent:40,chestLockedBonusPercent:60,chestMimicPercent:15,chestLootMin:1,chestLootMax:2,chestKeyChance:30,chestStrikeChance:40,chestStealthChance:15,chestExecuteChance:4,lockedChestKeyChance:25,lockedChestStrikeChance:50,lockedChestStealthChance:25,lockedChestExecuteChance:8,startingInventory:{key:1,strike:0,stealth:0,execute:0,healingPotion:1,greaterHealing:0,elixir:0,revivalCharm:0},hpEnabled:!0,maxHP:80,battlebarDamageMultiplier:1.3,onDeath:"respawnPenalty",respawnHPPercent:50,safeRoomCount:2,safeRoomHealPercent:75,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:15,restCooldown:4,restInterruptChance:25,restInterruptScript:"",storyConfig:{mainStory:"They call it Dead Man's Canyon for a reason. Three territories of sun-bleached bones and ruthless killers. The fastest guns in the west wait at every turn. Only the quickest will survive."},findEarly:{radius:3,items:["torch","healingPotion"],itemsPerChest:1},fairness:{enabled:!0,keyPityThreshold:5,healingPityThreshold:6,lowHpThreshold:.3,mercyUnlock:!1,mercyUnlockThreshold:0},bspConfig:{zoneCount:4,secretDensity:.05,zonesRequireClear:!0,clearThreshold:.9,secretHints:!1,floorComplexityScaling:!0},safeStartRadius:1,visionProfile:"survival",combatMechanicsProfile:"default",factionProfile:"western",permadeathEnabled:!1,vfxEnabled:!0,soundProfile:"default",questProfile:"Western - Hard",questGatingEnabled:!0,questPool:[{questId:"quest_defeat_5",chance:80},{questId:"quest_explore_75",chance:70},{questId:"quest_find_secret",chance:60},{questId:"quest_survive_combat",chance:70},{questId:"quest_boss_slayer",chance:50}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","execute","minionBane","portalStone","mapFragment","voidWalk","timeShard","healingPotion","greaterHealing","elixir","revivalCharm","torch","lantern","revealScroll","sightPotion","crystalBall","ironGuard","weapon_rusty_sword","weapon_iron_sword","weapon_enchanted_blade","weapon_shadow_dagger","armor_leather","armor_chainmail","armor_plate","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","accessory_vampiric_pendant","repairKit"]}},"Blood Mesa":{gridSize:14,floors:4,difficulty:"nightmare",theme:"western",mapStyle:"outpost",mapVisibility:"hideUnexplored",winCommand:"/echo LEGENDARY GUNSLINGER. The west will never forget.",loseCommand:"/echo Another unmarked grave in the badlands...",winMessage:"LEGENDARY! You survived the nightmare frontier!",winImage:"",mainMinion:"western_dealer",mainMinionIntroMessage:"Four territories. No law. No mercy. Just death.",mainMinionRandomChance:30,mainMinionRandomMessages:["YOUR GRAVE IS DUG.","THE VULTURES FEAST TONIGHT.","NO ONE ESCAPES."],mainMinionExitType:"turnbased",mainMinionExitProfile:"Western - Nightmare",minionEncounters:[{minionId:"western_posse",percent:2,zoneMin:0,zoneMax:1},{minionId:"western_bandit",percent:3,zoneMin:1,zoneMax:2},{minionId:"western_quickdraw",percent:3,zoneMin:2,zoneMax:3},{minionId:"western_sheriff",percent:3,zoneMin:3,zoneMax:99},{minionId:"western_dealer",percent:2,zoneMin:3,zoneMax:99}],trapEncounters:[{trapId:"bear_trap",percent:4},{trapId:"snake_pit",percent:4},{trapId:"dynamite",percent:3}],onBattlebarLoss:"gameover",chestTilePercent:5,chestLockedPercent:50,chestLockedBonusPercent:70,chestMimicPercent:25,chestLootMin:1,chestLootMax:2,chestKeyChance:25,chestStrikeChance:35,chestStealthChance:15,chestExecuteChance:5,lockedChestKeyChance:20,lockedChestStrikeChance:50,lockedChestStealthChance:25,lockedChestExecuteChance:10,startingInventory:{key:1,strike:0,stealth:0,execute:0,healingPotion:0,greaterHealing:0,elixir:0,revivalCharm:0,ironGuard:1},hpEnabled:!0,maxHP:70,battlebarDamageMultiplier:1.5,onDeath:"gameover",respawnHPPercent:25,safeRoomCount:2,safeRoomHealPercent:60,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:10,restCooldown:5,restInterruptChance:35,restInterruptScript:"",storyConfig:{mainStory:"Blood Mesa. The name alone keeps travelers away. Four territories of outlaws so dangerous, the army stopped trying to take them. You ride in with nothing. You'll leave a legendor not at all."},findEarly:{radius:2,items:["torch"],itemsPerChest:1},fairness:{enabled:!1,keyPityThreshold:0,healingPityThreshold:0,lowHpThreshold:0,mercyUnlock:!1,mercyUnlockThreshold:0},bspConfig:{zoneCount:4,secretDensity:.06,zonesRequireClear:!0,clearThreshold:1,secretHints:!1,floorComplexityScaling:!0},safeStartRadius:0,visionProfile:"survival",combatMechanicsProfile:"aggressive",factionProfile:"western",permadeathEnabled:!0,vfxEnabled:!0,soundProfile:"default",questProfile:"Western - Nightmare",questGatingEnabled:!0,questPool:[{questId:"quest_defeat_5",chance:90},{questId:"quest_explore_75",chance:80},{questId:"quest_find_secret",chance:70},{questId:"quest_survive_combat",chance:80},{questId:"quest_boss_slayer",chance:60},{questId:"quest_full_clear",chance:40}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","execute","minionBane","portalStone","mapFragment","voidWalk","timeShard","healingPotion","elixir","revivalCharm","heartCrystal","torch","lantern","revealScroll","sightPotion","crystalBall","ironGuard","weapon_rusty_sword","weapon_iron_sword","weapon_enchanted_blade","weapon_shadow_dagger","weapon_steel_blade","armor_leather","armor_chainmail","armor_plate","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","accessory_vampiric_pendant","repairKit"]}},"The Devil's Crossing":{gridSize:16,floors:5,difficulty:"apocalypse",theme:"western",mapStyle:"outpost",mapVisibility:"hideUnexplored",winCommand:"/echo THE GREATEST GUNSLINGER IN HISTORY.",loseCommand:"/echo THE BADLANDS CLAIM ALL.",winMessage:"LEGENDARY! The apocalypse frontier conquered! Your name lives forever!",winImage:"",mainMinion:"western_dealer",mainMinionIntroMessage:"APOCALYPSE: Five territories. Death incarnate. No survivors... until now?",mainMinionRandomChance:35,mainMinionRandomMessages:["DEATH RIDES WITH YOU.","THE REAPER WATCHES.","NO MERCY. NO QUARTER."],mainMinionExitType:"turnbased",mainMinionExitProfile:"Western - Apocalypse",minionEncounters:[{minionId:"western_bandit",percent:3,zoneMin:0,zoneMax:1},{minionId:"western_quickdraw",percent:4,zoneMin:1,zoneMax:2},{minionId:"western_sheriff",percent:4,zoneMin:2,zoneMax:3},{minionId:"western_dealer",percent:3,zoneMin:3,zoneMax:4}],trapEncounters:[{trapId:"bear_trap",percent:5},{trapId:"snake_pit",percent:5},{trapId:"dynamite",percent:4}],onBattlebarLoss:"gameover",chestTilePercent:4,chestLockedPercent:60,chestLockedBonusPercent:80,chestMimicPercent:35,chestLootMin:1,chestLootMax:1,chestKeyChance:20,chestStrikeChance:30,chestStealthChance:10,chestExecuteChance:5,lockedChestKeyChance:15,lockedChestStrikeChance:45,lockedChestStealthChance:20,lockedChestExecuteChance:12,startingInventory:{key:1,strike:0,stealth:0,execute:0,healingPotion:0,greaterHealing:0,elixir:0,revivalCharm:0,ironGuard:1},hpEnabled:!0,maxHP:60,battlebarDamageMultiplier:2,onDeath:"gameover",respawnHPPercent:0,safeRoomCount:1,safeRoomHealPercent:40,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:5,restCooldown:6,restInterruptChance:50,restInterruptScript:"",storyConfig:{mainStory:"The Devil's Crossing. Five territories where even Death fears to tread. Legend says the devil himself guards the final pass. No one has ever crossed alive. Will you be the first?"},findEarly:{radius:0,items:[],itemsPerChest:0},fairness:{enabled:!1,keyPityThreshold:0,healingPityThreshold:0,lowHpThreshold:0,mercyUnlock:!1,mercyUnlockThreshold:0},bspConfig:{zoneCount:5,secretDensity:.08,zonesRequireClear:!0,clearThreshold:1,secretHints:!1,floorComplexityScaling:!0},safeStartRadius:0,visionProfile:"survival",combatMechanicsProfile:"lethal",factionProfile:"western",permadeathEnabled:!0,vfxEnabled:!0,soundProfile:"default",questProfile:"Western - Apocalypse",questGatingEnabled:!0,questPool:[{questId:"quest_defeat_5",chance:100},{questId:"quest_explore_75",chance:90},{questId:"quest_find_secret",chance:80},{questId:"quest_survive_combat",chance:90},{questId:"quest_boss_slayer",chance:70},{questId:"quest_full_clear",chance:60}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","execute","minionBane","portalStone","mapFragment","voidWalk","timeShard","healingPotion","greaterHealing","elixir","revivalCharm","heartCrystal","torch","lantern","revealScroll","sightPotion","crystalBall","ironGuard","weapon_rusty_sword","weapon_iron_sword","weapon_enchanted_blade","weapon_shadow_dagger","weapon_steel_blade","armor_leather","armor_chainmail","armor_plate","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","accessory_vampiric_pendant","repairKit"]}},"Basic Training":{gridSize:8,floors:1,difficulty:"easy",theme:"action",mapStyle:"arena",mapVisibility:"showAll",winCommand:"/echo Mission complete. Good work, operator.",loseCommand:"/echo Mission failed. Retry available.",winMessage:"Objective secured! Nice work, rookie!",winImage:"",mainMinion:"action_intel",mainMinionIntroMessage:"Welcome to the training facility, operator. Show us what you've got.",mainMinionRandomChance:15,mainMinionRandomMessages:["Stay focused, operator.","Clear the AO."],mainMinionExitType:"battlebar",mainMinionExitProfile:"Street Fight",minionEncounters:[{minionId:"action_intel",percent:3,zoneMin:0,zoneMax:1},{minionId:"action_supply",percent:2,zoneMin:0,zoneMax:1},{minionId:"action_combatant",percent:2,zoneMin:1,zoneMax:99}],trapEncounters:[{trapId:"tripwire",percent:1},{trapId:"flashbang",percent:1}],onBattlebarLoss:"respawn",chestTilePercent:10,chestLockedPercent:20,chestLockedBonusPercent:50,chestMimicPercent:5,chestLootMin:2,chestLootMax:4,chestKeyChance:40,chestStrikeChance:50,chestStealthChance:15,chestExecuteChance:2,lockedChestKeyChance:30,lockedChestStrikeChance:55,lockedChestStealthChance:25,lockedChestExecuteChance:5,startingInventory:{key:2,strike:2,stealth:1,execute:0,healingPotion:2,greaterHealing:0,elixir:0,revivalCharm:0},hpEnabled:!0,maxHP:130,battlebarDamageMultiplier:.7,onDeath:"respawn",respawnHPPercent:75,safeRoomCount:4,safeRoomHealPercent:100,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:30,restCooldown:2,restInterruptChance:5,restInterruptScript:"",storyConfig:{mainStory:"Welcome to Blacksite Training Facility, operator. This is your basic qualification course. Clear the simulated hostiles and prove you're ready for field operations."},findEarly:{radius:5,items:["lantern","torch","healingPotion","mapFragment"],itemsPerChest:2},fairness:{enabled:!0,keyPityThreshold:3,healingPityThreshold:4,lowHpThreshold:.4,mercyUnlock:!0,mercyUnlockThreshold:2},bspConfig:{zoneCount:2,secretDensity:.02,zonesRequireClear:!0,clearThreshold:.5,secretHints:!0,floorComplexityScaling:!1},safeStartRadius:3,visionProfile:"explorer",combatMechanicsProfile:"simple",factionProfile:"action",permadeathEnabled:!1,vfxEnabled:!0,soundProfile:"default",questProfile:"Action - Easy",questGatingEnabled:!0,questPool:[{questId:"quest_collect_keys",chance:80},{questId:"quest_defeat_5",chance:60},{questId:"quest_treasure_hunter",chance:70}],itemPool:{enabled:!0,items:["key","strike","stealth","healingPotion","greaterHealing","torch","lantern","mapFragment","weapon_rusty_sword","weapon_iron_sword","armor_leather","accessory_ring_power","repairKit"]}},"Hostile Territory":{gridSize:10,floors:2,difficulty:"normal",theme:"action",mapStyle:"arena",mapVisibility:"fogOfWar",winCommand:"/echo Mission accomplished. Well done, operator.",loseCommand:"/echo KIA. Mission failed.",winMessage:"Objective secured! Extraction successful!",winImage:"",mainMinion:"action_combatant",mainMinionIntroMessage:"Multiple hostiles in the AO. Weapons hot.",mainMinionRandomChance:20,mainMinionRandomMessages:["Contact left!","Stay frosty, operator."],mainMinionExitType:"battlebar",mainMinionExitProfile:"Elite Combat",minionEncounters:[{minionId:"action_intel",percent:2,zoneMin:0,zoneMax:1},{minionId:"action_supply",percent:2,zoneMin:0,zoneMax:1},{minionId:"action_combatant",percent:3,zoneMin:1,zoneMax:2},{minionId:"action_patrol",percent:2,zoneMin:1,zoneMax:2},{minionId:"action_soldier",percent:1,zoneMin:2,zoneMax:99}],trapEncounters:[{trapId:"tripwire",percent:2},{trapId:"flashbang",percent:2},{trapId:"claymore",percent:1}],onBattlebarLoss:"respawn",chestTilePercent:8,chestLockedPercent:30,chestLockedBonusPercent:50,chestMimicPercent:10,chestLootMin:1,chestLootMax:3,chestKeyChance:35,chestStrikeChance:45,chestStealthChance:15,chestExecuteChance:3,lockedChestKeyChance:25,lockedChestStrikeChance:55,lockedChestStealthChance:25,lockedChestExecuteChance:7,startingInventory:{key:1,strike:1,stealth:0,execute:0,healingPotion:1,greaterHealing:0,elixir:0,revivalCharm:0},hpEnabled:!0,maxHP:100,battlebarDamageMultiplier:1,onDeath:"respawn",respawnHPPercent:50,safeRoomCount:3,safeRoomHealPercent:100,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:20,restCooldown:3,restInterruptChance:15,restInterruptScript:"",storyConfig:{mainStory:"Tactical insertion complete. An insurgent cell has taken control of the warehouse district. Two floors of hostiles stand between you and the extraction point. Weapons hot."},findEarly:{radius:4,items:["torch","healingPotion","mapFragment"],itemsPerChest:1},fairness:{enabled:!0,keyPityThreshold:4,healingPityThreshold:5,lowHpThreshold:.35,mercyUnlock:!0,mercyUnlockThreshold:3},bspConfig:{zoneCount:3,secretDensity:.04,zonesRequireClear:!0,clearThreshold:.75,secretHints:!0,floorComplexityScaling:!0},safeStartRadius:2,visionProfile:"default",combatMechanicsProfile:"default",factionProfile:"action",permadeathEnabled:!1,vfxEnabled:!0,soundProfile:"default",questProfile:"Action - Normal",questGatingEnabled:!0,questPool:[{questId:"quest_collect_keys",chance:70},{questId:"quest_defeat_5",chance:80},{questId:"quest_explore_75",chance:60},{questId:"quest_treasure_hunter",chance:50}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","minionBane","portalStone","mapFragment","timeShard","healingPotion","greaterHealing","elixir","torch","lantern","revealScroll","sightPotion","weapon_rusty_sword","weapon_iron_sword","weapon_shadow_dagger","armor_leather","armor_chainmail","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","repairKit"]}},"Behind Enemy Lines":{gridSize:12,floors:3,difficulty:"hard",theme:"action",mapStyle:"arena",mapVisibility:"hideUnexplored",winCommand:"/echo Mission accomplished. Outstanding work, operator.",loseCommand:"/echo KIA. Mission failed.",winMessage:"Objective secured! Extraction complete!",winImage:"",mainMinion:"action_warlord",mainMinionIntroMessage:"Full combat zone. Multiple hostile cells operating in the AO.",mainMinionRandomChance:25,mainMinionRandomMessages:["Contact! Enemy reinforcements!","They've got us pinned!"],mainMinionExitType:"turnbased",mainMinionExitProfile:"Action - Hard",minionEncounters:[{minionId:"action_combatant",percent:2,zoneMin:0,zoneMax:1},{minionId:"action_patrol",percent:3,zoneMin:1,zoneMax:2},{minionId:"action_bomb",percent:2,zoneMin:1,zoneMax:2},{minionId:"action_soldier",percent:3,zoneMin:2,zoneMax:3},{minionId:"action_warlord",percent:2,zoneMin:3,zoneMax:99}],trapEncounters:[{trapId:"tripwire",percent:3},{trapId:"flashbang",percent:3},{trapId:"claymore",percent:2}],onBattlebarLoss:"respawn",chestTilePercent:6,chestLockedPercent:40,chestLockedBonusPercent:60,chestMimicPercent:15,chestLootMin:1,chestLootMax:2,chestKeyChance:30,chestStrikeChance:45,chestStealthChance:15,chestExecuteChance:4,lockedChestKeyChance:25,lockedChestStrikeChance:55,lockedChestStealthChance:25,lockedChestExecuteChance:8,startingInventory:{key:1,strike:0,stealth:0,execute:0,healingPotion:1,greaterHealing:0,elixir:0,revivalCharm:0},hpEnabled:!0,maxHP:80,battlebarDamageMultiplier:1.3,onDeath:"respawnPenalty",respawnHPPercent:40,safeRoomCount:2,safeRoomHealPercent:75,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:15,restCooldown:4,restInterruptChance:30,restInterruptScript:"",storyConfig:{mainStory:"You've been dropped behind enemy lines. Three sectors of fortified positions guard the HVT. No air support. No reinforcements. Complete the mission or don't come back."},findEarly:{radius:3,items:["torch","healingPotion"],itemsPerChest:1},fairness:{enabled:!0,keyPityThreshold:5,healingPityThreshold:6,lowHpThreshold:.3,mercyUnlock:!1,mercyUnlockThreshold:0},bspConfig:{zoneCount:4,secretDensity:.05,zonesRequireClear:!0,clearThreshold:.9,secretHints:!1,floorComplexityScaling:!0},safeStartRadius:1,visionProfile:"survival",combatMechanicsProfile:"default",factionProfile:"action",permadeathEnabled:!1,vfxEnabled:!0,soundProfile:"default",questProfile:"Action - Hard",questGatingEnabled:!0,questPool:[{questId:"quest_defeat_5",chance:80},{questId:"quest_explore_75",chance:70},{questId:"quest_find_secret",chance:60},{questId:"quest_survive_combat",chance:70},{questId:"quest_boss_slayer",chance:50}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","execute","minionBane","portalStone","mapFragment","voidWalk","timeShard","healingPotion","greaterHealing","elixir","revivalCharm","torch","lantern","revealScroll","sightPotion","crystalBall","ironGuard","weapon_rusty_sword","weapon_iron_sword","weapon_enchanted_blade","weapon_shadow_dagger","armor_leather","armor_chainmail","armor_plate","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","accessory_vampiric_pendant","repairKit"]}},"No Man's Land":{gridSize:14,floors:4,difficulty:"nightmare",theme:"action",mapStyle:"arena",mapVisibility:"hideUnexplored",winCommand:"/echo LEGENDARY OPERATOR. Mission impossible: completed.",loseCommand:"/echo KIA. Your sacrifice will be remembered.",winMessage:"LEGENDARY! You completed the impossible mission!",winImage:"",mainMinion:"action_sniper",mainMinionIntroMessage:"Code black. Four sectors of hell. Zero support. Good luck, operator.",mainMinionRandomChance:30,mainMinionRandomMessages:["CONTACT EVERYWHERE!","THEY KNOW WE'RE HERE!","NO EXTRACTION POSSIBLE!"],mainMinionExitType:"turnbased",mainMinionExitProfile:"Action - Nightmare",minionEncounters:[{minionId:"action_patrol",percent:2,zoneMin:0,zoneMax:1},{minionId:"action_soldier",percent:3,zoneMin:1,zoneMax:2},{minionId:"action_warlord",percent:3,zoneMin:2,zoneMax:3},{minionId:"action_sniper",percent:3,zoneMin:3,zoneMax:99},{minionId:"action_defuser",percent:2,zoneMin:3,zoneMax:99}],trapEncounters:[{trapId:"tripwire",percent:4},{trapId:"flashbang",percent:4},{trapId:"claymore",percent:3}],onBattlebarLoss:"gameover",chestTilePercent:5,chestLockedPercent:50,chestLockedBonusPercent:70,chestMimicPercent:25,chestLootMin:1,chestLootMax:2,chestKeyChance:25,chestStrikeChance:35,chestStealthChance:15,chestExecuteChance:5,lockedChestKeyChance:20,lockedChestStrikeChance:50,lockedChestStealthChance:25,lockedChestExecuteChance:10,startingInventory:{key:1,strike:0,stealth:0,execute:0,healingPotion:0,greaterHealing:0,elixir:0,revivalCharm:0,ironGuard:1},hpEnabled:!0,maxHP:70,battlebarDamageMultiplier:1.5,onDeath:"gameover",respawnHPPercent:25,safeRoomCount:2,safeRoomHealPercent:60,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:10,restCooldown:5,restInterruptChance:40,restInterruptScript:"",storyConfig:{mainStory:"They call it No Man's Land because no one comes back. Four sectors of pure carnage. Zero support. Zero extraction. You drop in with nothing. If you survive, you'll be a legend."},findEarly:{radius:2,items:["torch"],itemsPerChest:1},fairness:{enabled:!1,keyPityThreshold:0,healingPityThreshold:0,lowHpThreshold:0,mercyUnlock:!1,mercyUnlockThreshold:0},bspConfig:{zoneCount:4,secretDensity:.06,zonesRequireClear:!0,clearThreshold:1,secretHints:!1,floorComplexityScaling:!0},safeStartRadius:0,visionProfile:"survival",combatMechanicsProfile:"aggressive",factionProfile:"action",permadeathEnabled:!0,vfxEnabled:!0,soundProfile:"default",questProfile:"Action - Nightmare",questGatingEnabled:!0,questPool:[{questId:"quest_defeat_5",chance:90},{questId:"quest_explore_75",chance:80},{questId:"quest_find_secret",chance:70},{questId:"quest_survive_combat",chance:80},{questId:"quest_boss_slayer",chance:60},{questId:"quest_full_clear",chance:40}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","execute","minionBane","portalStone","mapFragment","voidWalk","timeShard","healingPotion","elixir","revivalCharm","heartCrystal","torch","lantern","revealScroll","sightPotion","crystalBall","ironGuard","weapon_rusty_sword","weapon_iron_sword","weapon_enchanted_blade","weapon_shadow_dagger","weapon_steel_blade","armor_leather","armor_chainmail","armor_plate","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","accessory_vampiric_pendant","repairKit"]}},"Operation Armageddon":{gridSize:16,floors:5,difficulty:"apocalypse",theme:"action",mapStyle:"arena",mapVisibility:"hideUnexplored",winCommand:"/echo THE LEGEND. THE IMPOSSIBLE MISSION. COMPLETED.",loseCommand:"/echo TOTAL ANNIHILATION. MISSION FAILED.",winMessage:"LEGENDARY! You completed the apocalypse mission! Your name echoes through military history!",winImage:"",mainMinion:"action_defuser",mainMinionIntroMessage:"APOCALYPSE: Five sectors. Full hostile occupation. Zero survival probability. Prove the odds wrong.",mainMinionRandomChance:35,mainMinionRandomMessages:["TOTAL WAR!","NO MERCY!","DEATH OR GLORY!"],mainMinionExitType:"turnbased",mainMinionExitProfile:"Action - Apocalypse",minionEncounters:[{minionId:"action_soldier",percent:3,zoneMin:0,zoneMax:1},{minionId:"action_warlord",percent:4,zoneMin:1,zoneMax:2},{minionId:"action_sniper",percent:4,zoneMin:2,zoneMax:3},{minionId:"action_defuser",percent:3,zoneMin:3,zoneMax:4}],trapEncounters:[{trapId:"tripwire",percent:5},{trapId:"flashbang",percent:5},{trapId:"claymore",percent:4}],onBattlebarLoss:"gameover",chestTilePercent:4,chestLockedPercent:60,chestLockedBonusPercent:80,chestMimicPercent:35,chestLootMin:1,chestLootMax:1,chestKeyChance:20,chestStrikeChance:30,chestStealthChance:10,chestExecuteChance:5,lockedChestKeyChance:15,lockedChestStrikeChance:45,lockedChestStealthChance:20,lockedChestExecuteChance:12,startingInventory:{key:1,strike:0,stealth:0,execute:0,healingPotion:0,greaterHealing:0,elixir:0,revivalCharm:0,ironGuard:1},hpEnabled:!0,maxHP:60,battlebarDamageMultiplier:2,onDeath:"gameover",respawnHPPercent:0,safeRoomCount:1,safeRoomHealPercent:40,safeRoomUseLLM:!1,restEnabled:!0,restHealPercent:5,restCooldown:6,restInterruptChance:50,restInterruptScript:"",storyConfig:{mainStory:"Operation Armageddon. The mission that ended careersand lives. Five sectors of absolute annihilation. Every operator before you has failed. Command says it's impossible. Prove them wrong."},findEarly:{radius:0,items:[],itemsPerChest:0},fairness:{enabled:!1,keyPityThreshold:0,healingPityThreshold:0,lowHpThreshold:0,mercyUnlock:!1,mercyUnlockThreshold:0},bspConfig:{zoneCount:5,secretDensity:.08,zonesRequireClear:!0,clearThreshold:1,secretHints:!1,floorComplexityScaling:!0},safeStartRadius:0,visionProfile:"survival",combatMechanicsProfile:"lethal",factionProfile:"action",permadeathEnabled:!0,vfxEnabled:!0,soundProfile:"default",questProfile:"Action - Apocalypse",questGatingEnabled:!0,questPool:[{questId:"quest_defeat_5",chance:100},{questId:"quest_explore_75",chance:90},{questId:"quest_find_secret",chance:80},{questId:"quest_survive_combat",chance:90},{questId:"quest_boss_slayer",chance:70},{questId:"quest_full_clear",chance:60}],itemPool:{enabled:!0,items:["key","floorKey","strike","stealth","execute","minionBane","portalStone","mapFragment","voidWalk","timeShard","healingPotion","greaterHealing","elixir","revivalCharm","heartCrystal","torch","lantern","revealScroll","sightPotion","crystalBall","ironGuard","weapon_rusty_sword","weapon_iron_sword","weapon_enchanted_blade","weapon_shadow_dagger","weapon_steel_blade","armor_leather","armor_chainmail","armor_plate","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","accessory_vampiric_pendant","repairKit"]}}};let qt={},Rt={segments:[],isOpen:!1,isSpinning:!1,pendingRespin:!1,hasRespun:!1},Nt={isOpen:!1,profile:null,hits:0,misses:0,arrowPosition:0,arrowDirection:1,zoneStart:0,zoneEnd:0,animationId:null,lastFrameTime:0,isVictory:!1,isDefeat:!1},Ht={isOpen:!1,profile:null,profileName:"",playerHP:0,playerMaxHP:0,enemyHP:0,enemyMaxHP:0,currentTurn:"player",turnCount:0,isDefending:!1,isVictory:!1,isDefeat:!1,isMazeEncounter:!1,combatLog:[],playerStatusEffects:[],enemyStatusEffects:[],enemyType:"warrior",isFirstStrike:!0,difficulty:1},Ot={isOpen:!1,profile:null,profileName:"",sequence:[],currentIndex:0,currentTimeWindow:0,promptStartTime:0,timeoutId:null,successes:0,perfects:0,misses:0,combo:0,maxCombo:0,isComplete:!1,isSuccess:!1,combatLog:[]},Ft={isOpen:!1,profile:null,profileName:"",diceResults:[],total:0,rawTotal:0,threshold:0,modifier:0,rerollsRemaining:0,isCriticalSuccess:!1,isCriticalFail:!1,isSuccess:!1,isComplete:!1,combatLog:[]},Wt={isOpen:!1,profile:null,profileName:"",currentSection:0,sectionsToPass:0,detection:0,detectionThreshold:100,isSuccess:!1,isCaught:!1,isComplete:!1,actionsTaken:0,combatLog:[]},Yt={isOpen:!1,profile:null,profileName:"",puzzleType:"sequence",gridSize:3,grid:[],sequence:[],playerSequence:[],currentStep:0,timeLimit:0,timeRemaining:0,timerInterval:null,hintsRemaining:0,hintsUsed:0,wrongGuesses:0,wrongGuessesAllowed:3,score:0,isShowingSequence:!1,isSuccess:!1,isFailed:!1,isComplete:!1,combatLog:[]},Ut={isOpen:!1,profile:null,profileName:"",favor:50,favorThreshold:75,turnsRemaining:0,turnsUsed:0,lastAction:"",lastResult:"",isSuccess:!1,isFailed:!1,isComplete:!1,combatLog:[]},Gt=!1,jt={isOpen:!1,profile:null,profileName:null,grid:[],size:10,playerX:0,playerY:0,exitX:0,exitY:0,visited:new Set,isVictory:!1,currentMinion:null,isPaused:!1,pendingEncounter:null,exitEncounterDone:!1,currentFloor:0,totalFloors:1,floors:[],inventory:{key:0,stealth:0,strike:0,execute:0,floorKey:0,portalStone:0,minionBane:0,mapFragment:0,timeShard:0,voidWalk:0,healingPotion:0,greaterHealing:0,elixir:0,revivalCharm:0,heartCrystal:0,torch:0,lantern:0,revealScroll:0,sightPotion:0,crystalBall:0,ironGuard:0},itemCharges:{},visibility:{baseRadius:1,tempBonus:0,tempMovesLeft:0,permBonus:0,floorRevealed:!1},pendingConfirmation:null,pendingChest:null,voidWalkActive:!1,messageLog:[],hpEnabled:!0,hp:{current:100,max:100,maxBonus:0,reviveCharges:0},equipment:{weapon:null,armor:null,accessory:null},equipmentInventory:[],character:{level:1,xp:0,xpToNextLevel:100,skillPoints:0,lastExplorationMilestone:0},skills:{learned:{},cooldowns:{},activeEffects:[],abilityBar:[]},combatMechanics:{comboCounter:0,maxCombo:0,comboDecayTimer:0,isBlocking:!1,parryWindow:!1,parrySuccess:!1,lastAction:null},minimap:{enabled:!0,markers:[],zoom:1,position:"top-right"},customInventory:{},lighting:{ambientLevel:"normal",activeLight:null,lightRadius:1,torchMovesLeft:0,sightPotionMovesLeft:0},factions:{},activatedSwitches:null,campaign:null};const Kt={wheel:{},battlebar:{},maze:{}},Vt=new WeakSet;async function Xt(e){const{minionName:t,minionDescription:a,baseMessage:n,mainStory:o,currentMilestone:i,minionType:r}=e;if(!n)return"";if(!1===qt.llmEnabled)return console.log("[MazeMaster] LLM generation disabled, using base message"),n;if("function"!=typeof h)return console.log("[MazeMaster] generateQuietPrompt not available, using base message"),n;let s=[];o&&s.push("Story Setting: ".concat(o)),i&&s.push("Current Progress: ".concat(i));const l=a||{messenger:"a mysterious messenger who delivers cryptic hints",battlebar:"a guardian who challenges travelers to combat",prizewheel:"a fortune teller who offers games of chance",merchant:"a wandering trader who barters for rare items"}[r]||"a mysterious figure",c=oe(),m="You are ".concat(t,", ").concat(l,".\nThe player's name is ").concat(c,".\n\n").concat(s.length>0?s.join("\n")+"\n\n":"",'The player has encountered you in a maze. Based on this message template: "').concat(n,'"\n\nWrite a short, atmospheric response (1-2 sentences max, under 100 characters if possible). Stay in character. Be mysterious and engaging. You may address the player by name if appropriate. Do not use quotation marks around your response.');try{console.log("[MazeMaster] Generating LLM message for:",t);const e=await h(m,{quietToLoud:!1,skipWIAN:!0,skipWI:!0,max_length:80});if(e&&e.trim()){let t=e.trim();return t=t.replace(/^["']|["']$/g,""),t=t.replace(/^["""''']|["""''']$/g,""),console.log("[MazeMaster] Generated message:",t),t}}catch(e){console.error("[MazeMaster] LLM generation failed:",e)}return n}async function Qt(e,t){var a,n,o;if(console.log("[MazeMaster] enhanceRoomOnEntry called:",{x:e,y:t}),null===(a=jt)||void 0===a||!a.isOpen||!jt.profile)return void console.log("[MazeMaster] Enhancement skipped: maze not open or no profile");if(!jt.profile.llmEnhanceRooms)return void console.log("[MazeMaster] Enhancement skipped: llmEnhanceRooms disabled in profile",jt.profile.llmEnhanceRooms);const i=jt.currentFloor||0,r="".concat(i,":").concat(e,",").concat(t);if(null!==(n=jt.enhancedRooms)&&void 0!==n&&n[r])return void console.log("[MazeMaster] Room already enhanced:",r);const s=null===(o=jt.grid[t])||void 0===o?void 0:o[e];if(!s||!s.roomInfo)return void console.log("[MazeMaster] Enhancement skipped: no cell or roomInfo at",{x:e,y:t,hasCell:!!s,hasRoomInfo:!(null==s||!s.roomInfo)});console.log("[MazeMaster] Proceeding with room enhancement for:",r);const l=s.roomInfo.description||"...",c=s.roomInfo.name||"Unknown Room",m=s.roomInfo.type||"standard",d=jt.profile.theme||"fantasy";Mi(!0);try{const e=await async function(e){var t,a,n,o;const{roomName:i,roomType:r,baseDescription:s,theme:l,sessionNotes:c}=e;if("function"!=typeof h)return console.log("[MazeMaster] generateQuietPrompt not available"),s;if(!1===qt.llmEnabled)return s;const m=(null===(a=((null===(t=jt)||void 0===t?void 0:t.profile)||{}).storyConfig)||void 0===a?void 0:a.mainStory)||"",d=((null===(n=jt)||void 0===n?void 0:n.currentFloor)||0)+1,u=(null===(o=jt)||void 0===o?void 0:o.totalFloors)||1,p=oe(),g=c?c.slice(-500).split("\n").slice(-5).join("\n"):"",f=La(l);let y=l;var v;f&&(y=f.displayName||l,null!==(v=f.tags)&&void 0!==v&&v.length&&(y+=" (".concat(f.tags.join(", "),")")));const b=(null==f?void 0:f.atmosphere)||"",z="You are the narrator for a ".concat(y," dungeon crawler game.\nPlayer: ").concat(p,"\nFloor: ").concat(d,"/").concat(u,"\n").concat(b?"Atmosphere: ".concat(b,"\n"):"").concat(m?"Story: ".concat(m,"\n"):"","\n").concat(g?"Recent events:\n".concat(g,"\n"):"",'\nThe player enters "').concat(i,'" (a ').concat(r||"standard",' room).\nBase description: "').concat(s,'"\n\nWrite a vivid, atmospheric description (2-3 sentences max). Reference recent events if relevant. Stay in theme. Do not use quotation marks.');try{console.log("[MazeMaster] Generating enhanced room description for:",i);const e=await h(z,{quietToLoud:!1,skipWIAN:!0,skipWI:!0,max_length:150});if(e&&e.trim()){let t=e.trim();return t=t.replace(/^["']|["']$/g,""),t=t.replace(/^["""''']|["""''']$/g,""),console.log("[MazeMaster] Enhanced description:",t),t}}catch(e){console.error("[MazeMaster] Room description LLM failed:",e)}return s}({roomName:c,roomType:m,baseDescription:l,theme:d,sessionNotes:jt.sessionNotes||""});jt.enhancedRooms||(jt.enhancedRooms={}),jt.enhancedRooms[r]=e,s.roomInfo.enhancedDescription=e,Ei("".concat(c,": ").concat(e),"Explore"),Pi(),console.log("[MazeMaster] Room enhanced and cached:",r)}catch(e){console.error("[MazeMaster] Room enhancement failed:",e)}finally{Mi(!1)}}function Jt(){var e;if(!jt.isOpen||!jt.profile)return null;const t=jt.profile.storyConfig;if(!t||!t.milestones||0===t.milestones.length)return null;const a=jt.size*jt.size,n=((null===(e=jt.visited)||void 0===e?void 0:e.size)||0)/a*100;let o=null;for(const e of t.milestones)n>=e.percent&&(o=e.storyUpdate);return o}function Zt(){var e;return jt.isOpen&&jt.profile&&(null===(e=jt.profile.storyConfig)||void 0===e?void 0:e.mainStory)||null}function $t(){console.log("[MazeMaster] Resetting all factory defaults to version",13),qt.traps={};for(const[e,t]of Object.entries(Pt))qt.traps[e]=JSON.parse(JSON.stringify(t));console.log("[MazeMaster] Reset",Object.keys(Pt).length,"factory traps"),qt.minions={};for(const[e,t]of Object.entries(Mt))qt.minions[e]=JSON.parse(JSON.stringify(t));console.log("[MazeMaster] Reset",Object.keys(Mt).length,"factory minions"),qt.profiles={};for(const[e,t]of Object.entries(Re))qt.profiles[e]=JSON.parse(JSON.stringify(t));qt.currentProfile="Tutorial - Learn the Wheel",console.log("[MazeMaster] Reset",Object.keys(Re).length,"factory wheel profiles"),qt.battlebarProfiles={};for(const[e,t]of Object.entries(Ne))qt.battlebarProfiles[e]=JSON.parse(JSON.stringify(t));qt.currentBattlebarProfile="Tutorial - Learn Combat",console.log("[MazeMaster] Reset",Object.keys(Ne).length,"factory battlebar profiles"),qt.turnbasedProfiles={};for(const[e,t]of Object.entries(He))qt.turnbasedProfiles[e]=JSON.parse(JSON.stringify(t));qt.currentTurnbasedProfile="Tutorial - Learn Turn-Based",console.log("[MazeMaster] Reset",Object.keys(He).length,"factory turn-based profiles"),qt.qteProfiles={};for(const[e,t]of Object.entries(Oe))qt.qteProfiles[e]=JSON.parse(JSON.stringify(t));qt.currentQteProfile="Tutorial - First Steps",console.log("[MazeMaster] Reset",Object.keys(Oe).length,"factory QTE profiles"),qt.diceProfiles={};for(const[e,t]of Object.entries(Fe))qt.diceProfiles[e]=JSON.parse(JSON.stringify(t));qt.currentDiceProfile="Tutorial - Luck Practice",console.log("[MazeMaster] Reset",Object.keys(Fe).length,"factory Dice profiles"),qt.stealthProfiles={};for(const[e,t]of Object.entries(We))qt.stealthProfiles[e]=JSON.parse(JSON.stringify(t));qt.currentStealthProfile="Tutorial - Stealth Basics",console.log("[MazeMaster] Reset",Object.keys(We).length,"factory Stealth profiles"),qt.puzzleProfiles={};for(const[e,t]of Object.entries(Ye))qt.puzzleProfiles[e]=JSON.parse(JSON.stringify(t));qt.currentPuzzleProfile="Tutorial - Mind Training",console.log("[MazeMaster] Reset",Object.keys(Ye).length,"factory Puzzle profiles"),qt.negotiationProfiles={};for(const[e,t]of Object.entries(Ue))qt.negotiationProfiles[e]=JSON.parse(JSON.stringify(t));qt.currentNegotiationProfile="Tutorial - Social Training",console.log("[MazeMaster] Reset",Object.keys(Ue).length,"factory Negotiation profiles"),qt.mazeProfiles={};for(const[e,t]of Object.entries(Lt))qt.mazeProfiles[e]=JSON.parse(JSON.stringify(t));qt.currentMazeProfile="Tutorial - Learn the Basics",console.log("[MazeMaster] Reset",Object.keys(Lt).length,"factory maze profiles"),qt.minionProfiles={};for(const[e,t]of Object.entries(At))qt.minionProfiles[e]=JSON.parse(JSON.stringify(t));console.log("[MazeMaster] Reset",Object.keys(At).length,"factory minion profiles"),qt.trapProfiles={};for(const[e,t]of Object.entries(Bt))qt.trapProfiles[e]=JSON.parse(JSON.stringify(t));console.log("[MazeMaster] Reset",Object.keys(Bt).length,"factory trap profiles"),qt.questProfiles={};for(const[e,t]of Object.entries(Ke))qt.questProfiles[e]=JSON.parse(JSON.stringify(t));console.log("[MazeMaster] Reset",Object.keys(Ke).length,"factory quest profiles"),qt.customThemes={},console.log("[MazeMaster] Cleared custom themes - factory defaults available via dropdown"),qt.customStyles={},console.log("[MazeMaster] Cleared custom styles - factory defaults available via dropdown"),qt.factoryDefaultsVersion=13,console.log("[MazeMaster] Factory defaults reset complete - all old profiles removed, v2.0.1 profiles installed")}function ea(){return Object.keys(qt.profiles||{})}function ta(e){return qt.profiles[e]}function aa(){return Object.keys(qt.battlebarProfiles||{})}function na(e){return qt.battlebarProfiles[e]}function oa(e,t){var a,n,o;qt.battlebarProfiles[e]={mainTitle:t.mainTitle||"",description:t.description||"",difficulty:t.difficulty||3,hitsToWin:t.hitsToWin||5,missesToLose:t.missesToLose||3,hitCommand:t.hitCommand||"",missCommand:t.missCommand||"",winCommand:t.winCommand||"",loseCommand:t.loseCommand||"",images:t.images||[],keyDropChance:null!==(a=t.keyDropChance)&&void 0!==a?a:40,strikeDropChance:null!==(n=t.strikeDropChance)&&void 0!==n?n:20,stealthDropChance:null!==(o=t.stealthDropChance)&&void 0!==o?o:10},i(),console.log("[MazeMaster] Battlebar profile saved:",e,qt.battlebarProfiles[e])}function ia(){return Object.keys(qt.turnbasedProfiles||{})}function ra(e){var t;return null===(t=qt.turnbasedProfiles)||void 0===t?void 0:t[e]}function sa(e,a){qt.turnbasedProfiles||(qt.turnbasedProfiles={}),qt.turnbasedProfiles[e]=t({},a),i()}function la(){return Object.keys(qt.qteProfiles||{})}function ca(e){var t;return null===(t=qt.qteProfiles)||void 0===t?void 0:t[e]}function ma(e,a){qt.qteProfiles||(qt.qteProfiles={}),qt.qteProfiles[e]=t({},a),i()}function da(){return Object.keys(qt.diceProfiles||{})}function ua(e){var t;return null===(t=qt.diceProfiles)||void 0===t?void 0:t[e]}function pa(e,a){qt.diceProfiles||(qt.diceProfiles={}),qt.diceProfiles[e]=t({},a),i()}function ha(){return Object.keys(qt.stealthProfiles||{})}function ga(e){var t;return null===(t=qt.stealthProfiles)||void 0===t?void 0:t[e]}function fa(e,a){qt.stealthProfiles||(qt.stealthProfiles={}),qt.stealthProfiles[e]=t({},a),i()}function ya(){return Object.keys(qt.puzzleProfiles||{})}function va(e){var t;return null===(t=qt.puzzleProfiles)||void 0===t?void 0:t[e]}function ba(e,a){qt.puzzleProfiles||(qt.puzzleProfiles={}),qt.puzzleProfiles[e]=t({},a),i()}function za(){return Object.keys(qt.negotiationProfiles||{})}function _a(e){var t;return null===(t=qt.negotiationProfiles)||void 0===t?void 0:t[e]}function xa(e,a){qt.negotiationProfiles||(qt.negotiationProfiles={}),qt.negotiationProfiles[e]=t({},a),i()}function ka(e){var a;if(Ge[e]){var n;const a=(null===(n=qt.combatMechanicsProfiles)||void 0===n?void 0:n[e])||{};return t(t({},Ge[e]),a)}return(null===(a=qt.combatMechanicsProfiles)||void 0===a?void 0:a[e])||Ge.default}function Ca(e,t){var a,n,o,r,s,l,c,m,d,u,p,h,g,f,y,v,b,z,_;qt.combatMechanicsProfiles||(qt.combatMechanicsProfiles={}),qt.combatMechanicsProfiles[e]={name:t.name||e,description:t.description||"",comboEnabled:null===(a=t.comboEnabled)||void 0===a||a,comboBonusPerHit:null!==(n=t.comboBonusPerHit)&&void 0!==n?n:5,maxComboBonus:null!==(o=t.maxComboBonus)&&void 0!==o?o:50,comboDecayTurns:null!==(r=t.comboDecayTurns)&&void 0!==r?r:2,comboResetOnMiss:null===(s=t.comboResetOnMiss)||void 0===s||s,comboResetOnDamage:null!==(l=t.comboResetOnDamage)&&void 0!==l&&l,blockEnabled:null===(c=t.blockEnabled)||void 0===c||c,blockDamageReduction:null!==(m=t.blockDamageReduction)&&void 0!==m?m:.5,blockBreakThreshold:null!==(d=t.blockBreakThreshold)&&void 0!==d?d:0,perfectBlockWindow:null!==(u=t.perfectBlockWindow)&&void 0!==u?u:.3,perfectBlockReduction:null!==(p=t.perfectBlockReduction)&&void 0!==p?p:.8,parryEnabled:null===(h=t.parryEnabled)||void 0===h||h,parryWindow:null!==(g=t.parryWindow)&&void 0!==g?g:.5,parryDamageMultiplier:null!==(f=t.parryDamageMultiplier)&&void 0!==f?f:1.5,parryStunDuration:null!==(y=t.parryStunDuration)&&void 0!==y?y:1,parryDifficulty:null!==(v=t.parryDifficulty)&&void 0!==v?v:"normal",counterEnabled:null===(b=t.counterEnabled)||void 0===b||b,counterDamageBonus:null!==(z=t.counterDamageBonus)&&void 0!==z?z:25,counterCritBonus:null!==(_=t.counterCritBonus)&&void 0!==_?_:15,onComboStart:t.onComboStart||"",onComboIncrease:t.onComboIncrease||"",onComboBreak:t.onComboBreak||"",onBlockAttempt:t.onBlockAttempt||"",onBlockSuccess:t.onBlockSuccess||"",onBlockBreak:t.onBlockBreak||"",onParryAttempt:t.onParryAttempt||"",onParrySuccess:t.onParrySuccess||"",onParryFail:t.onParryFail||"",onCounterAttack:t.onCounterAttack||""},i(),console.log("[MazeMaster] Combat Mechanics profile saved:",e)}function wa(e){var t;return Ge[e]?(console.log("[MazeMaster] Cannot delete default profile:",e),!1):(null===(t=qt.combatMechanicsProfiles)||void 0===t||delete t[e],qt.currentCombatMechanicsProfile===e&&(qt.currentCombatMechanicsProfile="default"),i(),!0)}function Ea(e){var t;return null===(t=qt.customItems)||void 0===t?void 0:t[e]}function Sa(e){var t;qt.customItems||(qt.customItems={});const a=e.id||"item_"+Date.now()+"_"+Math.random().toString(36).substr(2,9);return qt.customItems[a]={id:a,name:e.name||"New Item",type:e.type||"consumable",subtype:e.subtype||null,rarity:e.rarity||"common",icon:e.icon||"fa-box",description:e.description||"",effects:e.effects||[],attack:e.attack||0,defense:e.defense||0,critBonus:e.critBonus||0,special:e.special||null,lootWeight:null!==(t=e.lootWeight)&&void 0!==t?t:20,lootSources:e.lootSources||["chest"],onUse:e.onUse||"",onEquip:e.onEquip||"",onDrop:e.onDrop||""},i(),console.log("[MazeMaster] Custom item created:",a,qt.customItems[a]),a}function Ta(){return qt.minimapSettings||{enabled:!0,size:150,opacity:.85,position:"top-right",showMarkers:!0,showMinions:!0,showChests:!0,showPlayer:!0,showExit:!0}}function Ia(){var e,t,a;const n=document.getElementById("mazemaster_minimap_container"),o=document.getElementById("mazemaster_minimap_canvas");if(!n||!o||null===(e=jt)||void 0===e||!e.grid)return;const i=Ta();if(!i.enabled||null===(t=jt.minimap)||void 0===t||!t.enabled)return void(n.style.display="none");n.style.display="block";const r=o.getContext("2d"),s=i.size||150,l=jt.grid.length,c=Math.floor(s/l);o.width=c*l,o.height=c*l,n.style.width="".concat(o.width,"px"),n.style.height="".concat(o.height+30,"px"),n.style.opacity=i.opacity||.85;const m={"top-right":{top:"10px",right:"10px",bottom:"auto",left:"auto"},"top-left":{top:"10px",left:"10px",bottom:"auto",right:"auto"},"bottom-right":{bottom:"10px",right:"10px",top:"auto",left:"auto"},"bottom-left":{bottom:"10px",left:"10px",top:"auto",right:"auto"}},d=m[i.position]||m["top-right"];Object.assign(n.style,d),r.fillStyle="rgba(0, 0, 0, 0.7)",r.fillRect(0,0,o.width,o.height);for(let e=0;e<l;e++)for(let t=0;t<l;t++){var u;const a=null===(u=jt.grid[e])||void 0===u?void 0:u[t];if(!a)continue;const n=t*c,o=e*c;let s="#1a1a2e";(a.explored||a.visible)&&(s="wall"===a.type?"#333":"exit"===a.type?i.showExit?"#2ecc71":"#2a2a4a":"chest"===a.type?i.showChests?"#f1c40f":"#2a2a4a":"saferoom"===a.type?"#27ae60":"#2a2a4a"),r.fillStyle=s,r.fillRect(n,o,c-1,c-1),i.showMinions&&a.minion&&(a.explored||a.visible)&&(r.fillStyle="#e74c3c",r.beginPath(),r.arc(n+c/2,o+c/2,c/4,0,2*Math.PI),r.fill())}if(i.showPlayer&&void 0!==jt.x&&void 0!==jt.y){const e=jt.x*c+c/2,t=jt.y*c+c/2;r.fillStyle="#3498db",r.beginPath(),r.arc(e,t,c/2.5,0,2*Math.PI),r.fill(),r.fillStyle="#fff",r.beginPath(),r.arc(e,t,c/6,0,2*Math.PI),r.fill()}if(i.showMarkers&&null!==(a=jt.minimap)&&void 0!==a&&a.markers)for(const e of jt.minimap.markers){const t=e.x*c+c/2,a=e.y*c+c/2;r.fillStyle=e.color||"#f39c12",r.beginPath(),r.arc(t,a,c/3,0,2*Math.PI),r.fill(),r.strokeStyle="#fff",r.lineWidth=1,r.stroke()}}function Ma(){Ia()}function Pa(){const e=Object.keys(qt.mazeProfiles||{}),t=Object.keys(Lt||{});return[...new Set([...e,...t])]}function Da(e){var t;return(null===(t=qt.mazeProfiles)||void 0===t?void 0:t[e])||Lt[e]}function Aa(e,t){var a,n,o,r,s,l,c;qt.mazeProfiles[e]={gridSize:t.gridSize||10,difficulty:t.difficulty||"normal",theme:t.theme||"fantasy",mapStyle:t.mapStyle||"maze",floors:t.floors||1,mapVisibility:t.mapVisibility||"fogOfWar",winCommand:t.winCommand||"",winImage:t.winImage||"",winMessage:t.winMessage||"",mainMinion:t.mainMinion||"",mainMinionIntroMessage:t.mainMinionIntroMessage||"",mainMinionRandomChance:t.mainMinionRandomChance||15,mainMinionRandomMessages:t.mainMinionRandomMessages||[],mainMinionExitType:t.mainMinionExitType||"messenger",mainMinionExitProfile:t.mainMinionExitProfile||"",minionEncounters:t.minionEncounters||[],onBattlebarLoss:t.onBattlebarLoss||"continue",loseCommand:t.loseCommand||"",chestImage:t.chestImage||"",chestTilePercent:t.chestTilePercent||10,chestLockedPercent:t.chestLockedPercent||30,chestLockedBonusPercent:t.chestLockedBonusPercent||50,chestMimicPercent:t.chestMimicPercent||15,chestLootMin:t.chestLootMin||1,chestLootMax:t.chestLootMax||2,chestKeyChance:t.chestKeyChance||30,chestStrikeChance:t.chestStrikeChance||50,chestStealthChance:t.chestStealthChance||0,lockedChestKeyChance:t.lockedChestKeyChance||40,lockedChestStrikeChance:t.lockedChestStrikeChance||60,lockedChestStealthChance:t.lockedChestStealthChance||30,chestExecuteChance:t.chestExecuteChance||0,lockedChestExecuteChance:t.lockedChestExecuteChance||5,startingInventory:t.startingInventory||{key:0,stealth:0,strike:0,execute:0,healingPotion:0,greaterHealing:0,elixir:0,revivalCharm:0},trapEncounters:t.trapEncounters||[],storyConfig:t.storyConfig||{mainStory:"",milestones:[]},hpEnabled:!1!==t.hpEnabled,maxHP:t.maxHP||100,battlebarDamageMultiplier:null!==(a=t.battlebarDamageMultiplier)&&void 0!==a?a:1,battlebarDifficultyMultiplier:null!==(n=t.battlebarDifficultyMultiplier)&&void 0!==n?n:1,onDeath:t.onDeath||"respawn",respawnHPPercent:t.respawnHPPercent||50,safeRoomCount:null!==(o=t.safeRoomCount)&&void 0!==o?o:3,safeRoomHealPercent:null!==(r=t.safeRoomHealPercent)&&void 0!==r?r:100,safeRoomUseLLM:t.safeRoomUseLLM||!1,restEnabled:!1!==t.restEnabled,restHealPercent:null!==(s=t.restHealPercent)&&void 0!==s?s:20,restCooldown:null!==(l=t.restCooldown)&&void 0!==l?l:3,restInterruptChance:null!==(c=t.restInterruptChance)&&void 0!==c?c:0,restInterruptScript:t.restInterruptScript||""},i(),console.log("[MazeMaster] Maze profile saved:",e,qt.mazeProfiles[e])}function Ba(){const e=Object.keys(qt.customThemes||{}),t=Object.keys(S);return[...e,...t.filter((t=>!e.includes(t)))]}function La(e){var t;return null!==(t=qt.customThemes)&&void 0!==t&&t[e]?qt.customThemes[e]:S[e]?S[e]:void 0}function qa(){const e=Object.keys(qt.customStyles||{}),t=Object.keys(M);return[...e,...t.filter((t=>!e.includes(t)))]}function Ra(e){var t;return null!==(t=qt.customStyles)&&void 0!==t&&t[e]?qt.customStyles[e]:M[e]?M[e]:void 0}function Na(){const e=document.getElementById("mazemaster_quest_list");if(!e)return;const t=Ct(),a=Object.keys(t);if(0===a.length)return void(e.innerHTML='<div style="color: #666; text-align: center; padding: 20px;">No quest templates defined</div>');let n="";for(const e of a){var o,i,r;const a=t[e],s=xt(a.type),l=void 0!==_t[e];n+='\n            <div class="mazemaster-quest-template-card" data-quest-id="'.concat(e,'">\n                <div class="quest-template-header">\n                    <div class="quest-template-title">\n                        <i class="fa-solid ').concat(s.icon,'"></i>\n                        <span>').concat(Or(a.name),"</span>\n                        ").concat(l?'<span class="quest-default-badge">Default</span>':"",'\n                    </div>\n                    <div class="quest-template-actions">\n                        <button class="menu_button menu_button_icon quest-edit-btn" data-quest="').concat(e,'" title="Edit">\n                            <i class="fa-solid fa-pen"></i>\n                        </button>\n                        ').concat(l?"":'\n                        <button class="menu_button menu_button_icon quest-delete-btn" data-quest="'.concat(e,'" title="Delete">\n                            <i class="fa-solid fa-trash"></i>\n                        </button>\n                        '),'\n                    </div>\n                </div>\n                <div class="quest-template-info">\n                    <span class="quest-template-type">').concat(s.name,'</span>\n                    <span class="quest-template-objective">').concat((null===(o=a.objective)||void 0===o?void 0:o.count)||1," ").concat((null===(i=a.objective)||void 0===i?void 0:i.target)||"target",'</span>\n                    <span class="quest-template-reward"><i class="fa-solid fa-star"></i> ').concat((null===(r=a.rewards)||void 0===r?void 0:r.xp)||0,' XP</span>\n                </div>\n                <div class="quest-template-description">').concat(Or(a.description),"</div>\n            </div>\n        ")}e.innerHTML=n}function Ha(){var e,t,a;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const o=n?kt(n):null,i=!o,r=n&&void 0!==_t[n],s=document.createElement("div");s.className="mazemaster-quest-editor-dialog",s.innerHTML='\n        <div class="mazemaster-quest-editor-backdrop"></div>\n        <div class="mazemaster-quest-editor-content">\n            <div class="mazemaster-quest-editor-header">\n                <h3>'.concat(i?"New Quest":r?"View Quest (Default)":"Edit Quest",'</h3>\n                <button class="quest-editor-close">&times;</button>\n            </div>\n            <div class="mazemaster-quest-editor-body">\n                <div class="mazemaster-row">\n                    <label style="width: 100px;">Quest ID</label>\n                    <input type="text" id="quest_edit_id" class="mazemaster-input"\n                        value="').concat(n||"",'"\n                        placeholder="quest_my_quest"\n                        ').concat(i?"":"readonly",'\n                        style="flex: 1;">\n                </div>\n                <div class="mazemaster-row">\n                    <label style="width: 100px;">Name</label>\n                    <input type="text" id="quest_edit_name" class="mazemaster-input"\n                        value="').concat((null==o?void 0:o.name)||"",'"\n                        placeholder="Quest Name"\n                        ').concat(r?"readonly":"",'\n                        style="flex: 1;">\n                </div>\n                <div class="mazemaster-row">\n                    <label style="width: 100px;">Type</label>\n                    <select id="quest_edit_type" class="mazemaster-select" ').concat(r?"disabled":"",">\n                        ").concat(Object.values(zt).map((e=>'\n                            <option value="'.concat(e.id,'" ').concat((null==o?void 0:o.type)===e.id?"selected":"",">").concat(e.name,"</option>\n                        "))).join(""),'\n                    </select>\n                </div>\n                <div class="mazemaster-row">\n                    <label style="width: 100px;">Target</label>\n                    <input type="text" id="quest_edit_target" class="mazemaster-input"\n                        value="').concat((null==o||null===(e=o.objective)||void 0===e?void 0:e.target)||"",'"\n                        placeholder="any, key, chest, boss..."\n                        ').concat(r?"readonly":"",'\n                        style="flex: 1;">\n                </div>\n                <div class="mazemaster-row">\n                    <label style="width: 100px;">Count</label>\n                    <input type="number" id="quest_edit_count" class="mazemaster-input"\n                        value="').concat((null==o||null===(t=o.objective)||void 0===t?void 0:t.count)||1,'"\n                        min="1"\n                        ').concat(r?"readonly":"",'\n                        style="width: 80px;">\n                </div>\n                <div class="mazemaster-row">\n                    <label style="width: 100px;">XP Reward</label>\n                    <input type="number" id="quest_edit_xp" class="mazemaster-input"\n                        value="').concat((null==o||null===(a=o.rewards)||void 0===a?void 0:a.xp)||50,'"\n                        min="0"\n                        ').concat(r?"readonly":"",'\n                        style="width: 80px;">\n                </div>\n                <div class="mazemaster-row">\n                    <label style="width: 100px;">Description</label>\n                    <textarea id="quest_edit_desc" class="mazemaster-textarea"\n                        rows="3"\n                        placeholder="Quest description..."\n                        ').concat(r?"readonly":"",'\n                        style="flex: 1;">').concat((null==o?void 0:o.description)||"",'</textarea>\n                </div>\n                <div class="mazemaster-row">\n                    <label class="mazemaster-checkbox-label">\n                        <input type="checkbox" id="quest_edit_llm" ').concat(null!=o&&o.useLLM?"checked":""," ").concat(r?"disabled":"",'>\n                        Generate name/description with LLM\n                    </label>\n                </div>\n            </div>\n            <div class="mazemaster-quest-editor-footer">\n                ').concat(r?"":'\n                <button id="quest_editor_save" class="menu_button">\n                    <i class="fa-solid fa-floppy-disk"></i> '.concat(i?"Create":"Save","\n                </button>\n                "),'\n                <button id="quest_editor_cancel" class="menu_button">\n                    ').concat(r?"Close":"Cancel","\n                </button>\n            </div>\n        </div>\n    "),document.body.appendChild(s),s.querySelector(".mazemaster-quest-editor-backdrop").addEventListener("click",(()=>s.remove())),s.querySelector(".quest-editor-close").addEventListener("click",(()=>s.remove())),s.querySelector("#quest_editor_cancel").addEventListener("click",(()=>s.remove()));const l=s.querySelector("#quest_editor_save");l&&l.addEventListener("click",(()=>{const e=document.getElementById("quest_edit_id").value.trim();if(!e)return void toastr.error("Quest ID is required");const t={id:e,name:document.getElementById("quest_edit_name").value.trim()||"Unnamed Quest",type:document.getElementById("quest_edit_type").value,description:document.getElementById("quest_edit_desc").value.trim(),objective:{target:document.getElementById("quest_edit_target").value.trim()||"any",count:parseInt(document.getElementById("quest_edit_count").value)||1},rewards:{xp:parseInt(document.getElementById("quest_edit_xp").value)||0,items:[]},useLLM:document.getElementById("quest_edit_llm").checked};!function(e,t){const a=SillyTavern.getContext();a.extensionSettings.mazemaster||(a.extensionSettings.mazemaster={}),a.extensionSettings.mazemaster.quests||(a.extensionSettings.mazemaster.quests={}),a.extensionSettings.mazemaster.quests[e]=t,a.saveSettingsDebounced()}(e,t),toastr.success("Quest ".concat(i?"created":"saved",": ").concat(t.name)),s.remove(),Na()}))}function Oa(){const e=document.getElementById("mazemaster_items_list");if(!e)return;const t=qt.customItems||{},a=Object.keys(t);0!==a.length?e.innerHTML=a.map((e=>{const a=t[e],n={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"}[a.rarity]||"#9e9e9e";return'\n            <div class="mazemaster-item-card" data-id="'.concat(e,'" style="border-left: 3px solid ').concat(n,';">\n                <div class="mazemaster-item-header">\n                    <i class="fa-solid ').concat(a.icon||"fa-box",'"></i>\n                    <span class="mazemaster-item-name">').concat(Or(a.name),'</span>\n                    <span class="mazemaster-item-type">(').concat(a.type,')</span>\n                </div>\n                <div class="mazemaster-item-desc">').concat(Or(a.description||""),'</div>\n                <div class="mazemaster-item-actions">\n                    <button class="menu_button menu_button_icon mazemaster-item-edit-btn" title="Edit">\n                        <i class="fa-solid fa-pen"></i>\n                    </button>\n                    <button class="menu_button menu_button_icon mazemaster-item-delete-btn" title="Delete">\n                        <i class="fa-solid fa-trash"></i>\n                    </button>\n                </div>\n            </div>\n        ')})).join(""):e.innerHTML='<p style="color: #888; text-align: center;">No custom items defined. Click "Add Item" to create one.</p>'}function Fa(){var e;const t=document.getElementById("mazemaster_itempool_custom");if(!t)return;const a=qt.customItems||{},n=Object.keys(a);if(0===n.length)return void(t.innerHTML="");const o=(null===(e=getCurrentMazeProfile().itemPool)||void 0===e?void 0:e.items)||[];t.innerHTML='\n        <label class="mazemaster-label" style="font-size: 0.8em; color: var(--SmartThemeEmColor);">Custom Items</label>\n        <div class="mazemaster-grid-4col" style="gap: 4px;">\n            '.concat(n.map((e=>{const t=a[e],n=o.includes(e)?"checked":"",i=t.icon||"fa-box",r={common:"#9e9e9e",uncommon:"#4caf50",rare:"#2196f3",epic:"#9c27b0",legendary:"#ff9800"}[t.rarity]||"#9e9e9e";return'<label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="'.concat(e,'" ').concat(n,'><i class="fa-solid ').concat(i,'" style="color:').concat(r,';"></i> ').concat(Or(t.name),"</label>")})).join(""),"\n        </div>\n    "),t.querySelectorAll("input[data-pool-item]").forEach((e=>{e.addEventListener("change",(()=>{updateItemPoolFromCheckboxes()}))}))}function Wa(){var e,t;const a=(null===(e=jt)||void 0===e||null===(e=e.profile)||void 0===e?void 0:e.visionProfile)||qt.currentVisionProfile||"default",n=null===(t=qt.visionProfiles)||void 0===t?void 0:t[a];return n||(je[a]||je.default)}function Ya(){var e,t,a,n;if(!jt.lighting)return 1;const o=Wa();let i=o.baseVisibility||1;return i+=null!==(e=null===(t=o.ambientLevels)||void 0===t?void 0:t[jt.lighting.ambientLevel])&&void 0!==e?e:0,jt.lighting.torchMovesLeft>0&&(i+=o.torchBonus||2),(null===(a=jt.inventory)||void 0===a?void 0:a.lantern)>0&&(i+=o.lanternBonus||1),jt.lighting.sightPotionMovesLeft>0&&(i+=o.sightPotionBonus||2),(null===(n=jt.visibility)||void 0===n?void 0:n.permBonus)>0&&(i+=jt.visibility.permBonus),i=Math.max(1,i),jt.lighting.lightRadius=i,i}function Ua(e,t,a){const n=function(e,t,a){var n;if(!jt.isOpen||!jt.grid)return null;const o=null===(n=jt.grid[t])||void 0===n?void 0:n[e];return o&&o.doors&&o.doors.find((e=>e.direction===a))||null}(e,t,a);return n?n.opened?null:n.locked?n:null:null}async function Ga(e){var t;if(!e||!e.locked)return{success:!0,message:"Door is not locked",method:"none"};const a=(null===(n=jt.profile)||void 0===n?void 0:n.doorSettings)||{enabled:!0,lockTypes:["key","puzzle","boss","switch"],onDoorLocked:"",onDoorUnlock:"",onDoorOpen:""};var n;let o=!1,i="none",r="";switch(e.lockType){case"key":var s,l;if(e.keyRequired)(null===(s=jt.customInventory)||void 0===s?void 0:s[e.keyRequired])>0?(jt.customInventory[e.keyRequired]--,o=!0,i="specific_key",r="Used ".concat(e.keyRequired," to unlock the door.")):r="This door requires a ".concat(e.keyRequired," to open.");else(null===(l=jt.inventory)||void 0===l?void 0:l.key)>0?(jt.inventory.key--,o=!0,i="key",r="Used a key to unlock the door."):r="This door is locked. You need a key.";break;case"puzzle":r="This door requires solving a puzzle.";break;case"boss":jt.exitEncounterDone?(o=!0,i="boss_defeated",r="The boss is defeated. The door opens."):r="A powerful presence guards this door. Defeat the boss to proceed.";break;case"switch":const a=e.keyRequired;null!==(t=jt.activatedSwitches)&&void 0!==t&&t.has(a)?(o=!0,i="switch",r="The switch has been activated. The door opens."):r="This door is controlled by a switch somewhere in the maze.";break;default:r="This door cannot be opened."}return o?(e.locked=!1,e.opened=!0,a.onDoorUnlock&&await W(substituteParams(a.onDoorUnlock,{doorId:e.id,method:i,lockType:e.lockType}),"onDoorUnlock"),a.onDoorOpen&&await W(substituteParams(a.onDoorOpen,{doorId:e.id}),"onDoorOpen"),Ri(),wi()):a.onDoorLocked&&await W(substituteParams(a.onDoorLocked,{doorId:e.id,lockType:e.lockType,keyRequired:e.keyRequired||"any"}),"onDoorLocked"),{success:o,message:r,method:i}}function ja(){var e,t;const a=(null===(e=jt)||void 0===e||null===(e=e.profile)||void 0===e?void 0:e.factionProfile)||qt.currentFactionProfile||"default",n=null===(t=qt.factionProfiles)||void 0===t?void 0:t[a];return n||(lt[a]||lt.default)}function Ka(e){const t=ja().tiers||lt.default.tiers;for(const[a,n]of Object.entries(t))if(e>=n.min&&e<=n.max)return a;return"neutral"}function Va(){var e;return!0===(null===(e=jt.profile)||void 0===e?void 0:e.permadeathEnabled)}let Xa=null,Qa=!1;function Ja(){var e,t;const a=(null===(e=jt)||void 0===e||null===(e=e.profile)||void 0===e?void 0:e.soundProfile)||qt.currentSoundProfile||"default",n=null===(t=qt.soundProfiles)||void 0===t?void 0:t[a];return n||{enabled:!0,masterVolume:.8,categoryVolumes:{combat:.8,ui:.6,ambient:.4,music:.5},sounds:{attack_hit:{category:"combat",volume:1},attack_miss:{category:"combat",volume:.8},critical_hit:{category:"combat",volume:1},block:{category:"combat",volume:.9},parry:{category:"combat",volume:1},enemy_attack:{category:"combat",volume:.8},enemy_hit:{category:"combat",volume:.9},enemy_critical:{category:"combat",volume:1},heal:{category:"ui",volume:.8},chest_open:{category:"ui",volume:.7},chest_unlock:{category:"ui",volume:.8},chest_locked:{category:"ui",volume:.5},item_pickup:{category:"ui",volume:.6},level_up:{category:"ui",volume:1},door_unlock:{category:"ui",volume:.7},door_locked:{category:"ui",volume:.5},footstep:{category:"ambient",volume:.3},trap_trigger:{category:"combat",volume:.9},victory:{category:"ui",volume:1},defeat:{category:"ui",volume:.9}},onSoundPlay:""}}async function Za(e){var t,a,n,o,i;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const s=Ja();if(!1===s.enabled||Qa)return;const l=null===(t=s.sounds)||void 0===t?void 0:t[e];if(!l)return void console.log("[MazeMaster] Sound not found: ".concat(e));const c=l.category||"ui",m=(null!==(a=s.masterVolume)&&void 0!==a?a:.8)*(null!==(n=null===(o=s.categoryVolumes)||void 0===o?void 0:o[c])&&void 0!==n?n:.5)*(null!==(i=l.volume)&&void 0!==i?i:1)*r;s.onSoundPlay&&await W(substituteParams(s.onSoundPlay,{soundId:e,category:c,volume:m}),"onSoundPlay"),l.path?await $a(l.path,m):function(e,t){if(!Xa)return;try{const a=Xa.createOscillator(),n=Xa.createGain();a.connect(n),n.connect(Xa.destination);const o={attack_hit:400,attack_miss:200,critical_hit:600,block:300,parry:500,chest_open:523,item_pickup:659,level_up:880,door_unlock:440,footstep:100,trap_trigger:220,victory:698,defeat:147};a.frequency.value=o[e]||440,a.type="sine",n.gain.setValueAtTime(.3*t,Xa.currentTime),n.gain.exponentialRampToValueAtTime(.01,Xa.currentTime+.1),a.start(Xa.currentTime),a.stop(Xa.currentTime+.1)}catch(e){}}(e,m)}async function $a(e,t){try{const a=new Audio(e);a.volume=Math.max(0,Math.min(1,t)),await a.play()}catch(t){console.warn("[MazeMaster] Could not play sound: ".concat(e),t)}}async function en(e){var a;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=function(){var e;const a=null===(e=jt)||void 0===e||null===(e=e.profile)||void 0===e?void 0:e.vfxEnabled,n=qt.vfxSettings||{enabled:!0,screenShake:!0,particles:!0,skillVFX:{attack_hit:{particleType:"sparks",color:"#fff",shake:{intensity:3,duration:100}},critical_hit:{particleType:"sparks",color:"#e74c3c",shake:{intensity:10,duration:250}},enemy_attack:{particleType:"sparks",color:"#c0392b",shake:{intensity:4,duration:150}},enemy_critical:{particleType:"flames",color:"#e74c3c",shake:{intensity:12,duration:300}},block:{particleType:"sparks",color:"#7f8c8d",shake:{intensity:4,duration:100}},parry:{particleType:"sparks",color:"#f1c40f",shake:{intensity:6,duration:150}},combat_power_strike:{particleType:"sparks",color:"#f39c12",shake:{intensity:5,duration:200}},magic_fireball:{particleType:"flames",color:"#e74c3c",shake:{intensity:8,duration:300}},magic_frost:{particleType:"frost",color:"#3498db",shake:{intensity:3,duration:150}},magic_lightning:{particleType:"lightning",color:"#f1c40f",shake:{intensity:7,duration:200}},heal:{particleType:"heal",color:"#2ecc71",shake:null},level_up:{particleType:"sparks",color:"#f39c12",shake:null}}};return"boolean"==typeof a?t(t({},n),{},{enabled:a}):n}();if(!o.enabled)return;const i=null===(a=o.skillVFX)||void 0===a?void 0:a[e];if(!i)return void console.log("[MazeMaster] VFX not found: ".concat(e));const r=n||document.getElementById("maze_grid_container")||document.getElementById("mazemaster_maze_modal");if(r&&(o.screenShake&&i.shake&&function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;if(!e)return;const n=e.style.transform,o=performance.now();function i(r){const s=r-o;if(s>=a)return void(e.style.transform=n);const l=1-s/a,c=2*(Math.random()-.5)*t*l,m=2*(Math.random()-.5)*t*l;e.style.transform="translate(".concat(c,"px, ").concat(m,"px)"),requestAnimationFrame(i)}requestAnimationFrame(i)}(r,i.shake.intensity,i.shake.duration),o.particles&&i.particleType)){const e=r.getBoundingClientRect(),t={x:e.left+e.width/2,y:e.top+e.height/2};!function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#fff";const o=document.createElement("div");o.className="mazemaster-particle-container",o.style.cssText="position: fixed; pointer-events: none; z-index: 9999;",document.body.appendChild(o);for(let i=0;i<t;i++){const t=document.createElement("div");t.className="mazemaster-particle particle-".concat(e);const i=Math.random()*Math.PI*2,r=50+100*Math.random(),s=Math.cos(i)*r,l=Math.sin(i)*r;t.style.cssText="\n            position: absolute;\n            left: ".concat(a.x,"px;\n            top: ").concat(a.y,"px;\n            width: 8px;\n            height: 8px;\n            background: ").concat(n,";\n            border-radius: 50%;\n            opacity: 1;\n            --dx: ").concat(s,"px;\n            --dy: ").concat(l,"px;\n            animation: particle-fly 0.5s ease-out forwards;\n        "),o.appendChild(t)}setTimeout((()=>o.remove()),600)}(i.particleType,10,t,i.color)}}let tn={},an=null;function nn(){return qt.animationSettings||{enabled:!0,animations:{player_idle:{frames:["idle_1","idle_2"],frameTime:500,loop:!0},player_walk:{frames:["walk_1","walk_2","walk_3","walk_4"],frameTime:150,loop:!0},player_attack:{frames:["attack_1","attack_2","attack_3"],frameTime:100,loop:!1},minion_idle:{frames:["minion_idle_1","minion_idle_2"],frameTime:400,loop:!0},minion_attack:{frames:["minion_attack_1","minion_attack_2"],frameTime:120,loop:!1},chest_open:{frames:["chest_closed","chest_opening","chest_open"],frameTime:150,loop:!1}},frameSprites:{idle_1:{sprite:null},idle_2:{sprite:null},walk_1:{sprite:null},walk_2:{sprite:null},walk_3:{sprite:null},walk_4:{sprite:null},attack_1:{sprite:null},attack_2:{sprite:null},attack_3:{sprite:null},minion_idle_1:{sprite:null},minion_idle_2:{sprite:null},minion_attack_1:{sprite:null},minion_attack_2:{sprite:null},chest_closed:{sprite:null},chest_opening:{sprite:null},chest_open:{sprite:null}}}}function on(e,t){var a;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=nn();if(!o.enabled)return;const i=null===(a=o.animations)||void 0===a?void 0:a[t];i?(tn[e]={animation:t,frames:i.frames,frameTime:i.frameTime||200,loop:!1!==i.loop,currentFrame:0,lastUpdate:performance.now(),onComplete:n},an||rn()):console.log("[MazeMaster] Animation not found: ".concat(t))}function rn(){const e=performance.now();let t=!1;for(const[a,n]of Object.entries(tn)){t=!0;if(e-n.lastUpdate>=n.frameTime){if(n.currentFrame++,n.lastUpdate=e,n.currentFrame>=n.frames.length){if(!n.loop){n.onComplete&&n.onComplete(),delete tn[a];continue}n.currentFrame=0}sn(a,n.frames[n.currentFrame])}}an=t||Object.keys(tn).length>0?requestAnimationFrame(rn):null}function sn(e,t){var a;const n=null===(a=nn().frameSprites)||void 0===a?void 0:a[t];if("player"===e){const e=document.getElementById("maze_player_overlay");e&&(e.dataset.animFrame=t,null!=n&&n.sprite&&(e.style.backgroundImage="url('".concat(n.sprite,"')")))}else if(e.startsWith("minion_")){e.replace("minion_","");const t=document.getElementById("maze_minion_img");t&&null!=n&&n.sprite&&(t.src=n.sprite)}else{const a=document.querySelector('[data-entity="'.concat(e,'"]'));a&&(a.dataset.animFrame=t,null!=n&&n.sprite&&("IMG"===a.tagName?a.src=n.sprite:a.style.backgroundImage="url('".concat(n.sprite,"')")))}}function ln(){const e=document.getElementById("mazemaster_theme_profile_select");if(!e)return;const t=Ba(),a=qt.customThemes||{};e.innerHTML='<option value="">-- Select Theme --</option>'+t.map((e=>{const t=La(e),n=t&&t.displayName?t.displayName:e,o=S[e]&&!a[e]?"".concat(n," (Default)"):n;return'<option value="'.concat(Or(e),'">').concat(Or(o),"</option>")})).join("")}function cn(){const e=document.getElementById("mazemaster_style_profile_select");if(!e)return;const t=qa(),a=qt.customStyles||{};e.innerHTML='<option value="">-- Select Style --</option>'+t.map((e=>{const t=Ra(e),n=t&&t.displayName?t.displayName:e,o=M[e]&&!a[e]?"".concat(n," (Default)"):n;return'<option value="'.concat(Or(e),'">').concat(Or(o),"</option>")})).join("")}function mn(){["mazemaster_theme_name","mazemaster_theme_display","mazemaster_theme_tags","mazemaster_theme_atmosphere","mazemaster_theme_adjectives","mazemaster_theme_rooms_small","mazemaster_theme_rooms_medium","mazemaster_theme_rooms_large","mazemaster_theme_rooms_special","mazemaster_theme_flavor_chest","mazemaster_theme_flavor_trap","mazemaster_theme_flavor_victory","mazemaster_theme_flavor_defeat"].forEach((e=>{const t=document.getElementById(e);t&&(t.value="")}));const e=document.getElementById("mazemaster_theme_color_primary"),t=document.getElementById("mazemaster_theme_color_secondary"),a=document.getElementById("mazemaster_theme_color_accent");e&&(e.value="#8b0000"),t&&(t.value="#2d1f1f"),a&&(a.value="#ff4444")}function dn(){["mazemaster_style_name","mazemaster_style_display","mazemaster_style_common_prefixes","mazemaster_style_common_nouns","mazemaster_style_common_desc","mazemaster_style_junction_prefixes","mazemaster_style_junction_nouns","mazemaster_style_junction_desc","mazemaster_style_deadend_prefixes","mazemaster_style_deadend_nouns","mazemaster_style_deadend_desc","mazemaster_style_start_names","mazemaster_style_staircase_names","mazemaster_style_portal_names","mazemaster_style_chest_names","mazemaster_style_minion_names","mazemaster_style_trap_names","mazemaster_style_exit_names"].forEach((e=>{const t=document.getElementById(e);t&&(t.value="")}));const e=(e,t)=>{const a=document.getElementById(e);a&&(a.value=t)},t=(e,t)=>{const a=document.getElementById(e);a&&(a.checked=t)};e("mazemaster_style_bsp_minroom","2"),e("mazemaster_style_bsp_maxroom","5"),e("mazemaster_style_bsp_corridor","1"),e("mazemaster_style_bsp_padding","1"),e("mazemaster_style_bsp_minsplit","4"),e("mazemaster_style_bsp_variance","0.3"),e("mazemaster_style_bsp_connections","0.1"),e("mazemaster_style_bsp_branch","0.3"),t("mazemaster_style_bsp_grid",!1),t("mazemaster_style_bsp_winding",!1),t("mazemaster_style_bsp_modular",!1),t("mazemaster_style_bsp_square",!1)}function un(){return Object.keys(qt.minions||{})}function pn(e){return qt.minions[e]}function hn(e,t){qt.minions[e]={name:t.name||"Unknown",imagePath:t.imagePath||"",description:t.description||"",type:t.type||"messenger",battlebarProfiles:t.battlebarProfiles||[],wheelProfiles:t.wheelProfiles||[],messages:t.messages||[],encounterScript:t.encounterScript||"",merchantItemCount:t.merchantItemCount||{min:1,max:3},movement:t.movement||{type:"stationary",patrolRadius:3,chaseRange:5,speed:1}},i(),console.log("[MazeMaster] Minion saved:",e,qt.minions[e])}function gn(){return Object.keys(qt.traps||{})}function fn(e){var t;return null===(t=qt.traps)||void 0===t?void 0:t[e]}function yn(e,t){var a;qt.traps||(qt.traps={}),qt.traps[e]={name:t.name||"Unknown Trap",imagePath:t.imagePath||"",message:t.message||"You triggered a trap!",script:t.script||"",avoidChance:null!==(a=t.avoidChance)&&void 0!==a?a:0,avoidMessage:t.avoidMessage||"",avoidScript:t.avoidScript||""},i(),console.log("[MazeMaster] Trap saved:",e,qt.traps[e])}function vn(e){const a=ta(e);return a&&a.segments&&0!==a.segments.length?(Rt.segments=a.segments.map(((e,a)=>t(t({},e),{},{units:v[e.size]||1,color:y[a%y.length]}))),Rt.isOpen=!1,Rt.isSpinning=!1,Rt.pendingRespin=!1,Rt.hasRespun=!1,{success:!0,count:Rt.segments.length}):{error:'Profile "'.concat(e,'" not found or empty')}}function bn(){const e=Rt.segments.filter((e=>"halfseg"===e.size)).length,t=Rt.segments.filter((e=>"doubleseg"===e.size)).length;return e!==t?(console.error("[MazeMaster] Wheel balance error: ".concat(e," halfseg(s) but ").concat(t," doubleseg(s). They must be equal.")),{valid:!1,error:"Wheel unbalanced: ".concat(e," halfseg(s)  ").concat(t," doubleseg(s)")}):{valid:!0}}function zn(){return Rt.segments.reduce(((e,t)=>e+t.units),0)}function _n(){Rt.segments=[],Rt.isOpen=!1,Rt.isSpinning=!1,Rt.pendingRespin=!1,Rt.hasRespun=!1}function xn(){const e=document.getElementById("mazemaster_wheel_modal");if(e&&e.remove(),!document.getElementById("mazemaster_wheel_styles")){const e=document.createElement("style");e.id="mazemaster_wheel_styles",e.textContent="\n        .mazemaster-wheel-overlay {\n            position: fixed;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            background: rgba(0, 0, 0, 0.95);\n            display: flex;\n            align-items: flex-start;\n            justify-content: center;\n            z-index: 10002;\n            overflow-y: auto;\n            padding: 10px 0;\n            -webkit-overflow-scrolling: touch;\n        }\n\n        .mazemaster-wheel-container {\n            position: relative;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            gap: 20px;\n            padding: 25px;\n            margin: auto;\n            background: #1a1a2e;\n            border-radius: 15px;\n            border: 2px solid #333;\n            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);\n        }\n\n        .mazemaster-wheel-pointer {\n            position: absolute;\n            top: -20px;\n            left: 50%;\n            transform: translateX(-50%);\n            width: 0;\n            height: 0;\n            border-left: 15px solid transparent;\n            border-right: 15px solid transparent;\n            border-top: 30px solid #fff;\n            z-index: 10;\n            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));\n        }\n\n        #mazemaster_wheel_canvas {\n            border-radius: 50%;\n            box-shadow: 0 0 30px rgba(0,0,0,0.5), inset 0 0 20px rgba(255,255,255,0.1);\n            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);\n        }\n\n        .mazemaster-spin-btn {\n            padding: 15px 40px;\n            font-size: 1.2em;\n            font-weight: bold;\n            background: linear-gradient(135deg, #e74c3c, #c0392b);\n            color: white;\n            border: none;\n            border-radius: 30px;\n            cursor: pointer;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);\n            transition: transform 0.2s, box-shadow 0.2s;\n        }\n\n        .mazemaster-spin-btn:hover {\n            transform: scale(1.05);\n            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.6);\n        }\n\n        .mazemaster-spin-btn:disabled {\n            background: #555;\n            cursor: not-allowed;\n            box-shadow: none;\n            transform: none;\n        }\n\n        .mazemaster-spin-btn.respin {\n            background: linear-gradient(135deg, #f39c12, #d68910);\n            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.4);\n        }\n\n        .mazemaster-spin-btn.respin:hover {\n            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.6);\n        }\n\n        .mazemaster-wheel-cancel-btn {\n            position: absolute;\n            top: 8px;\n            right: 8px;\n            width: 28px;\n            height: 28px;\n            border-radius: 50%;\n            background: rgba(100, 100, 100, 0.8);\n            color: #ccc;\n            border: 1px solid #555;\n            cursor: pointer;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 14px;\n            z-index: 100;\n            transition: background 0.2s, color 0.2s;\n        }\n\n        .mazemaster-wheel-cancel-btn:hover {\n            background: rgba(180, 60, 60, 0.9);\n            color: white;\n            border-color: #a33;\n        }\n    ",document.head.appendChild(e)}const t=document.createElement("div");t.innerHTML=function(){const e=jt.isOpen&&jt.pendingEncounter;return'\n        <div id="mazemaster_wheel_modal" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:999999;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.95);">\n            <div class="mazemaster-wheel-container">\n                '.concat(e?'<button id="mazemaster_wheel_cancel_btn" class="mazemaster-wheel-cancel-btn" title="Cancel wheel (skip encounter)"><i class="fa-solid fa-xmark"></i></button>':"",'\n                <div class="mazemaster-wheel-pointer"></div>\n                <canvas id="mazemaster_wheel_canvas" width="400" height="400"></canvas>\n                <button id="mazemaster_spin_btn" class="mazemaster-spin-btn">\n                    <i class="fa-solid fa-play"></i> SPIN\n                </button>\n            </div>\n        </div>\n    ')}(),document.body.appendChild(t.firstElementChild);const a=document.getElementById("mazemaster_wheel_canvas");a&&function(e){const t=e.getContext("2d"),a=e.width/2,n=e.height/2,o=Math.min(a,n)-10;t.clearRect(0,0,e.width,e.height);const i=zn();let r=-Math.PI/2;for(const e of Rt.segments){const s=e.units/i*2*Math.PI;t.beginPath(),t.moveTo(a,n),t.arc(a,n,o,r,r+s),t.closePath(),t.fillStyle=e.color,t.fill(),t.strokeStyle="#222",t.lineWidth=2,t.stroke();const l=r+s/2,c=.55*o,m=a+Math.cos(l)*c,d=n+Math.sin(l)*c;t.save(),t.translate(m,d),t.rotate(l),t.fillStyle="#fff",t.font="bold 12px Arial",t.textAlign="center",t.textBaseline="middle",t.shadowColor="rgba(0,0,0,0.5)",t.shadowBlur=3;let u=e.text||e.trigger;u.length>12&&(u=u.substring(0,10)+"..."),t.fillText(u,0,0),t.restore(),r+=s}t.beginPath(),t.arc(a,n,20,0,2*Math.PI),t.fillStyle="#333",t.fill(),t.strokeStyle="#555",t.lineWidth=3,t.stroke()}(a);const n=document.getElementById("mazemaster_spin_btn");n&&n.addEventListener("click",kn);const o=document.getElementById("mazemaster_wheel_cancel_btn");o&&o.addEventListener("click",(()=>{if(Rt.isSpinning)return;console.log("[MazeMaster] Wheel cancelled by user");const e=document.getElementById("mazemaster_wheel_modal");if(e&&e.remove(),Rt.isOpen=!1,Rt.isSpinning=!1,_n(),jt.isOpen){var t;const e=null===(t=jt.pendingEncounter)||void 0===t?void 0:t.type;jt.pendingEncounter=null,"exit_wheel"===e?jt.isPaused=!1:qi()}})),Rt.isOpen=!0}async function kn(){var e,t;const a=document.getElementById("mazemaster_spin_btn");if(!a||Rt.isSpinning)return;a.disabled=!0,a.innerHTML='<i class="fa-solid fa-spinner fa-spin"></i> Spinning...',Rt.isSpinning=!0,Rt.pendingRespin=!1;const n=function(){const e=zn();let t=Math.random()*e;for(const e of Rt.segments)if(t-=e.units,t<=0)return e;return Rt.segments[Rt.segments.length-1]}(),o=document.getElementById("mazemaster_wheel_canvas");if(!o)return void(Rt.isSpinning=!1);const i=zn();let r=0;for(const e of Rt.segments){if(e===n)break;r+=e.units/i*360}const s=r+n.units/i*360/2,l=5+Math.floor(3*Math.random()),c=parseFloat((null===(e=o.style.transform)||void 0===e||null===(e=e.match(/rotate\((\d+\.?\d*)deg\)/))||void 0===e?void 0:e[1])||0)+360*l+(360-s);o.style.transition="transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99)",o.style.transform="rotate(".concat(c,"deg)"),await new Promise((e=>setTimeout(e,4200))),Rt.isSpinning=!1,n.command&&(console.log('[MazeMaster] Executing command for "'.concat(n.text,'": ').concat(n.command)),await W(n.command));const m=jt.isOpen&&null!==(t=jt.pendingEncounter)&&void 0!==t&&t.profile?jt.pendingEncounter.profile:qt.currentProfile;Kt.wheel[m||"unknown"]={segmentName:n.text,command:n.command||"",timestamp:Date.now()},n.respin&&!Rt.hasRespun?(Rt.pendingRespin=!0,Rt.hasRespun=!0,a.disabled=!1,a.className="mazemaster-spin-btn respin",a.innerHTML='<i class="fa-solid fa-rotate"></i> RESPIN'):(!function(){const e=document.getElementById("mazemaster_wheel_modal");if(e&&e.remove(),Rt.isOpen=!1,jt.isOpen){try{if(jt.pendingEncounter){const e=jt.pendingEncounter.type;if("exit_wheel"===e)return jt.exitEncounterDone=!0,jt.isPaused=!1,void Rr();if("wheel"===e)return void qi()}}catch(e){console.error("[MazeMaster] Error in closeWheelModal:",e)}jt.isPaused=!1,jt.pendingEncounter=null}}(),_n())}function Cn(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;console.log("[MazeMaster] startTurnBased called with profile:",e);const a=ra(e);if(console.log("[MazeMaster] Retrieved profile:",a),!a)return console.error('[MazeMaster] Turn-based profile "'.concat(e,'" not found')),{error:'Profile "'.concat(e,'" not found')};let n=a.playerHP||100,o=a.playerHP||100,i=!1;jt.isOpen&&jt.hpEnabled&&jt.hp?(i=!0,n=jt.hp.current,o=jt.hp.max+(jt.hp.maxBonus||0),console.log("[MazeMaster] Using maze HP for combat:",n,"/",o)):console.log("[MazeMaster] Using profile HP for combat:",n,"/",o);const r=Object.keys(bt),s=r[Math.floor(Math.random()*r.length)];return console.log("[MazeMaster] Initializing turn-based combat state"),Ht={isOpen:!0,profile:a,profileName:e,playerHP:n,playerMaxHP:o,enemyHP:a.enemyHP||100,enemyMaxHP:a.enemyHP||100,currentTurn:"enemy_first"===a.turnOrder?"enemy":"player",turnCount:1,isDefending:!1,isVictory:!1,isDefeat:!1,isMazeEncounter:i,combatLog:["Combat begins!"],enemyNameOverride:t,playerStatusEffects:[],enemyStatusEffects:[],enemyType:s,isFirstStrike:!0,difficulty:a.difficulty||1},jt.isOpen&&(jt.isPaused=!0),function(){console.log("[MazeMaster] showTurnBasedModal called");const e=document.getElementById("mazemaster_turnbased_modal");e&&(console.log("[MazeMaster] Removing existing turn-based modal"),e.remove());if(!document.getElementById("mazemaster_tb_styles")){console.log("[MazeMaster] Adding turn-based styles");const e=document.createElement("style");e.id="mazemaster_tb_styles",e.textContent="\n        .mazemaster-tb-container {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            gap: 15px;\n            padding: 25px;\n            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\n            border-radius: 15px;\n            border: 2px solid #4a7c59;\n            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), 0 0 20px rgba(74, 124, 89, 0.3);\n            width: 500px;\n            max-width: 95vw;\n            max-height: 90vh;\n            overflow-y: auto;\n        }\n\n        .mazemaster-tb-main-title {\n            font-size: 1.8em;\n            font-weight: bold;\n            color: #fff;\n            text-shadow: 0 2px 4px rgba(0,0,0,0.5);\n        }\n\n        .mazemaster-tb-combatants {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            width: 100%;\n            gap: 20px;\n        }\n\n        .mazemaster-tb-combatant {\n            flex: 1;\n            text-align: center;\n            padding: 15px;\n            background: rgba(0,0,0,0.3);\n            border-radius: 10px;\n        }\n\n        .tb-combatant-name {\n            font-size: 1.2em;\n            font-weight: bold;\n            margin-bottom: 10px;\n            color: #fff;\n        }\n\n        .tb-hp-bar-container {\n            width: 100%;\n            height: 20px;\n            background: #333;\n            border-radius: 10px;\n            overflow: hidden;\n            margin-bottom: 5px;\n        }\n\n        .tb-hp-bar {\n            height: 100%;\n            transition: width 0.3s ease;\n            border-radius: 10px;\n        }\n\n        .tb-hp-player {\n            background: linear-gradient(90deg, #2ecc71 0%, #27ae60 100%);\n        }\n\n        .tb-hp-enemy {\n            background: linear-gradient(90deg, #e74c3c 0%, #c0392b 100%);\n        }\n\n        .tb-hp-text {\n            font-size: 0.9em;\n            color: #aaa;\n        }\n\n        .tb-status-effects {\n            display: flex;\n            flex-wrap: wrap;\n            gap: 4px;\n            justify-content: center;\n            margin-top: 8px;\n            min-height: 24px;\n        }\n\n        .tb-status-icon {\n            width: 24px;\n            height: 24px;\n            border-radius: 4px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 12px;\n            color: white;\n            position: relative;\n            cursor: help;\n            animation: status-pulse 2s ease-in-out infinite;\n        }\n\n        .tb-status-icon .status-duration {\n            position: absolute;\n            bottom: -4px;\n            right: -4px;\n            background: #333;\n            border-radius: 50%;\n            width: 14px;\n            height: 14px;\n            font-size: 10px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            border: 1px solid #555;\n        }\n\n        @keyframes status-pulse {\n            0%, 100% { opacity: 1; }\n            50% { opacity: 0.7; }\n        }\n\n        .tb-status-dot { animation: status-pulse 1s ease-in-out infinite; }\n        .tb-status-cc { animation: status-shake 0.5s ease-in-out infinite; }\n\n        @keyframes status-shake {\n            0%, 100% { transform: translateX(0); }\n            25% { transform: translateX(-2px); }\n            75% { transform: translateX(2px); }\n        }\n\n        .tb-log-status { color: #9b59b6; }\n        .tb-log-burn { color: #e74c3c; }\n        .tb-log-poison { color: #2ecc71; }\n        .tb-log-freeze { color: #3498db; }\n        .tb-log-stun { color: #f1c40f; }\n        .tb-log-ability { color: #e67e22; font-style: italic; }\n\n        /* v1.6.0: Combo/Block/Parry log styles */\n        .tb-log-combo { color: #f39c12; font-weight: bold; }\n        .tb-log-block { color: #3498db; font-weight: bold; }\n        .tb-log-block-break { color: #e74c3c; font-weight: bold; font-style: italic; }\n        .tb-log-parry { color: #9b59b6; font-style: italic; }\n        .tb-log-parry-success { color: #2ecc71; font-weight: bold; }\n        .tb-log-info { color: #95a5a6; font-style: italic; }\n\n        /* v1.6.0: Combo display */\n        .tb-combo-display {\n            display: none;\n            align-items: center;\n            justify-content: center;\n            gap: 8px;\n            margin-top: 8px;\n            padding: 5px 15px;\n            background: linear-gradient(135deg, rgba(243, 156, 18, 0.3) 0%, rgba(231, 76, 60, 0.3) 100%);\n            border-radius: 15px;\n            border: 2px solid #f39c12;\n            animation: combo-glow 0.5s ease-in-out infinite alternate;\n        }\n\n        .tb-combo-display.combo-active {\n            display: flex;\n        }\n\n        .combo-counter {\n            font-size: 1.4em;\n            font-weight: bold;\n            color: #f39c12;\n            text-shadow: 0 0 10px rgba(243, 156, 18, 0.8);\n        }\n\n        .combo-bonus {\n            font-size: 1.1em;\n            color: #2ecc71;\n            font-weight: bold;\n        }\n\n        @keyframes combo-glow {\n            0% { box-shadow: 0 0 5px rgba(243, 156, 18, 0.5); }\n            100% { box-shadow: 0 0 15px rgba(243, 156, 18, 0.8); }\n        }\n\n        /* v1.6.0: Block/Parry button styles */\n        .tb-btn-block {\n            background: linear-gradient(135deg, #2980b9 0%, #1abc9c 100%) !important;\n        }\n\n        .tb-btn-block:hover {\n            background: linear-gradient(135deg, #3498db 0%, #1abc9c 100%) !important;\n        }\n\n        .tb-btn-parry {\n            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%) !important;\n        }\n\n        .tb-btn-parry:hover {\n            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%) !important;\n        }\n\n        .mazemaster-tb-vs {\n            font-size: 1.5em;\n            font-weight: bold;\n            color: #f39c12;\n            text-shadow: 0 2px 4px rgba(0,0,0,0.5);\n        }\n\n        .mazemaster-tb-turn-indicator {\n            font-size: 1.1em;\n            color: #3498db;\n            padding: 8px 20px;\n            background: rgba(52, 152, 219, 0.2);\n            border-radius: 20px;\n            border: 1px solid rgba(52, 152, 219, 0.5);\n        }\n\n        .mazemaster-tb-log {\n            width: 100%;\n            height: 120px;\n            background: rgba(0,0,0,0.4);\n            border-radius: 8px;\n            padding: 10px;\n            overflow-y: auto;\n            font-size: 0.9em;\n            color: #ccc;\n        }\n\n        .tb-log-entry {\n            padding: 3px 0;\n            border-bottom: 1px solid rgba(255,255,255,0.1);\n        }\n\n        .tb-log-entry:last-child {\n            border-bottom: none;\n        }\n\n        .tb-log-damage { color: #e74c3c; }\n        .tb-log-heal { color: #2ecc71; }\n        .tb-log-defend { color: #3498db; }\n        .tb-log-crit { color: #f39c12; font-weight: bold; }\n        .tb-log-flee { color: #9b59b6; }\n\n        .mazemaster-tb-actions {\n            display: flex;\n            gap: 10px;\n            flex-wrap: wrap;\n            justify-content: center;\n        }\n\n        .mazemaster-tb-btn {\n            padding: 12px 20px;\n            border: none;\n            border-radius: 8px;\n            font-size: 1em;\n            font-weight: bold;\n            cursor: pointer;\n            transition: all 0.2s ease;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .mazemaster-tb-btn:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n        }\n\n        .mazemaster-tb-btn:disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n            transform: none;\n        }\n\n        .tb-btn-attack {\n            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);\n            color: white;\n        }\n\n        .tb-btn-defend {\n            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);\n            color: white;\n        }\n\n        .tb-btn-item {\n            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);\n            color: white;\n        }\n\n        .tb-btn-flee {\n            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);\n            color: white;\n        }\n\n        .tb-btn-skill {\n            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);\n            color: white;\n        }\n\n        .tb-btn-skill:hover {\n            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);\n        }\n\n        .tb-btn-close {\n            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);\n            color: white;\n            padding: 15px 40px;\n        }\n\n        .mazemaster-tb-result {\n            text-align: center;\n        }\n\n        .tb-result-text {\n            font-size: 1.5em;\n            font-weight: bold;\n            margin-bottom: 15px;\n        }\n\n        .tb-result-victory { color: #2ecc71; }\n        .tb-result-defeat { color: #e74c3c; }\n        .tb-result-fled { color: #9b59b6; }\n\n        .tb-combatant.defending {\n            box-shadow: 0 0 15px rgba(52, 152, 219, 0.6);\n        }\n\n        .tb-hp-bar.flash-damage {\n            animation: tb-flash-damage 0.3s ease;\n        }\n\n        .tb-hp-bar.flash-heal {\n            animation: tb-flash-heal 0.3s ease;\n        }\n\n        @keyframes tb-flash-damage {\n            0%, 100% { filter: brightness(1); }\n            50% { filter: brightness(1.5) saturate(2); }\n        }\n\n        @keyframes tb-flash-heal {\n            0%, 100% { filter: brightness(1); }\n            50% { filter: brightness(1.5) hue-rotate(60deg); }\n        }\n    ",document.head.appendChild(e)}console.log("[MazeMaster] Inserting turn-based modal HTML"),document.body.insertAdjacentHTML("beforeend",'\n        <div id="mazemaster_turnbased_modal" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:999999;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.9);">\n            <div class="mazemaster-tb-container">\n                <div id="tb_main_title" class="mazemaster-tb-main-title">Combat!</div>\n\n                <div class="mazemaster-tb-combatants">\n                    <div class="mazemaster-tb-combatant tb-player">\n                        <div class="tb-combatant-name">You</div>\n                        <div class="tb-hp-bar-container">\n                            <div class="tb-hp-bar tb-hp-player" id="tb_player_hp_bar"></div>\n                        </div>\n                        <div class="tb-hp-text"><span id="tb_player_hp">100</span>/<span id="tb_player_max_hp">100</span> HP</div>\n                        <div class="tb-status-effects" id="tb_player_status_effects"></div>\n                    </div>\n                    <div class="mazemaster-tb-vs">VS</div>\n                    <div class="mazemaster-tb-combatant tb-enemy">\n                        <div class="tb-combatant-name" id="tb_enemy_name">Enemy</div>\n                        <div class="tb-hp-bar-container">\n                            <div class="tb-hp-bar tb-hp-enemy" id="tb_enemy_hp_bar"></div>\n                        </div>\n                        <div class="tb-hp-text"><span id="tb_enemy_hp">100</span>/<span id="tb_enemy_max_hp">100</span> HP</div>\n                        <div class="tb-status-effects" id="tb_enemy_status_effects"></div>\n                    </div>\n                </div>\n\n                <div class="mazemaster-tb-turn-indicator">\n                    <span id="tb_turn_text">Your Turn</span> - Turn <span id="tb_turn_count">1</span>\n                    <div id="tb_combo_display" class="tb-combo-display" style="display: none;"></div>\n                </div>\n\n                <div class="mazemaster-tb-log" id="tb_combat_log">\n                    <div class="tb-log-entry">Combat begins!</div>\n                </div>\n\n                <div class="mazemaster-tb-actions" id="tb_action_buttons">\n                    <button id="tb_attack_btn" class="mazemaster-tb-btn tb-btn-attack">\n                        <i class="fa-solid fa-sword"></i> Attack\n                    </button>\n                    <button id="tb_defend_btn" class="mazemaster-tb-btn tb-btn-defend">\n                        <i class="fa-solid fa-shield"></i> Defend\n                    </button>\n                    <button id="tb_block_btn" class="mazemaster-tb-btn tb-btn-block">\n                        <i class="fa-solid fa-shield-halved"></i> Block\n                    </button>\n                    <button id="tb_parry_btn" class="mazemaster-tb-btn tb-btn-parry">\n                        <i class="fa-solid fa-rotate-left"></i> Parry\n                    </button>\n                    <button id="tb_item_btn" class="mazemaster-tb-btn tb-btn-item">\n                        <i class="fa-solid fa-flask"></i> Item\n                    </button>\n                    <button id="tb_skill_btn" class="mazemaster-tb-btn tb-btn-skill">\n                        <i class="fa-solid fa-fire"></i> Skills\n                    </button>\n                    <button id="tb_flee_btn" class="mazemaster-tb-btn tb-btn-flee">\n                        <i class="fa-solid fa-person-running"></i> Flee\n                    </button>\n                </div>\n\n                <div class="mazemaster-tb-result" id="tb_result_panel" style="display: none;">\n                    <div id="tb_result_text" class="tb-result-text"></div>\n                    <button id="tb_close_btn" class="mazemaster-tb-btn tb-btn-close">\n                        <i class="fa-solid fa-check"></i> Close\n                    </button>\n                </div>\n            </div>\n        </div>\n    ');const t=document.getElementById("mazemaster_turnbased_modal");console.log("[MazeMaster] Modal element exists:",!!t);const a=document.getElementById("tb_main_title"),n=document.getElementById("tb_enemy_name");console.log("[MazeMaster] Title element:",a,"Enemy name element:",n);const o=Ht.enemyNameOverride||Ht.profile.mainTitle||"Combat!";a&&(a.textContent=o);n&&(n.textContent=Ht.enemyNameOverride||Ht.profile.enemyName||"Enemy");console.log("[MazeMaster] Attaching turn-based event handlers");const i=document.getElementById("tb_attack_btn"),r=document.getElementById("tb_defend_btn"),s=document.getElementById("tb_block_btn"),l=document.getElementById("tb_parry_btn"),c=document.getElementById("tb_item_btn"),m=document.getElementById("tb_skill_btn"),d=document.getElementById("tb_flee_btn"),u=document.getElementById("tb_close_btn");console.log("[MazeMaster] Button elements found:",{attack:!!i,defend:!!r,block:!!s,parry:!!l,item:!!c,skill:!!m,flee:!!d,close:!!u}),i&&(i.onclick=e=>{console.log("[MazeMaster] Attack button clicked!",e),async function(){var e;if("player"!==Ht.currentTurn)return;if(lr("player")){En('<span class="tb-log-stun">You are unable to act!</span>');const e=cr("player");return e.damage>0&&(Ht.playerHP=Math.max(0,Ht.playerHP-e.damage),Sn(!0,!0)),pr(),Ht.playerHP<=0?void await qn():(Ht.currentTurn="enemy",wn(),void setTimeout((()=>Bn()),1e3))}const t=Ht.profile;Ht.isDefending=!1;const a=mr("player"),n=!0===Ht.isFirstStrike,{damage:o,isCrit:i,lifestealPercent:r}=An(t.playerAttack||15,t.enemyDefense||5,t.critChance||10,t.critMultiplier||2,!0,!1,n),s=Math.round(o*(1+(a.damageBonus||0)/100));Ht.isFirstStrike=!1,Ht.enemyHP=Math.max(0,Ht.enemyHP-s),Sn(!1,!0);const l=document.querySelector(".turn-based-container");on("player","player_attack"),i?(Za("critical_hit"),en("critical_hit",l)):(Za("attack_hit"),en("attack_hit",l));const c=await async function(){var e;if(null===(e=jt)||void 0===e||!e.combatMechanics)return{comboCount:0,bonusDamage:0,totalBonus:0};const t=Tn();if(!t.comboEnabled)return{comboCount:0,bonusDamage:0,totalBonus:0};const a=jt.combatMechanics,n=0===a.comboCounter;a.comboCounter++,a.comboDecayTimer=t.comboDecayTurns,a.comboCounter>a.maxCombo&&(a.maxCombo=a.comboCounter);const o=Math.min(a.comboCounter*t.comboBonusPerHit,t.maxComboBonus);n&&t.onComboStart&&await W(t.onComboStart,{comboCount:a.comboCounter});t.onComboIncrease&&await W(t.onComboIncrease,{comboCount:a.comboCounter,bonusDamage:t.comboBonusPerHit,totalBonus:o});return{comboCount:a.comboCounter,bonusDamage:t.comboBonusPerHit,totalBonus:o}}();Dn(),i?c.comboCount>1?En('<span class="tb-log-crit">CRITICAL HIT! '.concat(c.comboCount,"x COMBO! You deal ").concat(s," damage!</span>")):En('<span class="tb-log-crit">CRITICAL HIT! You deal '.concat(s," damage!</span>")):c.comboCount>1?En('<span class="tb-log-combo">'.concat(c.comboCount,"x COMBO!</span> You attack for ").concat(s," damage!")):En("You attack for ".concat(s," damage!"));if(r>0&&s>0){const e=Math.round(s*r/100);e>0&&(Ht.playerHP=Math.min(Ht.playerMaxHP,Ht.playerHP+e),Sn(!0,!1),Za("heal"),en("heal",l),En('<span class="tb-log-heal">Lifesteal heals you for '.concat(e," HP!</span>")))}null!==(e=jt)&&void 0!==e&&null!==(e=e.equipment)&&void 0!==e&&e.weapon&&ji("weapon",1);t.onAttack&&await W(t.onAttack);if(Ht.enemyHP<=0)return void await Ln();Ht.currentTurn="enemy",wn(),setTimeout((()=>Bn()),1e3)}()});r&&(r.onclick=e=>{console.log("[MazeMaster] Defend button clicked!",e),async function(){if("player"!==Ht.currentTurn)return;Ht.isDefending=!0,En("You take a defensive stance."),Ht.profile.onDefend&&await W(Ht.profile.onDefend);Ht.currentTurn="enemy",wn(),setTimeout((()=>Bn()),1e3)}()});s&&(s.onclick=e=>{console.log("[MazeMaster] Block button clicked!",e),async function(){if("player"!==Ht.currentTurn)return;const e=Tn();if(!e.blockEnabled)return void En('<span class="tb-log-info">Blocking is not available.</span>');if(lr("player"))return En('<span class="tb-log-stun">You are unable to act!</span>'),Ht.currentTurn="enemy",wn(),void setTimeout((()=>Bn()),1e3);if((await async function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(null===(e=jt)||void 0===e||!e.combatMechanics)return{isBlocking:!1,damageReduction:0};const a=Tn();if(!a.blockEnabled)return{isBlocking:!1,damageReduction:0};const n=jt.combatMechanics;n.isBlocking=!0,n.lastAction="block",a.onBlockAttempt&&await W(a.onBlockAttempt,{damageIncoming:t});return{isBlocking:!0,damageReduction:a.blockDamageReduction}}()).isBlocking){const t=Math.round(100*e.blockDamageReduction);En('<span class="tb-log-block">You raise your guard! ('.concat(t,"% damage reduction)</span>")),Ht.isDefending=!0}await Pn(),Dn(),Ht.currentTurn="enemy",wn(),setTimeout((()=>Bn()),1e3)}()});l&&(l.onclick=e=>{console.log("[MazeMaster] Parry button clicked!",e),async function(){if("player"!==Ht.currentTurn)return;const e=Tn();if(!e.parryEnabled)return void En('<span class="tb-log-info">Parrying is not available.</span>');if(lr("player"))return En('<span class="tb-log-stun">You are unable to act!</span>'),Ht.currentTurn="enemy",wn(),void setTimeout((()=>Bn()),1e3);await async function(e,t){var a;if(null===(a=jt)||void 0===a||!a.combatMechanics)return;const n=Tn();if(!n.parryEnabled)return;const o=jt.combatMechanics;o.parryWindow=!0,o.parrySuccess=!1,o.lastAction="parry_attempt",n.onParryAttempt&&await W(n.onParryAttempt,{enemyName:e,attackDamage:t});const i={easy:1.5,normal:1,hard:.6},r=1e3*n.parryWindow*(i[n.parryDifficulty]||1);setTimeout((()=>{var e;null!==(e=jt)&&void 0!==e&&e.combatMechanics&&(jt.combatMechanics.parryWindow=!1)}),r)}(Ht.enemyName||"Enemy",Ht.profile.enemyAttack||10),En('<span class="tb-log-parry">You prepare to parry! Time your defense...</span>'),Ht.isDefending=!1,await Pn(),Dn(),Ht.currentTurn="enemy",wn(),setTimeout((()=>Bn()),800)}()});c&&(c.onclick=e=>{console.log("[MazeMaster] Item button clicked!",e),async function(){if("player"!==Ht.currentTurn)return;if(jt.isOpen&&jt.inventory&&jt.inventory.healingPotion>0){const e=Math.round(.25*Ht.playerMaxHP);Ht.playerHP=Math.min(Ht.playerMaxHP,Ht.playerHP+e),jt.inventory.healingPotion--,Sn(!0,!1),En("You use a Healing Potion and restore ".concat(e," HP!")),Ht.profile.onItem&&await W(Ht.profile.onItem),Ht.isDefending=!1,Ht.currentTurn="enemy",wn(),setTimeout((()=>Bn()),1e3)}else En("No items available!")}()});m&&(m.onclick=e=>{console.log("[MazeMaster] Skills button clicked!",e),async function(){var e,t;if("player"!==Ht.currentTurn)return;console.log("[MazeMaster] handleTBSkills called");const a=(null===(e=jt.skills)||void 0===e?void 0:e.learned)||{},n=(null===(t=jt.skills)||void 0===t?void 0:t.cooldowns)||{};console.log("[MazeMaster] Learned skills:",a),console.log("[MazeMaster] Cooldowns:",n);const o=[];for(const[e,t]of Object.entries(a)){if(t<1)continue;const a=ht(e);if(!a)continue;const i=ft(e,t);if(!("combat"===a.tree||"magic"===a.tree||(null==i?void 0:i.damage)>0||(null==i?void 0:i.heal)>0||(null==i?void 0:i.damageBonus)>0||(null==i?void 0:i.stun)||(null==i?void 0:i.burn)||(null==i?void 0:i.burnChance)))continue;const r=(n[e]||0)>0;o.push({id:e,skill:a,rank:t,effect:i,cooldown:n[e]||0,onCooldown:r})}if(console.log("[MazeMaster] Available combat skills:",o),0===o.length)return void En("No combat skills available!");!function(e){const t=document.getElementById("tb_skill_popup");t&&t.remove();let a="";for(const t of e){const e=ut[t.skill.tree]||{color:"#666"},n=t.onCooldown?" (".concat(t.cooldown," turns)"):"",o=t.onCooldown?"disabled":"",i=t.effect.damage?"".concat(t.effect.damage," dmg"):t.effect.heal?"".concat(t.effect.heal," heal"):t.effect.damageBonus?"+".concat(t.effect.damageBonus,"% dmg"):"Use";a+='\n            <button class="tb-skill-option '.concat(o,'" data-skill="').concat(t.id,'" ').concat(t.onCooldown?"disabled":"",'\n                    style="border-color: ').concat(e.color,';">\n                <span class="skill-name">').concat(t.skill.name,'</span>\n                <span class="skill-effect">').concat(i).concat(n,"</span>\n            </button>\n        ")}const n='\n        <div id="tb_skill_popup" class="tb-skill-popup">\n            <div class="tb-skill-popup-title">Select Skill</div>\n            <div class="tb-skill-popup-skills">\n                '.concat(a,'\n            </div>\n            <button id="tb_skill_cancel" class="tb-skill-cancel">Cancel</button>\n        </div>\n    ');if(!document.getElementById("tb_skill_popup_styles")){const e=document.createElement("style");e.id="tb_skill_popup_styles",e.textContent="\n            .tb-skill-popup {\n                position: fixed;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\n                border: 2px solid #e67e22;\n                border-radius: 12px;\n                padding: 20px;\n                z-index: 1000000;\n                min-width: 250px;\n                max-width: 400px;\n                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);\n            }\n            .tb-skill-popup-title {\n                font-size: 1.3em;\n                font-weight: bold;\n                color: #e67e22;\n                text-align: center;\n                margin-bottom: 15px;\n            }\n            .tb-skill-popup-skills {\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n            }\n            .tb-skill-option {\n                padding: 12px 15px;\n                background: rgba(0, 0, 0, 0.4);\n                border: 2px solid #444;\n                border-radius: 8px;\n                color: #fff;\n                cursor: pointer;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                transition: all 0.2s ease;\n            }\n            .tb-skill-option:hover:not(.disabled) {\n                background: rgba(230, 126, 34, 0.3);\n                transform: translateX(5px);\n            }\n            .tb-skill-option.disabled {\n                opacity: 0.5;\n                cursor: not-allowed;\n            }\n            .skill-name {\n                font-weight: bold;\n            }\n            .skill-effect {\n                font-size: 0.85em;\n                color: #aaa;\n            }\n            .tb-skill-cancel {\n                width: 100%;\n                margin-top: 15px;\n                padding: 10px;\n                background: rgba(149, 165, 166, 0.3);\n                border: 1px solid #95a5a6;\n                border-radius: 6px;\n                color: #fff;\n                cursor: pointer;\n                transition: background 0.2s;\n            }\n            .tb-skill-cancel:hover {\n                background: rgba(149, 165, 166, 0.5);\n            }\n        ",document.head.appendChild(e)}const o=document.getElementById("mazemaster_turnbased_modal");if(o){var i;o.insertAdjacentHTML("beforeend",n);const e=document.getElementById("tb_skill_popup");null===(i=document.getElementById("tb_skill_cancel"))||void 0===i||i.addEventListener("click",(()=>{null==e||e.remove()})),null==e||e.querySelectorAll(".tb-skill-option:not(.disabled)").forEach((t=>{t.addEventListener("click",(async()=>{const a=t.dataset.skill;e.remove(),await async function(e){console.log("[MazeMaster] Using combat skill:",e);const t=await er(e);if(!t.success)return void En("Skill failed: ".concat(t.message));if(Ht.enemyHP<=0)return void await Ln();Ht.isDefending=!1,Ht.currentTurn="enemy",wn(),setTimeout((()=>Bn()),1e3)}(a)}))}))}}(o)}()});d&&(d.onclick=e=>{console.log("[MazeMaster] Flee button clicked!",e),async function(){if("player"!==Ht.currentTurn)return;const e=Ht.profile.fleeChance||30,t=100*Math.random();t<e?(En("You successfully flee from combat!"),Ht.profile.onFlee&&await W(Ht.profile.onFlee),Ht.isVictory=!1,Ht.isDefeat=!1,Rn("fled")):(En("Failed to escape! (".concat(Math.round(t)," vs ").concat(e,")")),Ht.isDefending=!1,Ht.currentTurn="enemy",wn(),setTimeout((()=>Bn()),1e3))}()});u&&(u.onclick=e=>{console.log("[MazeMaster] Close button clicked!",e),Nn()});const p=Tn();s&&(s.style.display=p.blockEnabled?"flex":"none");l&&(l.style.display=p.parryEnabled?"flex":"none");console.log("[MazeMaster] Turn-based modal setup complete")}(),wn(),pr(),"enemy"===Ht.currentTurn&&setTimeout((()=>Bn()),1e3),console.log("[MazeMaster] Turn-based combat started: ".concat(e," (enemy type: ").concat(s,")")),{success:!0}}function wn(){const e=Ht.playerHP/Ht.playerMaxHP*100,t=Ht.enemyHP/Ht.enemyMaxHP*100,a=document.getElementById("tb_player_hp_bar"),n=document.getElementById("tb_enemy_hp_bar");a&&(a.style.width="".concat(e,"%")),n&&(n.style.width="".concat(t,"%"));const o=document.getElementById("tb_player_hp"),i=document.getElementById("tb_player_max_hp"),r=document.getElementById("tb_enemy_hp"),s=document.getElementById("tb_enemy_max_hp");o&&(o.textContent=Math.max(0,Ht.playerHP)),i&&(i.textContent=Ht.playerMaxHP),r&&(r.textContent=Math.max(0,Ht.enemyHP)),s&&(s.textContent=Ht.enemyMaxHP);const l=document.getElementById("tb_turn_text"),c=document.getElementById("tb_turn_count");l&&(l.textContent="player"===Ht.currentTurn?"Your Turn":"Enemy Turn"),c&&(c.textContent=Ht.turnCount);const m=document.getElementById("tb_combat_log");m&&(m.innerHTML=Ht.combatLog.map((e=>{let t="tb-log-entry";return(e.includes("damage")||e.includes("hit"))&&(t+=" tb-log-damage"),(e.includes("heal")||e.includes("restored"))&&(t+=" tb-log-heal"),(e.includes("defend")||e.includes("block"))&&(t+=" tb-log-defend"),e.includes("CRITICAL")&&(t+=" tb-log-crit"),(e.includes("flee")||e.includes("escape"))&&(t+=" tb-log-flee"),'<div class="'.concat(t,'">').concat(e,"</div>")})).join(""),m.scrollTop=m.scrollHeight);const d=document.querySelector(".tb-player");d&&d.classList.toggle("defending",Ht.isDefending);document.querySelectorAll(".mazemaster-tb-btn").forEach((e=>{"tb_close_btn"!==e.id&&(e.disabled="player"!==Ht.currentTurn||Ht.isVictory||Ht.isDefeat)}))}function En(e){Ht.combatLog.push(e),Ht.combatLog.length>50&&Ht.combatLog.shift(),wn()}function Sn(e,t){const a=e?"tb_player_hp_bar":"tb_enemy_hp_bar",n=document.getElementById(a);n&&(n.classList.remove("flash-damage","flash-heal"),n.offsetWidth,n.classList.add(t?"flash-damage":"flash-heal"))}function Tn(){var e;const t=(null===(e=jt)||void 0===e||null===(e=e.profile)||void 0===e?void 0:e.combatMechanicsProfile)||qt.currentCombatMechanicsProfile||"default";return(qt.combatMechanicsProfiles||{})[t]||Ge[t]||Ge.default}async function In(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"combat_end";if(null===(e=jt)||void 0===e||!e.combatMechanics)return;const a=Tn();if(!a.comboEnabled)return;const n=jt.combatMechanics,o=n.comboCounter,i=n.maxCombo;o>0&&a.onComboBreak&&await W(a.onComboBreak,{finalCombo:o,maxCombo:i,reason:t}),n.comboCounter=0,n.comboDecayTimer=0}function Mn(){var e;if(null===(e=jt)||void 0===e||!e.combatMechanics)return 0;const t=Tn();if(!t.comboEnabled)return 0;const a=jt.combatMechanics;return Math.min(a.comboCounter*t.comboBonusPerHit,t.maxComboBonus)}async function Pn(){var e;if(null===(e=jt)||void 0===e||!e.combatMechanics)return;if(!Tn().comboEnabled)return;const t=jt.combatMechanics;t.comboDecayTimer>0&&(t.comboDecayTimer--,0===t.comboDecayTimer&&t.comboCounter>0&&await In("turn_end"))}function Dn(){var e;const t=document.getElementById("tb_combo_display");if(!t||null===(e=jt)||void 0===e||!e.combatMechanics)return;if(!Tn().comboEnabled)return void(t.style.display="none");const a=jt.combatMechanics;if(a.comboCounter>0){const e=Mn();t.innerHTML='<span class="combo-counter">'.concat(a.comboCounter,'x</span> <span class="combo-bonus">+').concat(e,"%</span>"),t.style.display="flex",t.classList.add("combo-active")}else t.style.display="none",t.classList.remove("combo-active")}function An(e,t,a,n){var o,i,r,s;let l=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],c=arguments.length>5&&void 0!==arguments[5]&&arguments[5],m=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const d=null!==(o=jt)&&void 0!==o&&o.isOpen?Fi():{attack:0,defense:0,critBonus:0,specials:[]},u=null!==(i=jt)&&void 0!==i&&i.isOpen&&jt.character?Vi(jt.character.level):{attackBonus:0,defenseBonus:0},p=null!==(r=jt)&&void 0!==r&&r.isOpen?function(){var e;const t={critBonus:0,lifestealPercent:0,firstStrikeBonus:0,damageBonus:0,damageReduction:0};if(null===(e=jt)||void 0===e||null===(e=e.skills)||void 0===e||!e.learned)return t;for(const[e,a]of Object.entries(jt.skills.learned)){const n=ht(e);if(!n||"passive"!==n.type)continue;const o=ft(e,a);o&&(o.critBonus&&(t.critBonus+=o.critBonus),o.lifestealPercent&&(t.lifestealPercent+=o.lifestealPercent),o.firstStrikeBonus&&(t.firstStrikeBonus+=o.firstStrikeBonus))}return t}():{critBonus:0,lifestealPercent:0,firstStrikeBonus:0},h=null!==(s=jt)&&void 0!==s&&s.isOpen?function(){var e;const t={damageBonus:0,damageReduction:0,freezeChance:0,guaranteedCrit:!1};if(null===(e=jt)||void 0===e||null===(e=e.skills)||void 0===e||!e.activeEffects)return t;for(const e of jt.skills.activeEffects){const a=e.effect;a.damageBonus&&(t.damageBonus+=a.damageBonus),a.damageReduction&&(t.damageReduction+=a.damageReduction),a.freezeChance&&(t.freezeChance+=a.freezeChance),a.guaranteedCrit&&(t.guaranteedCrit=!0)}return t}():{damageBonus:0,damageReduction:0,guaranteedCrit:!1};l&&(e+=d.attack+u.attackBonus,a+=d.critBonus+p.critBonus),c&&(t+=d.defense+u.defenseBonus);let g=Math.max(1,e-t);g=Math.round(g*(.8+.4*Math.random())),l&&m&&p.firstStrikeBonus>0&&(g=Math.round(g*(1+p.firstStrikeBonus/100))),l&&h.damageBonus>0&&(g=Math.round(g*(1+h.damageBonus/100)));const f=l?Mn():0;f>0&&(g=Math.round(g*(1+f/100))),c&&h.damageReduction>0&&(g=Math.round(g*(1-h.damageReduction/100)));let y=!1;return(h.guaranteedCrit||100*Math.random()<a)&&(g=Math.round(g*n),y=!0),{damage:g,isCrit:y,equipBonuses:d,levelBonuses:u,skillBonuses:{passive:p,active:h},lifestealPercent:p.lifestealPercent,comboBonus:f}}async function Bn(){var e;if("enemy"!==Ht.currentTurn)return;if(Ht.isVictory||Ht.isDefeat)return;const t=Ht.profile,a=Ht.enemyNameOverride||t.enemyName||"Enemy";t.onTurnStart&&await W(t.onTurnStart);const n=cr("enemy");if(n.damage>0&&(Ht.enemyHP=Math.max(0,Ht.enemyHP-n.damage),Sn(!1,!0)),pr(),Ht.enemyHP<=0)return void await Ln();if(lr("enemy"))return En('<span class="tb-log-stun">'.concat(a," is unable to act!</span>")),Ht.currentTurn="player",Ht.turnCount++,Ht.isDefending=!1,wt("survive","turn",1),void wn();const o=Ht.enemyType||"warrior",i=bt[o];let r=null;if(i&&i.abilities&&i.abilities.length>0){const e=i.abilities.reduce(((e,t)=>e+(t.weight||10)),0);let t=Math.random()*e;for(const e of i.abilities)if(t-=e.weight||10,t<=0){r=e;break}}const s=(null==i?void 0:i.baseAttack)||t.enemyAttack||12,l=t.playerDefense||5,c=mr("enemy"),m=dr("player");let{damage:d,isCrit:u}=An(s,l,t.critChance||10,t.critMultiplier||2,!1,!0);d=Math.round(d*(1+(c.damageBonus||0)/100)*(1-(m.damageReduction||0)/100)),r&&r.damageMultiplier&&(d=Math.round(d*r.damageMultiplier));let p=d,h=!1,g=!1;const f=await async function(e,t){var a;if(null===(a=jt)||void 0===a||!a.combatMechanics)return{parried:!1,counterDamage:0,stunDuration:0,damageTaken:e};const n=Tn(),o=jt.combatMechanics;if(!n.parryEnabled)return{parried:!1,counterDamage:0,stunDuration:0,damageTaken:e};if(o.parrySuccess){const a=Math.floor(e*n.parryDamageMultiplier);return n.onParrySuccess&&await W(n.onParrySuccess,{enemyName:t,counterDamage:a,stunDuration:n.parryStunDuration}),o.parrySuccess=!1,{parried:!0,counterDamage:a,stunDuration:n.parryStunDuration,damageTaken:0}}return"parry_attempt"===o.lastAction&&n.onParryFail&&await W(n.onParryFail,{enemyName:t,damageTaken:e}),{parried:!1,counterDamage:0,stunDuration:0,damageTaken:e}}(p,a);if(f.parried){g=!0,p=0;const e=await async function(e,t){var a;if(null===(a=jt)||void 0===a||!a.combatMechanics)return{damage:e,isCrit:!1};const n=Tn();if(!n.counterEnabled)return{damage:e,isCrit:!1};let o=Math.floor(e*(1+n.counterDamageBonus/100)),i=!1;const r=n.counterCritBonus;return 100*Math.random()<r&&(o=Math.floor(1.5*o),i=!0),n.onCounterAttack&&await W(n.onCounterAttack,{damage:o,enemyName:t,isCrit:i}),{damage:o,isCrit:i}}(f.counterDamage,a);Ht.enemyHP=Math.max(0,Ht.enemyHP-e.damage),Sn(!1,!0);const t=document.querySelector(".turn-based-container");if(Za("parry"),en("parry",t),e.isCrit?En('<span class="tb-log-parry-success">PARRY! CRITICAL COUNTER for '.concat(e.damage," damage!</span>")):En('<span class="tb-log-parry-success">PARRY! Counter-attack for '.concat(e.damage," damage!</span>")),f.stunDuration>0&&(rr("enemy","stunned",f.stunDuration),En('<span class="tb-log-stun">'.concat(a," is stunned!</span>"))),Ht.enemyHP<=0)return void await Ln()}else{const e=await async function(e){var t;if(null===(t=jt)||void 0===t||!t.combatMechanics)return{damageTaken:e,damageBlocked:0,blockBroken:!1};const a=Tn(),n=jt.combatMechanics;if(!n.isBlocking||!a.blockEnabled)return{damageTaken:e,damageBlocked:0,blockBroken:!1};if(a.blockBreakThreshold>0&&e>=a.blockBreakThreshold)return n.isBlocking=!1,a.onBlockBreak&&await W(a.onBlockBreak,{damage:e,threshold:a.blockBreakThreshold}),{damageTaken:e,damageBlocked:0,blockBroken:!0};const o=Math.floor(e*a.blockDamageReduction),i=e-o;return a.onBlockSuccess&&await W(a.onBlockSuccess,{damageBlocked:o,damageTaken:i,originalDamage:e}),n.isBlocking=!1,{damageTaken:i,damageBlocked:o,blockBroken:!1}}(p);e.damageBlocked>0?(h=!0,p=e.damageTaken,e.blockBroken?En('<span class="tb-log-block-break">Your guard is broken!</span>'):En('<span class="tb-log-block">You block '.concat(e.damageBlocked," damage!</span>"))):Ht.isDefending&&(p=Math.round(.5*p),En("Your defense reduces the damage!"))}r&&(!function(e){let t=0,a=null;const n=Ht.profile,o=n.enemyAttack||10,i=5;if(e.damageMultiplier>0){const a=Math.round(o*e.damageMultiplier),n=mr("enemy");let r=a;n.damageBonus>0&&(r=Math.round(r*(1+n.damageBonus/100))),n.damageReduction>0&&(r=Math.round(r*(1-n.damageReduction/100)));const s=dr("player");t=Math.max(1,r-i),s.damageReduction>0&&(t=Math.round(t*(1-s.damageReduction/100))),Ht.isDefending&&(t=Math.round(.5*t)),t=Math.max(1,t)}e.selfBuff&&rr("enemy",e.selfBuff);e.statusEffect&&e.statusChance&&100*Math.random()<e.statusChance&&(rr("player",e.statusEffect),a=e.statusEffect);if(e.lifesteal&&t>0){const a=Math.round(t*e.lifesteal/100);Ht.enemyHP=Math.min(Ht.enemyMaxHP,Ht.enemyHP+a),En("Enemy heals for ".concat(a,"!"))}}(r),En('<span class="tb-log-ability">'.concat(a," uses ").concat(r.name,"!</span>")));const y=document.querySelector(".turn-based-container");if(on("minion_0","minion_attack"),p>0){var v;Ht.playerHP=Math.max(0,Ht.playerHP-p),Sn(!0,!0),u&&!h?(Za("critical_hit"),en("enemy_critical",y),En('<span class="tb-log-crit">CRITICAL! '.concat(a," deals ").concat(p," damage!</span>"))):h||g?h&&(Za("block"),en("block",y),En("".concat(a," attacks! You take ").concat(p," damage through your guard."))):(Za("enemy_hit"),en("enemy_attack",y),En("".concat(a," attacks for ").concat(p," damage!")));Tn().comboResetOnDamage&&p>0&&(await In("damage"),Dn()),null!==(v=jt)&&void 0!==v&&null!==(v=v.equipment)&&void 0!==v&&v.armor&&ji("armor",1)}else g||En("".concat(a," attacks but deals no damage!"));const b=null===(e=jt)||void 0===e||null===(e=e.skills)||void 0===e||null===(e=e.activeEffects)||void 0===e?void 0:e.find((e=>"magic_ice_shield"===e.skillId));if(b){var z;const e=(null===(z=b.effect)||void 0===z?void 0:z.freezeChance)||15;100*Math.random()<e&&(rr("enemy","frozen"),En('<span class="tb-log-freeze">Ice Shield freezes '.concat(a,"!</span>")))}if(pr(),t.onPlayerHit&&await W(t.onPlayerHit),Ht.playerHP<=0)return void await qn();const _=cr("player");_.damage>0&&(Ht.playerHP=Math.max(0,Ht.playerHP-_.damage),Sn(!0,!0),Ht.playerHP<=0)?await qn():(pr(),Ht.currentTurn="player",Ht.turnCount++,Ht.isDefending=!1,wt("survive","turn",1),function(){var e;if(null===(e=jt)||void 0===e||null===(e=e.skills)||void 0===e||!e.cooldowns)return;for(const e of Object.keys(jt.skills.cooldowns))jt.skills.cooldowns[e]>0&&(jt.skills.cooldowns[e]--,jt.skills.cooldowns[e]<=0&&delete jt.skills.cooldowns[e]);jt.skills.activeEffects=jt.skills.activeEffects.filter((e=>(e.turnsRemaining--,e.turnsRemaining>0))),ar()}(),wn())}async function Ln(){Ht.isVictory=!0,Ht.currentTurn="none",ur(),pr(),Za("victory");const e=Ht.profile;En("Victory! The enemy is defeated!");try{if(e.onWin&&await W(e.onWin),jt.isOpen&&jt.pendingEncounter){at("key")&&100*Math.random()<(e.keyDropChance||40)&&(Ni("key"),En("You found a Key!")),at("strike")&&100*Math.random()<(e.strikeDropChance||20)&&(Ni("strike"),En("You found a Strike!")),at("healingPotion")&&100*Math.random()<(e.healingPotionDropChance||20)&&(Ni("healingPotion"),En("You found a Healing Potion!"));try{var a;const n=null!==(a=e.equipmentDropChance)&&void 0!==a?a:15,o=await async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(100*Math.random()>e)return null;const n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const a=t({},mt);a.rare+=Math.floor(e/10),a.epic+=Math.floor(e/25),a.common=Math.max(20,a.common-e);const n=Object.values(a).reduce(((e,t)=>e+t),0);let o=Math.random()*n;for(const[e,t]of Object.entries(a))if(o-=t,o<=0){const t=dt(e);if(t.length>0)return t[Math.floor(Math.random()*t.length)]}return null}(a);if(n)return await async function(e){const t=Oi(e);if(!t)return console.warn("[MazeMaster] Unknown equipment: ".concat(e)),!1;jt.equipmentInventory||(jt.equipmentInventory=[]);return jt.equipmentInventory.push(e),Wi(),Si("Loot","Found ".concat(t.name,"!")),await Y("onEquipmentFound",{itemId:e,name:t.name,slot:t.slot,rarity:t.rarity}),!0}(n.id),n;return null}(n);o&&En("You found ".concat(o.name,"!"))}catch(e){console.error("[MazeMaster] Equipment drop error:",e)}try{const e=Ht.difficulty||1,t=Ki.combatVictory+e*Ki.combatDifficultyBonus,a=await Xi(t,"combat");En("+".concat(t," XP")),null!=a&&a.leveledUp&&En("LEVEL UP! Now level ".concat(a.newLevel,"!"))}catch(e){console.error("[MazeMaster] XP grant error:",e)}try{const e=Ht.enemyType||"enemy";await wt("defeat",e,1)}catch(e){console.error("[MazeMaster] Quest progress error:",e)}}}catch(e){console.error("[MazeMaster] Victory handler error:",e)}Kt.turnbased=Kt.turnbased||{},Kt.turnbased[Ht.profileName]={result:"win",turnsPlayed:Ht.turnCount,timestamp:Date.now()},Rn("victory")}async function qn(){Ht.isDefeat=!0,Ht.currentTurn="none",ur(),pr(),Za("defeat");const e=Ht.profile;En("Defeat... You have fallen."),e.onLose&&await W(e.onLose);let t=!1;if(jt.isOpen&&jt.hpEnabled&&jt.hp){var a,n;const o=e.damage||25,i=null!==(a=null===(n=jt.profile)||void 0===n?void 0:n.battlebarDamageMultiplier)&&void 0!==a?a:1,r=Math.round(o*i);t=!await K(r,"turnbased")}Kt.turnbased=Kt.turnbased||{},Kt.turnbased[Ht.profileName]={result:"lose",turnsPlayed:Ht.turnCount,timestamp:Date.now()},t?Nn():Rn("defeat")}function Rn(e){const t=document.getElementById("tb_action_buttons"),a=document.getElementById("tb_result_panel"),n=document.getElementById("tb_result_text");t&&(t.style.display="none"),a&&(a.style.display="block"),n&&("victory"===e?(n.textContent="Victory!",n.className="tb-result-text tb-result-victory"):"defeat"===e?(n.textContent="Defeat...",n.className="tb-result-text tb-result-defeat"):"fled"===e&&(n.textContent="Escaped!",n.className="tb-result-text tb-result-fled")),wn()}async function Nn(){const e=document.getElementById("mazemaster_turnbased_modal");e&&e.remove();const t=Ht.isVictory,a=Ht.isDefeat,n=Ht.isMazeEncounter;if(n&&jt.isOpen&&jt.hpEnabled&&jt.hp){const e=jt.hp.current;jt.hp.current=Math.max(0,Ht.playerHP),console.log("[MazeMaster] Persisting combat HP to maze:",e,"->",jt.hp.current),Z(),a&&jt.hp.current<=0&&console.log("[MazeMaster] Player died in turn-based combat")}if(Ht.isOpen=!1,jt.isOpen){try{if(jt.pendingEncounter){const e=jt.pendingEncounter.type;if(t){if(await li(jt.playerX,jt.playerY),"exit_turnbased"===e)return jt.exitEncounterDone=!0,jt.isPaused=!1,void Rr()}else if(a&&n&&jt.hp&&jt.hp.current<=0)return jt.pendingEncounter=null,void Lr()}}catch(e){console.error("[MazeMaster] Error in closeTurnBasedModal:",e)}jt.isPaused=!1,jt.pendingEncounter=null}}const Hn={W:{label:"W",icon:"fa-arrow-up",color:"#3498db"},A:{label:"A",icon:"fa-arrow-left",color:"#e74c3c"},S:{label:"S",icon:"fa-arrow-down",color:"#2ecc71"},D:{label:"D",icon:"fa-arrow-right",color:"#f39c12"},SPACE:{label:"SPACE",icon:"fa-square",color:"#9b59b6"},E:{label:"E",icon:"fa-hand",color:"#1abc9c"},Q:{label:"Q",icon:"fa-shield",color:"#e67e22"}};function On(e){console.log("[MazeMaster] startQTE called with profile:",e);const t=ca(e);if(console.log("[MazeMaster] QTE profile retrieved:",t),!t)return console.error('[MazeMaster] QTE profile "'.concat(e,'" not found')),{error:'Profile "'.concat(e,'" not found')};const a=Math.floor(Math.random()*(t.sequenceLengthMax-t.sequenceLengthMin+1)+t.sequenceLengthMin),n=[];for(let e=0;e<a;e++){const e=t.allowedKeys[Math.floor(Math.random()*t.allowedKeys.length)];n.push(e)}return Ot={isOpen:!0,profile:t,profileName:e,sequence:n,currentIndex:0,currentTimeWindow:t.timeWindowBase,promptStartTime:0,timeoutId:null,successes:0,perfects:0,misses:0,combo:0,maxCombo:0,isComplete:!1,isSuccess:!1,combatLog:["Prepare yourself..."]},jt.isOpen&&(jt.isPaused=!0),function(){var e;const t=document.getElementById("mazemaster_qte_modal");t&&t.remove();if(!document.getElementById("mazemaster_qte_styles")){const e=document.createElement("style");e.id="mazemaster_qte_styles",e.textContent="\n        .mazemaster-qte-container {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            gap: 15px;\n            padding: 25px;\n            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\n            border-radius: 15px;\n            border: 2px solid #9b59b6;\n            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), 0 0 20px rgba(155, 89, 182, 0.3);\n            width: 450px;\n            max-width: 95vw;\n            max-height: 90vh;\n            overflow-y: auto;\n        }\n\n        .mazemaster-qte-main-title {\n            font-size: 1.8em;\n            font-weight: bold;\n            color: #fff;\n            text-shadow: 0 2px 4px rgba(0,0,0,0.5);\n        }\n\n        .mazemaster-qte-progress {\n            width: 100%;\n            position: relative;\n        }\n\n        .qte-progress-bar {\n            width: 100%;\n            height: 8px;\n            background: #333;\n            border-radius: 4px;\n            overflow: hidden;\n        }\n\n        .qte-progress-bar::after {\n            content: '';\n            display: block;\n            height: 100%;\n            width: var(--progress, 0%);\n            background: linear-gradient(90deg, #9b59b6, #3498db);\n            transition: width 0.3s ease;\n        }\n\n        .qte-progress-text {\n            position: absolute;\n            right: 0;\n            top: -20px;\n            font-size: 0.9em;\n            color: #aaa;\n        }\n\n        .mazemaster-qte-prompt-area {\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            min-height: 180px;\n            width: 100%;\n        }\n\n        .qte-timer-ring {\n            position: relative;\n            width: 160px;\n            height: 160px;\n        }\n\n        .qte-timer-ring svg {\n            width: 100%;\n            height: 100%;\n            transform: rotate(-90deg);\n        }\n\n        .qte-timer-bg {\n            fill: none;\n            stroke: #333;\n            stroke-width: 8;\n        }\n\n        .qte-timer-fill {\n            fill: none;\n            stroke: #9b59b6;\n            stroke-width: 8;\n            stroke-linecap: round;\n            stroke-dasharray: 283;\n            stroke-dashoffset: 0;\n            transition: stroke-dashoffset 0.1s linear;\n        }\n\n        .qte-timer-fill.warning {\n            stroke: #f39c12;\n        }\n\n        .qte-timer-fill.critical {\n            stroke: #e74c3c;\n        }\n\n        .qte-key-prompt {\n            position: absolute;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%);\n            text-align: center;\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            gap: 5px;\n        }\n\n        .qte-key-prompt i {\n            font-size: 2.5em;\n            color: #fff;\n        }\n\n        .qte-key-prompt span {\n            font-size: 1.2em;\n            font-weight: bold;\n            color: #fff;\n            text-shadow: 0 2px 4px rgba(0,0,0,0.5);\n        }\n\n        .qte-key-prompt.success {\n            animation: qte-success-pulse 0.3s ease;\n        }\n\n        .qte-key-prompt.fail {\n            animation: qte-fail-shake 0.3s ease;\n        }\n\n        .qte-key-prompt.perfect {\n            animation: qte-perfect-glow 0.4s ease;\n        }\n\n        @keyframes qte-success-pulse {\n            0%, 100% { transform: translate(-50%, -50%) scale(1); }\n            50% { transform: translate(-50%, -50%) scale(1.2); }\n        }\n\n        @keyframes qte-fail-shake {\n            0%, 100% { transform: translate(-50%, -50%); }\n            25% { transform: translate(calc(-50% - 10px), -50%); }\n            75% { transform: translate(calc(-50% + 10px), -50%); }\n        }\n\n        @keyframes qte-perfect-glow {\n            0% { filter: brightness(1); }\n            50% { filter: brightness(1.5) drop-shadow(0 0 20px gold); }\n            100% { filter: brightness(1); }\n        }\n\n        .mazemaster-qte-stats {\n            display: flex;\n            gap: 20px;\n            font-size: 1em;\n            font-weight: bold;\n        }\n\n        .qte-stat-combo { color: #f39c12; }\n        .qte-stat-perfects { color: #2ecc71; }\n        .qte-stat-misses { color: #e74c3c; }\n\n        .mazemaster-qte-log {\n            width: 100%;\n            height: 80px;\n            background: rgba(0,0,0,0.4);\n            border-radius: 8px;\n            padding: 10px;\n            overflow-y: auto;\n            font-size: 0.85em;\n            color: #ccc;\n        }\n\n        .qte-log-entry {\n            padding: 2px 0;\n            border-bottom: 1px solid rgba(255,255,255,0.1);\n        }\n\n        .qte-log-entry:last-child { border-bottom: none; }\n        .qte-log-success { color: #2ecc71; }\n        .qte-log-perfect { color: #f1c40f; font-weight: bold; }\n        .qte-log-miss { color: #e74c3c; }\n        .qte-log-combo { color: #3498db; }\n\n        .mazemaster-qte-result {\n            text-align: center;\n            padding: 15px;\n        }\n\n        .qte-result-text {\n            font-size: 1.8em;\n            font-weight: bold;\n            margin-bottom: 10px;\n        }\n\n        .qte-result-text.success { color: #2ecc71; }\n        .qte-result-text.fail { color: #e74c3c; }\n\n        .qte-result-stats {\n            font-size: 0.95em;\n            color: #aaa;\n            margin-bottom: 15px;\n        }\n\n        .mazemaster-qte-btn {\n            padding: 12px 25px;\n            border: none;\n            border-radius: 8px;\n            font-size: 1em;\n            font-weight: bold;\n            cursor: pointer;\n            transition: all 0.2s ease;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .mazemaster-qte-btn:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n        }\n\n        .qte-btn-close {\n            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);\n            color: white;\n            padding: 15px 40px;\n            margin: 0 auto;\n        }\n    ",document.head.appendChild(e)}document.body.insertAdjacentHTML("beforeend",'\n        <div id="mazemaster_qte_modal" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:999999;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.9);">\n            <div class="mazemaster-qte-container">\n                <div id="qte_main_title" class="mazemaster-qte-main-title">QTE!</div>\n\n                <div class="mazemaster-qte-progress">\n                    <div class="qte-progress-bar" id="qte_progress_bar"></div>\n                    <div class="qte-progress-text"><span id="qte_current_index">0</span>/<span id="qte_total_count">0</span></div>\n                </div>\n\n                <div class="mazemaster-qte-prompt-area">\n                    <div class="qte-timer-ring" id="qte_timer_ring">\n                        <svg viewBox="0 0 100 100">\n                            <circle class="qte-timer-bg" cx="50" cy="50" r="45"/>\n                            <circle class="qte-timer-fill" id="qte_timer_circle" cx="50" cy="50" r="45"/>\n                        </svg>\n                        <div class="qte-key-prompt" id="qte_key_prompt">\n                            <i class="fa-solid fa-hourglass-start"></i>\n                            <span>GET READY</span>\n                        </div>\n                    </div>\n                </div>\n\n                <div class="mazemaster-qte-stats">\n                    <span class="qte-stat qte-stat-combo">\n                        Combo: <span id="qte_combo">0</span>x\n                    </span>\n                    <span class="qte-stat qte-stat-perfects">\n                        Perfect: <span id="qte_perfects">0</span>\n                    </span>\n                    <span class="qte-stat qte-stat-misses">\n                        Miss: <span id="qte_misses">0</span>\n                    </span>\n                </div>\n\n                <div class="mazemaster-qte-log" id="qte_combat_log">\n                    <div class="qte-log-entry">Prepare yourself...</div>\n                </div>\n\n                <div class="mazemaster-qte-result" id="qte_result_panel" style="display: none;">\n                    <div id="qte_result_text" class="qte-result-text"></div>\n                    <div id="qte_result_stats" class="qte-result-stats"></div>\n                    <button id="qte_close_btn" class="mazemaster-qte-btn qte-btn-close">\n                        <i class="fa-solid fa-check"></i> Close\n                    </button>\n                </div>\n            </div>\n        </div>\n    ');const a=document.getElementById("qte_main_title");a&&(a.textContent=Ot.profile.mainTitle||"QTE!");const n=document.getElementById("qte_total_count");n&&(n.textContent=Ot.sequence.length);null===(e=document.getElementById("qte_close_btn"))||void 0===e||e.addEventListener("click",Kn),document.addEventListener("keydown",Gn),Fn()}(),t.onStart&&W(t.onStart),setTimeout((()=>{Wn("GO!"),Yn()}),1e3),console.log("[MazeMaster] QTE started: ".concat(e,", sequence length: ").concat(a)),{success:!0}}function Fn(){const e=document.getElementById("qte_progress_bar"),t=Ot.currentIndex/Ot.sequence.length*100;e&&e.style.setProperty("--progress","".concat(t,"%"));const a=document.getElementById("qte_current_index");a&&(a.textContent=Ot.currentIndex);const n=document.getElementById("qte_combo"),o=document.getElementById("qte_perfects"),i=document.getElementById("qte_misses");n&&(n.textContent=Ot.combo),o&&(o.textContent=Ot.perfects),i&&(i.textContent=Ot.misses);const r=document.getElementById("qte_combat_log");r&&(r.innerHTML=Ot.combatLog.map((e=>{let t="qte-log-entry";return(e.includes("Success")||e.includes("Hit"))&&(t+=" qte-log-success"),e.includes("PERFECT")&&(t+=" qte-log-perfect"),(e.includes("Miss")||e.includes("Too slow"))&&(t+=" qte-log-miss"),e.includes("Combo")&&(t+=" qte-log-combo"),'<div class="'.concat(t,'">').concat(e,"</div>")})).join(""),r.scrollTop=r.scrollHeight)}function Wn(e){Ot.combatLog.push(e),Ot.combatLog.length>30&&Ot.combatLog.shift(),Fn()}function Yn(){if(Ot.currentIndex>=Ot.sequence.length)return void async function(){Ot.isComplete=!0;const e=Ot.successes/Ot.sequence.length;Ot.isSuccess=e>=.5,document.removeEventListener("keydown",Gn);const t=Ot.profile;if(Ot.isSuccess)Wn("QTE Complete - Success!"),t.onComplete&&await W(t.onComplete),jt.isOpen&&jt.pendingEncounter&&(at("key")&&100*Math.random()<(t.keyDropChance||30)&&(Ni("key"),Wn("You found a Key!")),at("strike")&&100*Math.random()<(t.strikeDropChance||15)&&(Ni("strike"),Wn("You found a Strike!")),at("healingPotion")&&100*Math.random()<(t.healingPotionDropChance||15)&&(Ni("healingPotion"),Wn("You found a Healing Potion!"))),Kt.qte=Kt.qte||{},Kt.qte[Ot.profileName]={result:"success",successRate:e,perfects:Ot.perfects,maxCombo:Ot.maxCombo,timestamp:Date.now()};else{Wn("QTE Failed..."),t.onFail&&await W(t.onFail);let o=!1;if(jt.isOpen&&jt.hpEnabled&&jt.hp){var a,n;const e=t.damage||20,i=null!==(a=null===(n=jt.profile)||void 0===n?void 0:n.battlebarDamageMultiplier)&&void 0!==a?a:1,r=Math.round(e*i);o=!await K(r,"qte")}if(Kt.qte=Kt.qte||{},Kt.qte[Ot.profileName]={result:"fail",successRate:e,perfects:Ot.perfects,maxCombo:Ot.maxCombo,timestamp:Date.now()},o)return void Kn()}!function(){const e=document.querySelector(".mazemaster-qte-prompt-area"),t=document.querySelector(".mazemaster-qte-stats"),a=document.querySelector(".mazemaster-qte-log"),n=document.getElementById("qte_result_panel"),o=document.getElementById("qte_result_text"),i=document.getElementById("qte_result_stats");e&&(e.style.display="none");t&&(t.style.display="none");a&&(a.style.display="none");n&&(n.style.display="block");const r=Math.round(Ot.successes/Ot.sequence.length*100);o&&(Ot.isSuccess?(o.textContent=Ot.perfects===Ot.sequence.length?"PERFECT!":"Success!",o.className="qte-result-text success"):(o.textContent="Failed...",o.className="qte-result-text fail"));i&&(i.innerHTML="\n            <div>Hits: ".concat(Ot.successes,"/").concat(Ot.sequence.length," (").concat(r,"%)</div>\n            <div>Perfect: ").concat(Ot.perfects," | Max Combo: ").concat(Ot.maxCombo,"x</div>\n        "))}()}();const e=Ot.sequence[Ot.currentIndex],t=Hn[e]||{label:e,icon:"fa-keyboard",color:"#fff"},a=document.getElementById("qte_key_prompt");a&&(a.innerHTML='\n            <i class="fa-solid '.concat(t.icon,'" style="color: ').concat(t.color,'"></i>\n            <span>').concat(t.label,"</span>\n        "),a.classList.remove("success","fail","perfect"));const n=document.getElementById("qte_timer_circle");n&&(n.style.strokeDashoffset="0",n.classList.remove("warning","critical")),Ot.promptStartTime=performance.now(),Ot.profile.onPrompt&&W(Ot.profile.onPrompt),Ot.timeoutId&&clearTimeout(Ot.timeoutId),Ot.timeoutId=setTimeout((()=>jn()),Ot.currentTimeWindow),Un()}function Un(){const e=document.getElementById("qte_timer_circle");if(!e||!Ot.isOpen||Ot.isComplete)return;const t=(performance.now()-Ot.promptStartTime)/Ot.currentTimeWindow,a=283*t;e.style.strokeDashoffset=a,t>.75?(e.classList.add("critical"),e.classList.remove("warning")):t>.5&&(e.classList.add("warning"),e.classList.remove("critical")),t<1&&Ot.isOpen&&!Ot.isComplete&&requestAnimationFrame(Un)}function Gn(e){if(!Ot.isOpen||Ot.isComplete)return;const t=Ot.sequence[Ot.currentIndex];let a=e.key.toUpperCase();" "===e.key&&(a="SPACE"),Ot.profile.allowedKeys.includes(a)&&(e.preventDefault(),a===t?async function(){Ot.timeoutId&&(clearTimeout(Ot.timeoutId),Ot.timeoutId=null);const e=performance.now()-Ot.promptStartTime,t=Ot.currentTimeWindow*(Ot.profile.perfectWindowPercent/100),a=e<=t;Ot.successes++,Ot.combo++,Ot.maxCombo=Math.max(Ot.maxCombo,Ot.combo);const n=document.getElementById("qte_key_prompt");a?(Ot.perfects++,null==n||n.classList.add("perfect"),Wn("PERFECT! (".concat(Math.round(e),"ms)")),Ot.profile.onPerfect&&await W(Ot.profile.onPerfect)):(null==n||n.classList.add("success"),Wn("Success! (".concat(Math.round(e),"ms)")),Ot.profile.onSuccess&&await W(Ot.profile.onSuccess));Ot.combo>1&&Ot.combo%3==0&&Wn("Combo x".concat(Ot.combo,"!"));Ot.currentIndex++,Fn(),Ot.profile.difficultyScaling&&(Ot.currentTimeWindow=Math.max(Ot.profile.timeWindowMin,Ot.currentTimeWindow*Ot.profile.difficultyScaling));setTimeout((()=>Yn()),400)}():jn())}async function jn(){Ot.timeoutId&&(clearTimeout(Ot.timeoutId),Ot.timeoutId=null),Ot.misses++,Ot.combo=0;const e=document.getElementById("qte_key_prompt");null==e||e.classList.add("fail");const t=Ot.sequence[Ot.currentIndex];Wn("Miss! Expected: ".concat(t)),Ot.profile.onMiss&&await W(Ot.profile.onMiss),Ot.currentIndex++,Fn(),setTimeout((()=>Yn()),400)}async function Kn(){Ot.timeoutId&&(clearTimeout(Ot.timeoutId),Ot.timeoutId=null),document.removeEventListener("keydown",Gn);const e=document.getElementById("mazemaster_qte_modal");e&&e.remove();const t=Ot.isSuccess;if(Ot.isOpen=!1,jt.isOpen){try{if(jt.pendingEncounter){const e=jt.pendingEncounter.type;if(t){var a;if(await li(jt.playerX,jt.playerY),jt.hp&&!1!==(null===(a=jt.profile)||void 0===a?void 0:a.hpEnabled)){const e=jt.profile.skillEncounterHealPercent||25,t=jt.hp.max+(jt.hp.maxBonus||0),a=Math.floor(t*(e/100));jt.hp.current<t&&a>0&&(await V(a,!1,"QTE success"),addMazeLogMessage("Quick reflexes! Recovered ".concat(a," HP."),"heal"))}if("exit_qte"===e)return jt.exitEncounterDone=!0,jt.isPaused=!1,void Rr()}}}catch(e){console.error("[MazeMaster] Error in closeQTEModal:",e)}jt.isPaused=!1,jt.pendingEncounter=null}}const Vn={d4:{sides:4,icon:"fa-dice-d4",color:"#e74c3c"},d6:{sides:6,icon:"fa-dice-d6",color:"#3498db"},d8:{sides:8,icon:"fa-dice",color:"#2ecc71"},d10:{sides:10,icon:"fa-dice-d10",color:"#f39c12"},d12:{sides:12,icon:"fa-dice-d12",color:"#9b59b6"},d20:{sides:20,icon:"fa-dice-d20",color:"#e67e22"},d100:{sides:100,icon:"fa-percent",color:"#1abc9c"}};function Xn(e){console.log("[MazeMaster] startDice called with profile:",e);const t=ua(e);if(console.log("[MazeMaster] Dice profile retrieved:",t),!t)return console.error('[MazeMaster] Dice profile "'.concat(e,'" not found')),{error:'Profile "'.concat(e,'" not found')};Vn[t.diceType]||Vn.d6;return Ft={isOpen:!0,profile:t,profileName:e,diceResults:[],total:0,rawTotal:0,threshold:t.threshold,modifier:t.modifier||0,rerollsRemaining:t.rerollsAllowed||0,isCriticalSuccess:!1,isCriticalFail:!1,isSuccess:!1,isComplete:!1,combatLog:["Ready to roll..."]},jt.isOpen&&(jt.isPaused=!0),function(){var e,t,a;const n=document.getElementById("mazemaster_dice_modal");n&&n.remove();if(!document.getElementById("mazemaster_dice_styles")){const e=document.createElement("style");e.id="mazemaster_dice_styles",e.textContent="\n        .mazemaster-dice-container {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            gap: 15px;\n            padding: 25px;\n            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\n            border-radius: 15px;\n            border: 2px solid #f39c12;\n            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), 0 0 20px rgba(243, 156, 18, 0.3);\n            width: 420px;\n            max-width: 95vw;\n            max-height: 90vh;\n            overflow-y: auto;\n        }\n\n        .mazemaster-dice-main-title {\n            font-size: 1.8em;\n            font-weight: bold;\n            color: #fff;\n            text-shadow: 0 2px 4px rgba(0,0,0,0.5);\n        }\n\n        .mazemaster-dice-description {\n            font-size: 0.9em;\n            color: #aaa;\n            text-align: center;\n            max-width: 350px;\n        }\n\n        .mazemaster-dice-info {\n            display: flex;\n            gap: 20px;\n            font-size: 0.95em;\n            color: #ddd;\n        }\n\n        .dice-info-item {\n            display: flex;\n            align-items: center;\n            gap: 5px;\n        }\n\n        .dice-info-item i {\n            color: #f39c12;\n        }\n\n        .mazemaster-dice-roll-area {\n            width: 100%;\n            min-height: 120px;\n            background: rgba(0,0,0,0.3);\n            border-radius: 10px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            cursor: pointer;\n            transition: all 0.3s ease;\n        }\n\n        .mazemaster-dice-roll-area:hover {\n            background: rgba(243, 156, 18, 0.2);\n        }\n\n        .dice-waiting {\n            text-align: center;\n            color: #888;\n        }\n\n        .dice-waiting i {\n            margin-bottom: 10px;\n            animation: dice-pulse 2s ease-in-out infinite;\n        }\n\n        @keyframes dice-pulse {\n            0%, 100% { opacity: 0.5; transform: scale(1); }\n            50% { opacity: 1; transform: scale(1.1); }\n        }\n\n        .dice-rolling {\n            display: flex;\n            gap: 10px;\n            flex-wrap: wrap;\n            justify-content: center;\n        }\n\n        .dice-single {\n            width: 60px;\n            height: 60px;\n            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);\n            border-radius: 10px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 1.5em;\n            font-weight: bold;\n            color: #fff;\n            box-shadow: 0 4px 8px rgba(0,0,0,0.3);\n            animation: dice-roll 0.5s ease-out;\n        }\n\n        .dice-single.critical-success {\n            background: linear-gradient(135deg, #f1c40f 0%, #f39c12 100%);\n            box-shadow: 0 0 20px rgba(241, 196, 15, 0.5);\n        }\n\n        .dice-single.critical-fail {\n            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);\n            box-shadow: 0 0 20px rgba(231, 76, 60, 0.5);\n        }\n\n        @keyframes dice-roll {\n            0% { transform: rotateX(0deg) rotateY(0deg) scale(0.5); opacity: 0; }\n            50% { transform: rotateX(180deg) rotateY(180deg) scale(1.2); }\n            100% { transform: rotateX(360deg) rotateY(360deg) scale(1); opacity: 1; }\n        }\n\n        .mazemaster-dice-result {\n            text-align: center;\n        }\n\n        .dice-result-total {\n            font-size: 3em;\n            font-weight: bold;\n            color: #f39c12;\n            text-shadow: 0 2px 4px rgba(0,0,0,0.5);\n        }\n\n        .dice-result-total.success { color: #2ecc71; }\n        .dice-result-total.fail { color: #e74c3c; }\n        .dice-result-total.critical-success {\n            color: #f1c40f;\n            animation: critical-glow 1s ease-in-out infinite;\n        }\n        .dice-result-total.critical-fail {\n            color: #c0392b;\n            animation: critical-shake 0.5s ease-in-out;\n        }\n\n        @keyframes critical-glow {\n            0%, 100% { text-shadow: 0 0 10px rgba(241, 196, 15, 0.5); }\n            50% { text-shadow: 0 0 30px rgba(241, 196, 15, 1); }\n        }\n\n        @keyframes critical-shake {\n            0%, 100% { transform: translateX(0); }\n            25% { transform: translateX(-5px); }\n            75% { transform: translateX(5px); }\n        }\n\n        /* v1.6.0: VFX Particle Animations */\n        @keyframes particle-fly {\n            0% {\n                transform: translate(0, 0) scale(1);\n                opacity: 1;\n            }\n            100% {\n                transform: translate(var(--dx, 50px), var(--dy, -50px)) scale(0.3);\n                opacity: 0;\n            }\n        }\n\n        @keyframes vfx-flash {\n            0% { opacity: 0; }\n            50% { opacity: 1; }\n            100% { opacity: 0; }\n        }\n\n        @keyframes vfx-expand {\n            0% { transform: scale(0.5); opacity: 1; }\n            100% { transform: scale(2); opacity: 0; }\n        }\n\n        .mazemaster-vfx-flash {\n            position: absolute;\n            width: 100%;\n            height: 100%;\n            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%);\n            animation: vfx-flash 0.3s ease-out forwards;\n            pointer-events: none;\n            z-index: 100;\n        }\n\n        .mazemaster-particle.particle-sparks {\n            background: linear-gradient(135deg, #f39c12, #e74c3c);\n            box-shadow: 0 0 6px #f39c12;\n        }\n\n        .mazemaster-particle.particle-flames {\n            background: linear-gradient(135deg, #e74c3c, #c0392b);\n            box-shadow: 0 0 8px #e74c3c;\n            border-radius: 30% 70% 70% 30%;\n        }\n\n        .mazemaster-particle.particle-frost {\n            background: linear-gradient(135deg, #3498db, #9b59b6);\n            box-shadow: 0 0 6px #3498db;\n        }\n\n        .mazemaster-particle.particle-heal {\n            background: linear-gradient(135deg, #2ecc71, #27ae60);\n            box-shadow: 0 0 6px #2ecc71;\n        }\n\n        .mazemaster-particle.particle-lightning {\n            background: linear-gradient(135deg, #f1c40f, #fff);\n            box-shadow: 0 0 10px #f1c40f;\n            width: 4px !important;\n            height: 12px !important;\n            border-radius: 2px;\n        }\n\n        .dice-result-breakdown {\n            font-size: 0.9em;\n            color: #888;\n            margin-top: 5px;\n        }\n\n        .mazemaster-dice-log {\n            width: 100%;\n            height: 60px;\n            background: rgba(0,0,0,0.4);\n            border-radius: 8px;\n            padding: 10px;\n            overflow-y: auto;\n            font-size: 0.85em;\n            color: #ccc;\n        }\n\n        .dice-log-entry { padding: 2px 0; }\n        .dice-log-success { color: #2ecc71; }\n        .dice-log-fail { color: #e74c3c; }\n        .dice-log-critical { color: #f1c40f; font-weight: bold; }\n        .dice-log-reroll { color: #3498db; }\n\n        .mazemaster-dice-actions {\n            display: flex;\n            gap: 10px;\n        }\n\n        .mazemaster-dice-btn {\n            padding: 12px 25px;\n            border: none;\n            border-radius: 8px;\n            font-size: 1em;\n            font-weight: bold;\n            cursor: pointer;\n            transition: all 0.2s ease;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .mazemaster-dice-btn:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n        }\n\n        .mazemaster-dice-btn:disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n            transform: none;\n        }\n\n        .dice-btn-roll {\n            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);\n            color: white;\n        }\n\n        .dice-btn-reroll {\n            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);\n            color: white;\n        }\n\n        .dice-btn-close {\n            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);\n            color: white;\n            padding: 15px 40px;\n        }\n\n        .mazemaster-dice-final {\n            text-align: center;\n            padding: 15px;\n        }\n\n        .dice-final-text {\n            font-size: 1.6em;\n            font-weight: bold;\n            margin-bottom: 15px;\n        }\n\n        .dice-final-text.success { color: #2ecc71; }\n        .dice-final-text.fail { color: #e74c3c; }\n    ",document.head.appendChild(e)}document.body.insertAdjacentHTML("beforeend",'\n        <div id="mazemaster_dice_modal" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:999999;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.9);">\n            <div class="mazemaster-dice-container">\n                <div id="dice_main_title" class="mazemaster-dice-main-title">Roll the Dice!</div>\n                <div id="dice_description" class="mazemaster-dice-description"></div>\n\n                <div class="mazemaster-dice-info">\n                    <span class="dice-info-item">\n                        <i class="fa-solid fa-bullseye"></i>\n                        Target: <span id="dice_threshold">0</span>\n                    </span>\n                    <span class="dice-info-item">\n                        <i class="fa-solid fa-plus-minus"></i>\n                        Modifier: <span id="dice_modifier">+0</span>\n                    </span>\n                    <span class="dice-info-item">\n                        <i class="fa-solid fa-rotate"></i>\n                        Rerolls: <span id="dice_rerolls">0</span>\n                    </span>\n                </div>\n\n                <div class="mazemaster-dice-roll-area" id="dice_roll_area">\n                    <div class="dice-waiting">\n                        <i class="fa-solid fa-dice fa-3x"></i>\n                        <div>Click to Roll!</div>\n                    </div>\n                </div>\n\n                <div class="mazemaster-dice-result" id="dice_result_display" style="display: none;">\n                    <div class="dice-result-total">\n                        <span id="dice_result_total">0</span>\n                    </div>\n                    <div class="dice-result-breakdown" id="dice_result_breakdown"></div>\n                </div>\n\n                <div class="mazemaster-dice-log" id="dice_combat_log">\n                    <div class="dice-log-entry">Ready to roll...</div>\n                </div>\n\n                <div class="mazemaster-dice-actions" id="dice_actions">\n                    <button id="dice_roll_btn" class="mazemaster-dice-btn dice-btn-roll">\n                        <i class="fa-solid fa-dice"></i> Roll\n                    </button>\n                </div>\n\n                <div class="mazemaster-dice-final" id="dice_final_panel" style="display: none;">\n                    <div id="dice_final_text" class="dice-final-text"></div>\n                    <button id="dice_close_btn" class="mazemaster-dice-btn dice-btn-close">\n                        <i class="fa-solid fa-check"></i> Close\n                    </button>\n                </div>\n            </div>\n        </div>\n    ');const o=Ft.profile;document.getElementById("dice_main_title").textContent=o.mainTitle||"Roll the Dice!",document.getElementById("dice_description").textContent=o.description||"";const i="beat"===o.thresholdType?"> ".concat(o.threshold):" ".concat(o.threshold);document.getElementById("dice_threshold").textContent=i;const r=o.modifier>=0?"+".concat(o.modifier):"".concat(o.modifier);document.getElementById("dice_modifier").textContent=r,document.getElementById("dice_rerolls").textContent=Ft.rerollsRemaining,null===(e=document.getElementById("dice_roll_area"))||void 0===e||e.addEventListener("click",Zn),null===(t=document.getElementById("dice_roll_btn"))||void 0===t||t.addEventListener("click",Zn),null===(a=document.getElementById("dice_close_btn"))||void 0===a||a.addEventListener("click",to),Qn()}(),t.onStart&&W(t.onStart),console.log("[MazeMaster] Dice started: ".concat(e)),{success:!0}}function Qn(){document.getElementById("dice_rerolls").textContent=Ft.rerollsRemaining;const e=document.getElementById("dice_combat_log");e&&(e.innerHTML=Ft.combatLog.map((e=>{let t="dice-log-entry";return(e.includes("Success")||e.includes("passed"))&&(t+=" dice-log-success"),(e.includes("Failed")||e.includes("failed"))&&(t+=" dice-log-fail"),(e.includes("Critical")||e.includes("CRITICAL"))&&(t+=" dice-log-critical"),e.includes("Reroll")&&(t+=" dice-log-reroll"),'<div class="'.concat(t,'">').concat(e,"</div>")})).join(""),e.scrollTop=e.scrollHeight)}function Jn(e){Ft.combatLog.push(e),Ft.combatLog.length>20&&Ft.combatLog.shift(),Qn()}async function Zn(){if(Ft.isComplete)return;const e=Ft.profile,t=Vn[e.diceType]||Vn.d6,a=e.diceCount||1,n=[];for(let e=0;e<a;e++)n.push((o=t.sides,Math.floor(Math.random()*o)+1));var o;Ft.diceResults=n,Ft.rawTotal=n.reduce(((e,t)=>e+t),0),Ft.total=Ft.rawTotal+Ft.modifier;document.getElementById("dice_roll_area").innerHTML='<div class="dice-rolling">'.concat(n.map((e=>'<div class="dice-single">'.concat(e,"</div>"))).join(""),"</div>");const i="".concat(a).concat(e.diceType),r=0!==Ft.modifier?Ft.modifier>0?" + ".concat(Ft.modifier):" - ".concat(Math.abs(Ft.modifier)):"";Jn("Rolled ".concat(i,": [").concat(n.join(", "),"]").concat(r," = ").concat(Ft.total)),e.onRoll&&await W(e.onRoll),Ft.isCriticalSuccess=Ft.rawTotal>=e.criticalSuccess,Ft.isCriticalFail=Ft.rawTotal<=e.criticalFail,"beat"===e.thresholdType?Ft.isSuccess=Ft.total>Ft.threshold:Ft.isSuccess=Ft.total>=Ft.threshold,setTimeout((()=>{!async function(){const e=Ft.profile,t=document.getElementById("dice_result_display"),a=document.getElementById("dice_result_total"),n=document.getElementById("dice_result_breakdown"),o=document.getElementById("dice_actions");t.style.display="block",a.textContent=Ft.total;let i=Ft.isSuccess?"success":"fail";Ft.isCriticalSuccess&&(i="critical-success");Ft.isCriticalFail&&(i="critical-fail");a.className="dice-result-total "+i;const r=document.querySelectorAll(".dice-single");Ft.isCriticalSuccess?r.forEach((e=>e.classList.add("critical-success"))):Ft.isCriticalFail&&r.forEach((e=>e.classList.add("critical-fail")));const s="beat"===e.thresholdType?"needed > ".concat(Ft.threshold):"needed  ".concat(Ft.threshold);n.textContent=s,Ft.isCriticalSuccess?(Jn("CRITICAL SUCCESS!"),e.onCriticalSuccess&&await W(e.onCriticalSuccess)):Ft.isCriticalFail&&(Jn("CRITICAL FAILURE!"),e.onCriticalFail&&await W(e.onCriticalFail));Ft.isSuccess?(Jn("Roll passed!"),e.onSuccess&&await W(e.onSuccess)):(Jn("Roll failed..."),e.onFail&&await W(e.onFail));if(Ft.rerollsRemaining>0&&!Ft.isSuccess){var l,c;const t="none"===e.rerollCost?"":" (costs 1 ".concat(e.rerollCost,")");o.innerHTML='\n            <button id="dice_reroll_btn" class="mazemaster-dice-btn dice-btn-reroll">\n                <i class="fa-solid fa-rotate"></i> Reroll'.concat(t,'\n            </button>\n            <button id="dice_accept_btn" class="mazemaster-dice-btn dice-btn-close">\n                <i class="fa-solid fa-check"></i> Accept\n            </button>\n        '),null===(l=document.getElementById("dice_reroll_btn"))||void 0===l||l.addEventListener("click",$n),null===(c=document.getElementById("dice_accept_btn"))||void 0===c||c.addEventListener("click",eo)}else setTimeout((()=>eo()),1e3)}()}),600)}async function $n(){const e=Ft.profile;if("none"!==e.rerollCost){const t=e.rerollCost;if(jt.isOpen&&jt.inventory){if((jt.inventory[t]||0)<=0)return void Jn("Not enough ".concat(t,"s to reroll!"));jt.inventory[t]--,Jn("Spent 1 ".concat(t," to reroll"))}}Ft.rerollsRemaining--,Jn("Rerolling... (".concat(Ft.rerollsRemaining," left)")),e.onReroll&&await W(e.onReroll),document.getElementById("dice_result_display").style.display="none",await Zn()}async function eo(){Ft.isComplete=!0;const e=Ft.profile;document.getElementById("dice_actions").style.display="none";const t=document.getElementById("dice_final_panel"),a=document.getElementById("dice_final_text");if(Ft.isSuccess)Ft.isCriticalSuccess?a.textContent="CRITICAL SUCCESS!":a.textContent="Success!",a.className="dice-final-text success",e.onComplete&&await W(e.onComplete),jt.isOpen&&jt.pendingEncounter&&(at("key")&&100*Math.random()<(e.keyDropChance||25)&&(Ni("key"),Jn("You found a Key!")),at("strike")&&100*Math.random()<(e.strikeDropChance||12)&&(Ni("strike"),Jn("You found a Strike!")),at("healingPotion")&&100*Math.random()<(e.healingPotionDropChance||15)&&(Ni("healingPotion"),Jn("You found a Healing Potion!"))),Kt.dice=Kt.dice||{},Kt.dice[Ft.profileName]={result:"success",total:Ft.total,rawTotal:Ft.rawTotal,isCritical:Ft.isCriticalSuccess,timestamp:Date.now()};else{Ft.isCriticalFail?a.textContent="CRITICAL FAILURE!":a.textContent="Failed...",a.className="dice-final-text fail",e.onLose&&await W(e.onLose);let t=!1;if(jt.isOpen&&jt.hpEnabled&&jt.hp){var n,o;let a=e.damage||20;Ft.isCriticalFail&&(a=Math.round(1.5*a));const i=null!==(n=null===(o=jt.profile)||void 0===o?void 0:o.battlebarDamageMultiplier)&&void 0!==n?n:1,r=Math.round(a*i);t=!await K(r,"dice")}if(Kt.dice=Kt.dice||{},Kt.dice[Ft.profileName]={result:"fail",total:Ft.total,rawTotal:Ft.rawTotal,isCritical:Ft.isCriticalFail,timestamp:Date.now()},t)return void to()}t.style.display="block"}async function to(){const e=document.getElementById("mazemaster_dice_modal");e&&e.remove();const t=Ft.isSuccess;if(Ft.isOpen=!1,jt.isOpen){try{if(jt.pendingEncounter){const e=jt.pendingEncounter.type;if(t&&(await li(jt.playerX,jt.playerY),"exit_dice"===e))return jt.exitEncounterDone=!0,jt.isPaused=!1,void Rr()}}catch(e){console.error("[MazeMaster] Error in closeDiceModal:",e)}jt.isPaused=!1,jt.pendingEncounter=null}}function ao(e){console.log("[MazeMaster] startStealth called with profile:",e);const t=ga(e);return console.log("[MazeMaster] Retrieved stealth profile:",t),t?(console.log("[MazeMaster] Initializing stealth state with config:",{sectionsToPass:t.sectionsToPass,detectionThreshold:t.detectionThreshold}),Wt={isOpen:!0,profile:t,profileName:e,currentSection:0,sectionsToPass:t.sectionsToPass,detection:0,detectionThreshold:t.detectionThreshold,isSuccess:!1,isCaught:!1,isComplete:!1,actionsTaken:0,combatLog:["You begin your infiltration..."]},console.log("[MazeMaster] currentStealth initialized:",Wt),jt.isOpen&&(jt.isPaused=!0,console.log("[MazeMaster] Maze paused for stealth")),console.log("[MazeMaster] Calling showStealthModal..."),function(){var e,t,a,n,o;console.log("[MazeMaster] showStealthModal called");const i=document.getElementById("mazemaster_stealth_modal");i&&(console.log("[MazeMaster] Removing existing stealth modal"),i.remove());if(!document.getElementById("mazemaster_stealth_styles")){console.log("[MazeMaster] Adding stealth styles to document");const e=document.createElement("style");e.id="mazemaster_stealth_styles",e.textContent="\n        .mazemaster-stealth-container {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            gap: 15px;\n            padding: 25px;\n            background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1a 100%);\n            border-radius: 15px;\n            border: 2px solid #1abc9c;\n            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), 0 0 20px rgba(26, 188, 156, 0.3);\n            width: 450px;\n            max-width: 95vw;\n            max-height: 90vh;\n            overflow-y: auto;\n        }\n\n        .mazemaster-stealth-main-title {\n            font-size: 1.8em;\n            font-weight: bold;\n            color: #fff;\n            text-shadow: 0 2px 4px rgba(0,0,0,0.5);\n        }\n\n        .mazemaster-stealth-description {\n            font-size: 0.9em;\n            color: #aaa;\n            text-align: center;\n            max-width: 380px;\n        }\n\n        .mazemaster-stealth-progress {\n            width: 100%;\n            text-align: center;\n        }\n\n        .stealth-sections {\n            font-size: 1.1em;\n            color: #1abc9c;\n        }\n\n        #stealth_section_display {\n            font-weight: bold;\n        }\n\n        .mazemaster-stealth-detection {\n            width: 100%;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n        }\n\n        .stealth-detection-label {\n            display: flex;\n            align-items: center;\n            gap: 5px;\n            color: #e74c3c;\n            min-width: 90px;\n        }\n\n        .stealth-detection-bar {\n            flex: 1;\n            height: 20px;\n            background: #333;\n            border-radius: 10px;\n            overflow: hidden;\n        }\n\n        .stealth-detection-fill {\n            height: 100%;\n            width: 0%;\n            background: linear-gradient(90deg, #27ae60, #f39c12, #e74c3c);\n            transition: width 0.3s ease;\n        }\n\n        .stealth-detection-text {\n            min-width: 60px;\n            text-align: right;\n            color: #ddd;\n        }\n\n        .mazemaster-stealth-guard {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            gap: 10px;\n            padding: 20px;\n            background: rgba(0,0,0,0.3);\n            border-radius: 10px;\n            width: 100%;\n        }\n\n        .mazemaster-stealth-guard i {\n            color: #7f8c8d;\n            transition: all 0.3s ease;\n        }\n\n        .mazemaster-stealth-guard.alert i {\n            color: #f39c12;\n            animation: guard-alert 1s ease infinite;\n        }\n\n        .mazemaster-stealth-guard.detected i {\n            color: #e74c3c;\n            animation: guard-detected 0.5s ease infinite;\n        }\n\n        @keyframes guard-alert {\n            0%, 100% { opacity: 0.7; }\n            50% { opacity: 1; }\n        }\n\n        @keyframes guard-detected {\n            0%, 100% { transform: scale(1); }\n            50% { transform: scale(1.1); }\n        }\n\n        #stealth_guard_name {\n            font-size: 1.1em;\n            font-weight: bold;\n            color: #ddd;\n        }\n\n        #stealth_guard_status {\n            font-size: 0.9em;\n            color: #888;\n        }\n\n        #stealth_guard_status.alert { color: #f39c12; }\n        #stealth_guard_status.detected { color: #e74c3c; font-weight: bold; }\n\n        .mazemaster-stealth-log {\n            width: 100%;\n            height: 80px;\n            background: rgba(0,0,0,0.4);\n            border-radius: 8px;\n            padding: 10px;\n            overflow-y: auto;\n            font-size: 0.85em;\n            color: #ccc;\n        }\n\n        .stealth-log-entry { padding: 2px 0; }\n        .stealth-log-success { color: #1abc9c; }\n        .stealth-log-fail { color: #e74c3c; }\n        .stealth-log-warning { color: #f39c12; }\n        .stealth-log-action { color: #3498db; }\n\n        .mazemaster-stealth-actions {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 10px;\n            width: 100%;\n        }\n\n        .mazemaster-stealth-btn {\n            padding: 12px 20px;\n            border: none;\n            border-radius: 8px;\n            font-size: 1em;\n            font-weight: bold;\n            cursor: pointer;\n            transition: all 0.2s ease;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 8px;\n        }\n\n        .mazemaster-stealth-btn:hover {\n            transform: translateY(-2px);\n            box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n        }\n\n        .mazemaster-stealth-btn:disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n            transform: none;\n        }\n\n        .stealth-btn-advance {\n            background: linear-gradient(135deg, #1abc9c 0%, #16a085 100%);\n            color: white;\n        }\n\n        .stealth-btn-hide {\n            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);\n            color: white;\n        }\n\n        .stealth-btn-distract {\n            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);\n            color: white;\n        }\n\n        .stealth-btn-wait {\n            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);\n            color: white;\n        }\n\n        .stealth-btn-close {\n            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);\n            color: white;\n            padding: 15px 40px;\n        }\n\n        .mazemaster-stealth-result {\n            text-align: center;\n            padding: 15px;\n        }\n\n        .stealth-result-text {\n            font-size: 1.6em;\n            font-weight: bold;\n            margin-bottom: 15px;\n        }\n\n        .stealth-result-text.success { color: #1abc9c; }\n        .stealth-result-text.fail { color: #e74c3c; }\n    ",document.head.appendChild(e)}console.log("[MazeMaster] Inserting stealth modal HTML"),document.body.insertAdjacentHTML("beforeend",'\n        <div id="mazemaster_stealth_modal" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:999999;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.9);">\n            <div class="mazemaster-stealth-container">\n                <div id="stealth_main_title" class="mazemaster-stealth-main-title">Stealth</div>\n                <div id="stealth_description" class="mazemaster-stealth-description"></div>\n\n                <div class="mazemaster-stealth-progress">\n                    <div class="stealth-sections">\n                        <span>Progress: </span>\n                        <span id="stealth_section_display"></span>\n                    </div>\n                </div>\n\n                <div class="mazemaster-stealth-detection">\n                    <div class="stealth-detection-label">\n                        <i class="fa-solid fa-eye"></i>\n                        <span>Detection</span>\n                    </div>\n                    <div class="stealth-detection-bar">\n                        <div class="stealth-detection-fill" id="stealth_detection_bar"></div>\n                    </div>\n                    <div class="stealth-detection-text">\n                        <span id="stealth_detection_value">0</span>/<span id="stealth_detection_max">100</span>\n                    </div>\n                </div>\n\n                <div class="mazemaster-stealth-guard" id="stealth_guard_area">\n                    <i class="fa-solid fa-user-shield fa-3x"></i>\n                    <div id="stealth_guard_name">Guard</div>\n                    <div id="stealth_guard_status">Unaware</div>\n                </div>\n\n                <div class="mazemaster-stealth-log" id="stealth_combat_log">\n                    <div class="stealth-log-entry">You begin your infiltration...</div>\n                </div>\n\n                <div class="mazemaster-stealth-actions" id="stealth_actions">\n                    <button id="stealth_advance_btn" class="mazemaster-stealth-btn stealth-btn-advance" title="Move forward - risky but progresses">\n                        <i class="fa-solid fa-forward"></i> Advance\n                    </button>\n                    <button id="stealth_hide_btn" class="mazemaster-stealth-btn stealth-btn-hide" title="Stay hidden - reduces detection">\n                        <i class="fa-solid fa-mask"></i> Hide\n                    </button>\n                    <button id="stealth_distract_btn" class="mazemaster-stealth-btn stealth-btn-distract" title="Create a distraction - may reduce detection significantly">\n                        <i class="fa-solid fa-volume-high"></i> Distract\n                    </button>\n                    <button id="stealth_wait_btn" class="mazemaster-stealth-btn stealth-btn-wait" title="Wait patiently - small detection reduction">\n                        <i class="fa-solid fa-hourglass-half"></i> Wait\n                    </button>\n                </div>\n\n                <div class="mazemaster-stealth-result" id="stealth_result_panel" style="display: none;">\n                    <div id="stealth_result_text" class="stealth-result-text"></div>\n                    <button id="stealth_close_btn" class="mazemaster-stealth-btn stealth-btn-close">\n                        <i class="fa-solid fa-check"></i> Close\n                    </button>\n                </div>\n            </div>\n        </div>\n    ');const r=document.getElementById("mazemaster_stealth_modal");console.log("[MazeMaster] Stealth modal element after insert:",r);const s=Wt.profile;console.log("[MazeMaster] Updating stealth UI with profile:",null==s?void 0:s.name);const l=document.getElementById("stealth_main_title"),c=document.getElementById("stealth_description");console.log("[MazeMaster] Stealth UI elements - title:",l,"desc:",c),l&&(l.textContent=s.mainTitle||"Stealth");c&&(c.textContent=s.description||"");document.getElementById("stealth_guard_name").textContent=s.guardName||"Guard",document.getElementById("stealth_detection_max").textContent=Wt.detectionThreshold,console.log("[MazeMaster] Attaching stealth event handlers"),null===(e=document.getElementById("stealth_advance_btn"))||void 0===e||e.addEventListener("click",(()=>io("advance"))),null===(t=document.getElementById("stealth_hide_btn"))||void 0===t||t.addEventListener("click",(()=>io("hide"))),null===(a=document.getElementById("stealth_distract_btn"))||void 0===a||a.addEventListener("click",(()=>io("distract"))),null===(n=document.getElementById("stealth_wait_btn"))||void 0===n||n.addEventListener("click",(()=>io("wait"))),null===(o=document.getElementById("stealth_close_btn"))||void 0===o||o.addEventListener("click",so),console.log("[MazeMaster] Calling updateStealthDisplay"),no(),console.log("[MazeMaster] showStealthModal complete")}(),t.onStart&&W(t.onStart),console.log("[MazeMaster] Stealth started: ".concat(e)),{success:!0}):(console.error('[MazeMaster] Stealth profile "'.concat(e,'" not found')),{error:'Profile "'.concat(e,'" not found')})}function no(){const e=document.getElementById("stealth_section_display");if(e){let t="";for(let e=0;e<Wt.sectionsToPass;e++)e<Wt.currentSection?t+=" ":t+=" ";e.textContent=t.trim()}const t=document.getElementById("stealth_detection_bar"),a=document.getElementById("stealth_detection_value"),n=Wt.detection/Wt.detectionThreshold*100;t&&(t.style.width="".concat(Math.min(n,100),"%")),a&&(a.textContent=Math.round(Wt.detection));const o=document.getElementById("stealth_guard_area"),i=document.getElementById("stealth_guard_status");o&&i&&(o.classList.remove("alert","detected"),n>=80?(o.classList.add("detected"),i.textContent="ALERT!",i.className="detected"):n>=50?(o.classList.add("alert"),i.textContent="Suspicious",i.className="alert"):n>=25?(i.textContent="Cautious",i.className=""):(i.textContent="Unaware",i.className=""));const r=document.getElementById("stealth_combat_log");r&&(r.innerHTML=Wt.combatLog.map((e=>{let t="stealth-log-entry";return(e.includes("success")||e.includes("passed")||e.includes("clear"))&&(t+=" stealth-log-success"),(e.includes("spotted")||e.includes("caught")||e.includes("failed"))&&(t+=" stealth-log-fail"),(e.includes("suspicion")||e.includes("alert")||e.includes("detection"))&&(t+=" stealth-log-warning"),e.includes("You ")&&(t+=" stealth-log-action"),'<div class="'.concat(t,'">').concat(e,"</div>")})).join(""),r.scrollTop=r.scrollHeight)}function oo(e){Wt.combatLog.push(e),Wt.combatLog.length>30&&Wt.combatLog.shift(),no()}async function io(e){if(Wt.isComplete)return;const t=Wt.profile;Wt.actionsTaken++;let a=!1,n=0;switch(e){case"advance":a=100*Math.random()<t.advanceSuccessChance,a?(Wt.currentSection++,oo("You advance quietly... clear!"),t.onAdvance&&await W(t.onAdvance)):(n=t.baseDetectionRate,oo("You made noise! (+".concat(n," detection)")),t.onDetectionIncrease&&await W(t.onDetectionIncrease));break;case"hide":n=-t.hideRecovery,oo("You hide in the shadows... (-".concat(t.hideRecovery," detection)")),t.onHide&&await W(t.onHide),a=!0;break;case"distract":a=100*Math.random()<t.distractSuccessChance,a?(n=-t.distractReduction,oo("Distraction worked! (-".concat(t.distractReduction," detection)")),t.onDistract&&await W(t.onDistract)):(n=Math.round(.5*t.baseDetectionRate),oo("Distraction failed! (+".concat(n," detection)")),t.onDetectionIncrease&&await W(t.onDetectionIncrease));break;case"wait":n=-t.waitRecovery,oo("You wait patiently... (-".concat(t.waitRecovery," detection)")),t.onWait&&await W(t.onWait),a=!0}Wt.detection=Math.max(0,Wt.detection+n),no(),Wt.detection>=Wt.detectionThreshold?await async function(){Wt.isComplete=!0,Wt.isCaught=!0,oo("You've been caught!");const e=Wt.profile;e.onCaught&&await W(e.onCaught);let t=!1;if(jt.isOpen&&jt.hpEnabled&&jt.hp){var a,n;const o=e.damage||25,i=null!==(a=null===(n=jt.profile)||void 0===n?void 0:n.battlebarDamageMultiplier)&&void 0!==a?a:1,r=Math.round(o*i);t=!await K(r,"stealth")}if(Kt.stealth=Kt.stealth||{},Kt.stealth[Wt.profileName]={result:"caught",actionsTaken:Wt.actionsTaken,finalDetection:Wt.detection,timestamp:Date.now()},t)return void so();ro()}():Wt.currentSection>=Wt.sectionsToPass&&await async function(){Wt.isComplete=!0,Wt.isSuccess=!0,oo("Infiltration successful!");const e=Wt.profile;e.onComplete&&await W(e.onComplete);jt.isOpen&&jt.pendingEncounter&&(at("key")&&100*Math.random()<(e.keyDropChance||20)&&(Ni("key"),oo("You found a Key!")),at("stealth")&&100*Math.random()<(e.stealthDropChance||15)&&(Ni("stealth"),oo("You found a Stealth item!")),at("healingPotion")&&100*Math.random()<(e.healingPotionDropChance||15)&&(Ni("healingPotion"),oo("You found a Healing Potion!")));Kt.stealth=Kt.stealth||{},Kt.stealth[Wt.profileName]={result:"success",actionsTaken:Wt.actionsTaken,finalDetection:Wt.detection,timestamp:Date.now()},ro()}()}function ro(){const e=document.getElementById("stealth_actions"),t=document.getElementById("stealth_result_panel"),a=document.getElementById("stealth_result_text");e&&(e.style.display="none"),t&&(t.style.display="block"),a&&(Wt.isSuccess?(a.textContent="Infiltration Successful!",a.className="stealth-result-text success"):(a.textContent="Caught!",a.className="stealth-result-text fail"))}async function so(){const e=document.getElementById("mazemaster_stealth_modal");e&&e.remove();const t=Wt.isSuccess;if(Wt.isOpen=!1,jt.isOpen){try{if(jt.pendingEncounter){const e=jt.pendingEncounter.type;if(t){var a;if(await li(jt.playerX,jt.playerY),jt.hp&&!1!==(null===(a=jt.profile)||void 0===a?void 0:a.hpEnabled)){const e=jt.profile.skillEncounterHealPercent||25,t=jt.hp.max+(jt.hp.maxBonus||0),a=Math.floor(t*(e/100));jt.hp.current<t&&a>0&&(await V(a,!1,"Stealth success"),addMazeLogMessage("Silent and deadly! Recovered ".concat(a," HP."),"heal"))}if("exit_stealth"===e)return jt.exitEncounterDone=!0,jt.isPaused=!1,void Rr()}}}catch(e){console.error("[MazeMaster] Error in closeStealthModal:",e)}jt.isPaused=!1,jt.pendingEncounter=null}}function lo(e){console.log("[MazeMaster] startPuzzle called with profile:",e);const t=va(e);if(console.log("[MazeMaster] Retrieved puzzle profile:",t),!t)return console.error('[MazeMaster] Puzzle profile "'.concat(e,'" not found')),{error:'Profile "'.concat(e,'" not found')};const a=t.gridSize||3,n=t.sequenceLength||4,o=[],i=a*a;console.log("[MazeMaster] Generating puzzle with gridSize:",a,"sequenceLength:",n);for(let e=0;e<n;e++)o.push(Math.floor(Math.random()*i));return console.log("[MazeMaster] Generated sequence:",o),Yt={isOpen:!0,profile:t,profileName:e,puzzleType:t.puzzleType||"sequence",gridSize:a,grid:[],sequence:o,playerSequence:[],currentStep:0,timeLimit:t.timeLimit||0,timeRemaining:t.timeLimit||0,timerInterval:null,hintsRemaining:t.hintsAllowed||0,hintsUsed:0,wrongGuesses:0,wrongGuessesAllowed:t.wrongGuessesAllowed||3,score:100,isShowingSequence:!1,isSuccess:!1,isFailed:!1,isComplete:!1,combatLog:["The puzzle awaits..."]},console.log("[MazeMaster] currentPuzzle initialized:",Yt),jt.isOpen&&(jt.isPaused=!0,console.log("[MazeMaster] Maze paused for puzzle")),console.log("[MazeMaster] Calling showPuzzleModal..."),function(){var e,t,a;console.log("[MazeMaster] showPuzzleModal called");const n=document.getElementById("mazemaster_puzzle_modal");n&&(console.log("[MazeMaster] Removing existing puzzle modal"),n.remove());if(!document.getElementById("mazemaster_puzzle_styles")){console.log("[MazeMaster] Adding puzzle styles to document");const e=document.createElement("style");e.id="mazemaster_puzzle_styles",e.textContent="\n        .mazemaster-puzzle-container {\n            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);\n            border: 2px solid #3d5a80;\n            border-radius: 15px;\n            padding: 25px;\n            min-width: 450px;\n            max-width: 550px;\n            box-shadow: 0 0 40px rgba(61, 90, 128, 0.4);\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            color: #e0e0e0;\n        }\n\n        .puzzle-main-title {\n            text-align: center;\n            font-size: 1.8em;\n            font-weight: bold;\n            color: #9b59b6;\n            text-shadow: 0 0 10px rgba(155, 89, 182, 0.5);\n            margin-bottom: 8px;\n        }\n\n        .puzzle-description {\n            text-align: center;\n            font-size: 0.95em;\n            color: #bbb;\n            margin-bottom: 15px;\n            font-style: italic;\n        }\n\n        .puzzle-stats-row {\n            display: flex;\n            justify-content: space-around;\n            margin-bottom: 15px;\n            padding: 10px;\n            background: rgba(0,0,0,0.3);\n            border-radius: 8px;\n        }\n\n        .puzzle-stat {\n            text-align: center;\n        }\n\n        .puzzle-stat-label {\n            color: #888;\n            font-size: 0.85em;\n            display: block;\n        }\n\n        .puzzle-stat span:not(.puzzle-stat-label) {\n            color: #9b59b6;\n            font-weight: bold;\n            font-size: 1.1em;\n        }\n\n        .puzzle-instruction {\n            text-align: center;\n            font-size: 1.1em;\n            color: #f1c40f;\n            margin-bottom: 15px;\n            padding: 10px;\n            background: rgba(241, 196, 15, 0.1);\n            border-radius: 8px;\n            border: 1px solid rgba(241, 196, 15, 0.3);\n        }\n\n        .puzzle-grid-container {\n            display: flex;\n            justify-content: center;\n            margin-bottom: 20px;\n        }\n\n        .puzzle-grid {\n            display: grid;\n            gap: 8px;\n            padding: 15px;\n            background: rgba(0,0,0,0.4);\n            border-radius: 10px;\n            border: 2px solid #3d5a80;\n        }\n\n        .puzzle-cell {\n            width: 60px;\n            height: 60px;\n            background: linear-gradient(135deg, #2c3e50 0%, #1a252f 100%);\n            border: 2px solid #3d5a80;\n            border-radius: 8px;\n            cursor: pointer;\n            transition: all 0.2s ease;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-size: 1.5em;\n            font-weight: bold;\n            color: #fff;\n        }\n\n        .puzzle-cell:hover:not(.disabled) {\n            background: linear-gradient(135deg, #3d5a80 0%, #2c3e50 100%);\n            transform: scale(1.05);\n        }\n\n        .puzzle-cell.highlighted {\n            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);\n            border-color: #bb6bd9;\n            box-shadow: 0 0 20px rgba(155, 89, 182, 0.6);\n            animation: puzzle-pulse 0.5s ease;\n        }\n\n        .puzzle-cell.correct {\n            background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);\n            border-color: #2ecc71;\n            box-shadow: 0 0 15px rgba(46, 204, 113, 0.5);\n        }\n\n        .puzzle-cell.wrong {\n            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);\n            border-color: #e74c3c;\n            animation: puzzle-shake 0.3s ease;\n        }\n\n        .puzzle-cell.hint {\n            background: linear-gradient(135deg, #f39c12 0%, #d68910 100%);\n            border-color: #f1c40f;\n            box-shadow: 0 0 15px rgba(241, 196, 15, 0.5);\n        }\n\n        .puzzle-cell.disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n        }\n\n        @keyframes puzzle-pulse {\n            0% { transform: scale(1); }\n            50% { transform: scale(1.1); }\n            100% { transform: scale(1); }\n        }\n\n        @keyframes puzzle-shake {\n            0%, 100% { transform: translateX(0); }\n            25% { transform: translateX(-5px); }\n            75% { transform: translateX(5px); }\n        }\n\n        .puzzle-actions {\n            display: flex;\n            justify-content: center;\n            gap: 15px;\n            margin-bottom: 15px;\n        }\n\n        .puzzle-btn {\n            padding: 12px 25px;\n            border: none;\n            border-radius: 8px;\n            cursor: pointer;\n            font-size: 1em;\n            font-weight: bold;\n            transition: all 0.2s ease;\n        }\n\n        .puzzle-hint-btn {\n            background: linear-gradient(135deg, #f39c12 0%, #d68910 100%);\n            color: white;\n        }\n\n        .puzzle-hint-btn:hover:not(:disabled) {\n            transform: scale(1.05);\n            box-shadow: 0 0 15px rgba(243, 156, 18, 0.5);\n        }\n\n        .puzzle-hint-btn:disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n        }\n\n        .puzzle-reset-btn {\n            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);\n            color: white;\n        }\n\n        .puzzle-reset-btn:hover {\n            transform: scale(1.05);\n            box-shadow: 0 0 15px rgba(52, 152, 219, 0.5);\n        }\n\n        .puzzle-close-btn {\n            background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);\n            color: white;\n            padding: 15px 40px;\n            font-size: 1.1em;\n        }\n\n        .puzzle-close-btn:hover {\n            transform: scale(1.05);\n            box-shadow: 0 0 15px rgba(39, 174, 96, 0.5);\n        }\n\n        .puzzle-result-panel {\n            text-align: center;\n            padding: 20px;\n        }\n\n        .puzzle-result-text {\n            font-size: 1.6em;\n            font-weight: bold;\n            margin-bottom: 20px;\n        }\n\n        .puzzle-result-text.success { color: #2ecc71; }\n        .puzzle-result-text.fail { color: #e74c3c; }\n\n        .puzzle-combat-log {\n            max-height: 100px;\n            overflow-y: auto;\n            background: rgba(0,0,0,0.3);\n            border-radius: 8px;\n            padding: 10px;\n            font-size: 0.9em;\n        }\n\n        .puzzle-log-entry {\n            padding: 3px 0;\n            border-bottom: 1px solid rgba(255,255,255,0.1);\n        }\n\n        .puzzle-log-entry:last-child { border-bottom: none; }\n        .puzzle-log-success { color: #2ecc71; }\n        .puzzle-log-fail { color: #e74c3c; }\n        .puzzle-log-warning { color: #f39c12; }\n        .puzzle-log-info { color: #3498db; }\n    ",document.head.appendChild(e)}console.log("[MazeMaster] Inserting puzzle modal HTML"),document.body.insertAdjacentHTML("beforeend",'\n        <div id="mazemaster_puzzle_modal" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:999999;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.9);">\n            <div class="mazemaster-puzzle-container">\n                <div id="puzzle_main_title" class="puzzle-main-title">Puzzle</div>\n                <div id="puzzle_description" class="puzzle-description"></div>\n\n                <div class="puzzle-stats-row">\n                    <div class="puzzle-stat">\n                        <span class="puzzle-stat-label">Progress:</span>\n                        <span id="puzzle_progress">0/0</span>\n                    </div>\n                    <div class="puzzle-stat">\n                        <span class="puzzle-stat-label">Time:</span>\n                        <span id="puzzle_timer">--</span>\n                    </div>\n                    <div class="puzzle-stat">\n                        <span class="puzzle-stat-label">Hints:</span>\n                        <span id="puzzle_hints">0</span>\n                    </div>\n                    <div class="puzzle-stat">\n                        <span class="puzzle-stat-label">Mistakes:</span>\n                        <span id="puzzle_mistakes">0/0</span>\n                    </div>\n                </div>\n\n                <div class="puzzle-instruction" id="puzzle_instruction">Watch the sequence...</div>\n\n                <div id="puzzle_grid_container" class="puzzle-grid-container">\n                    \x3c!-- Grid will be generated here --\x3e\n                </div>\n\n                <div id="puzzle_actions" class="puzzle-actions">\n                    <button id="puzzle_hint_btn" class="puzzle-btn puzzle-hint-btn">\n                        <i class="fa-solid fa-lightbulb"></i> Use Hint\n                    </button>\n                    <button id="puzzle_reset_btn" class="puzzle-btn puzzle-reset-btn">\n                        <i class="fa-solid fa-redo"></i> Show Sequence\n                    </button>\n                </div>\n\n                <div id="puzzle_result_panel" class="puzzle-result-panel" style="display:none;">\n                    <div id="puzzle_result_text" class="puzzle-result-text"></div>\n                    <button id="puzzle_close_btn" class="puzzle-btn puzzle-close-btn">\n                        <i class="fa-solid fa-check"></i> Continue\n                    </button>\n                </div>\n\n                <div id="puzzle_combat_log" class="puzzle-combat-log"></div>\n            </div>\n        </div>\n    ');const o=document.getElementById("mazemaster_puzzle_modal");console.log("[MazeMaster] Puzzle modal element after insert:",o);const i=Yt.profile;console.log("[MazeMaster] Updating puzzle UI with profile:",null==i?void 0:i.name);const r=document.getElementById("puzzle_main_title"),s=document.getElementById("puzzle_description");console.log("[MazeMaster] Puzzle UI elements - title:",r,"desc:",s),r&&(r.textContent=i.mainTitle||"Puzzle");s&&(s.textContent=i.description||"");document.getElementById("puzzle_hints").textContent=Yt.hintsRemaining,document.getElementById("puzzle_mistakes").textContent="".concat(Yt.wrongGuesses,"/").concat(Yt.wrongGuessesAllowed),document.getElementById("puzzle_progress").textContent="".concat(Yt.currentStep,"/").concat(Yt.sequence.length),console.log("[MazeMaster] Generating puzzle grid"),function(){const e=document.getElementById("puzzle_grid_container");if(!e)return;const t=Yt.gridSize,a=document.createElement("div");a.className="puzzle-grid",a.style.gridTemplateColumns="repeat(".concat(t,", 60px)");for(let e=0;e<t*t;e++){const t=document.createElement("div");t.className="puzzle-cell",t.dataset.index=e,t.textContent=e+1,t.addEventListener("click",(()=>mo(e))),a.appendChild(t),Yt.grid.push(t)}e.innerHTML="",e.appendChild(a)}(),console.log("[MazeMaster] Attaching puzzle event handlers"),null===(e=document.getElementById("puzzle_hint_btn"))||void 0===e||e.addEventListener("click",uo),null===(t=document.getElementById("puzzle_reset_btn"))||void 0===t||t.addEventListener("click",co),null===(a=document.getElementById("puzzle_close_btn"))||void 0===a||a.addEventListener("click",fo),Yt.timeLimit>0?(console.log("[MazeMaster] Starting puzzle timer with limit:",Yt.timeLimit),function(){const e=document.getElementById("puzzle_timer");Yt.timerInterval=setInterval((()=>{if(Yt.timeRemaining--,e){const t=Math.floor(Yt.timeRemaining/60),a=Yt.timeRemaining%60;e.textContent="".concat(t,":").concat(a.toString().padStart(2,"0")),Yt.timeRemaining<=10&&(e.style.color="#e74c3c")}Yt.timeRemaining<=0&&(clearInterval(Yt.timerInterval),go("Time's up!"),po())}),1e3)}()):document.getElementById("puzzle_timer").textContent="";console.log("[MazeMaster] Scheduling sequence display in 500ms"),setTimeout((()=>co()),500),console.log("[MazeMaster] showPuzzleModal complete")}(),t.onStart&&W(t.onStart),console.log("[MazeMaster] Puzzle started: ".concat(e)),{success:!0}}async function co(){if(Yt.isComplete)return;Yt.isShowingSequence=!0;const e=document.getElementById("puzzle_instruction");e&&(e.textContent="Watch carefully..."),Yt.grid.forEach((e=>e.classList.add("disabled")));for(let e=0;e<Yt.sequence.length;e++){const t=Yt.sequence[e],a=Yt.grid[t];await new Promise((e=>setTimeout(e,600))),a.classList.add("highlighted"),await new Promise((e=>setTimeout(e,400))),a.classList.remove("highlighted")}await new Promise((e=>setTimeout(e,300))),Yt.isShowingSequence=!1,e&&(e.textContent="Repeat the sequence!"),Yt.grid.forEach((e=>e.classList.remove("disabled"))),go("Sequence shown. Your turn!")}function mo(e){if(Yt.isComplete||Yt.isShowingSequence)return;const t=Yt.grid[e],a=Yt.sequence[Yt.currentStep],n=Yt.profile;e===a?(t.classList.add("correct"),setTimeout((()=>t.classList.remove("correct")),300),Yt.currentStep++,Yt.playerSequence.push(e),document.getElementById("puzzle_progress").textContent="".concat(Yt.currentStep,"/").concat(Yt.sequence.length),go("Step ".concat(Yt.currentStep," correct!")),n.onCorrectMove&&W(n.onCorrectMove),Yt.currentStep>=Yt.sequence.length&&async function(){Yt.isComplete=!0,Yt.isSuccess=!0,Yt.timerInterval&&clearInterval(Yt.timerInterval);go("Puzzle solved!");const e=Yt.profile;e.onComplete&&await W(e.onComplete);jt.isOpen&&jt.pendingEncounter&&(at("key")&&100*Math.random()<(e.keyDropChance||20)&&(Ni("key"),go("You found a Key!")),at("stealth")&&100*Math.random()<(e.stealthDropChance||15)&&(Ni("stealth"),go("You found a Stealth item!")),at("healingPotion")&&100*Math.random()<(e.healingPotionDropChance||15)&&(Ni("healingPotion"),go("You found a Healing Potion!")));Kt.puzzle=Kt.puzzle||{},Kt.puzzle[Yt.profileName]={result:"success",score:Yt.score,hintsUsed:Yt.hintsUsed,wrongGuesses:Yt.wrongGuesses,timeRemaining:Yt.timeRemaining,timestamp:Date.now()},ho()}()):(t.classList.add("wrong"),setTimeout((()=>t.classList.remove("wrong")),300),Yt.wrongGuesses++,Yt.score-=n.wrongGuessPenalty||10,document.getElementById("puzzle_mistakes").textContent="".concat(Yt.wrongGuesses,"/").concat(Yt.wrongGuessesAllowed),go("Wrong! Mistakes: ".concat(Yt.wrongGuesses,"/").concat(Yt.wrongGuessesAllowed)),n.onWrongMove&&W(n.onWrongMove),Yt.wrongGuesses>=Yt.wrongGuessesAllowed&&po())}function uo(){if(Yt.isComplete||Yt.hintsRemaining<=0)return;Yt.hintsRemaining--,Yt.hintsUsed++,Yt.score-=Yt.profile.hintPenalty||10,document.getElementById("puzzle_hints").textContent=Yt.hintsRemaining;const e=Yt.sequence[Yt.currentStep],t=Yt.grid[e];if(t.classList.add("hint"),setTimeout((()=>t.classList.remove("hint")),1e3),go("Hint used! ".concat(Yt.hintsRemaining," remaining.")),Yt.profile.onHint&&W(Yt.profile.onHint),Yt.hintsRemaining<=0){const e=document.getElementById("puzzle_hint_btn");e&&(e.disabled=!0)}}async function po(){Yt.isComplete=!0,Yt.isFailed=!0,Yt.timerInterval&&clearInterval(Yt.timerInterval),go("Puzzle failed!");const e=Yt.profile;e.onFail&&await W(e.onFail),Kt.puzzle=Kt.puzzle||{},Kt.puzzle[Yt.profileName]={result:"fail",score:Yt.score,hintsUsed:Yt.hintsUsed,wrongGuesses:Yt.wrongGuesses,timestamp:Date.now()},ho()}function ho(){const e=document.getElementById("puzzle_actions"),t=document.getElementById("puzzle_result_panel"),a=document.getElementById("puzzle_result_text"),n=document.getElementById("puzzle_instruction");e&&(e.style.display="none"),n&&(n.style.display="none"),t&&(t.style.display="block"),Yt.grid.forEach((e=>e.classList.add("disabled"))),a&&(Yt.isSuccess?(a.textContent=Yt.profile.successMessage||"Puzzle Solved!",a.className="puzzle-result-text success"):(a.textContent=Yt.profile.failMessage||"Puzzle Failed!",a.className="puzzle-result-text fail"))}function go(e){Yt.combatLog.push(e),Yt.combatLog.length>20&&Yt.combatLog.shift();const t=document.getElementById("puzzle_combat_log");t&&(t.innerHTML=Yt.combatLog.map((e=>{let t="puzzle-log-entry";return(e.includes("correct")||e.includes("solved")||e.includes("found"))&&(t+=" puzzle-log-success"),(e.includes("Wrong")||e.includes("failed")||e.includes("Time"))&&(t+=" puzzle-log-fail"),e.includes("Hint")&&(t+=" puzzle-log-warning"),(e.includes("turn")||e.includes("shown"))&&(t+=" puzzle-log-info"),'<div class="'.concat(t,'">').concat(e,"</div>")})).join(""),t.scrollTop=t.scrollHeight)}async function fo(){Yt.timerInterval&&clearInterval(Yt.timerInterval);const e=document.getElementById("mazemaster_puzzle_modal");e&&e.remove();const t=Yt.isSuccess;if(Yt.isOpen=!1,jt.isOpen){try{if(jt.pendingEncounter){const e=jt.pendingEncounter.type;if(t){var a;if(await li(jt.playerX,jt.playerY),jt.hp&&!1!==(null===(a=jt.profile)||void 0===a?void 0:a.hpEnabled)){const e=jt.profile.skillEncounterHealPercent||25,t=jt.hp.max+(jt.hp.maxBonus||0),a=Math.floor(t*(e/100));jt.hp.current<t&&a>0&&(await V(a,!1,"Puzzle success"),addMazeLogMessage("Brilliant mind! Recovered ".concat(a," HP."),"heal"))}if("exit_puzzle"===e)return jt.exitEncounterDone=!0,jt.isPaused=!1,void Rr()}}}catch(e){console.error("[MazeMaster] Error in closePuzzleModal:",e)}jt.isPaused=!1,jt.pendingEncounter=null}}function yo(e){console.log("[MazeMaster] startNegotiation called with profile:",e);const t=_a(e);return console.log("[MazeMaster] Retrieved negotiation profile:",t),t?(console.log("[MazeMaster] Initializing negotiation state with config:",{startingFavor:t.startingFavor,favorThreshold:t.favorThreshold,turnsAllowed:t.turnsAllowed}),Ut={isOpen:!0,profile:t,profileName:e,favor:t.startingFavor||50,favorThreshold:t.favorThreshold||75,turnsRemaining:t.turnsAllowed||5,turnsUsed:0,lastAction:"",lastResult:"",isSuccess:!1,isFailed:!1,isComplete:!1,combatLog:["The negotiation begins..."]},console.log("[MazeMaster] currentNegotiation initialized:",Ut),jt.isOpen&&(jt.isPaused=!0,console.log("[MazeMaster] Maze paused for negotiation")),console.log("[MazeMaster] Calling showNegotiationModal..."),function(){var e,t,a,n,o,i;console.log("[MazeMaster] showNegotiationModal called");const r=document.getElementById("mazemaster_negotiation_modal");r&&(console.log("[MazeMaster] Removing existing negotiation modal"),r.remove());if(!document.getElementById("mazemaster_negotiation_styles")){console.log("[MazeMaster] Adding negotiation styles to document");const e=document.createElement("style");e.id="mazemaster_negotiation_styles",e.textContent="\n        .mazemaster-negotiate-container {\n            background: linear-gradient(135deg, #2c1810 0%, #1a0f0a 50%, #0f0705 100%);\n            border: 2px solid #8b4513;\n            border-radius: 15px;\n            padding: 25px;\n            min-width: 450px;\n            max-width: 550px;\n            box-shadow: 0 0 40px rgba(139, 69, 19, 0.4);\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            color: #e0e0e0;\n        }\n\n        .negotiate-main-title {\n            text-align: center;\n            font-size: 1.8em;\n            font-weight: bold;\n            color: #daa520;\n            text-shadow: 0 0 10px rgba(218, 165, 32, 0.5);\n            margin-bottom: 8px;\n        }\n\n        .negotiate-description {\n            text-align: center;\n            font-size: 0.95em;\n            color: #bbb;\n            margin-bottom: 15px;\n            font-style: italic;\n        }\n\n        .negotiate-npc-area {\n            text-align: center;\n            padding: 15px;\n            background: rgba(0,0,0,0.4);\n            border-radius: 10px;\n            margin-bottom: 15px;\n            border: 1px solid #8b4513;\n        }\n\n        .negotiate-npc-name {\n            font-size: 1.3em;\n            font-weight: bold;\n            color: #daa520;\n            margin-bottom: 5px;\n        }\n\n        .negotiate-disposition {\n            font-size: 1em;\n            padding: 5px 15px;\n            border-radius: 15px;\n            display: inline-block;\n        }\n\n        .negotiate-disposition.hostile { background: #e74c3c; color: white; }\n        .negotiate-disposition.unfriendly { background: #e67e22; color: white; }\n        .negotiate-disposition.neutral { background: #7f8c8d; color: white; }\n        .negotiate-disposition.friendly { background: #27ae60; color: white; }\n        .negotiate-disposition.enthusiastic { background: #2ecc71; color: white; }\n\n        .negotiate-stats-row {\n            display: flex;\n            justify-content: space-around;\n            align-items: center;\n            margin-bottom: 15px;\n            padding: 10px;\n            background: rgba(0,0,0,0.3);\n            border-radius: 8px;\n        }\n\n        .negotiate-stat {\n            text-align: center;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .negotiate-stat-label {\n            color: #888;\n            font-size: 0.9em;\n        }\n\n        .negotiate-favor-bar-container {\n            width: 150px;\n            height: 20px;\n            background: #333;\n            border-radius: 10px;\n            overflow: hidden;\n            border: 1px solid #555;\n        }\n\n        .negotiate-favor-bar {\n            height: 100%;\n            background: linear-gradient(90deg, #e74c3c 0%, #f39c12 50%, #27ae60 100%);\n            transition: width 0.3s ease;\n            width: 50%;\n        }\n\n        .negotiate-actions {\n            display: grid;\n            grid-template-columns: repeat(2, 1fr);\n            gap: 10px;\n            margin-bottom: 15px;\n        }\n\n        .negotiate-btn {\n            padding: 12px 20px;\n            border: none;\n            border-radius: 8px;\n            cursor: pointer;\n            font-size: 1em;\n            font-weight: bold;\n            transition: all 0.2s ease;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 8px;\n        }\n\n        .negotiate-persuade-btn {\n            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);\n            color: white;\n        }\n\n        .negotiate-intimidate-btn {\n            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);\n            color: white;\n        }\n\n        .negotiate-flatter-btn {\n            background: linear-gradient(135deg, #e91e63 0%, #c2185b 100%);\n            color: white;\n        }\n\n        .negotiate-bribe-btn {\n            background: linear-gradient(135deg, #f39c12 0%, #d68910 100%);\n            color: white;\n        }\n\n        .negotiate-insult-btn {\n            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);\n            color: white;\n            grid-column: span 2;\n        }\n\n        .negotiate-btn:hover:not(:disabled) {\n            transform: scale(1.03);\n            box-shadow: 0 0 15px rgba(255,255,255,0.2);\n        }\n\n        .negotiate-btn:disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n        }\n\n        .negotiate-close-btn {\n            background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);\n            color: white;\n            padding: 15px 40px;\n            font-size: 1.1em;\n            width: 100%;\n        }\n\n        .negotiate-result-panel {\n            text-align: center;\n            padding: 20px;\n        }\n\n        .negotiate-result-text {\n            font-size: 1.6em;\n            font-weight: bold;\n            margin-bottom: 20px;\n        }\n\n        .negotiate-result-text.success { color: #2ecc71; }\n        .negotiate-result-text.fail { color: #e74c3c; }\n\n        .negotiate-combat-log {\n            max-height: 120px;\n            overflow-y: auto;\n            background: rgba(0,0,0,0.3);\n            border-radius: 8px;\n            padding: 10px;\n            font-size: 0.9em;\n        }\n\n        .negotiate-log-entry {\n            padding: 3px 0;\n            border-bottom: 1px solid rgba(255,255,255,0.1);\n        }\n\n        .negotiate-log-entry:last-child { border-bottom: none; }\n        .negotiate-log-success { color: #2ecc71; }\n        .negotiate-log-fail { color: #e74c3c; }\n        .negotiate-log-warning { color: #f39c12; }\n        .negotiate-log-info { color: #3498db; }\n        .negotiate-log-action { color: #daa520; }\n    ",document.head.appendChild(e)}console.log("[MazeMaster] Inserting negotiation modal HTML"),document.body.insertAdjacentHTML("beforeend",'\n        <div id="mazemaster_negotiation_modal" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:999999;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.9);">\n            <div class="mazemaster-negotiate-container">\n                <div id="negotiate_main_title" class="negotiate-main-title">Negotiation</div>\n                <div id="negotiate_description" class="negotiate-description"></div>\n\n                <div class="negotiate-npc-area">\n                    <div class="negotiate-npc-name" id="negotiate_npc_name">NPC</div>\n                    <div class="negotiate-disposition" id="negotiate_disposition">Neutral</div>\n                </div>\n\n                <div class="negotiate-stats-row">\n                    <div class="negotiate-stat">\n                        <span class="negotiate-stat-label">Favor:</span>\n                        <div class="negotiate-favor-bar-container">\n                            <div class="negotiate-favor-bar" id="negotiate_favor_bar"></div>\n                        </div>\n                        <span id="negotiate_favor_value">50</span>/<span id="negotiate_favor_max">75</span>\n                    </div>\n                    <div class="negotiate-stat">\n                        <span class="negotiate-stat-label">Turns:</span>\n                        <span id="negotiate_turns">0/0</span>\n                    </div>\n                </div>\n\n                <div id="negotiate_actions" class="negotiate-actions">\n                    <button id="negotiate_persuade_btn" class="negotiate-btn negotiate-persuade-btn">\n                        <i class="fa-solid fa-comment"></i> Persuade\n                    </button>\n                    <button id="negotiate_intimidate_btn" class="negotiate-btn negotiate-intimidate-btn">\n                        <i class="fa-solid fa-hand-fist"></i> Intimidate\n                    </button>\n                    <button id="negotiate_flatter_btn" class="negotiate-btn negotiate-flatter-btn">\n                        <i class="fa-solid fa-heart"></i> Flatter\n                    </button>\n                    <button id="negotiate_bribe_btn" class="negotiate-btn negotiate-bribe-btn">\n                        <i class="fa-solid fa-coins"></i> Bribe\n                    </button>\n                    <button id="negotiate_insult_btn" class="negotiate-btn negotiate-insult-btn" style="display:none;">\n                        <i class="fa-solid fa-face-angry"></i> Insult\n                    </button>\n                </div>\n\n                <div id="negotiate_result_panel" class="negotiate-result-panel" style="display:none;">\n                    <div id="negotiate_result_text" class="negotiate-result-text"></div>\n                    <button id="negotiate_close_btn" class="negotiate-btn negotiate-close-btn">\n                        <i class="fa-solid fa-check"></i> Continue\n                    </button>\n                </div>\n\n                <div id="negotiate_combat_log" class="negotiate-combat-log"></div>\n            </div>\n        </div>\n    ');const s=document.getElementById("mazemaster_negotiation_modal");console.log("[MazeMaster] Negotiation modal element after insert:",s);const l=Ut.profile;console.log("[MazeMaster] Updating negotiation UI with profile:",null==l?void 0:l.name);const c=document.getElementById("negotiate_main_title"),m=document.getElementById("negotiate_description");console.log("[MazeMaster] Negotiation UI elements - title:",c,"desc:",m),c&&(c.textContent=l.mainTitle||"Negotiation");m&&(m.textContent=l.description||"");document.getElementById("negotiate_npc_name").textContent=l.npcName||"NPC",document.getElementById("negotiate_favor_max").textContent=Ut.favorThreshold,document.getElementById("negotiate_turns").textContent="".concat(Ut.turnsUsed,"/").concat(l.turnsAllowed),l.flattery||(document.getElementById("negotiate_flatter_btn").style.display="none");l.insult&&(document.getElementById("negotiate_insult_btn").style.display="flex");console.log("[MazeMaster] Attaching negotiation event handlers"),null===(e=document.getElementById("negotiate_persuade_btn"))||void 0===e||e.addEventListener("click",(()=>zo("persuade"))),null===(t=document.getElementById("negotiate_intimidate_btn"))||void 0===t||t.addEventListener("click",(()=>zo("intimidate"))),null===(a=document.getElementById("negotiate_flatter_btn"))||void 0===a||a.addEventListener("click",(()=>zo("flatter"))),null===(n=document.getElementById("negotiate_bribe_btn"))||void 0===n||n.addEventListener("click",(()=>zo("bribe"))),null===(o=document.getElementById("negotiate_insult_btn"))||void 0===o||o.addEventListener("click",(()=>zo("insult"))),null===(i=document.getElementById("negotiate_close_btn"))||void 0===i||i.addEventListener("click",ko),console.log("[MazeMaster] Calling updateNegotiationDisplay"),vo(),console.log("[MazeMaster] showNegotiationModal complete")}(),t.onStart&&W(t.onStart),console.log("[MazeMaster] Negotiation started: ".concat(e)),{success:!0}):(console.error('[MazeMaster] Negotiation profile "'.concat(e,'" not found')),{error:'Profile "'.concat(e,'" not found')})}function vo(){const e=document.getElementById("negotiate_favor_bar"),t=document.getElementById("negotiate_favor_value"),a=Ut.favor/100*100;e&&(e.style.width="".concat(Math.min(a,100),"%")),t&&(t.textContent=Math.round(Ut.favor));const n=document.getElementById("negotiate_disposition");n&&(n.classList.remove("hostile","unfriendly","neutral","friendly","enthusiastic"),Ut.favor>=80?(n.textContent="Enthusiastic",n.classList.add("enthusiastic")):Ut.favor>=60?(n.textContent="Friendly",n.classList.add("friendly")):Ut.favor>=40?(n.textContent="Neutral",n.classList.add("neutral")):Ut.favor>=20?(n.textContent="Unfriendly",n.classList.add("unfriendly")):(n.textContent="Hostile",n.classList.add("hostile")));const o=document.getElementById("negotiate_turns");o&&(o.textContent="".concat(Ut.turnsUsed,"/").concat(Ut.profile.turnsAllowed));const i=document.getElementById("negotiate_combat_log");i&&(i.innerHTML=Ut.combatLog.map((e=>{let t="negotiate-log-entry";return(e.includes("success")||e.includes("agrees")||e.includes("impressed"))&&(t+=" negotiate-log-success"),(e.includes("fail")||e.includes("refuses")||e.includes("angry"))&&(t+=" negotiate-log-fail"),(e.includes("suspicious")||e.includes("wary"))&&(t+=" negotiate-log-warning"),e.includes("You ")&&(t+=" negotiate-log-action"),'<div class="'.concat(t,'">').concat(e,"</div>")})).join(""),i.scrollTop=i.scrollHeight)}function bo(e){Ut.combatLog.push(e),Ut.combatLog.length>30&&Ut.combatLog.shift(),vo()}async function zo(e){var t;if(Ut.isComplete)return;const a=Ut.profile;Ut.turnsUsed++,Ut.turnsRemaining--,Ut.lastAction=e;let n=0,o=!1;const i=100*Math.random();switch(e){case"persuade":o=i<a.persuadeBonus+.3*Ut.favor,o?(n=10+Math.floor(10*Math.random()),bo("You make a compelling argument. (+".concat(n," favor)"))):(n=-5,bo("Your words fall flat. (".concat(n," favor)"))),a.onPersuade&&await W(a.onPersuade);break;case"intimidate":o=i<a.intimidateBonus+.2*(100-Ut.favor),o?(n=15+Math.floor(10*Math.random()),bo("They seem... persuaded by your forcefulness. (+".concat(n," favor)"))):(n=-15,bo("They don't take kindly to threats. (".concat(n," favor)"))),a.onIntimidate&&await W(a.onIntimidate);break;case"flatter":o=i<a.flatterBonus+.4*Ut.favor,o?(n=8+Math.floor(8*Math.random()),bo("They're flattered by your words. (+".concat(n," favor)"))):(n=-3,bo("They see through your flattery. (".concat(n," favor)"))),a.onFlatter&&await W(a.onFlatter);break;case"bribe":const e=a.bribeCost||"key";if(!(!jt.isOpen||((null===(t=jt.inventory)||void 0===t?void 0:t[e])||0)>0))return bo("You don't have anything to offer..."),Ut.turnsUsed--,Ut.turnsRemaining++,void vo();jt.isOpen&&jt.inventory&&jt.inventory[e]--,o=i<a.bribeBonus,o?(n=20+Math.floor(15*Math.random()),bo("The bribe is accepted with a knowing smile. (+".concat(n," favor)"))):(n=-10,bo("They pocket the bribe but remain unmoved. (".concat(n," favor)"))),a.onBribe&&await W(a.onBribe);break;case"insult":o=i<25,o?(n=25+Math.floor(15*Math.random()),bo("Surprisingly, your insult earns their respect! (+".concat(n," favor)"))):(n=-(a.insultPenalty||20),bo("They're deeply offended! (".concat(n," favor)"))),a.onInsult&&await W(a.onInsult)}if(Ut.favor=Math.max(0,Math.min(100,Ut.favor+n)),Ut.lastResult=o?"success":"fail",vo(),!(Ut.favor>=Ut.favorThreshold))return Ut.turnsRemaining<=0?(bo("You've run out of time..."),void _o()):Ut.favor<=0?(bo("They refuse to speak with you any further!"),void _o()):void 0;!async function(){Ut.isComplete=!0,Ut.isSuccess=!0,bo("Negotiation successful!");const e=Ut.profile;e.onComplete&&await W(e.onComplete);jt.isOpen&&jt.pendingEncounter&&(at("key")&&100*Math.random()<(e.keyDropChance||20)&&(Ni("key"),bo("You received a Key!")),at("stealth")&&100*Math.random()<(e.stealthDropChance||15)&&(Ni("stealth"),bo("You received a Stealth item!")),at("healingPotion")&&100*Math.random()<(e.healingPotionDropChance||15)&&(Ni("healingPotion"),bo("You received a Healing Potion!")));Kt.negotiation=Kt.negotiation||{},Kt.negotiation[Ut.profileName]={result:"success",finalFavor:Ut.favor,turnsUsed:Ut.turnsUsed,timestamp:Date.now()},xo()}()}async function _o(){Ut.isComplete=!0,Ut.isFailed=!0,bo("Negotiation failed!");const e=Ut.profile;e.onFail&&await W(e.onFail);let t=!1;if(jt.isOpen&&jt.hpEnabled&&jt.hp){var a,n;const o=e.damage||25,i=null!==(a=null===(n=jt.profile)||void 0===n?void 0:n.battlebarDamageMultiplier)&&void 0!==a?a:1,r=Math.round(o*i);t=!await K(r,"negotiation")}Kt.negotiation=Kt.negotiation||{},Kt.negotiation[Ut.profileName]={result:"fail",finalFavor:Ut.favor,turnsUsed:Ut.turnsUsed,timestamp:Date.now()},t?ko():xo()}function xo(){const e=document.getElementById("negotiate_actions"),t=document.getElementById("negotiate_result_panel"),a=document.getElementById("negotiate_result_text");e&&(e.style.display="none"),t&&(t.style.display="block"),a&&(Ut.isSuccess?(a.textContent=Ut.profile.successMessage||"Negotiation Successful!",a.className="negotiate-result-text success"):(a.textContent=Ut.profile.failMessage||"Negotiation Failed!",a.className="negotiate-result-text fail"))}async function ko(){const e=document.getElementById("mazemaster_negotiation_modal");e&&e.remove();const t=Ut.isSuccess;if(Ut.isOpen=!1,jt.isOpen){try{if(jt.pendingEncounter){const e=jt.pendingEncounter.type;if(t){var a;if(await li(jt.playerX,jt.playerY),jt.hp&&!1!==(null===(a=jt.profile)||void 0===a?void 0:a.hpEnabled)){const e=jt.profile.skillEncounterHealPercent||25,t=jt.hp.max+(jt.hp.maxBonus||0),a=Math.floor(t*(e/100));jt.hp.current<t&&a>0&&(await V(a,!1,"Negotiation success"),addMazeLogMessage("Smooth talker! Recovered ".concat(a," HP."),"heal"))}if("exit_negotiation"===e)return jt.exitEncounterDone=!0,jt.isPaused=!1,void Rr()}}}catch(e){console.error("[MazeMaster] Error in closeNegotiationModal:",e)}jt.isPaused=!1,jt.pendingEncounter=null}}let Co={isOpen:!1,minionId:null,minion:null,offeredItems:[],selectedItem:null};function wo(e,a){const n=function(e){var t;return(null===(t=qt.merchantItemPools)||void 0===t?void 0:t[e])||Dt[e]||Dt["Common Goods"]}(e);if(!n||!n.items||0===n.items.length)return[{id:"key",name:"Key",description:"Opens locked doors",icon:""}];const o=n.items,i=o.reduce(((e,t)=>e+(t.weight||10)),0),r=[],s=new Set;for(;r.length<a&&r.length<o.length;){let e=Math.random()*i;for(const a of o)if(!s.has(a.id)&&(e-=a.weight||10,e<=0)){r.push(t({},a)),s.add(a.id);break}if(r.length<a&&!s.has(o[r.length%o.length].id)){const e=o.find((e=>!s.has(e.id)));e&&(r.push(t({},e)),s.add(e.id))}}return r}function Eo(){if(!Co.selectedItem)return;const e=Co.selectedItem;Ni(e.id),jt.currentMinion&&(jt.currentMinion.message="Enjoy your ".concat(e.name,"! A pleasure doing business!"),Ii()),To(!0)}function So(){jt.currentMinion&&(jt.currentMinion.message="Perhaps another time, then...",Ii()),To(!1)}function To(e){const t=document.getElementById("mazemaster_merchant_modal");t&&t.remove(),Co.isOpen=!1,jt.pendingConfirmation&&(jt.pendingConfirmation=null);const a=document.getElementById("maze_encounter_confirm");var n;a?(a.innerHTML='<button id="maze_confirm_ok" class="menu_button maze-confirm-btn">OK</button>',a.style.display="flex",null===(n=document.getElementById("maze_confirm_ok"))||void 0===n||n.addEventListener("click",(()=>{Ir(),qi()}))):qi()}function Io(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=na(e);if(!a)return{error:'Battlebar profile "'.concat(e,'" not found')};const n=null===(o=jt)||void 0===o||!o.inventory.timeShard||jt.inventory.timeShard<=0?1:.5;var o;const i=n<1;return Nt={isOpen:!0,profile:a,hits:0,misses:0,arrowPosition:0,arrowDirection:1,zoneStart:0,zoneEnd:0,animationId:null,lastFrameTime:0,isVictory:!1,isDefeat:!1,speedMultiplier:n,enemyNameOverride:t},No(),function(){const e=document.getElementById("mazemaster_battlebar_modal");e&&e.remove();if(!document.getElementById("mazemaster_battlebar_styles")){const e=document.createElement("style");e.id="mazemaster_battlebar_styles",e.textContent="\n        .mazemaster-bb-overlay {\n            position: fixed;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            background: rgba(0, 0, 0, 0.9);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            z-index: 10010;\n        }\n\n        .mazemaster-bb-container {\n            display: flex;\n            flex-direction: column;\n            align-items: center;\n            gap: 15px;\n            padding: 25px;\n            background: #1a1a2e;\n            border-radius: 15px;\n            border: 2px solid #333;\n            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);\n            width: 450px;\n            max-width: 95vw;\n            overflow-y: auto;\n        }\n\n        .mazemaster-bb-main-title {\n            font-size: 32px;\n            font-weight: bold;\n            color: #fff;\n            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);\n            text-align: center;\n        }\n\n        .mazemaster-bb-stage-title {\n            font-size: 18px;\n            color: #aaa;\n            text-align: center;\n            min-height: 24px;\n            max-width: 100%;\n            word-wrap: break-word;\n            overflow-wrap: break-word;\n        }\n\n        .mazemaster-bb-image-display {\n            width: min(300px, 80vw);\n            height: min(300px, 40vh);\n            border: 3px solid #444;\n            border-radius: 10px;\n            overflow: hidden;\n            background: #222;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n\n        .mazemaster-bb-image-display img {\n            max-width: 100%;\n            max-height: 100%;\n            object-fit: contain;\n        }\n\n        .mazemaster-bb-stats {\n            display: flex;\n            gap: 30px;\n            font-size: 1.2em;\n            font-weight: bold;\n        }\n\n        .bb-stat-hits {\n            color: #27ae60;\n        }\n\n        .bb-stat-misses {\n            color: #e74c3c;\n        }\n\n        .mazemaster-bb-bar-container {\n            padding: 10px;\n        }\n\n        .mazemaster-bb-bar {\n            position: relative;\n            width: min(400px, 90vw);\n            height: 50px;\n            background: linear-gradient(to bottom, #c0392b, #a93226);\n            border-radius: 8px;\n            overflow: hidden;\n            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5), inset 0 2px 5px rgba(0, 0, 0, 0.3);\n        }\n\n        .mazemaster-bb-zone {\n            position: absolute;\n            height: 100%;\n            background: linear-gradient(to bottom, #27ae60, #1e8449);\n            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2);\n        }\n\n        .mazemaster-bb-arrow {\n            position: absolute;\n            width: 6px;\n            height: 100%;\n            background: #fff;\n            box-shadow: 0 0 15px #fff, 0 0 30px rgba(255, 255, 255, 0.5);\n            left: 0;\n            transition: none;\n        }\n\n        .mazemaster-bb-instructions {\n            font-size: 1.1em;\n            color: #aaa;\n        }\n\n        .mazemaster-bb-instructions kbd {\n            background: #444;\n            padding: 5px 15px;\n            border-radius: 5px;\n            font-weight: bold;\n            color: #fff;\n            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);\n        }\n\n        .mazemaster-bb-bar.flash-hit {\n            animation: flashHit 0.3s ease;\n        }\n\n        .mazemaster-bb-bar.flash-miss {\n            animation: flashMiss 0.3s ease;\n        }\n\n        @keyframes flashHit {\n            0%, 100% { box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); }\n            50% { box-shadow: 0 0 30px rgba(39, 174, 96, 0.8), 0 0 60px rgba(39, 174, 96, 0.5); }\n        }\n\n        @keyframes flashMiss {\n            0%, 100% { box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); }\n            50% { box-shadow: 0 0 30px rgba(231, 76, 60, 0.8), 0 0 60px rgba(231, 76, 60, 0.5); }\n        }\n\n        .mazemaster-bb-hit-btn {\n            width: min(100%, 90vw);\n            max-width: 400px;\n            padding: 20px 30px;\n            font-size: 24px;\n            font-weight: bold;\n            background: linear-gradient(135deg, #27ae60, #2ecc71);\n            color: white;\n            border: none;\n            border-radius: 12px;\n            cursor: pointer;\n            margin-top: 10px;\n            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);\n            transition: transform 0.1s ease, box-shadow 0.1s ease;\n            touch-action: manipulation;\n            -webkit-tap-highlight-color: transparent;\n        }\n\n        .mazemaster-bb-hit-btn:hover {\n            transform: scale(1.02);\n            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.5);\n        }\n\n        .mazemaster-bb-hit-btn:active {\n            transform: scale(0.98);\n            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);\n        }\n\n        .mazemaster-bb-hit-btn i {\n            margin-right: 10px;\n        }\n\n        .mazemaster-bb-hit-btn.victory {\n            background: linear-gradient(135deg, #f39c12, #e67e22);\n            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.4);\n        }\n\n        .mazemaster-bb-hit-btn.victory:hover {\n            box-shadow: 0 8px 25px rgba(243, 156, 18, 0.5);\n        }\n\n        .mazemaster-bb-hit-btn.defeat {\n            background: linear-gradient(135deg, #c0392b, #e74c3c);\n            box-shadow: 0 6px 20px rgba(192, 57, 43, 0.4);\n        }\n\n        .mazemaster-bb-hit-btn.defeat:hover {\n            box-shadow: 0 8px 25px rgba(192, 57, 43, 0.5);\n        }\n    ",document.head.appendChild(e)}const t=document.createElement("div");t.innerHTML='\n        <div id="mazemaster_battlebar_modal" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:999999;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.9);">\n            <div class="mazemaster-bb-container">\n                <div id="bb_main_title" class="mazemaster-bb-main-title"></div>\n                <div class="mazemaster-bb-image-display">\n                    <img id="mazemaster_bb_img" src="" alt="">\n                </div>\n                <div id="bb_stage_title" class="mazemaster-bb-stage-title"></div>\n                <div class="mazemaster-bb-stats">\n                    <span class="bb-stat bb-stat-hits">\n                        Hits: <span id="bb_current_hits">0</span>/<span id="bb_needed_hits">5</span>\n                    </span>\n                    <span class="bb-stat bb-stat-misses">\n                        Misses: <span id="bb_current_misses">0</span>/<span id="bb_max_misses">3</span>\n                    </span>\n                </div>\n                <div class="mazemaster-bb-bar-container">\n                    <div class="mazemaster-bb-bar">\n                        <div class="mazemaster-bb-zone" id="bb_zone"></div>\n                        <div class="mazemaster-bb-arrow" id="bb_arrow"></div>\n                    </div>\n                </div>\n                <div class="mazemaster-bb-instructions">\n                    Press <kbd>SPACE</kbd> when the arrow is in the green zone!\n                </div>\n                <div class="mazemaster-bb-action-buttons">\n                    <button id="mazemaster_bb_hit_btn" class="mazemaster-bb-hit-btn">\n                        <i class="fa-solid fa-bullseye"></i> HIT!\n                    </button>\n                    <button id="mazemaster_bb_strike_btn" class="mazemaster-bb-strike-btn" style="display: none;">\n                        <i class="fa-solid fa-bolt"></i> STRIKE! (<span id="bb_strike_count">0</span>)\n                    </button>\n                    <button id="mazemaster_bb_execute_btn" class="mazemaster-bb-execute-btn" style="display: none;">\n                        <i class="fa-solid fa-star"></i> GRANDSTRIKE! (<span id="bb_execute_count">0</span>)\n                    </button>\n                </div>\n            </div>\n        </div>\n    ',document.body.appendChild(t.firstElementChild),Oo(),Ho(),Fo(),Mo();const a=document.getElementById("mazemaster_bb_hit_btn");a&&(a.addEventListener("click",Po),a.addEventListener("touchend",(e=>{e.preventDefault(),Po(e)})));const n=document.getElementById("mazemaster_bb_strike_btn");n&&n.addEventListener("click",Ao);const o=document.getElementById("mazemaster_bb_execute_btn");o&&o.addEventListener("click",qo);Do(),Lo()}(),function(){var e,t;const a=Nt.effectiveDifficulty||_(Nt.profile.difficulty||5,jt.isOpen&&null!==(e=null===(t=jt.profile)||void 0===t?void 0:t.battlebarDifficultyMultiplier)&&void 0!==e?e:1),n=100/a.traverseTime*(Nt.speedMultiplier||1);function o(e){if(!Nt.isOpen)return;0===Nt.lastFrameTime&&(Nt.lastFrameTime=e);const t=e-Nt.lastFrameTime;Nt.lastFrameTime=e,Nt.arrowPosition+=n*t*Nt.arrowDirection,Nt.arrowPosition>=100?(Nt.arrowPosition=100,Nt.arrowDirection=-1):Nt.arrowPosition<=0&&(Nt.arrowPosition=0,Nt.arrowDirection=1),function(){const e=document.getElementById("bb_arrow");e&&(e.style.left="".concat(Nt.arrowPosition,"%"))}(),Nt.animationId=requestAnimationFrame(o)}Nt.lastFrameTime=0,Nt.animationId=requestAnimationFrame(o)}(),document.addEventListener("keydown",Wo),i&&async function(){var e;(null===(e=jt)||void 0===e?void 0:e.inventory.timeShard)>0&&(await Hi("timeShard",1),jt.currentMinion={name:"Time Shard",imagePath:"",message:"Time slows around you... The battlebar moves at half speed!"},Ii())}(),{success:!0}}function Mo(){const e=Nt.profile||{},t=document.getElementById("bb_main_title");t&&(t.textContent=Nt.enemyNameOverride||e.mainTitle||"");const a=document.getElementById("bb_stage_title");if(a){const t=(e.images||[])[Nt.hits||0];a.textContent=(null==t?void 0:t.stageMessage)||""}}function Po(e){if(e.preventDefault(),!Nt.isOpen)return;if(Nt.isVictory||Nt.isDefeat)return void Ro();const t=Nt.arrowPosition>=Nt.zoneStart&&Nt.arrowPosition<=Nt.zoneEnd;console.log("[MazeMaster] Hit check:",{arrowPosition:Nt.arrowPosition,zoneStart:Nt.zoneStart,zoneEnd:Nt.zoneEnd,inZone:t}),t?Yo():Uo()}function Do(){const e=document.getElementById("mazemaster_bb_strike_btn"),t=document.getElementById("bb_strike_count");e&&jt.isOpen&&jt.inventory.strike>0?(e.style.display="",t&&(t.textContent=jt.inventory.strike)):e&&(e.style.display="none")}function Ao(e){e.preventDefault(),!jt.isOpen||jt.inventory.strike<=0||Nt.isOpen&&(Nt.isVictory||Nt.isDefeat||(Hi("strike"),Do(),Nt.hits++,updateBattlebarDisplay(),Nt.hits>=Nt.profile.hitsToWin&&Go()))}function Bo(){return jt.pendingEncounter&&"exit_battlebar"===jt.pendingEncounter.type}function Lo(){const e=document.getElementById("mazemaster_bb_execute_btn"),t=document.getElementById("bb_execute_count");e&&jt.isOpen&&jt.inventory.execute>0&&!Bo()?(e.style.display="",t&&(t.textContent=jt.inventory.execute)):e&&(e.style.display="none")}function qo(e){e.preventDefault(),!jt.isOpen||jt.inventory.execute<=0||Nt.isOpen&&(Nt.isVictory||Nt.isDefeat||(Bo()?console.log("[MazeMaster] EXECUTE cannot be used against the main minion!"):(Hi("execute"),Lo(),Nt.hits=Nt.profile.hitsToWin,updateBattlebarDisplay(),Go())))}async function Ro(){const e=Nt.isVictory,t=Nt.isDefeat;Nt.animationId&&cancelAnimationFrame(Nt.animationId),document.removeEventListener("keydown",Wo);const a=document.getElementById("mazemaster_battlebar_modal");if(a&&a.remove(),Nt.isOpen=!1,Nt.isVictory=!1,Nt.isDefeat=!1,jt.isOpen){try{if(jt.pendingEncounter){const a=jt.pendingEncounter.type;if(e)return await li(jt.playerX,jt.playerY),"exit_battlebar"===a?(jt.exitEncounterDone=!0,jt.isPaused=!1,void Rr()):void qi();if(t){const e=jt.profile.onBattlebarLoss||"continue";if("exit_battlebar"===a)return"gameover"===e?void Lr():void qr();switch(e){case"gameover":return void Lr();case"respawn":return void qr();default:return void qi()}}}}catch(e){console.error("[MazeMaster] Error in closeBattlebarModal:",e)}jt.isPaused=!1,jt.pendingEncounter=null}}function No(){var e,t;let a=Nt.profile.difficulty||5;a<=5&&x[a]&&(a=x[a]);const n=jt.isOpen&&null!==(e=null===(t=jt.profile)||void 0===t?void 0:t.battlebarDifficultyMultiplier)&&void 0!==e?e:1,o=_(a,n),i=100*o.zoneWidth,r=100-i;Nt.zoneStart=Math.random()*r,Nt.zoneEnd=Nt.zoneStart+i,Nt.effectiveDifficulty=o,console.log("[MazeMaster] Zone randomized:",{baseDifficulty:a,mazeMultiplier:n,zoneWidth:i.toFixed(1)+"%",traverseTime:o.traverseTime+"ms",zoneStart:Nt.zoneStart.toFixed(1),zoneEnd:Nt.zoneEnd.toFixed(1)})}function Ho(){const e=document.getElementById("bb_zone");e&&(e.style.left="".concat(Nt.zoneStart,"%"),e.style.width="".concat(Nt.zoneEnd-Nt.zoneStart,"%"))}function Oo(){const e=document.getElementById("bb_current_hits"),t=document.getElementById("bb_needed_hits"),a=document.getElementById("bb_current_misses"),n=document.getElementById("bb_max_misses");e&&(e.textContent=Nt.hits),t&&(t.textContent=Nt.profile.hitsToWin||5),a&&(a.textContent=Nt.misses),n&&(n.textContent=Nt.profile.missesToLose||3)}function Fo(){const e=document.getElementById("mazemaster_bb_img");if(!e)return;const t=Nt.profile.images||[];if(0===t.length)return void(e.style.display="none");const a=t[Math.min(Nt.hits,t.length-1)],n=a.imagePath||a.path||"";n?(e.src=It(n),e.style.display="block"):e.style.display="none"}function Wo(e){if("Space"!==e.code||!Nt.isOpen)return;if(e.preventDefault(),Nt.isVictory||Nt.isDefeat)return void Ro();Nt.arrowPosition>=Nt.zoneStart&&Nt.arrowPosition<=Nt.zoneEnd?Yo():Uo()}async function Yo(){Nt.hits++;const e=document.querySelector(".mazemaster-bb-bar");e&&(e.classList.remove("flash-hit","flash-miss"),e.offsetWidth,e.classList.add("flash-hit")),Oo(),Fo(),Mo(),Nt.profile.hitCommand&&await W(Nt.profile.hitCommand),Nt.hits>=(Nt.profile.hitsToWin||5)?await Go():(No(),Ho())}async function Uo(){Nt.misses++;const e=document.querySelector(".mazemaster-bb-bar");e&&(e.classList.remove("flash-hit","flash-miss"),e.offsetWidth,e.classList.add("flash-miss")),Oo(),Nt.profile.missCommand&&await W(Nt.profile.missCommand),Nt.misses>=(Nt.profile.missesToLose||3)&&await async function(){var e;const t=qt.currentBattlebarProfile||"Tutorial - Learn Combat";if(Kt.battlebar[t]={result:"lose",hits:Nt.hits,misses:Nt.misses,timestamp:Date.now()},null!==(e=jt)&&void 0!==e&&e.isOpen){var a;Ei("Battlebar defeat: ".concat((null===(a=Nt.profile)||void 0===a?void 0:a.mainTitle)||t),"Combat"),jt.fairness&&(jt.fairness.combatLossStreak++,console.log("[MazeMaster] Fairness: Combat loss streak: ".concat(jt.fairness.combatLossStreak)))}Nt.isDefeat=!0,Nt.animationId&&(cancelAnimationFrame(Nt.animationId),Nt.animationId=null);const n=document.querySelector(".mazemaster-bb-bar-container"),o=document.querySelector(".mazemaster-bb-instructions");n&&(n.style.display="none");o&&(o.style.display="none");if(jt.isOpen&&jt.hpEnabled&&jt.hp){var i,r;const e=jt.profile,t=(null===(i=Nt.profile)||void 0===i?void 0:i.damage)||25,a=null!==(r=e.battlebarDamageMultiplier)&&void 0!==r?r:1,n=Math.round(t*a);if(await K(n,"battlebar")){const e=document.getElementById("bb_stage_title");e&&(e.textContent="Wounded!");const t=document.getElementById("mazemaster_bb_hit_btn");return t&&(t.innerHTML='<i class="fa-solid fa-arrow-right"></i> Continue',t.classList.add("wounded")),void(Nt.profile.loseCommand&&await W(Nt.profile.loseCommand))}return Nt.profile.loseCommand&&await W(Nt.profile.loseCommand),Nt.isDefeat=!0,void Ro()}const s=document.getElementById("bb_stage_title");s&&(s.textContent="Defeat...");const l=document.getElementById("mazemaster_bb_hit_btn");l&&(l.innerHTML='<i class="fa-solid fa-times"></i> Close',l.classList.add("defeat"));Nt.profile.loseCommand&&await W(Nt.profile.loseCommand)}()}async function Go(){var e;const t=qt.currentBattlebarProfile||"Tutorial - Learn Combat";var a;(Kt.battlebar[t]={result:"win",hits:Nt.hits,misses:Nt.misses,timestamp:Date.now()},null!==(e=jt)&&void 0!==e&&e.isOpen)&&(Ei("Battlebar victory: ".concat((null===(a=Nt.profile)||void 0===a?void 0:a.mainTitle)||t),"Combat"),jt.fairness&&(jt.fairness.combatLossStreak=0));if(Nt.isVictory=!0,jt.isOpen&&jt.pendingEncounter){var n,o,i,r,s,l,c,m,d,u;const e=Nt.profile;var p,h,g,f,y;if(at("key")&&100*Math.random()<(null!==(n=e.keyDropChance)&&void 0!==n?n:40)&&Ni("key"),at("strike")&&100*Math.random()<(null!==(o=e.strikeDropChance)&&void 0!==o?o:20)&&Ni("strike"),at("stealth")&&100*Math.random()<(null!==(i=e.stealthDropChance)&&void 0!==i?i:10)&&Ni("stealth"),at("execute")&&100*Math.random()<(null!==(r=e.executeDropChance)&&void 0!==r?r:2)&&Ni("execute"),at("floorKey")&&100*Math.random()<(null!==(s=e.floorKeyDropChance)&&void 0!==s?s:5)&&Ni("floorKey"),at("portalStone")&&100*Math.random()<(null!==(l=e.portalStoneDropChance)&&void 0!==l?l:3)&&Ni("portalStone"),at("minionBane")&&100*Math.random()<(null!==(c=e.minionBaneDropChance)&&void 0!==c?c:4)&&Ni("minionBane"),at("mapFragment")&&100*Math.random()<(null!==(m=e.mapFragmentDropChance)&&void 0!==m?m:8)&&Ni("mapFragment"),at("timeShard")&&100*Math.random()<(null!==(d=e.timeShardDropChance)&&void 0!==d?d:2)&&Ni("timeShard"),at("voidWalk")&&100*Math.random()<(null!==(u=e.voidWalkDropChance)&&void 0!==u?u:1)&&Ni("voidWalk"),jt.hpEnabled)at("healingPotion")&&100*Math.random()<(null!==(p=e.healingPotionDropChance)&&void 0!==p?p:15)&&Ni("healingPotion"),at("greaterHealing")&&100*Math.random()<(null!==(h=e.greaterHealingDropChance)&&void 0!==h?h:5)&&Ni("greaterHealing"),at("elixir")&&100*Math.random()<(null!==(g=e.elixirDropChance)&&void 0!==g?g:1)&&Ni("elixir"),at("revivalCharm")&&100*Math.random()<(null!==(f=e.revivalCharmDropChance)&&void 0!==f?f:.5)&&Ni("revivalCharm"),at("heartCrystal")&&100*Math.random()<(null!==(y=e.heartCrystalDropChance)&&void 0!==y?y:.3)&&Ni("heartCrystal")}Nt.animationId&&(cancelAnimationFrame(Nt.animationId),Nt.animationId=null);const v=document.querySelector(".mazemaster-bb-bar-container"),b=document.querySelector(".mazemaster-bb-instructions");v&&(v.style.display="none"),b&&(b.style.display="none");const z=Nt.profile.images||[],_=z.length>0?z[z.length-1]:null;if(_){const e=document.getElementById("mazemaster_bb_img");e&&(e.src="/"+_.path)}const x=document.getElementById("bb_stage_title");if(x){const e=(null==_?void 0:_.stageMessage)||"Victory!";x.textContent=e}const k=document.getElementById("mazemaster_bb_hit_btn");k&&(k.innerHTML='<i class="fa-solid fa-check"></i> Close',k.classList.add("victory")),Nt.profile.winCommand&&await W(Nt.profile.winCommand)}const jo={fantasy:{small:["alcove","guardPost","shrine","cell","storeroom"],medium:["treasureVault","library","armory","chapel","barracks"],large:["throneRoom","arena","crypt","greatHall","dungeon"],special:["bossLair","dragonDen","wizardTower"]},scifi:{small:["airlock","terminal","cryoPod","storageUnit","junction"],medium:["lab","serverRoom","medbay","armory","quarters"],large:["hangar","reactor","bridge","hydroponics","cargo"],special:["aiCore","alienNest","escapePod"]},horror:{small:["closet","cell","ritualNook","crawlspace","alcove"],medium:["morgue","cultRoom","tortureChamber","nursery","study"],large:["cathedral","asylumWard","abattoir","ritualHall","crypt"],special:["finalGate","elderShrine","heartOfDarkness"]},western:{small:["storeroom","jailCell","stall","privy","closet"],medium:["saloon","sheriffOffice","bankVault","generalStore","hotel"],large:["townSquare","ranchHouse","goldMine","trainStation","church"],special:["showdownStreet","outlawHideout","ghostTownCenter"]},action:{small:["checkpoint","ammoCache","commsRoom","bunker","vent"],medium:["warRoom","armory","interrogation","motorPool","barracks"],large:["hangar","trainingGround","commandCenter","missileSilo","prison"],special:["bossArena","extractionZone","doomsdayDevice"]},comedy:{small:["broomCloset","vendingCorner","awkwardBathroom","supplyRoom","cubicle"],medium:["breakRoom","conferenceDisaster","printerGraveyard","itDungeon","mailRoom"],large:["cafeteria","ballPit","karaokeHall","escapeRoomInception","openOffice"],special:["finalBossOffice","plotTwistRoom","creditsRoom"]},cyberpunk:{small:["jackPoint","stash","corpoCloset","vendingAlcove","maintenance"],medium:["netrunnerDen","chopShop","blackMarket","ripperdoc","flophouse"],large:["megacorpFloor","club","dataFortress","gangHQ","bazaar"],special:["aiCore","finalUpload","skyGarden"]}},Ko={treasureVault:{guaranteedChest:!0,chestQuality:"rare",trapDensity:1.5,minionGuard:!0},bankVault:{guaranteedChest:!0,chestQuality:"rare",trapDensity:2,minionGuard:!0},arena:{waveBattle:!0,waveCount:{min:2,max:4},noRetreat:!0,rewardOnClear:"special"},bossArena:{bossEncounter:!0,lockedUntilCleared:!0,specialLoot:!0},bossLair:{bossEncounter:!0,lockedUntilCleared:!0,specialLoot:!0},trainingGround:{waveBattle:!0,waveCount:{min:1,max:2},noRetreat:!1},library:{revealMapOnEnter:!0,revealRadius:3,scholarNPC:!0},serverRoom:{revealMapOnEnter:!0,revealRadius:4},terminal:{revealMapOnEnter:!0,revealRadius:2},shrine:{noEnemies:!0,healPercent:25},chapel:{noEnemies:!0,healPercent:50,savePoint:!0},medbay:{noEnemies:!0,fullHeal:!0,savePoint:!0},ripperdoc:{noEnemies:!0,fullHeal:!0,merchantNPC:!0},crypt:{undeadOnly:!0,trapDensity:1.5},reactor:{hazardDamage:5,noRest:!0},crawlspace:{stealthBonus:!0,noLargeEnemies:!0},default:{}},Vo={dungeon:{minRoomSize:2,maxRoomSize:3,minSplitSize:2,splitVariance:.3,corridorWidth:1,roomPadding:0,extraConnections:.9,branchChance:.65,preferSquareRooms:!1},maze:{minRoomSize:2,maxRoomSize:2,minSplitSize:2,splitVariance:.3,corridorWidth:1,roomPadding:0,extraConnections:1,addDeadEnds:!0,branchChance:.7,preferSquareRooms:!0},city:{minRoomSize:2,maxRoomSize:3,minSplitSize:2,splitVariance:.25,corridorWidth:1,roomPadding:0,gridAlign:!0,extraConnections:.95,branchChance:.6,preferSquareRooms:!1},forest:{minRoomSize:2,maxRoomSize:3,minSplitSize:2,splitVariance:.35,corridorWidth:1,roomPadding:0,windingCorridors:!0,extraConnections:.9,branchChance:.7,preferSquareRooms:!1},spaceship:{minRoomSize:2,maxRoomSize:3,minSplitSize:2,splitVariance:.2,corridorWidth:1,roomPadding:0,extraConnections:.85,modularRooms:!0,branchChance:.6,preferSquareRooms:!0},arena:{minRoomSize:2,maxRoomSize:3,minSplitSize:2,splitVariance:.3,corridorWidth:1,roomPadding:0,extraConnections:.9,branchChance:.65,preferSquareRooms:!0},hospital:{minRoomSize:2,maxRoomSize:3,minSplitSize:2,splitVariance:.2,corridorWidth:1,roomPadding:0,gridAlign:!0,extraConnections:.85,branchChance:.6,preferSquareRooms:!1}},Xo={dungeon:"dungeon",maze:"maze",city:"city",neotokyo:"city",forest:"forest",spaceship:"spaceship",spacestation:"spaceship",arena:"arena",outpost:"dungeon",college:"hospital",apartment:"city",hospital:"hospital",highrise:"city"};function Qo(e,t,a,n,o,i){const r={x:e,y:t,width:a,height:n,left:null,right:null,room:null,splitHorizontal:null},s=i.minSplitSize||2,l=a>=s+1,c=n>=s+1;if(o>=(i.maxDepth||8)||!l&&!c)return r.room=Jo(r,i),r;const m=a/n;let d;d=!l||!!c&&(!(m>1.5)&&(m<.67||Math.random()<.5)),r.splitHorizontal=d;const u=i.splitVariance||.3,p=Math.max(.25,.5-u),h=Math.min(.75,.5+u),g=p+Math.random()*(h-p);if(d){const l=Math.max(s,Math.min(n-s,Math.floor(n*g)));if(l<1||n-l<1)return r.room=Jo(r,i),r;r.left=Qo(e,t,a,l,o+1,i),r.right=Qo(e,t+l,a,n-l,o+1,i)}else{const l=Math.max(s,Math.min(a-s,Math.floor(a*g)));if(l<1||a-l<1)return r.room=Jo(r,i),r;r.left=Qo(e,t,l,n,o+1,i),r.right=Qo(e+l,t,a-l,n,o+1,i)}return r}function Jo(e,t){const a=t.roomPadding||1,n=t.minRoomSize||2,o=t.maxRoomSize||5,i=e.width-2*a,r=e.height-2*a;if(i<n||r<n)return null;let s=Math.min(o,i),l=Math.min(o,r);if(s=Math.max(n,Math.floor(s*(.7+.3*Math.random()))),l=Math.max(n,Math.floor(l*(.7+.3*Math.random()))),t.preferSquareRooms){const e=Math.min(s,l);s=e,l=e}const c=i-s,m=r-l,d=c>0?Math.floor(Math.random()*c):0,u=m>0?Math.floor(Math.random()*m):0,p=e.x+a+d,h=e.y+a+u;return{x:p,y:h,width:s,height:l,centerX:Math.floor(p+s/2),centerY:Math.floor(h+l/2),type:"common",zoneId:null,isCleared:!1,connections:[]}}function Zo(e){return e?e.room?[e.room]:[...Zo(e.left),...Zo(e.right)]:[]}function $o(e,t,a){if(!e)return null;if(e.room)return e.room;const n=$o(e.left,t,a),o=$o(e.right,t,a);if(!n)return o;if(!o)return n;return Math.abs(n.centerX-t)+Math.abs(n.centerY-a)<Math.abs(o.centerX-t)+Math.abs(o.centerY-a)?n:o}function ei(e,t,a,n){if(!e||!e.left||!e.right)return;ei(e.left,t,a,n),ei(e.right,t,a,n);const o=$o(e.left,e.x+e.width/2,e.y+e.height/2),i=$o(e.right,e.x+e.width/2,e.y+e.height/2);o&&i&&(ti(t,a,o.centerX,o.centerY,i.centerX,i.centerY,n),o.connections.push(i),i.connections.push(o))}function ti(e,t,a,n,o,i,r){let s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const l=r.corridorWidth||1,c=Math.abs(o-a)+Math.abs(i-n);if(c>3&&(Math.random()<.75||c>6)&&s<4){if(3===(c>8?3:2)&&c>8){const l=1/3,c=2/3,m=Math.floor((Math.random()-.5)*Math.min(4,t/4)),d=Math.floor((Math.random()-.5)*Math.min(4,t/4)),u=Math.max(1,Math.min(t-2,Math.floor(a+(o-a)*l)+m)),p=Math.max(1,Math.min(t-2,Math.floor(n+(i-n)*l)+d)),h=Math.max(1,Math.min(t-2,Math.floor(a+(o-a)*c)-m)),g=Math.max(1,Math.min(t-2,Math.floor(n+(i-n)*c)-d));return ti(e,t,a,n,u,p,r,s+1),ti(e,t,u,p,h,g,r,s+1),void ti(e,t,h,g,o,i,r,s+1)}{const l=Math.min(3,Math.floor(c/3)),m=Math.max(1,Math.min(t-2,Math.floor((a+o)/2)+Math.floor((Math.random()-.5)*l*2))),d=Math.max(1,Math.min(t-2,Math.floor((n+i)/2)+Math.floor((Math.random()-.5)*l*2)));return ti(e,t,a,n,m,d,r,s+1),void ti(e,t,m,d,o,i,r,s+1)}}Math.random()<.5?(ai(e,t,a,o,n,l),ni(e,t,n,i,o,l)):(ni(e,t,n,i,a,l),ai(e,t,a,o,i,l))}function ai(e,t,a,n,o,i){const r=Math.min(a,n),s=Math.max(a,n);for(let a=r;a<=s;a++)for(let n=0;n<i;n++){const i=o+n;if(a>=0&&a<t&&i>=0&&i<t){const n=e[i][a];n.corridorType="main",a>r&&(n.walls.left=!1),a<s&&(n.walls.right=!1),a>0&&a-1>=r&&(e[i][a-1].walls.right=!1),a<t-1&&a+1<=s&&(e[i][a+1].walls.left=!1)}}}function ni(e,t,a,n,o,i){const r=Math.min(a,n),s=Math.max(a,n);for(let a=r;a<=s;a++)for(let n=0;n<i;n++){const i=o+n;if(i>=0&&i<t&&a>=0&&a<t){const n=e[a][i];n.corridorType="main",a>r&&(n.walls.top=!1),a<s&&(n.walls.bottom=!1),a>0&&a-1>=r&&(e[a-1][i].walls.bottom=!1),a<t-1&&a+1<=s&&(e[a+1][i].walls.top=!1)}}}function oi(e,a,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=Xo[a]||"dungeon",r=t(t({},Vo[i]||Vo.dungeon),o);r.maxDepth=Math.max(4,Math.floor(1.5*Math.log2(e)));const s=[];for(let t=0;t<e;t++){s[t]=[];for(let a=0;a<e;a++)s[t][a]={walls:{top:!0,right:!0,bottom:!0,left:!0},visited:!1,minion:null,trap:null,roomId:null,zoneId:null,isRoomInterior:!1,secretPassage:null,corridorType:null}}const l=Qo(0,0,e,e,0,r),c=Zo(l).filter((e=>null!==e));return c.forEach(((e,t)=>{e.id=t,function(e,t,a){for(let n=t.y;n<t.y+t.height;n++)for(let o=t.x;o<t.x+t.width;o++)if(n>=0&&n<e.length&&o>=0&&o<e[0].length){const i=e[n][o];i.roomId=a,i.isRoomInterior=!0,o>t.x&&(i.walls.left=!1),o<t.x+t.width-1&&(i.walls.right=!1),n>t.y&&(i.walls.top=!1),n<t.y+t.height-1&&(i.walls.bottom=!1),o>t.x&&o>0&&(e[n][o-1].walls.right=!1),o<t.x+t.width-1&&o<e[0].length-1&&(e[n][o+1].walls.left=!1),n>t.y&&n>0&&(e[n-1][o].walls.bottom=!1),n<t.y+t.height-1&&n<e.length-1&&(e[n+1][o].walls.top=!1)}}(s,e,t)})),ei(l,s,e,r),function(e,t){const a=jo[t]||jo.fantasy,n=e.length>5;let o=!1;e.forEach(((t,i)=>{const r=t.width*t.height;let s;if(s=r<=4?"small":r<=9?"medium":"large",n&&!o&&(i===e.length-1||Math.random()<.1))t.type=a.special[Math.floor(Math.random()*a.special.length)],o=!0;else{const e=a[s];t.type=e[Math.floor(Math.random()*e.length)]}t.mechanics=Ko[t.type]||Ko.default}))}(c,n),r.extraConnections>0&&function(e,t,a,n){const o=Math.floor(t.length*n.extraConnections);for(let i=0;i<o;i++){const o=t[Math.floor(Math.random()*t.length)],i=t[Math.floor(Math.random()*t.length)];o===i||o.connections.includes(i)||(ti(e,a,o.centerX,o.centerY,i.centerX,i.centerY,n),o.connections.push(i),i.connections.push(o))}!function(e,t){const a=Math.floor(2.5*t);for(let n=0;n<a;n++){const a=2+Math.floor(Math.random()*(t-4)),n=2+Math.floor(Math.random()*(t-4)),o=e[n][a];if(o.isRoomInterior)continue;let i=0;if(o.walls.top||i++,o.walls.right||i++,o.walls.bottom||i++,o.walls.left||i++,i>=1&&i<=2){const i=[];o.walls.top&&n>0&&i.push("top"),o.walls.right&&a<t-1&&i.push("right"),o.walls.bottom&&n<t-1&&i.push("bottom"),o.walls.left&&a>0&&i.push("left");const r=Math.min(i.length,1+Math.floor(2*Math.random()));for(let t=0;t<r;t++){const t=Math.floor(Math.random()*i.length);switch(i.splice(t,1)[0]){case"top":o.walls.top=!1,e[n-1][a].walls.bottom=!1;break;case"right":o.walls.right=!1,e[n][a+1].walls.left=!1;break;case"bottom":o.walls.bottom=!1,e[n+1][a].walls.top=!1;break;case"left":o.walls.left=!1,e[n][a-1].walls.right=!1}}}}}(e,a)}(s,c,e,r),r.addDeadEnds&&function(e,t,a){const n=Math.floor(.8*t.length);for(let o=0;o<n;o++){const n=t[Math.floor(Math.random()*t.length)],o=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1}],i=o[Math.floor(Math.random()*o.length)],r=2+Math.floor(3*Math.random());let s=n.centerX+i.dx*(Math.floor(n.width/2)+1),l=n.centerY+i.dy*(Math.floor(n.height/2)+1);for(let t=0;t<r;t++)if(s>=0&&s<a&&l>=0&&l<a){const t=e[l][s];t.corridorType="branch",i.dx>0&&s<a-1?(t.walls.right=!1,e[l][s+1].walls.left=!1):i.dx<0&&s>0?(t.walls.left=!1,e[l][s-1].walls.right=!1):i.dy>0&&l<a-1?(t.walls.bottom=!1,e[l+1][s].walls.top=!1):i.dy<0&&l>0&&(t.walls.top=!1,e[l-1][s].walls.bottom=!1),s+=i.dx,l+=i.dy}}}(s,c,e),ui(s,e,0,0,e-1,e-1),function(e,t,a,n){const o=e[0][0],i=[];o.walls.right||i.push("east");o.walls.bottom||i.push("south");if(i.length>=2)return;const r=t.filter((e=>{const t=Math.abs(e.centerX)+Math.abs(e.centerY);return t>0&&t<a/2})).sort(((e,t)=>Math.abs(e.centerX)+Math.abs(e.centerY)-(Math.abs(t.centerX)+Math.abs(t.centerY))));if(!i.includes("east")&&a>1){const t=r.find((e=>e.centerX>0));if(t){let o=0;const i=Math.min(3,t.centerX);for(;o<i&&o<a-1;)e[0][o].walls.right=!1,e[0][o+1].walls.left=!1,o++;ti(e,a,o,0,t.centerX,t.centerY,n)}else e[0][0].walls.right=!1,a>1&&(e[0][1].walls.left=!1)}if(!i.includes("south")&&a>1){const t=r.find((e=>e.centerY>0&&e.centerX<a/3));if(t){let o=0;const i=Math.min(3,t.centerY);for(;o<i&&o<a-1;)e[o][0].walls.bottom=!1,e[o+1][0].walls.top=!1,o++;ti(e,a,0,o,t.centerX,t.centerY,n)}else e[0][0].walls.bottom=!1,a>1&&(e[1][0].walls.top=!1)}}(s,c,e,r),{grid:s,rooms:c}}function ii(e,t,a){if(t<=1||e.length<=1)return e.forEach((e=>{e.zoneId=0})),[{id:0,name:"Main Area",rooms:e.map(((e,t)=>t)),isUnlocked:!0,unlockCondition:null,gatePositions:[]}];const n=[...e].sort(((e,t)=>e.centerX+e.centerY-(t.centerX+t.centerY))),o=Math.ceil(n.length/t),i=[];for(let e=0;e<t;e++){const r=e*o,s=Math.min(r+o,n.length),l=n.slice(r,s);l.forEach((t=>{t.zoneId=e})),i.push({id:e,name:ri(e,t,a),rooms:l.map((e=>e.id)),isUnlocked:0===e,unlockCondition:0===e?null:{type:"clear",targetZoneId:e-1,requiredClears:Math.max(1,Math.floor(.6*l.length))},gatePositions:[]})}return i}function ri(e,t,a){const n={fantasy:["Entrance Hall","The Depths","Ancient Crypt","Dragon's Domain","Throne of Shadows","Final Sanctum"],scifi:["Docking Bay","Crew Quarters","Engineering","Research Labs","Command Deck","Core Systems"],horror:["Foyer","Patient Ward","Basement","Ritual Chamber","The Abyss","Heart of Darkness"],cyberpunk:["Street Level","Lower Floors","Corporate Zone","Executive Suite","Server Core","Penthouse"],western:["Town Entrance","Main Street","Back Alleys","Mine Tunnels","Hideout","Final Showdown"],action:["Insertion Point","Outer Perimeter","Inner Complex","High Security","Command Center","Extraction Zone"],comedy:["Lobby","Open Office","Break Room Hell","Management Floor","IT Dungeon","CEO's Lair"]},o=n[a]||n.fantasy;return o[Math.min(e,o.length-1)]}function si(e,t,a){a.forEach((t=>{for(let a=t.y;a<t.y+t.height;a++)for(let n=t.x;n<t.x+t.width;n++)a>=0&&a<e.length&&n>=0&&n<e[0].length&&(e[a][n].zoneId=t.zoneId)}));for(let t=0;t<e.length;t++)for(let n=0;n<e[0].length;n++){const o=e[t][n];if(o.corridorType&&null===o.zoneId){let e=null,i=1/0;a.forEach((a=>{const o=Math.abs(a.centerX-n)+Math.abs(a.centerY-t);o<i&&(i=o,e=a)})),e&&(o.zoneId=e.zoneId)}}}async function li(e,t){var a;if(!jt||!jt.floorsData)return;const n=jt.floorsData[jt.currentFloor];if(!n||!n.rooms)return;const o=null===(a=jt.grid[t])||void 0===a?void 0:a[e];if(!o||void 0===o.roomId||null===o.roomId)return;const i=n.rooms.find((e=>e.id===o.roomId));i&&!i.isCleared&&(i.isCleared=!0,console.log("[MazeMaster] Room ".concat(i.id," (").concat(i.type,") cleared")),await Y("onRoomClear",{roomId:i.id,roomType:i.type,x:e,y:t}),await async function(){var e;if(!jt||!jt.floorsData)return;const t=jt.floorsData[jt.currentFloor];if(!t||!t.zones||!t.rooms)return;for(const a of t.zones){if(a.isUnlocked)continue;const n=a.unlockCondition;if(!n)continue;let o=!1;switch(n.type){case"clear":const i=null!==(e=n.targetZoneId)&&void 0!==e?e:a.id-1;o=t.rooms.filter((e=>e.zoneId===i)).filter((e=>e.isCleared)).length>=(n.requiredClears||1);break;case"boss":const r=t.rooms.find((e=>{var t;return e.zoneId===(null!==(t=n.targetZoneId)&&void 0!==t?t:a.id-1)&&("bossLair"===e.type||"boss-arena"===e.type)}));o=!0===(null==r?void 0:r.isCleared);break;case"key":o=!1;break;case"start":o=!0}o&&(a.isUnlocked=!0,console.log("[MazeMaster] Zone ".concat(a.id," (").concat(a.name,") unlocked!")),Si("Zone Unlocked","".concat(a.name," is now accessible!")),await Y("onZoneUnlock",{zoneId:a.id,zoneName:a.name}))}}())}function ci(e,t,a){const n=a.secretDensity||.02,o=Math.max(1,Math.floor(t*t*n));let i=0,r=0;const s=10*o;for(;i<o&&r<s;){var l;r++;const n=Math.floor(Math.random()*t),o=Math.floor(Math.random()*t),s=e[o][n];if(s.secretPassage||s.staircase||s.portal)continue;const c=[];if(s.walls.top&&o>0&&c.push("top"),s.walls.right&&n<t-1&&c.push("right"),s.walls.bottom&&o<t-1&&c.push("bottom"),s.walls.left&&n>0&&c.push("left"),0===c.length)continue;const m=c[Math.floor(Math.random()*c.length)];let d=n,u=o;"top"===m&&u--,"bottom"===m&&u++,"left"===m&&d--,"right"===m&&d++;if(!(null===(l=e[u])||void 0===l?void 0:l[d]))continue;if(0===n&&0===o||0===d&&0===u)continue;if(n===t-1&&o===t-1||d===t-1&&u===t-1)continue;const p=a.secretHints?Math.floor(4*Math.random()):0;s.secretPassage={direction:m,revealed:!1,hintLevel:p,targetCell:{x:d,y:u}},i++}console.log("[MazeMaster] Placed ".concat(i," secret passages"))}function mi(e,t){var a;if(!e.secretPassage||e.secretPassage.direction!==t)return{found:!1,attempted:!1};if(e.secretPassage.revealed)return{found:!1,attempted:!1};const n=function(e,t,a,n){const o=e.secretPassage;if(!o||o.direction!==t||o.revealed)return{found:!1};let i=0;switch(a){case"tap":i=.15+.25*o.hintLevel,o.hintLevel>=3&&(i=.95);break;case"item":i=.9+.025*o.hintLevel;break;case"passive":i=o.hintLevel>=3?.7:0}return(null==n?void 0:n.secretSense)>0&&(i+=.2),i=Math.min(i,1),Math.random()<i?{found:!0,revealed:!0}:o.hintLevel>0&&"tap"===a?{found:!1,hint:!0,hintLevel:o.hintLevel}:{found:!1}}(e,t,"tap",null===(a=jt)||void 0===a?void 0:a.inventory);if(n.found)return{found:!0,attempted:!0};let o="The wall feels solid...";if(n.hint)switch(n.hintLevel){case 1:o="You notice something unusual about this wall...";break;case 2:o="There's a faint crack here. Try again?";break;case 3:o="This section of wall seems hollow!"}return{found:!1,attempted:!0,message:o}}function di(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"fantasy",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};console.log("[MazeMaster] Generating BSP grid: size=".concat(e,", style=").concat(t,", theme=").concat(a));const o=oi(e,t,a,n);return console.log("[MazeMaster] Generated ".concat(o.rooms.length," rooms")),o}function ui(e,t,a,n,o,i){const r=new Set(["".concat(a,",").concat(n)]),s=[{x:a,y:n}];for(;s.length>0;){const{x:a,y:n}=s.shift();if(a===o&&n===i)return;!e[n][a].walls.top&&n>0&&!r.has("".concat(a,",").concat(n-1))&&(r.add("".concat(a,",").concat(n-1)),s.push({x:a,y:n-1})),!e[n][a].walls.right&&a<t-1&&!r.has("".concat(a+1,",").concat(n))&&(r.add("".concat(a+1,",").concat(n)),s.push({x:a+1,y:n})),!e[n][a].walls.bottom&&n<t-1&&!r.has("".concat(a,",").concat(n+1))&&(r.add("".concat(a,",").concat(n+1)),s.push({x:a,y:n+1})),!e[n][a].walls.left&&a>0&&!r.has("".concat(a-1,",").concat(n))&&(r.add("".concat(a-1,",").concat(n)),s.push({x:a-1,y:n}))}const l=[],c=2+Math.floor(3*Math.random());for(let e=1;e<=c;e++){const r=e/(c+1),s=a+Math.floor((o-a)*r),m=n+Math.floor((i-n)*r),d=Math.floor((Math.random()-.5)*t*.4),u=Math.floor((Math.random()-.5)*t*.4);l.push({x:Math.max(0,Math.min(t-1,s+d)),y:Math.max(0,Math.min(t-1,m+u))})}let m=a,d=n;const u=[...l,{x:o,y:i}];for(const a of u){if(Math.random()<.5){for(;m!==a.x;){const n=m<a.x?m+1:m-1;if(!(n>=0&&n<t))break;m<a.x?(e[d][m].walls.right=!1,e[d][n].walls.left=!1):(e[d][m].walls.left=!1,e[d][n].walls.right=!1),m=n}for(;d!==a.y;){const n=d<a.y?d+1:d-1;if(!(n>=0&&n<t))break;d<a.y?(e[d][m].walls.bottom=!1,e[n][m].walls.top=!1):(e[d][m].walls.top=!1,e[n][m].walls.bottom=!1),d=n}}else{for(;d!==a.y;){const n=d<a.y?d+1:d-1;if(!(n>=0&&n<t))break;d<a.y?(e[d][m].walls.bottom=!1,e[n][m].walls.top=!1):(e[d][m].walls.top=!1,e[n][m].walls.bottom=!1),d=n}for(;m!==a.x;){const n=m<a.x?m+1:m-1;if(!(n>=0&&n<t))break;m<a.x?(e[d][m].walls.right=!1,e[d][n].walls.left=!1):(e[d][m].walls.left=!1,e[d][n].walls.right=!1),m=n}}}}function pi(e,t,a,n,o,i){if(a===o&&n===i)return!0;const r=new Set(["".concat(a,",").concat(n)]),s=[{x:a,y:n}];for(;s.length>0;){const{x:a,y:n}=s.shift();if(a===o&&n===i)return!0;!e[n][a].walls.top&&n>0&&!r.has("".concat(a,",").concat(n-1))&&(r.add("".concat(a,",").concat(n-1)),s.push({x:a,y:n-1})),!e[n][a].walls.right&&a<t-1&&!r.has("".concat(a+1,",").concat(n))&&(r.add("".concat(a+1,",").concat(n)),s.push({x:a+1,y:n})),!e[n][a].walls.bottom&&n<t-1&&!r.has("".concat(a,",").concat(n+1))&&(r.add("".concat(a,",").concat(n+1)),s.push({x:a,y:n+1})),!e[n][a].walls.left&&a>0&&!r.has("".concat(a-1,",").concat(n))&&(r.add("".concat(a-1,",").concat(n)),s.push({x:a-1,y:n}))}return!1}function hi(e){return!(e.walls.top&&e.walls.right&&e.walls.bottom&&e.walls.left)}function gi(e,t){let a=0;console.log("[MazeMaster] Running wall consistency check...");for(let n=0;n<t;n++)for(let o=0;o<t;o++){const i=e[n][o];if(o<t-1){const t=e[n][o+1];i.walls.right!==t.walls.left&&(console.log("[MazeMaster] Wall mismatch at (".concat(o,",").concat(n,") right: ").concat(i.walls.right," vs (").concat(o+1,",").concat(n,") left: ").concat(t.walls.left)),i.walls.right&&t.walls.left?(i.walls.right=!0,t.walls.left=!0):(i.walls.right=!1,t.walls.left=!1),a++)}if(n<t-1){const t=e[n+1][o];i.walls.bottom!==t.walls.top&&(console.log("[MazeMaster] Wall mismatch at (".concat(o,",").concat(n,") bottom: ").concat(i.walls.bottom," vs (").concat(o,",").concat(n+1,") top: ").concat(t.walls.top)),i.walls.bottom&&t.walls.top?(i.walls.bottom=!0,t.walls.top=!0):(i.walls.bottom=!1,t.walls.top=!1),a++)}}console.log("[MazeMaster] Wall consistency check complete. Fixed ".concat(a," mismatch(es)"))}function fi(e){const t=100*Math.random();return t<(e.chestMimicPercent||0)?"mimic":t<(e.chestMimicPercent||0)+(e.chestLockedPercent||0)?"locked":"normal"}function yi(e,t,a){var n;const o=[];for(let t=0;t<a;t++)for(let n=0;n<a;n++)0===n&&0===t||n===a-1&&t===a-1||hi(e[t][n])&&o.push({x:n,y:t});vi(o);const i=function(e,t){const a={minionPlacements:[],trapPlacements:[],chestCount:0},n=U(e),o=n.encounterDensityMult||1,i=n.trapFrequencyMult||1,r=e.chestTilePercent||0,s=e.minionEncounters||[],l=e.trapEncounters||[],c=r+s.reduce(((e,t)=>e+(t.percent||0)*o),0)+l.reduce(((e,t)=>e+(t.percent||0)*i),0);let m=1;c>100&&(m=100/c,console.log("[MazeMaster] Distribution over 100% (".concat(c,"%), scaling down by ").concat(m.toFixed(2)))),a.chestCount=Math.floor(t*(r*m)/100);for(const e of s){const n=(e.percent||0)*o*m,i=Math.round(t*n/100);i>0&&a.minionPlacements.push({minionId:e.minionId,count:i})}for(const e of l){const n=(e.percent||0)*i*m,o=Math.round(t*n/100);o>0&&a.trapPlacements.push({trapId:e.trapId,count:o})}return a}(t,o.length);let r=0;for(let a=0;a<i.chestCount&&r<o.length;a++){const a=o[r++],n=fi(t);e[a.y][a.x].chest={type:n,opened:!1}}const s=function(e,t,a,n){var o,i;const r=(null===(o=t.bspConfig)||void 0===o?void 0:o.zoneCount)||4,s=null!==(i=t.safeStartRadius)&&void 0!==i?i:2,l=t.minionEncounters||[],c=U(t).encounterDensityMult||1,m={};let d=0;for(let t=0;t<a;t++)for(let n=0;n<a;n++){var u;if(0===n&&0===t||n===a-1&&t===a-1)continue;if(!hi(e[t][n]))continue;if(e[t][n].chest)continue;if(n+t<=s)continue;const o=null!==(u=e[t][n].zoneId)&&void 0!==u?u:0;m[o]||(m[o]=[]),m[o].push({x:n,y:t}),d++}Object.values(m).forEach(vi);let p=0;for(const t of l){let{minionId:a,percent:o,zoneMin:i=0,zoneMax:s=99}=t;if(a===n){const e=r-1;i<e&&(console.log("[MazeMaster] Restricting ".concat(a," to final zone (was zoneMin: ").concat(i,", now: ").concat(e,")")),i=e)}const l=(o||0)*c,u=Math.round(d*l/100);if(u<=0)continue;const h=[];for(let t=Math.max(0,i);t<=Math.min(s,r-1);t++)m[t]&&h.push(...m[t].filter((t=>!e[t.y][t.x].minion)));vi(h);let g=0;for(const t of h){if(g>=u)break;e[t.y][t.x].minion||(e[t.y][t.x].minion={minionId:a,triggered:!1},g++,p++)}g>0&&console.log("[MazeMaster] Placed ".concat(g,"/").concat(u," ").concat(a," in zones ").concat(i,"-").concat(Math.min(s,r-1)))}return p}(e,t,a,t.mainMinion),l=r;for(const t of i.trapPlacements)for(let a=0;a<t.count&&r<o.length;a++){const a=o[r++];e[a.y][a.x].trap={trapId:t.trapId,triggered:!1}}const c=r-l,m=function(e,t,a,n){if(!t.portals||0===t.portals.length)return;const o=[];for(const i of t.portals){let t=i.startX,r=i.startY,s=i.endX,l=i.endY;if(null==t||null==r){const o=n.find((t=>!(e[t.y][t.x].chest||e[t.y][t.x].minion||e[t.y][t.x].trap||e[t.y][t.x].portal||0===t.x&&0===t.y||t.x===a-1&&t.y===a-1)));if(!o)continue;{t=o.x,r=o.y;const e=n.indexOf(o);e>-1&&n.splice(e,1)}}if(null==s||null==l){const o=n.find((n=>!(e[n.y][n.x].chest||e[n.y][n.x].minion||e[n.y][n.x].trap||e[n.y][n.x].portal||n.x===t&&n.y===r||0===n.x&&0===n.y||n.x===a-1&&n.y===a-1)));if(!o)continue;{s=o.x,l=o.y;const e=n.indexOf(o);e>-1&&n.splice(e,1)}}const c=i.id||"portal_".concat(o.length+1),m=i.color||"#9b59b6",d=!1!==i.bidirectional;e[r][t].portal={id:c,target:{x:s,y:l},isStart:!0,color:m,bidirectional:d},e[l][s].portal={id:c,target:{x:t,y:r},isStart:!1,color:m,bidirectional:d},o.push({id:c,startX:t,startY:r,endX:s,endY:l,color:m,bidirectional:d})}return o.length>0&&console.log("[MazeMaster] Placed ".concat(o.length," portal pair(s)")),o}(e,t,a,o.slice(r)),d=null!==(n=t.safeRoomCount)&&void 0!==n?n:3;if(d>0){const t=[];for(let n=0;n<a;n++)for(let o=0;o<a;o++){if(0===o&&0===n||o===a-1&&n===a-1)continue;const i=e[n][o];hi(i)&&(i.chest||i.minion||i.trap||i.portal||i.staircase||t.push({x:o,y:n}))}vi(t);const n=Math.min(d,t.length);for(let a=0;a<n;a++){const n=t[a];e[n.y][n.x].safeRoom={exhausted:!1}}console.log("[MazeMaster] Placed ".concat(n," safe rooms"))}return console.log("[MazeMaster] Placed ".concat(i.chestCount," chests, ").concat(s," minions, ").concat(c," traps")),function(e,t,a){const n=t.findEarly;if(!n||!n.items||0===n.items.length)return;const o=n.radius||4,i=n.items.filter((e=>at(e,t)));if(0===i.length)return;const r=[];for(let t=0;t<a;t++)for(let n=0;n<a;n++){const a=n+t;if(a<=o&&a>0){const o=e[t][n];o.chest&&!o.chest.opened&&r.push({x:n,y:t,dist:a})}}r.sort(((e,t)=>e.dist-t.dist));let s=0;for(const t of r){if(s>=i.length)break;const a=e[t.y][t.x].chest;a.guaranteedItems||(a.guaranteedItems=[]);const o=n.itemsPerChest||1;for(let e=0;e<o&&s<i.length;e++)a.guaranteedItems.push(i[s]),s++}s>0&&console.log("[MazeMaster] Find Early: Assigned ".concat(s," guaranteed items to ").concat(r.length," nearby chests"))}(e,t,a),{placedPortals:m||[]}}function vi(e){for(let t=e.length-1;t>0;t--){const a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}}function bi(e){return e&&0!==e.length?e[Math.floor(Math.random()*e.length)]:null}function zi(e){return new Promise((t=>setTimeout(t,e)))}function _i(e){return R.getRenderer().getCellSize(e)}async function xi(e){var a,n,o,i;const r=G(e);if(!r)return console.error('[MazeMaster] Maze profile "'.concat(e,'" not found')),{error:'Profile "'.concat(e,'" not found')};if(!1!==qt.closeChatOnStart)try{const e=SillyTavern.getContext();e&&"function"==typeof e.clearChat?(e.clearChat(),console.log("[MazeMaster] Closed current chat to prevent context bleed")):"function"==typeof doNewChat&&(doNewChat(),console.log("[MazeMaster] Started new chat to prevent context bleed"))}catch(e){console.warn("[MazeMaster] Could not close chat:",e)}const s=r.gridSize||10,l=r.mapStyle||"maze",c=Math.max(1,Math.min(10,r.floors||1)),m=[];let d,u;const p=r.difficulty||"normal";if(c>1||"hard"===p||"nightmare"===p){const e=[];e.push({x:s-1,y:0}),e.push({x:0,y:s-1}),e.push({x:s-1,y:s-1}),("nightmare"===p||c>=3)&&(e.push({x:Math.floor(s/2),y:s-1}),e.push({x:s-1,y:Math.floor(s/2)}));const t=e[Math.floor(Math.random()*e.length)];d=t.x,u=t.y,console.log("[MazeMaster] Randomized exit position: (".concat(d,", ").concat(u,") for ").concat(p," maze with ").concat(c," floor(s)"))}else d=s-1,u=s-1;const h=[];for(let e=0;e<c;e++){const t=r.bspConfig||{};if(!1!==t.floorComplexityScaling&&c>1){const a=e/Math.max(1,c-1);t.maxDepth=(t.maxDepth||4)+Math.floor(2*a),t.secretDensity=(t.secretDensity||.02)*(1+a)}const a=r.theme||"fantasy",n=di(s,l,a,t),o=n.grid,i=n.rooms,p=ii(i,t.zoneCount||1,a);si(o,0,i),t.secretDensity>0&&ci(o,s,{secretDensity:t.secretDensity,secretHints:!1!==t.secretHints}),gi(o,s),yi(o,r,s),D(o,r,s,d,u),m.push(o),h.push({grid:o,rooms:i,zones:p})}let g=0;if(c>1){!function(e,t,a,n,o){const i=e.length;for(let r=0;r<i-1;r++){const i=e[r],s=e[r+1],l=[];for(let e=0;e<t;e++)for(let a=0;a<t;a++){if(0===a&&0===e||a===n&&e===o)continue;const r=i[e][a],c=s[e][a];r.minion||r.trap||r.chest||c.minion||c.trap||c.chest||hi(r)&&hi(c)&&pi(i,t,0,0,a,e)&&l.push({x:a,y:e})}if(l.length<1){console.warn("[MazeMaster] No valid staircase positions found for floor ".concat(r," -> ").concat(r+1));continue}const c=Math.min(2,Math.max(1,Math.floor(t/5)));for(let e=0;e<c&&l.length>0;e++){const e=Math.floor(Math.random()*l.length),c=l.splice(e,1)[0];i[c.y][c.x].staircase={direction:"up",targetFloor:r+1,targetX:c.x,targetY:c.y,requireKey:a},s[c.y][c.x].staircase={direction:"down",targetFloor:r,targetX:c.x,targetY:c.y,requireKey:!1},ui(s,t,c.x,c.y,n,o),console.log("[MazeMaster] Staircase placed at (".concat(c.x,", ").concat(c.y,") connecting floor ").concat(r," to ").concat(r+1))}}}(m,s,r.requireFloorKey||!1,d,u),r.requireFloorKey&&(g=function(e,t){let a=0;for(let i=0;i<e.length;i++){const r=e[i];let s=!1;for(let e=0;e<t&&!s;e++)for(let a=0;a<t&&!s;a++){var n,o;const t=r[e][a];"up"===(null===(n=t.staircase)||void 0===n?void 0:n.direction)&&null!==(o=t.staircase)&&void 0!==o&&o.requireKey&&(s=!0)}if(!s)continue;const l=[];for(let e=0;e<t;e++)for(let a=0;a<t;a++){const t=r[e][a];t.chest&&!t.chest.guaranteedFloorKey&&l.push({x:a,y:e,cell:t})}if(l.length>0){const e=l[Math.floor(Math.random()*l.length)];e.cell.chest.guaranteedFloorKey=!0,console.log("[MazeMaster] Floor ".concat(i,": Guaranteed floor key in chest at (").concat(e.x,", ").concat(e.y,")"))}else a++,console.log("[MazeMaster] Floor ".concat(i,": No chest found - adding floor key to starting inventory"))}return a}(m,s));const e=m[0];e[u]&&e[u][d]&&(e[u][d].walls={top:!0,right:!0,bottom:!0,left:!0},console.log("[MazeMaster] Blocked exit area on floor 0 at (".concat(d,", ").concat(u,") - must use stairs")))}const f=m[0],y=r.startingInventory||{key:0,stealth:0,strike:0,execute:0},v={key:y.key||0,stealth:y.stealth||0,strike:y.strike||0,execute:y.execute||0,floorKey:(y.floorKey||0)+g,portalStone:y.portalStone||0,minionBane:y.minionBane||0,mapFragment:y.mapFragment||0,timeShard:y.timeShard||0,voidWalk:y.voidWalk||0,healingPotion:y.healingPotion||0,greaterHealing:y.greaterHealing||0,elixir:y.elixir||0,revivalCharm:y.revivalCharm||0,heartCrystal:y.heartCrystal||0,ironGuard:y.ironGuard||0,torch:y.torch||0,lantern:y.lantern||0,revealScroll:y.revealScroll||0,sightPotion:y.sightPotion||0,crystalBall:y.crystalBall||0,weapon_rusty_sword:y.weapon_rusty_sword||0,weapon_iron_sword:y.weapon_iron_sword||0,weapon_steel_blade:y.weapon_steel_blade||0,weapon_enchanted_blade:y.weapon_enchanted_blade||0,weapon_shadow_dagger:y.weapon_shadow_dagger||0,armor_leather:y.armor_leather||0,armor_chainmail:y.armor_chainmail||0,armor_plate:y.armor_plate||0,accessory_ring_power:y.accessory_ring_power||0,accessory_amulet_protection:y.accessory_amulet_protection||0,accessory_lucky_charm:y.accessory_lucky_charm||0,accessory_vampiric_pendant:y.accessory_vampiric_pendant||0};let b={name:"The Maze",imagePath:"",message:"Find your way to the exit..."};const z=r.mainMinion?pn(r.mainMinion):null;null!==(a=r.storyConfig)&&void 0!==a&&a.mainStory?b={name:(null==z?void 0:z.name)||"Story",role:"Narrator",imagePath:(null==z?void 0:z.imagePath)||"",message:r.storyConfig.mainStory}:z&&(b={name:z.name,role:"Main Minion",imagePath:z.imagePath,message:r.mainMinionIntroMessage||"Welcome to my maze..."}),jt={isOpen:!0,profile:r,profileName:e,grid:f,size:s,playerX:0,playerY:0,playerDirection:"south",exitX:s-1,exitY:s-1,visited:new Set(["0:0,0"]),isVictory:!1,currentMinion:b,isPaused:!1,pendingEncounter:null,exitEncounterDone:!1,pendingConfirmation:null,pendingChest:null,inventory:{key:v.key||0,stealth:v.stealth||0,strike:v.strike||0,execute:v.execute||0,floorKey:v.floorKey||0,portalStone:v.portalStone||0,minionBane:v.minionBane||0,mapFragment:v.mapFragment||0,timeShard:v.timeShard||0,voidWalk:v.voidWalk||0,healingPotion:v.healingPotion||0,greaterHealing:v.greaterHealing||0,elixir:v.elixir||0,revivalCharm:v.revivalCharm||0,heartCrystal:v.heartCrystal||0,ironGuard:v.ironGuard||0,torch:v.torch||0,lantern:v.lantern||0,revealScroll:v.revealScroll||0,sightPotion:v.sightPotion||0,crystalBall:v.crystalBall||0,secretSense:0},visibility:{baseRadius:1,tempBonus:0,tempMovesLeft:0,permBonus:0,floorRevealed:!1},shownMilestones:new Set,stats:{startTime:Date.now(),moves:0,encountersTotal:0,encountersWon:0,encountersLost:0,chestsOpened:0,trapsTriggered:0,teleportsUsed:0,itemsCollected:{key:0,strike:0,stealth:0,execute:0}},explorationComplete:!1,moveCount:0,movingMinions:[],portals:[],objectiveProgress:Me(r),allObjectivesComplete:!1,currentFloor:0,totalFloors:c,floors:m,floorsData:h,voidWalkActive:!1,messageLog:[],hpEnabled:!1!==r.hpEnabled,hp:j(r),restCooldown:0,sessionNotes:"",fairness:{chestsWithoutKey:0,combatLossStreak:0,chestsWithoutHealing:0,lockedChestsSkipped:0,lastHealingFoundFloor:0},enhancedRooms:{},quests:{active:[],available:[],completed:[],maxActive:3},equipment:{weapon:null!==(n=r.startingEquipment)&&void 0!==n&&n.weapon?Oi(r.startingEquipment.weapon):null,armor:null!==(o=r.startingEquipment)&&void 0!==o&&o.armor?Oi(r.startingEquipment.armor):null,accessory:null!==(i=r.startingEquipment)&&void 0!==i&&i.accessory?Oi(r.startingEquipment.accessory):null},equipmentInventory:[]};const _=["weapon_rusty_sword","weapon_iron_sword","weapon_steel_blade","weapon_enchanted_blade","weapon_shadow_dagger","armor_leather","armor_chainmail","armor_plate","accessory_ring_power","accessory_amulet_protection","accessory_lucky_charm","accessory_vampiric_pendant","ironGuard"];for(const e of _){const t=v[e]||0;for(let a=0;a<t;a++)jt.equipmentInventory.push(e)}if(!jt.equipment.weapon){const e=_.filter((e=>e.startsWith("weapon_"))).find((e=>v[e]>0));if(e){jt.equipment.weapon=Oi(e);const t=jt.equipmentInventory.indexOf(e);t>=0&&jt.equipmentInventory.splice(t,1)}}if(!jt.equipment.armor){const e=_.filter((e=>e.startsWith("armor_")||"ironGuard"===e)).find((e=>v[e]>0));if(e){jt.equipment.armor=Oi(e);const t=jt.equipmentInventory.indexOf(e);t>=0&&jt.equipmentInventory.splice(t,1)}}if(!jt.equipment.accessory){const e=_.filter((e=>e.startsWith("accessory_"))).find((e=>v[e]>0));if(e){jt.equipment.accessory=Oi(e);const t=jt.equipmentInventory.indexOf(e);t>=0&&jt.equipmentInventory.splice(t,1)}}Ei("Adventure begins: ".concat(e)),Ei("Floor 1/".concat(r.floors||1," - ").concat(s,"x").concat(s," ").concat(r.theme||"fantasy"," ").concat(r.mapStyle||"dungeon")),jt.movingMinions=function(e,a){const n=[];for(let o=0;o<a;o++)for(let i=0;i<a;i++){const a=e[o][i];if(a.minion&&!a.minion.triggered){const e=pn(a.minion.minionId),r=(null==e?void 0:e.movement)||{type:"stationary"};"stationary"!==r.type&&n.push({minionId:a.minion.minionId,x:i,y:o,originX:i,originY:o,triggered:!1,movement:t({},r)})}}return console.log("[MazeMaster] Initialized ".concat(n.length," moving minion(s)")),n}(f,s),console.log("[MazeMaster] After initMovingMinions, starting v1.6.0 systems...");try{!function(e){jt.lighting||(jt.lighting={ambientLevel:"normal",activeLight:null,lightRadius:1,torchMovesLeft:0,sightPotionMovesLeft:0});const t=Wa().roomDarkness||{};jt.lighting.ambientLevel=t[e]||"normal",Ya()}(r.mapStyle||"maze"),console.log("[MazeMaster] Lighting initialized")}catch(e){console.error("[MazeMaster] initLighting error:",e)}try{!function(){const e=ja();if(e.factions&&0!==e.factions.length){jt.factions={};for(const t of e.factions)jt.factions[t.id]={id:t.id,name:t.name,standing:t.initialStanding||0,tier:"neutral",lastChange:null},jt.factions[t.id].tier=Ka(jt.factions[t.id].standing);console.log("[MazeMaster] Initialized ".concat(Object.keys(jt.factions).length," factions"))}else jt.factions={}}(),console.log("[MazeMaster] Factions initialized")}catch(e){console.error("[MazeMaster] initFactions error:",e)}try{Va()&&(jt.campaign={isPermadeath:!0,startTime:Date.now(),endTime:null,deathCause:null,finalStats:null},console.log("[MazeMaster] Permadeath campaign started")),console.log("[MazeMaster] Permadeath initialized")}catch(e){console.error("[MazeMaster] initPermadeathCampaign error:",e)}r.questPool&&r.questPool.length>0&&(jt.quests.available=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const a=(null==e?void 0:e.questPool)||[];if(0===a.length)return[];const n=[],o=a.reduce(((e,t)=>e+(t.chance||50)),0);for(let e=0;e<t&&n.length<a.length;e++){let e=Math.random()*o;for(const t of a)if(!n.includes(t.questId)&&(e-=t.chance||50,e<=0)){n.push(t.questId);break}}return n.map((e=>({questId:e,offered:!0,generatedText:null})))}(r,2),jt.quests.available.length>0&&Ei("Quests available: ".concat(jt.quests.available.length))),function(){var e;const t=St();if(t&&t.quests){jt.quests||(jt.quests={active:[],completed:[],failed:[]}),jt.questProfileMeta={profileName:jt.profile.questProfile,gatingMode:t.gatingMode||"none",questGatingEnabled:null!==(e=jt.profile.questGatingEnabled)&&void 0!==e&&e};for(const e of t.quests)e.autoAccept&&kt(e.questId)&&jt.quests.active.push({questId:e.questId,progress:0,profileEntry:e});t.onQuestProfileLoad&&executeSTScript(t.onQuestProfileLoad),ir()}}(),console.log("[MazeMaster] About to show maze modal...");try{ki(),console.log("[MazeMaster] Modal shown"),ne(0,0,s),console.log("[MazeMaster] Visibility applied"),wi(),console.log("[MazeMaster] Grid rendered"),ze(!1),Ii(),J(),Pi(),Ri(),le(),Z(),Ae(),Wi(),de&&clearInterval(de),de=setInterval((()=>{var e,t;null===(e=jt)||void 0===e||!e.isOpen||null!==(t=jt)&&void 0!==t&&t.isVictory?(clearInterval(de),de=null):le()}),1e3),console.log("[MazeMaster] UI updated"),ve(),fe(),document.addEventListener("keydown",Di,{capture:!0}),await Qt(0,0),console.log('[MazeMaster] Maze "'.concat(e,'" started (').concat(s,"x").concat(s,", ").concat(c," floor").concat(c>1?"s":"",")"))}catch(e){return console.error("[MazeMaster] Error during maze rendering:",e),{error:"Failed to render maze: ".concat(e.message)}}return{success:!0}}function ki(){var e,t,a,n,o,i,r,s,l,c,m,d,u,p;console.log("[MazeMaster] showMazeModal() called, currentMaze:",null===(e=jt)||void 0===e?void 0:e.isOpen,"size:",null===(t=jt)||void 0===t?void 0:t.size);const h=document.getElementById("mazemaster_maze_modal");h&&(console.log("[MazeMaster] Removing existing modal"),h.remove());const g=_i(jt.size);console.log("[MazeMaster] Cell size:",g);const f=document.createElement("div");f.id="mazemaster_maze_modal",f.style.cssText="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:999999;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.95);",f.innerHTML='\n        <div class="mazemaster-maze-overlay">\n            <div class="mazemaster-maze-container">\n                \x3c!-- TOP PANEL: Info & Controls --\x3e\n                <div class="mazemaster-maze-top">\n                    \x3c!-- Left Column: Message Box, Stats, Inventory --\x3e\n                    <div class="mazemaster-maze-left-column">\n                        \x3c!-- Hero Section (Message Box) --\x3e\n                        <div class="mazemaster-maze-hero">\n                            <div class="mazemaster-maze-hero-content">\n                                <div class="mazemaster-maze-hero-avatar">\n                                    <img id="maze_minion_img" src="" alt="" style="display: none;">\n                                    <div id="maze_generating_indicator" class="maze-generating-indicator">\n                                        <i class="fa-solid fa-comment-dots"></i>\n                                    </div>\n                                </div>\n                                <div class="maze-hero-text">\n                                    <div id="maze_minion_name" class="maze-minion-name"></div>\n                                    <div id="maze_minion_role" class="maze-minion-role"></div>\n                                    <div id="maze_message_log" class="maze-message-log"></div>\n                                </div>\n                            </div>\n                        </div>\n\n                    \x3c!-- ROW 2: Stats and Inventory --\x3e\n                    <div class="mazemaster-maze-info-stack">\n                        \x3c!-- Stats Bar --\x3e\n                        <div class="mazemaster-maze-stats-bar">\n                            <div class="stats-item stats-persona" title="Current Persona">\n                                <i class="fa-solid fa-user"></i>\n                                <span id="maze_stat_persona">'.concat(oe(),'</span>\n                            </div>\n                            <div class="stats-item" title="Moves">\n                                <i class="fa-solid fa-shoe-prints"></i>\n                                <span id="maze_stat_moves">0</span>\n                            </div>\n                            <div class="stats-item" title="Time Elapsed">\n                                <i class="fa-solid fa-clock"></i>\n                                <span id="maze_stat_time">0:00</span>\n                            </div>\n                            <div class="stats-item" title="Exploration">\n                                <i class="fa-solid fa-map"></i>\n                                <span id="maze_stat_explore">0%</span>\n                            </div>\n                            <div class="stats-item" title="Difficulty">\n                                <i class="fa-solid fa-skull"></i>\n                                <span id="maze_stat_difficulty">').concat(U(jt.profile).name,'</span>\n                            </div>\n                            <div class="stats-item maze-floor-indicator" title="Current Floor" style="').concat(jt.totalFloors<=1?"display:none;":"",'">\n                                <i class="fa-solid fa-layer-group"></i>\n                                <span><span id="maze_floor_current">').concat(jt.currentFloor+1,'</span>/<span id="maze_floor_total">').concat(jt.totalFloors,'</span></span>\n                            </div>\n                            <div class="stats-item maze-zone-indicator" id="maze_zone_display" title="Current Zone" style="display: none;">\n                                <i class="fa-solid fa-map-pin"></i>\n                                <span id="maze_zone_name">Zone 1</span>\n                                <span id="maze_zone_progress" style="font-size: 0.8em; opacity: 0.7;"></span>\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- Objectives Section (if any) --\x3e\n                    <div class="maze-objectives-section ').concat(0===((null===(a=jt.profile)||void 0===a||null===(a=a.objectives)||void 0===a?void 0:a.length)||0)?"hidden":"",'">\n                        <div class="objectives-header">\n                            <i class="fa-solid fa-list-check"></i>\n                            <span>Objectives</span>\n                        </div>\n                        <div id="maze_objectives_list" class="objectives-list">\n                            \x3c!-- Populated by updateObjectivesDisplay() --\x3e\n                        </div>\n                    </div>\n                    </div>\n\n                    \x3c!-- ROOM INFO BOX (right side, full height) --\x3e\n                    <div class="mazemaster-maze-room-info" id="maze_room_info">\n                        <div class="room-info-content">\n                            <div class="room-info-name" id="room_info_name">Unknown Room</div>\n                            <div class="room-info-desc" id="room_info_desc">...</div>\n                            <div class="room-info-section">\n                                <div class="room-info-label"><i class="fa-solid fa-users"></i> Occupants</div>\n                                <div id="room_info_occupants">None</div>\n                            </div>\n                            <div class="room-info-section">\n                                <div class="room-info-label"><i class="fa-solid fa-skull"></i> Defeated</div>\n                                <div id="room_info_defeated">None</div>\n                            </div>\n                            <div class="room-info-section room-info-exits-section">\n                                <div class="room-info-label"><i class="fa-solid fa-compass"></i> Exits</div>\n                                <div id="room_info_exits" class="room-info-exits-list">None</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Power Button (top right corner) --\x3e\n                <button id="maze_power_btn" class="maze-power-btn" title="Exit Maze">\n                    <i class="fa-solid fa-power-off"></i>\n                </button>\n\n                \x3c!-- Inventory Info Button (below power button) --\x3e\n                <div class="maze-inventory-info-wrapper" id="maze_inventory_wrapper">\n                    <button id="maze_inventory_btn" class="maze-info-btn" title="Inventory">\n                        <i class="fa-solid fa-info"></i>\n                    </button>\n                    <div class="maze-inventory-dropdown hidden" id="maze_inventory_menu">\n                        \x3c!-- Dungeon Items --\x3e\n                        <div class="inventory-menu-section">\n                            <div class="inventory-menu-header">Dungeon Items</div>\n                            <div class="inventory-menu-item" data-item="key" title="Unlock locked chests">\n                                <i class="fa-solid fa-key" style="color: #f1c40f;"></i>\n                                <span class="item-name">Skeleton Key</span>\n                                <span class="item-count" id="maze_inv_key">').concat(jt.inventory.key,'</span>\n                            </div>\n                            <div class="inventory-menu-item" data-item="floorKey" title="Unlock staircases">\n                                <i class="fa-solid fa-stairs" style="color: #9b59b6;"></i>\n                                <span class="item-name">Floor Key</span>\n                                <span class="item-count" id="maze_inv_floorKey">').concat(jt.inventory.floorKey,'</span>\n                            </div>\n                            <div class="inventory-menu-item" data-item="portalStone" data-usable="true" title="Teleport to any revealed portal">\n                                <i class="fa-solid fa-gem" style="color: #3498db;"></i>\n                                <span class="item-name">Portal Stone</span>\n                                <span class="item-count" id="maze_inv_portalStone">').concat(jt.inventory.portalStone,'</span>\n                            </div>\n                            <div class="inventory-menu-item" data-item="mapFragment" data-usable="true" title="Reveal 3x3 area around you">\n                                <i class="fa-solid fa-scroll" style="color: #e67e22;"></i>\n                                <span class="item-name">Map Fragment</span>\n                                <span class="item-count" id="maze_inv_mapFragment">').concat(jt.inventory.mapFragment,'</span>\n                            </div>\n                            <div class="inventory-menu-item" data-item="voidWalk" data-usable="true" title="Phase through one wall">\n                                <i class="fa-solid fa-ghost" style="color: #1abc9c;"></i>\n                                <span class="item-name">Void Walk</span>\n                                <span class="item-count" id="maze_inv_voidWalk">').concat(jt.inventory.voidWalk,'</span>\n                            </div>\n                        </div>\n                        \x3c!-- Combat Items --\x3e\n                        <div class="inventory-menu-section">\n                            <div class="inventory-menu-header">Combat Items</div>\n                            <div class="inventory-menu-item" data-item="stealth" title="Sneak past enemies">\n                                <i class="fa-solid fa-user-ninja" style="color: #95a5a6;"></i>\n                                <span class="item-name">Shadow Cloak</span>\n                                <span class="item-count" id="maze_inv_stealth">').concat(jt.inventory.stealth,'</span>\n                            </div>\n                            <div class="inventory-menu-item" data-item="strike" title="Combat boost">\n                                <i class="fa-solid fa-bolt" style="color: #f39c12;"></i>\n                                <span class="item-name">Battle Surge</span>\n                                <span class="item-count" id="maze_inv_pow">').concat(jt.inventory.strike,'</span>\n                            </div>\n                            <div class="inventory-menu-item execute" data-item="execute" title="Instant victory!">\n                                <i class="fa-solid fa-star" style="color: #e74c3c;"></i>\n                                <span class="item-name">Death Blow</span>\n                                <span class="item-count" id="maze_inv_execute">').concat(jt.inventory.execute,'</span>\n                            </div>\n                            <div class="inventory-menu-item" data-item="minionBane" title="Auto-defeat next minion">\n                                <i class="fa-solid fa-skull-crossbones" style="color: #8e44ad;"></i>\n                                <span class="item-name">Minion Bane</span>\n                                <span class="item-count" id="maze_inv_minionBane">').concat(jt.inventory.minionBane,'</span>\n                            </div>\n                            <div class="inventory-menu-item" data-item="timeShard" title="Slow next battlebar by 50%">\n                                <i class="fa-solid fa-hourglass-half" style="color: #2980b9;"></i>\n                                <span class="item-name">Time Shard</span>\n                                <span class="item-count" id="maze_inv_timeShard">').concat(jt.inventory.timeShard,'</span>\n                            </div>\n                        </div>\n                        \x3c!-- HP Items (v1.3.0) --\x3e\n                        <div class="inventory-menu-section hp-items-section" style="').concat(jt.hpEnabled?"":"display:none;",'">\n                            <div class="inventory-menu-header">Healing & Restoration</div>\n                            <div class="inventory-menu-item" data-item="healingPotion" data-usable="true" data-hp-item="healingPotion" title="Restore 25% HP">\n                                <i class="fa-solid fa-flask" style="color: #e74c3c;"></i>\n                                <span class="item-name">Minor Elixir</span>\n                                <span class="item-count" id="maze_inv_healingPotion">').concat(jt.inventory.healingPotion,'</span>\n                            </div>\n                            <div class="inventory-menu-item" data-item="greaterHealing" data-usable="true" data-hp-item="greaterHealing" title="Restore 50% HP">\n                                <i class="fa-solid fa-flask-vial" style="color: #9b59b6;"></i>\n                                <span class="item-name">Healing Draught</span>\n                                <span class="item-count" id="maze_inv_greaterHealing">').concat(jt.inventory.greaterHealing,'</span>\n                            </div>\n                            <div class="inventory-menu-item" data-item="elixir" data-usable="true" data-hp-item="elixir" title="Full HP restore">\n                                <i class="fa-solid fa-wine-bottle" style="color: #f1c40f;"></i>\n                                <span class="item-name">Grand Elixir</span>\n                                <span class="item-count" id="maze_inv_elixir">').concat(jt.inventory.elixir,'</span>\n                            </div>\n                            <div class="inventory-menu-item" data-item="revivalCharm" data-usable="true" data-hp-item="revivalCharm" title="Auto-resurrect on death">\n                                <i class="fa-solid fa-feather" style="color: #3498db;"></i>\n                                <span class="item-name">Phoenix Feather</span>\n                                <span class="item-count" id="maze_inv_revivalCharm">').concat(jt.inventory.revivalCharm,'</span>\n                            </div>\n                            <div class="inventory-menu-item" data-item="heartCrystal" data-usable="true" data-hp-item="heartCrystal" title="+10 Max HP permanent">\n                                <i class="fa-solid fa-gem" style="color: #e91e63;"></i>\n                                <span class="item-name">Heart Crystal</span>\n                                <span class="item-count" id="maze_inv_heartCrystal">').concat(jt.inventory.heartCrystal,'</span>\n                            </div>\n                        </div>\n                        \x3c!-- Visibility Items (v1.3.2) --\x3e\n                        <div class="inventory-menu-section vis-items-section">\n                            <div class="inventory-menu-header">Vision & Awareness</div>\n                            <div class="inventory-menu-item" data-item="torch" data-usable="true" data-vis-item="torch" title="Temporary +2 visibility (3 moves)">\n                                <i class="fa-solid fa-fire" style="color: #f39c12;"></i>\n                                <span class="item-name">Torch</span>\n                                <span class="item-count" id="maze_inv_torch">').concat(jt.inventory.torch,'</span>\n                            </div>\n                            <div class="inventory-menu-item" data-item="lantern" title="Passive +1 visibility while held">\n                                <i class="fa-solid fa-lightbulb" style="color: #f1c40f;"></i>\n                                <span class="item-name">Lantern</span>\n                                <span class="item-count" id="maze_inv_lantern">').concat(jt.inventory.lantern,'</span>\n                            </div>\n                            <div class="inventory-menu-item" data-item="revealScroll" data-usable="true" data-vis-item="revealScroll" title="Reveals entire floor for 1 move">\n                                <i class="fa-solid fa-scroll" style="color: #9b59b6;"></i>\n                                <span class="item-name">Reveal Scroll</span>\n                                <span class="item-count" id="maze_inv_revealScroll">').concat(jt.inventory.revealScroll,'</span>\n                            </div>\n                            <div class="inventory-menu-item" data-item="sightPotion" data-usable="true" data-vis-item="sightPotion" title="Permanent +1 visibility">\n                                <i class="fa-solid fa-eye" style="color: #3498db;"></i>\n                                <span class="item-name">Sight Potion</span>\n                                <span class="item-count" id="maze_inv_sightPotion">').concat(jt.inventory.sightPotion,'</span>\n                            </div>\n                            <div class="inventory-menu-item" data-item="crystalBall" data-usable="true" data-vis-item="crystalBall" title="Reveals all minions on floor">\n                                <i class="fa-solid fa-circle" style="color: #8e44ad;"></i>\n                                <span class="item-name">Crystal Ball</span>\n                                <span class="item-count" id="maze_inv_crystalBall">').concat(jt.inventory.crystalBall,'</span>\n                            </div>\n                            \x3c!-- v1.7.0 Equipment Items --\x3e\n                            <div class="inventory-menu-item" data-item="ironGuard" data-usable="false" title="Absorbs damage from combat and traps">\n                                <i class="fa-solid fa-shield-halved" style="color: #95a5a6;"></i>\n                                <span class="item-name">Iron Guard</span>\n                                <span class="item-count" id="maze_inv_ironGuard">').concat(jt.inventory.ironGuard||0,'</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Session Memory Button (below inventory button) --\x3e\n                <div class="maze-memory-wrapper" id="maze_memory_wrapper">\n                    <button id="maze_memory_btn" class="maze-memory-btn" title="Session Notes">\n                        <i class="fa-solid fa-note-sticky"></i>\n                    </button>\n                </div>\n\n                \x3c!-- Player Stats Button (below memory button) --\x3e\n                <div class="maze-player-wrapper" id="maze_player_wrapper">\n                    <button id="maze_player_btn" class="maze-player-btn" title="Player Stats">\n                        <i class="fa-solid fa-person"></i>\n                    </button>\n                </div>\n\n                \x3c!-- Skills Button (below player button) --\x3e\n                <div class="maze-skills-wrapper" id="maze_skills_wrapper">\n                    <button id="maze_skills_btn" class="maze-skills-btn" title="Skills">\n                        <i class="fa-solid fa-toolbox"></i>\n                    </button>\n                </div>\n\n                \x3c!-- Quest Button (below skills button) --\x3e\n                <div class="maze-quest-wrapper" id="maze_quest_wrapper">\n                    <button id="maze_quest_btn" class="maze-quest-btn" title="Quests">\n                        \n                    </button>\n                </div>\n\n                \x3c!-- Session Memory Panel --\x3e\n                <div id="maze_memory_panel" class="maze-memory-panel" style="display: none;">\n                    <div class="maze-memory-header">\n                        <h3>Session Notes</h3>\n                        <button id="maze_memory_close" class="maze-memory-close">&times;</button>\n                    </div>\n                    <div class="maze-memory-content">\n                        <textarea id="maze_memory_textarea" class="maze-memory-textarea" placeholder="Write notes about your adventure...&#10;&#10;These notes are saved with this maze session."></textarea>\n                    </div>\n                    <div class="maze-memory-footer">\n                        <button id="maze_memory_save" class="maze-memory-save-btn">Save Notes</button>\n                    </div>\n                </div>\n                <div id="maze_memory_backdrop" class="maze-memory-backdrop" style="display: none;"></div>\n\n                \x3c!-- Player Stats Panel --\x3e\n                <div id="maze_player_panel" class="maze-player-panel" style="display: none;">\n                    <div class="maze-player-header">\n                        <h3>Player Stats</h3>\n                        <button id="maze_player_close" class="maze-player-close">&times;</button>\n                    </div>\n                    <div class="maze-player-content">\n                        \x3c!-- Level & XP Section --\x3e\n                        <div class="player-stats-section">\n                            <div class="player-level-display">\n                                <span class="level-label">Level</span>\n                                <span class="level-value" id="player_level">1</span>\n                            </div>\n                            <div class="player-xp-bar-wrapper">\n                                <div class="player-xp-bar">\n                                    <div class="player-xp-fill" id="player_xp_fill" style="width: 0%;"></div>\n                                </div>\n                                <div class="player-xp-text">\n                                    <span id="player_xp_current">0</span> / <span id="player_xp_needed">100</span> XP\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- Character Stats Section --\x3e\n                        <div class="player-stats-section">\n                            <h4>Stats</h4>\n                            <div class="player-stat-row">\n                                <span class="stat-icon"><i class="fa-solid fa-heart"></i></span>\n                                <span class="stat-name">HP</span>\n                                <span class="stat-value" id="player_stat_hp">100/100</span>\n                            </div>\n                            <div class="player-stat-row">\n                                <span class="stat-icon"><i class="fa-solid fa-sword"></i></span>\n                                <span class="stat-name">Attack</span>\n                                <span class="stat-value" id="player_stat_atk">0 <span class="stat-bonus" id="player_stat_atk_bonus"></span></span>\n                            </div>\n                            <div class="player-stat-row">\n                                <span class="stat-icon"><i class="fa-solid fa-shield"></i></span>\n                                <span class="stat-name">Defense</span>\n                                <span class="stat-value" id="player_stat_def">0 <span class="stat-bonus" id="player_stat_def_bonus"></span></span>\n                            </div>\n                            <div class="player-stat-row">\n                                <span class="stat-icon"><i class="fa-solid fa-crosshairs"></i></span>\n                                <span class="stat-name">Crit Chance</span>\n                                <span class="stat-value" id="player_stat_crit">5% <span class="stat-bonus" id="player_stat_crit_bonus"></span></span>\n                            </div>\n                        </div>\n\n                        \x3c!-- Skill Points Section --\x3e\n                        <div class="player-stats-section">\n                            <div class="player-skill-points">\n                                <span class="skill-points-label">Skill Points Available</span>\n                                <span class="skill-points-value" id="player_skill_points">0</span>\n                            </div>\n                        </div>\n\n                        \x3c!-- Equipment Summary --\x3e\n                        <div class="player-stats-section">\n                            <h4>Equipment</h4>\n                            <div class="player-equip-summary" id="player_equip_summary">\n                                \x3c!-- Populated dynamically --\x3e\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div id="maze_player_backdrop" class="maze-player-backdrop" style="display: none;"></div>\n\n                \x3c!-- Skill Tree Panel --\x3e\n                <div id="maze_skill_panel" class="maze-skill-panel" style="display: none;">\n                    <div class="maze-skill-header">\n                        <h3><i class="fa-solid fa-book-sparkles"></i> Skills</h3>\n                        <div class="skill-points-header">\n                            <span>Skill Points:</span>\n                            <span id="skill_points_display" class="skill-points-value">0</span>\n                        </div>\n                        <button id="maze_skill_close" class="maze-skill-close">&times;</button>\n                    </div>\n                    <div class="maze-skill-content">\n                        <div id="skill_tree_content" class="skill-tree-container">\n                            \x3c!-- Populated dynamically --\x3e\n                        </div>\n                    </div>\n                </div>\n                <div id="maze_skill_backdrop" class="maze-skill-backdrop" style="display: none;"></div>\n\n                \x3c!-- Quest Panel --\x3e\n                <div id="maze_quest_panel" class="maze-quest-panel" style="display: none;">\n                    <div class="maze-quest-header">\n                        <h3><i class="fa-solid fa-scroll"></i> Quests</h3>\n                        <button id="maze_quest_close" class="maze-quest-close">&times;</button>\n                    </div>\n                    <div class="maze-quest-content">\n                        <div class="quest-tabs">\n                            <button class="quest-tab active" data-quest-tab="active">Active</button>\n                            <button class="quest-tab" data-quest-tab="available">Available</button>\n                            <button class="quest-tab" data-quest-tab="completed">Completed</button>\n                        </div>\n                        <div id="quest_list_content" class="quest-list">\n                            \x3c!-- Populated dynamically --\x3e\n                        </div>\n                    </div>\n                </div>\n                <div id="maze_quest_backdrop" class="maze-quest-backdrop" style="display: none;"></div>\n\n                \x3c!-- Ability Bar (bottom of screen during combat) --\x3e\n                <div id="ability_bar" class="ability-bar">\n                    \x3c!-- Populated dynamically --\x3e\n                </div>\n\n                \x3c!-- Encounter Actions (shows when needed) --\x3e\n                <div id="maze_encounter_confirm" class="maze-action-buttons">\n                    \x3c!-- Populated dynamically when encounter happens --\x3e\n                </div>\n\n                \x3c!-- BOTTOM PANEL: Map Area --\x3e\n                <div class="mazemaster-maze-bottom">\n                    <div class="mazemaster-maze-area">\n                        <div id="maze_grid_container" class="mazemaster-maze-grid-wrapper" style="position: relative;">\n                            \x3c!-- Renderer inserts grid/canvas here --\x3e\n                        </div>\n\n                        \x3c!-- HP Overlay (upper-right corner of map) --\x3e\n                        <div class="maze-hp-overlay" id="maze_hp_overlay" style="').concat(jt.hpEnabled?"":"display:none;",'">\n                            <div class="hp-overlay-bar">\n                                <i class="fa-solid fa-heart"></i>\n                                <div class="hp-overlay-bar-bg">\n                                    <div class="hp-overlay-bar-fill high" id="maze_hp_bar" style="width: 100%;"></div>\n                                </div>\n                                <span class="hp-overlay-text">\n                                    <span id="maze_hp_current">').concat((null===(n=jt.hp)||void 0===n?void 0:n.current)||100,'</span>/<span id="maze_hp_max">').concat(((null===(o=jt.hp)||void 0===o?void 0:o.max)||100)+((null===(i=jt.hp)||void 0===i?void 0:i.maxBonus)||0),"</span>\n                                </span>\n                            </div>\n                        </div>\n\n                        \x3c!-- v1.6.0: Minimap Overlay --\x3e\n                        ").concat(function(){const e=Ta();return'\n        <div id="mazemaster_minimap_container" class="mazemaster-minimap" style="display: '.concat(e.enabled?"block":"none",';">\n            <div class="mazemaster-minimap-header">\n                <span><i class="fa-solid fa-map"></i> Minimap</span>\n                <button id="mazemaster_minimap_toggle" class="mazemaster-minimap-btn" title="Toggle Minimap">\n                    <i class="fa-solid fa-eye"></i>\n                </button>\n            </div>\n            <canvas id="mazemaster_minimap_canvas"></canvas>\n        </div>\n    ')}(),'\n\n                        \x3c!-- Inventory Symbols Overlay (upper-left corner of map) --\x3e\n                        <div class="maze-inventory-overlay" id="maze_inventory_overlay">\n                            <div class="inv-overlay-item" data-item="key" title="Skeleton Key">\n                                <i class="fa-solid fa-key" style="color: #f1c40f;"></i>\n                                <span id="maze_ov_key">').concat(jt.inventory.key,'</span>\n                            </div>\n                            <div class="inv-overlay-item" data-item="stealth" title="Shadow Cloak">\n                                <i class="fa-solid fa-user-ninja" style="color: #95a5a6;"></i>\n                                <span id="maze_ov_stealth">').concat(jt.inventory.stealth,'</span>\n                            </div>\n                            <div class="inv-overlay-item" data-item="strike" title="Battle Surge">\n                                <i class="fa-solid fa-bolt" style="color: #f39c12;"></i>\n                                <span id="maze_ov_strike">').concat(jt.inventory.strike,'</span>\n                            </div>\n                            <div class="inv-overlay-item execute" data-item="execute" title="Death Blow">\n                                <i class="fa-solid fa-star" style="color: #e74c3c;"></i>\n                                <span id="maze_ov_execute">').concat(jt.inventory.execute,'</span>\n                            </div>\n                            <div class="inv-overlay-item" data-item="floorKey" title="Floor Key" style="').concat(jt.totalFloors>1?"":"display:none;",'">\n                                <i class="fa-solid fa-stairs" style="color: #9b59b6;"></i>\n                                <span id="maze_ov_floorKey">').concat(jt.inventory.floorKey,'</span>\n                            </div>\n                            <div class="inv-overlay-item" data-item="portalStone" title="Portal Stone">\n                                <i class="fa-solid fa-gem" style="color: #3498db;"></i>\n                                <span id="maze_ov_portalStone">').concat(jt.inventory.portalStone,'</span>\n                            </div>\n                            <div class="inv-overlay-item" data-item="minionBane" title="Minion Bane">\n                                <i class="fa-solid fa-skull-crossbones" style="color: #8e44ad;"></i>\n                                <span id="maze_ov_minionBane">').concat(jt.inventory.minionBane,'</span>\n                            </div>\n                            <div class="inv-overlay-item" data-item="mapFragment" title="Map Fragment">\n                                <i class="fa-solid fa-scroll" style="color: #e67e22;"></i>\n                                <span id="maze_ov_mapFragment">').concat(jt.inventory.mapFragment,'</span>\n                            </div>\n                            <div class="inv-overlay-item" data-item="timeShard" title="Time Shard">\n                                <i class="fa-solid fa-hourglass-half" style="color: #2980b9;"></i>\n                                <span id="maze_ov_timeShard">').concat(jt.inventory.timeShard,'</span>\n                            </div>\n                            <div class="inv-overlay-item" data-item="voidWalk" title="Void Walk">\n                                <i class="fa-solid fa-ghost" style="color: #1abc9c;"></i>\n                                <span id="maze_ov_voidWalk">').concat(jt.inventory.voidWalk,'</span>\n                            </div>\n                            \x3c!-- HP Items --\x3e\n                            <div class="inv-overlay-item hp-item" data-item="healingPotion" title="Minor Elixir" style="').concat(jt.hpEnabled?"":"display:none;",'">\n                                <i class="fa-solid fa-flask" style="color: #e74c3c;"></i>\n                                <span id="maze_ov_healingPotion">').concat(jt.inventory.healingPotion,'</span>\n                            </div>\n                            <div class="inv-overlay-item hp-item" data-item="greaterHealing" title="Healing Draught" style="').concat(jt.hpEnabled?"":"display:none;",'">\n                                <i class="fa-solid fa-flask-vial" style="color: #9b59b6;"></i>\n                                <span id="maze_ov_greaterHealing">').concat(jt.inventory.greaterHealing,'</span>\n                            </div>\n                            <div class="inv-overlay-item hp-item" data-item="elixir" title="Grand Elixir" style="').concat(jt.hpEnabled?"":"display:none;",'">\n                                <i class="fa-solid fa-wine-bottle" style="color: #f1c40f;"></i>\n                                <span id="maze_ov_elixir">').concat(jt.inventory.elixir,'</span>\n                            </div>\n                            <div class="inv-overlay-item hp-item" data-item="revivalCharm" title="Phoenix Feather" style="').concat(jt.hpEnabled?"":"display:none;",'">\n                                <i class="fa-solid fa-feather" style="color: #3498db;"></i>\n                                <span id="maze_ov_revivalCharm">').concat(jt.inventory.revivalCharm,'</span>\n                            </div>\n                            <div class="inv-overlay-item hp-item" data-item="heartCrystal" title="Heart Crystal" style="').concat(jt.hpEnabled?"":"display:none;",'">\n                                <i class="fa-solid fa-gem" style="color: #e91e63;"></i>\n                                <span id="maze_ov_heartCrystal">').concat(jt.inventory.heartCrystal,'</span>\n                            </div>\n                            \x3c!-- Visibility Items --\x3e\n                            <div class="inv-overlay-item vis-item" data-item="torch" data-usable="true" title="Torch: +2 visibility for 3 moves">\n                                <i class="fa-solid fa-fire" style="color: #f39c12;"></i>\n                                <span id="maze_ov_torch">').concat(jt.inventory.torch,'</span>\n                            </div>\n                            <div class="inv-overlay-item vis-item" data-item="lantern" title="Lantern: Passive +1 visibility">\n                                <i class="fa-solid fa-lightbulb" style="color: #f1c40f;"></i>\n                                <span id="maze_ov_lantern">').concat(jt.inventory.lantern,'</span>\n                            </div>\n                            <div class="inv-overlay-item vis-item" data-item="revealScroll" data-usable="true" title="Reveal Scroll: Shows entire floor">\n                                <i class="fa-solid fa-scroll" style="color: #9b59b6;"></i>\n                                <span id="maze_ov_revealScroll">').concat(jt.inventory.revealScroll,'</span>\n                            </div>\n                            <div class="inv-overlay-item vis-item" data-item="sightPotion" data-usable="true" title="Sight Potion: Permanent +1 visibility">\n                                <i class="fa-solid fa-eye" style="color: #3498db;"></i>\n                                <span id="maze_ov_sightPotion">').concat(jt.inventory.sightPotion,'</span>\n                            </div>\n                            <div class="inv-overlay-item vis-item" data-item="crystalBall" data-usable="true" title="Crystal Ball: Reveals all minions">\n                                <i class="fa-solid fa-crystal-ball" style="color: #8e44ad;"></i>\n                                <span id="maze_ov_crystalBall">').concat(jt.inventory.crystalBall,'</span>\n                            </div>\n                            \x3c!-- v1.7.0 Equipment Items --\x3e\n                            <div class="inv-overlay-item equip-item" data-item="ironGuard" data-usable="false" title="Iron Guard: Absorbs damage">\n                                <i class="fa-solid fa-shield-halved" style="color: #95a5a6;"></i>\n                                <span id="maze_ov_ironGuard">').concat(jt.inventory.ironGuard||0,'</span>\n                            </div>\n                        </div>\n\n                        \x3c!-- v1.5.0: Equipment Overlay (bottom-left corner of map) --\x3e\n                        <div class="maze-equipment-overlay" id="maze_equipment_overlay">\n                            <div class="equip-overlay-header">\n                                <i class="fa-solid fa-shield-halved"></i> Equipment\n                                <span class="equip-stats-summary">\n                                    <span id="maze_equip_total_atk">+0</span> ATK\n                                    <span id="maze_equip_total_def">+0</span> DEF\n                                    <span id="maze_equip_total_crit">+0%</span> Crit\n                                </span>\n                            </div>\n                            <div class="equip-slots">\n                                <div class="equip-slot" id="maze_equip_weapon" data-slot="weapon" title="Empty weapon slot">\n                                    <div class="equip-item empty" data-slot="weapon">\n                                        <i class="fa-solid fa-sword"></i>\n                                        <span class="equip-name">Weapon</span>\n                                    </div>\n                                </div>\n                                <div class="equip-slot" id="maze_equip_armor" data-slot="armor" title="Empty armor slot">\n                                    <div class="equip-item empty" data-slot="armor">\n                                        <i class="fa-solid fa-shield"></i>\n                                        <span class="equip-name">Armor</span>\n                                    </div>\n                                </div>\n                                <div class="equip-slot" id="maze_equip_accessory" data-slot="accessory" title="Empty accessory slot">\n                                    <div class="equip-item empty" data-slot="accessory">\n                                        <i class="fa-solid fa-ring"></i>\n                                        <span class="equip-name">Accessory</span>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="equip-inventory-toggle">\n                                <button id="maze_equip_toggle" class="equip-toggle-btn" title="View Equipment Inventory">\n                                    <i class="fa-solid fa-backpack"></i> Backpack\n                                </button>\n                            </div>\n                            <div class="equip-inventory-dropdown" id="maze_equipment_inventory" style="display: none;">\n                                <div class="equip-inv-empty">No equipment in backpack</div>\n                            </div>\n                        </div>\n\n                        \x3c!-- Action Popup Overlay (for encounter buttons) - OUTSIDE grid container so it persists through re-renders --\x3e\n                        <div id="maze_action_popup" class="maze-action-popup" style="display: none;">\n                            <div class="maze-action-popup-content">\n                                <div id="maze_action_popup_buttons" class="maze-action-popup-buttons">\n                                    \x3c!-- Buttons populated dynamically --\x3e\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Circular D-Pad (floating) --\x3e\n                <div id="maze_dpad" class="maze-dpad ').concat(!1!==(null===(r=qt.dpadConfig)||void 0===r?void 0:r.floating)?"floating":"",'"\n                     style="').concat(!1===(null===(s=qt.dpadConfig)||void 0===s?void 0:s.enabled)?"display: none;":"").concat(null!==(l=qt.dpadConfig)&&void 0!==l&&null!==(l=l.position)&&void 0!==l&&l.x?"left: ".concat(qt.dpadConfig.position.x,"px; top: ").concat(qt.dpadConfig.position.y,"px;"):"",'">\n                    <div class="dpad-ring">\n                        <button class="dpad-btn dpad-up" data-dir="up" title="Move Up (Arrow Up)">\n                            <i class="fa-solid fa-chevron-up"></i>\n                        </button>\n                        <button class="dpad-btn dpad-right" data-dir="right" title="Move Right (Arrow Right)">\n                            <i class="fa-solid fa-chevron-right"></i>\n                        </button>\n                        <button class="dpad-btn dpad-down" data-dir="down" title="Move Down (Arrow Down)">\n                            <i class="fa-solid fa-chevron-down"></i>\n                        </button>\n                        <button class="dpad-btn dpad-left" data-dir="left" title="Move Left (Arrow Left)">\n                            <i class="fa-solid fa-chevron-left"></i>\n                        </button>\n                        \x3c!-- Floor navigation buttons (shown when on staircase) --\x3e\n                        <button class="dpad-btn dpad-floor-up hidden" data-dir="floor-up" title="Go Up Floor (Shift+Up)">\n                            <i class="fa-solid fa-arrow-up"></i><span>UP</span>\n                        </button>\n                        <button class="dpad-btn dpad-floor-down hidden" data-dir="floor-down" title="Go Down Floor (Shift+Down)">\n                            <i class="fa-solid fa-arrow-down"></i><span>DN</span>\n                        </button>\n                    </div>\n                    <div class="dpad-center"></div>\n                    <div class="dpad-drag-handle" title="Drag to reposition">\n                        <i class="fa-solid fa-grip"></i>\n                    </div>\n                    \x3c!-- Rest button (HP system) - positioned safely away from directional buttons --\x3e\n                    <button id="maze_rest_btn" class="dpad-rest-btn" title="Rest to recover HP" style="display: none;">\n                        <i class="fa-solid fa-bed"></i>\n                        <span class="rest-cooldown-badge" style="display: none;"></span>\n                    </button>\n                </div>\n\n                \x3c!-- Close Button (shown on victory) --\x3e\n                <button id="maze_close_btn" class="menu_button menu_button_primary maze-close-btn" style="display: none;">\n                    <i class="fa-solid fa-check"></i> Close\n                </button>\n            </div>\n        </div>\n\n        <style>\n            .mazemaster-maze-overlay {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                width: 100%;\n                height: 100%;\n                overflow-y: auto;\n                -webkit-overflow-scrolling: touch;\n            }\n\n            .mazemaster-maze-container {\n                position: relative;\n                display: flex;\n                flex-direction: column;\n                gap: 12px;\n                padding: 15px;\n                width: 90vw;\n                max-width: 1200px;\n                height: 94vh;\n                max-height: 960px;\n                margin: 10px;\n                background: #1a1a2e;\n                border-radius: 15px;\n                border: 2px solid #333;\n                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);\n                overflow: hidden;\n            }\n\n            /* Top Panel - Info & Controls */\n            .mazemaster-maze-top {\n                display: flex;\n                flex-direction: row;\n                gap: 16px;\n                flex-shrink: 0;\n                min-height: 240px;\n                height: 280px;\n            }\n\n            /* Left Column - Message Box, Stats, Inventory stacked */\n            .mazemaster-maze-left-column {\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n                width: 50.1%;\n                flex-shrink: 0;\n            }\n\n            /* Info Stack - Stats and Inventory */\n            .mazemaster-maze-info-stack {\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n                width: 100%;\n                position: relative;\n            }\n\n            /* ROOM INFO BOX - right side, full height */\n            .mazemaster-maze-room-info {\n                flex: 1;\n                margin-right: 46px; /* Space for power button */\n                background: rgba(0, 0, 0, 0.3);\n                border-radius: 8px;\n                padding: 10px 12px;\n                border: 1px solid #444;\n                display: flex;\n                flex-direction: column;\n            }\n\n            .room-info-content {\n                flex: 1;\n                display: flex;\n                flex-direction: column;\n                color: #aaa;\n                font-size: 0.9em;\n                gap: 8px;\n                overflow-y: auto;\n            }\n\n            .room-info-name {\n                font-size: 1.1em;\n                font-weight: 600;\n                color: #ecf0f1;\n                margin-bottom: 2px;\n            }\n\n            .room-info-desc {\n                font-style: italic;\n                color: #bdc3c7;\n                font-size: 0.9em;\n                line-height: 1.3;\n                padding-bottom: 8px;\n                border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n            }\n\n            .room-info-section {\n                display: flex;\n                flex-direction: column;\n                gap: 2px;\n            }\n\n            .room-info-label {\n                font-size: 0.75em;\n                color: #7f8c8d;\n                text-transform: uppercase;\n                display: flex;\n                align-items: center;\n                gap: 6px;\n            }\n\n            .room-info-label i {\n                font-size: 0.9em;\n                color: #3498db;\n            }\n\n            .room-info-section > div:last-child {\n                color: #ecf0f1;\n                font-size: 0.95em;\n            }\n\n            .maze-hero-text {\n                display: flex;\n                flex-direction: column;\n                flex: 1;\n                min-width: 0;\n            }\n\n            /* Power Button - Top Right Corner */\n            .maze-power-btn {\n                position: absolute;\n                top: 16px;\n                right: 10px;\n                width: 40px;\n                height: 40px;\n                border-radius: 50%;\n                border: 2px solid #e94560;\n                background: rgba(233, 69, 96, 0.2);\n                color: #e94560;\n                font-size: 18px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s ease;\n                z-index: 100;\n            }\n\n            .maze-power-btn:hover {\n                background: #e94560;\n                color: #fff;\n                transform: scale(1.1);\n            }\n\n            /* Inventory Info Button - Below Power Button */\n            .maze-inventory-info-wrapper {\n                position: absolute;\n                top: 66px;\n                right: 10px;\n                z-index: 200;\n            }\n\n            .maze-inventory-info-wrapper.open {\n                z-index: 10100;\n            }\n\n            .maze-info-btn {\n                width: 40px;\n                height: 40px;\n                border-radius: 50%;\n                border: 2px solid #f1c40f;\n                background: rgba(241, 196, 15, 0.2);\n                color: #f1c40f;\n                font-size: 18px;\n                font-weight: bold;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s ease;\n            }\n\n            .maze-info-btn:hover {\n                background: #f1c40f;\n                color: #1a1a2e;\n                transform: scale(1.1);\n            }\n\n            .maze-inventory-info-wrapper.open .maze-info-btn {\n                background: #f1c40f;\n                color: #1a1a2e;\n            }\n\n            /* Session Memory Button - Below Inventory Button */\n            .maze-memory-wrapper {\n                position: absolute;\n                top: 112px;\n                right: 10px;\n                z-index: 200;\n            }\n\n            .maze-memory-btn {\n                width: 40px;\n                height: 40px;\n                border-radius: 50%;\n                border: 2px solid #5dade2;\n                background: rgba(93, 173, 226, 0.2);\n                color: #5dade2;\n                font-size: 18px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s ease;\n            }\n\n            .maze-memory-btn:hover {\n                background: #5dade2;\n                color: #1a1a2e;\n                transform: scale(1.1);\n            }\n\n            .maze-memory-btn.active {\n                background: #5dade2;\n                color: #1a1a2e;\n            }\n\n            /* Session Memory Panel */\n            .maze-memory-panel {\n                position: fixed;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                width: 90%;\n                max-width: 500px;\n                max-height: 80vh;\n                background: rgba(20, 25, 35, 0.98);\n                border: 2px solid #5dade2;\n                border-radius: 12px;\n                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);\n                z-index: 10200;\n                display: flex;\n                flex-direction: column;\n            }\n\n            .maze-memory-panel.hidden {\n                display: none;\n            }\n\n            .maze-memory-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 12px 16px;\n                border-bottom: 1px solid rgba(93, 173, 226, 0.3);\n                background: rgba(93, 173, 226, 0.1);\n                border-radius: 10px 10px 0 0;\n            }\n\n            .maze-memory-header h3 {\n                margin: 0;\n                color: #5dade2;\n                font-size: 16px;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n\n            .maze-memory-close {\n                background: none;\n                border: none;\n                color: #888;\n                font-size: 20px;\n                cursor: pointer;\n                padding: 4px 8px;\n                transition: color 0.2s;\n            }\n\n            .maze-memory-close:hover {\n                color: #e74c3c;\n            }\n\n            .maze-memory-content {\n                flex: 1;\n                padding: 16px;\n                overflow-y: auto;\n            }\n\n            .maze-memory-textarea {\n                width: 100%;\n                height: 300px;\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid rgba(93, 173, 226, 0.3);\n                border-radius: 8px;\n                color: #e0e0e0;\n                font-family: \'Segoe UI\', Tahoma, sans-serif;\n                font-size: 14px;\n                line-height: 1.5;\n                padding: 12px;\n                resize: vertical;\n            }\n\n            .maze-memory-textarea:focus {\n                outline: none;\n                border-color: #5dade2;\n            }\n\n            .maze-memory-textarea::placeholder {\n                color: #666;\n                font-style: italic;\n            }\n\n            .maze-memory-footer {\n                padding: 12px 16px;\n                border-top: 1px solid rgba(93, 173, 226, 0.2);\n                display: flex;\n                justify-content: flex-end;\n                gap: 10px;\n            }\n\n            .maze-memory-save-btn {\n                background: linear-gradient(135deg, #5dade2 0%, #3498db 100%);\n                border: none;\n                color: white;\n                padding: 8px 20px;\n                border-radius: 6px;\n                cursor: pointer;\n                font-weight: bold;\n                transition: transform 0.2s, box-shadow 0.2s;\n            }\n\n            .maze-memory-save-btn:hover {\n                transform: scale(1.05);\n                box-shadow: 0 4px 12px rgba(93, 173, 226, 0.4);\n            }\n\n            .maze-memory-backdrop {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.6);\n                z-index: 10199;\n            }\n\n            .maze-memory-backdrop.hidden {\n                display: none;\n            }\n\n            /* Player Stats Button - Below Memory Button */\n            .maze-player-wrapper {\n                position: absolute;\n                top: 158px;\n                right: 10px;\n                z-index: 200;\n            }\n\n            .maze-player-btn {\n                width: 40px;\n                height: 40px;\n                border-radius: 50%;\n                border: 2px solid #58d68d;\n                background: rgba(88, 214, 141, 0.2);\n                color: #58d68d;\n                font-size: 18px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s ease;\n            }\n\n            .maze-player-btn:hover {\n                background: #58d68d;\n                color: #1a1a2e;\n                transform: scale(1.1);\n            }\n\n            .maze-player-btn.active {\n                background: #58d68d;\n                color: #1a1a2e;\n            }\n\n            /* Player Stats Panel */\n            .maze-player-panel {\n                position: fixed;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                width: 90%;\n                max-width: 400px;\n                max-height: 80vh;\n                background: rgba(20, 25, 35, 0.98);\n                border: 2px solid #58d68d;\n                border-radius: 12px;\n                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);\n                z-index: 10200;\n                display: flex;\n                flex-direction: column;\n                overflow: hidden;\n            }\n\n            .maze-player-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 12px 16px;\n                border-bottom: 1px solid rgba(88, 214, 141, 0.3);\n                background: rgba(88, 214, 141, 0.1);\n                border-radius: 10px 10px 0 0;\n            }\n\n            .maze-player-header h3 {\n                margin: 0;\n                color: #58d68d;\n                font-size: 16px;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n\n            .maze-player-close {\n                background: none;\n                border: none;\n                color: #888;\n                font-size: 20px;\n                cursor: pointer;\n                padding: 4px 8px;\n                transition: color 0.2s;\n            }\n\n            .maze-player-close:hover {\n                color: #e74c3c;\n            }\n\n            .maze-player-content {\n                flex: 1;\n                padding: 16px;\n                overflow-y: auto;\n            }\n\n            .player-stats-section {\n                margin-bottom: 20px;\n                padding-bottom: 16px;\n                border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n            }\n\n            .player-stats-section:last-child {\n                border-bottom: none;\n                margin-bottom: 0;\n            }\n\n            .player-stats-section h4 {\n                margin: 0 0 12px 0;\n                color: #58d68d;\n                font-size: 14px;\n                text-transform: uppercase;\n                letter-spacing: 1px;\n            }\n\n            .player-level-display {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 12px;\n                margin-bottom: 12px;\n            }\n\n            .level-label {\n                color: #888;\n                font-size: 14px;\n                text-transform: uppercase;\n            }\n\n            .level-value {\n                font-size: 36px;\n                font-weight: bold;\n                color: #58d68d;\n                text-shadow: 0 0 10px rgba(88, 214, 141, 0.5);\n            }\n\n            .player-xp-bar-wrapper {\n                width: 100%;\n            }\n\n            .player-xp-bar {\n                width: 100%;\n                height: 20px;\n                background: rgba(0, 0, 0, 0.4);\n                border-radius: 10px;\n                overflow: hidden;\n                border: 1px solid rgba(88, 214, 141, 0.3);\n            }\n\n            .player-xp-fill {\n                height: 100%;\n                background: linear-gradient(90deg, #27ae60, #58d68d);\n                border-radius: 10px;\n                transition: width 0.5s ease;\n            }\n\n            .player-xp-text {\n                text-align: center;\n                margin-top: 6px;\n                color: #aaa;\n                font-size: 13px;\n            }\n\n            .player-stat-row {\n                display: flex;\n                align-items: center;\n                padding: 8px 0;\n                border-bottom: 1px solid rgba(255, 255, 255, 0.05);\n            }\n\n            .player-stat-row:last-child {\n                border-bottom: none;\n            }\n\n            .stat-icon {\n                width: 30px;\n                text-align: center;\n                color: #58d68d;\n            }\n\n            .stat-name {\n                flex: 1;\n                color: #ccc;\n                font-size: 14px;\n            }\n\n            .stat-value {\n                color: #fff;\n                font-weight: bold;\n                font-size: 14px;\n            }\n\n            .stat-bonus {\n                color: #58d68d;\n                font-size: 12px;\n                margin-left: 4px;\n            }\n\n            .player-skill-points {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 12px;\n                background: rgba(88, 214, 141, 0.1);\n                border-radius: 8px;\n                border: 1px solid rgba(88, 214, 141, 0.3);\n            }\n\n            .skill-points-label {\n                color: #ccc;\n                font-size: 14px;\n            }\n\n            .skill-points-value {\n                font-size: 24px;\n                font-weight: bold;\n                color: #f1c40f;\n            }\n\n            .player-equip-summary {\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n            }\n\n            .equip-slot-row {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                padding: 6px 8px;\n                background: rgba(0, 0, 0, 0.2);\n                border-radius: 6px;\n            }\n\n            .equip-slot-icon {\n                width: 24px;\n                text-align: center;\n                color: #888;\n            }\n\n            .equip-slot-name {\n                width: 70px;\n                color: #888;\n                font-size: 12px;\n                text-transform: uppercase;\n            }\n\n            .equip-slot-item {\n                flex: 1;\n                color: #fff;\n                font-size: 13px;\n            }\n\n            .equip-slot-item.empty {\n                color: #555;\n                font-style: italic;\n            }\n\n            .maze-player-backdrop {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.6);\n                z-index: 10199;\n            }\n\n            /* Skills Button - Below Player Button */\n            .maze-skills-wrapper {\n                position: absolute;\n                top: 204px;\n                right: 10px;\n                z-index: 200;\n            }\n\n            .maze-skills-btn {\n                width: 40px;\n                height: 40px;\n                border-radius: 50%;\n                border: 2px solid #f39c12;\n                background: rgba(243, 156, 18, 0.2);\n                color: #f39c12;\n                font-size: 16px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s ease;\n            }\n\n            .maze-skills-btn:hover {\n                background: #f39c12;\n                color: #1a1a2e;\n                transform: scale(1.1);\n            }\n\n            .maze-skills-btn.active {\n                background: #f39c12;\n                color: #1a1a2e;\n            }\n\n            /* Skill Tree Panel */\n            .maze-skill-panel {\n                position: fixed;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                width: 95%;\n                max-width: 900px;\n                max-height: 85vh;\n                background: rgba(20, 25, 35, 0.98);\n                border: 2px solid #f39c12;\n                border-radius: 12px;\n                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);\n                z-index: 10200;\n                display: flex;\n                flex-direction: column;\n                overflow: hidden;\n            }\n\n            .maze-skill-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 12px 16px;\n                border-bottom: 1px solid rgba(243, 156, 18, 0.3);\n                background: rgba(243, 156, 18, 0.1);\n                border-radius: 10px 10px 0 0;\n                gap: 16px;\n            }\n\n            .maze-skill-header h3 {\n                margin: 0;\n                color: #f39c12;\n                font-size: 16px;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                flex: 1;\n            }\n\n            .skill-points-header {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                color: #ccc;\n                font-size: 14px;\n            }\n\n            .skill-points-header .skill-points-value {\n                font-size: 20px;\n                font-weight: bold;\n                color: #f1c40f;\n            }\n\n            .maze-skill-close {\n                background: none;\n                border: none;\n                color: #888;\n                font-size: 20px;\n                cursor: pointer;\n                padding: 4px 8px;\n                transition: color 0.2s;\n            }\n\n            .maze-skill-close:hover {\n                color: #e74c3c;\n            }\n\n            .maze-skill-content {\n                flex: 1;\n                padding: 16px;\n                overflow-y: auto;\n            }\n\n            .skill-tree-container {\n                display: flex;\n                gap: 16px;\n                flex-wrap: wrap;\n                justify-content: center;\n            }\n\n            .skill-tree {\n                flex: 1;\n                min-width: 250px;\n                max-width: 300px;\n                background: rgba(0, 0, 0, 0.3);\n                border-radius: 8px;\n                padding: 12px;\n            }\n\n            .skill-tree-header {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                padding: 8px 12px;\n                border-radius: 6px;\n                border: 2px solid;\n                background: rgba(0, 0, 0, 0.3);\n                margin-bottom: 12px;\n                font-weight: bold;\n            }\n\n            .skill-tree-skills {\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n            }\n\n            .skill-node {\n                padding: 10px 12px;\n                border-radius: 8px;\n                border: 2px solid #444;\n                background: rgba(0, 0, 0, 0.4);\n                transition: all 0.2s ease;\n            }\n\n            .skill-node.locked {\n                opacity: 0.5;\n                border-color: #333;\n            }\n\n            .skill-node.available {\n                border-color: var(--tree-color, #f39c12);\n                cursor: pointer;\n            }\n\n            .skill-node.available:hover {\n                background: rgba(243, 156, 18, 0.1);\n                transform: translateY(-2px);\n            }\n\n            .skill-node.learned {\n                border-color: var(--tree-color, #f39c12);\n                background: rgba(243, 156, 18, 0.15);\n                box-shadow: 0 0 10px rgba(243, 156, 18, 0.3);\n            }\n\n            .skill-node-header {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                margin-bottom: 4px;\n            }\n\n            .skill-node-header i {\n                color: var(--tree-color, #f39c12);\n            }\n\n            .skill-name {\n                flex: 1;\n                font-weight: bold;\n                color: #fff;\n                font-size: 13px;\n            }\n\n            .skill-rank {\n                font-size: 12px;\n                color: #888;\n                background: rgba(0, 0, 0, 0.3);\n                padding: 2px 6px;\n                border-radius: 4px;\n            }\n\n            .skill-node.learned .skill-rank {\n                color: var(--tree-color, #f39c12);\n                background: rgba(0, 0, 0, 0.5);\n            }\n\n            .skill-node-desc {\n                font-size: 11px;\n                color: #aaa;\n                margin-bottom: 4px;\n            }\n\n            .skill-cooldown {\n                font-size: 10px;\n                color: #888;\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n\n            .skill-learn-btn {\n                width: 100%;\n                margin-top: 8px;\n                padding: 6px 12px;\n                background: var(--tree-color, #f39c12);\n                border: none;\n                border-radius: 4px;\n                color: #1a1a2e;\n                font-weight: bold;\n                font-size: 12px;\n                cursor: pointer;\n                transition: all 0.2s ease;\n            }\n\n            .skill-learn-btn:hover {\n                transform: scale(1.02);\n                box-shadow: 0 2px 8px rgba(243, 156, 18, 0.4);\n            }\n\n            .skill-locked-reason {\n                font-size: 10px;\n                color: #e74c3c;\n                margin-top: 4px;\n                font-style: italic;\n            }\n\n            .maze-skill-backdrop {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.6);\n                z-index: 10199;\n            }\n\n            /* Quest Button - Below Skills Button */\n            .maze-quest-wrapper {\n                position: absolute;\n                top: 250px;\n                right: 10px;\n                z-index: 200;\n            }\n\n            .maze-quest-btn {\n                width: 40px;\n                height: 40px;\n                border-radius: 50%;\n                border: 2px solid #e91e63;\n                background: rgba(233, 30, 99, 0.2);\n                color: #e91e63;\n                font-size: 18px;\n                font-weight: bold;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.2s ease;\n            }\n\n            .maze-quest-btn:hover {\n                background: #e91e63;\n                color: #1a1a2e;\n                transform: scale(1.1);\n            }\n\n            .maze-quest-btn.active {\n                background: #e91e63;\n                color: #1a1a2e;\n            }\n\n            /* Quest Panel */\n            .maze-quest-panel {\n                position: fixed;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                width: 90%;\n                max-width: 500px;\n                max-height: 70vh;\n                background: rgba(20, 25, 35, 0.98);\n                border: 2px solid #e91e63;\n                border-radius: 12px;\n                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8);\n                z-index: 10200;\n                display: flex;\n                flex-direction: column;\n                overflow: hidden;\n            }\n\n            .maze-quest-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 12px 16px;\n                border-bottom: 1px solid rgba(233, 30, 99, 0.3);\n                background: rgba(233, 30, 99, 0.1);\n                border-radius: 10px 10px 0 0;\n            }\n\n            .maze-quest-header h3 {\n                margin: 0;\n                color: #e91e63;\n                font-size: 16px;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n\n            .maze-quest-close {\n                background: none;\n                border: none;\n                color: #888;\n                font-size: 24px;\n                cursor: pointer;\n                padding: 0;\n                width: 28px;\n                height: 28px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: color 0.2s ease;\n            }\n\n            .maze-quest-close:hover {\n                color: #e91e63;\n            }\n\n            .maze-quest-content {\n                flex: 1;\n                overflow-y: auto;\n                padding: 16px;\n            }\n\n            .quest-tabs {\n                display: flex;\n                gap: 8px;\n                margin-bottom: 16px;\n            }\n\n            .quest-tab {\n                flex: 1;\n                padding: 8px 12px;\n                border: 1px solid #444;\n                background: rgba(0, 0, 0, 0.3);\n                color: #888;\n                font-size: 13px;\n                cursor: pointer;\n                border-radius: 6px;\n                transition: all 0.2s ease;\n            }\n\n            .quest-tab:hover {\n                background: rgba(233, 30, 99, 0.1);\n                color: #e91e63;\n                border-color: #e91e63;\n            }\n\n            .quest-tab.active {\n                background: rgba(233, 30, 99, 0.2);\n                color: #e91e63;\n                border-color: #e91e63;\n            }\n\n            .quest-list {\n                display: flex;\n                flex-direction: column;\n                gap: 12px;\n            }\n\n            .quest-card {\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid #333;\n                border-radius: 8px;\n                padding: 12px;\n                transition: all 0.2s ease;\n            }\n\n            .quest-card:hover {\n                border-color: #555;\n            }\n\n            .quest-card-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: flex-start;\n                margin-bottom: 8px;\n            }\n\n            .quest-card-title {\n                color: #fff;\n                font-size: 14px;\n                font-weight: bold;\n                margin: 0;\n            }\n\n            .quest-card-type {\n                font-size: 11px;\n                color: #888;\n                background: rgba(0, 0, 0, 0.3);\n                padding: 2px 8px;\n                border-radius: 10px;\n            }\n\n            .quest-card-description {\n                color: #aaa;\n                font-size: 12px;\n                margin-bottom: 10px;\n                line-height: 1.4;\n            }\n\n            .quest-progress-bar {\n                height: 6px;\n                background: rgba(0, 0, 0, 0.4);\n                border-radius: 3px;\n                overflow: hidden;\n                margin-bottom: 8px;\n            }\n\n            .quest-progress-fill {\n                height: 100%;\n                background: linear-gradient(90deg, #e91e63, #ff6b9d);\n                border-radius: 3px;\n                transition: width 0.3s ease;\n            }\n\n            .quest-progress-text {\n                font-size: 11px;\n                color: #888;\n                margin-bottom: 8px;\n            }\n\n            .quest-rewards {\n                display: flex;\n                gap: 12px;\n                font-size: 12px;\n                color: #f1c40f;\n                margin-bottom: 10px;\n            }\n\n            .quest-reward-item {\n                display: flex;\n                align-items: center;\n                gap: 4px;\n            }\n\n            .quest-actions {\n                display: flex;\n                gap: 8px;\n            }\n\n            .quest-accept-btn,\n            .quest-abandon-btn {\n                padding: 6px 14px;\n                font-size: 12px;\n                border-radius: 4px;\n                cursor: pointer;\n                transition: all 0.2s ease;\n            }\n\n            .quest-accept-btn {\n                background: #e91e63;\n                color: #fff;\n                border: none;\n            }\n\n            .quest-accept-btn:hover {\n                background: #ff4081;\n            }\n\n            .quest-abandon-btn {\n                background: transparent;\n                color: #888;\n                border: 1px solid #555;\n            }\n\n            .quest-abandon-btn:hover {\n                color: #e74c3c;\n                border-color: #e74c3c;\n            }\n\n            .quest-empty-message {\n                text-align: center;\n                color: #666;\n                padding: 30px;\n                font-style: italic;\n            }\n\n            .quest-completed-badge {\n                display: inline-flex;\n                align-items: center;\n                gap: 4px;\n                color: #27ae60;\n                font-size: 12px;\n            }\n\n            .maze-quest-backdrop {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.6);\n                z-index: 10199;\n            }\n\n            /* Ability Bar */\n            .ability-bar {\n                position: absolute;\n                bottom: 10px;\n                left: 50%;\n                transform: translateX(-50%);\n                display: flex;\n                gap: 8px;\n                padding: 8px 12px;\n                background: rgba(20, 25, 35, 0.95);\n                border: 2px solid #444;\n                border-radius: 8px;\n                z-index: 150;\n            }\n\n            .ability-slot {\n                width: 60px;\n                height: 50px;\n                border-radius: 6px;\n                border: 2px solid #555;\n                background: rgba(0, 0, 0, 0.4);\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: center;\n                cursor: pointer;\n                transition: all 0.2s ease;\n                position: relative;\n            }\n\n            .ability-slot.ready {\n                border-color: var(--ability-color, #f39c12);\n                background: rgba(243, 156, 18, 0.15);\n            }\n\n            .ability-slot.ready:hover {\n                transform: translateY(-3px);\n                box-shadow: 0 4px 12px rgba(243, 156, 18, 0.3);\n            }\n\n            .ability-slot.on-cooldown {\n                border-color: #444;\n                opacity: 0.6;\n                cursor: not-allowed;\n            }\n\n            .ability-slot.empty {\n                border-color: #333;\n                opacity: 0.4;\n            }\n\n            .ability-hotkey {\n                position: absolute;\n                top: 2px;\n                left: 4px;\n                font-size: 10px;\n                color: #888;\n                font-weight: bold;\n            }\n\n            .ability-name {\n                font-size: 9px;\n                color: #fff;\n                text-align: center;\n                line-height: 1.1;\n                max-width: 55px;\n                overflow: hidden;\n                text-overflow: ellipsis;\n            }\n\n            .ability-cooldown {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                font-size: 18px;\n                font-weight: bold;\n                color: #e74c3c;\n                text-shadow: 0 0 5px rgba(0, 0, 0, 0.8);\n            }\n\n            .ability-empty {\n                font-size: 16px;\n                color: #444;\n            }\n\n            /* Inventory Dropdown from Info Button */\n            .maze-inventory-dropdown {\n                position: absolute;\n                top: calc(100% + 8px);\n                right: 0;\n                min-width: 220px;\n                max-height: 70vh;\n                overflow-y: auto;\n                background: rgba(20, 25, 35, 0.98);\n                border: 1px solid rgba(241, 196, 15, 0.3);\n                border-radius: 10px;\n                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);\n                backdrop-filter: blur(10px);\n                z-index: 10100;\n            }\n\n            .maze-inventory-dropdown.hidden {\n                display: none;\n            }\n\n            .maze-inventory-dropdown .inventory-menu-section {\n                padding: 8px 0;\n                border-bottom: 1px solid rgba(255, 255, 255, 0.08);\n            }\n\n            .maze-inventory-dropdown .inventory-menu-section:last-child {\n                border-bottom: none;\n            }\n\n            .maze-inventory-dropdown .inventory-menu-header {\n                padding: 4px 12px 6px;\n                font-size: 0.7em;\n                text-transform: uppercase;\n                letter-spacing: 0.5px;\n                color: #f1c40f;\n                font-weight: 600;\n            }\n\n            .maze-inventory-dropdown .inventory-menu-item {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                padding: 8px 12px;\n                cursor: pointer;\n                transition: background 0.15s ease;\n            }\n\n            .maze-inventory-dropdown .inventory-menu-item:hover {\n                background: rgba(255, 255, 255, 0.08);\n            }\n\n            .maze-inventory-dropdown .inventory-menu-item[data-usable="true"]:hover {\n                background: rgba(46, 204, 113, 0.15);\n            }\n\n            .maze-inventory-dropdown .inventory-menu-item i {\n                font-size: 14px;\n                width: 18px;\n                text-align: center;\n            }\n\n            .maze-inventory-dropdown .inventory-menu-item .item-name {\n                flex: 1;\n                font-size: 0.85em;\n                color: #ecf0f1;\n            }\n\n            .maze-inventory-dropdown .inventory-menu-item .item-count {\n                font-size: 0.85em;\n                font-weight: 600;\n                color: #f1c40f;\n                min-width: 20px;\n                text-align: right;\n            }\n\n            .maze-inventory-dropdown .inventory-menu-item.execute .item-name {\n                color: #e74c3c;\n            }\n\n            .maze-inventory-dropdown .inventory-menu-item.execute .item-count {\n                color: #e74c3c;\n            }\n\n            /* Save Dialog */\n            #maze_save_dialog {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                z-index: 1000;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .maze-save-dialog-backdrop {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.7);\n            }\n\n            .maze-save-dialog-content {\n                position: relative;\n                background: #1a1a2e;\n                border: 2px solid #4a90d9;\n                border-radius: 12px;\n                padding: 24px 32px;\n                text-align: center;\n                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);\n            }\n\n            .maze-save-dialog-title {\n                color: #fff;\n                font-size: 18px;\n                font-weight: 600;\n                margin-bottom: 20px;\n            }\n\n            .maze-save-dialog-buttons {\n                display: flex;\n                gap: 12px;\n                justify-content: center;\n            }\n\n            .maze-save-btn {\n                padding: 10px 24px;\n                border-radius: 6px;\n                border: none;\n                font-size: 14px;\n                font-weight: 600;\n                cursor: pointer;\n                transition: all 0.2s ease;\n            }\n\n            .maze-save-yes {\n                background: #27ae60;\n                color: #fff;\n            }\n\n            .maze-save-yes:hover {\n                background: #2ecc71;\n            }\n\n            .maze-save-no {\n                background: #e74c3c;\n                color: #fff;\n            }\n\n            .maze-save-no:hover {\n                background: #c0392b;\n            }\n\n            .maze-save-cancel {\n                background: #7f8c8d;\n                color: #fff;\n            }\n\n            .maze-save-cancel:hover {\n                background: #95a5a6;\n            }\n\n            /* Bottom Panel - Map Area */\n            .mazemaster-maze-bottom {\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                justify-content: flex-end;\n                flex: 1;\n                min-height: 200px;\n                padding-bottom: 15px;\n                overflow: auto;\n            }\n\n            /* Hero Section - Minion Area (fills remaining height) */\n            .mazemaster-maze-hero {\n                display: flex;\n                flex-direction: column;\n                flex: 1;\n                width: 100%;\n                background: rgba(0, 0, 0, 0.3);\n                border-radius: 8px;\n                padding: 10px 12px;\n                border: 1px solid #444;\n                min-height: 80px;\n            }\n\n            .maze-minion-name {\n                font-weight: bold;\n                font-size: 1.2em;\n                color: #e94560;\n                flex-shrink: 0;\n                margin-bottom: 0;\n            }\n\n            .maze-minion-role {\n                font-size: 0.8em;\n                color: #f1c40f;\n                flex-shrink: 0;\n                margin-bottom: 4px;\n            }\n\n            .mazemaster-maze-hero-content {\n                display: flex;\n                gap: 10px;\n                align-items: flex-start;\n                flex: 1;\n            }\n\n            .mazemaster-maze-hero-avatar {\n                width: 72px;\n                height: 72px;\n                min-width: 72px;\n                flex-shrink: 0;\n                border-radius: 6px;\n                overflow: hidden;\n                background: #16213e;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                position: relative;\n            }\n\n            .mazemaster-maze-hero-avatar img {\n                width: 100%;\n                height: 100%;\n                object-fit: cover;\n                object-position: center top;\n                display: block;\n            }\n\n            /* LLM Generating Indicator - overlays the entire image */\n            .maze-generating-indicator {\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background: rgba(52, 152, 219, 0.7);\n                border-radius: 8px;\n                display: none;\n                align-items: center;\n                justify-content: center;\n                z-index: 10;\n            }\n\n            .maze-generating-indicator.active {\n                display: flex;\n            }\n\n            .maze-generating-indicator i {\n                color: #fff;\n                font-size: 32px;\n                animation: maze-pulse 1s ease-in-out infinite;\n                text-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);\n            }\n\n            @keyframes maze-pulse {\n                0%, 100% { transform: scale(1); opacity: 1; }\n                50% { transform: scale(1.2); opacity: 0.7; }\n            }\n\n            .maze-message-log {\n                flex: 1;\n                color: #eee;\n                line-height: 1.4;\n                font-size: 0.9em;\n                overflow-y: auto;\n                max-height: 120px;\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n                padding-right: 4px;\n            }\n\n            .maze-message-log::-webkit-scrollbar {\n                width: 6px;\n            }\n\n            .maze-message-log::-webkit-scrollbar-track {\n                background: rgba(0, 0, 0, 0.2);\n                border-radius: 3px;\n            }\n\n            .maze-message-log::-webkit-scrollbar-thumb {\n                background: rgba(255, 255, 255, 0.3);\n                border-radius: 3px;\n            }\n\n            .maze-message-log::-webkit-scrollbar-thumb:hover {\n                background: rgba(255, 255, 255, 0.5);\n            }\n\n            .maze-message-entry {\n                padding: 4px 8px;\n                background: rgba(0, 0, 0, 0.2);\n                border-radius: 6px;\n                border-left: 3px solid rgba(52, 152, 219, 0.6);\n            }\n\n            .maze-message-entry:last-child {\n                border-left-color: rgba(46, 204, 113, 0.8);\n            }\n\n            .maze-message-speaker {\n                font-weight: 600;\n                color: #3498db;\n                font-size: 0.85em;\n                margin-bottom: 2px;\n            }\n\n            .maze-message-text {\n                font-style: italic;\n                color: #ecf0f1;\n            }\n\n            /* Stats Bar */\n            .mazemaster-maze-stats-bar {\n                display: flex;\n                justify-content: center;\n                flex-wrap: wrap;\n                gap: 12px;\n                width: 100%;\n                padding: 6px 12px;\n                background: linear-gradient(135deg, rgba(52, 73, 94, 0.4) 0%, rgba(44, 62, 80, 0.4) 100%);\n                border-radius: 8px;\n                border: 1px solid rgba(255, 255, 255, 0.1);\n            }\n\n            .stats-item {\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                font-size: 0.85em;\n                color: #bdc3c7;\n            }\n\n            .stats-item i {\n                color: #3498db;\n                font-size: 0.9em;\n            }\n\n            .stats-item span {\n                font-weight: 500;\n                color: #ecf0f1;\n            }\n\n            /* HP Bar Styles (v1.3.0) */\n            .stats-hp {\n                min-width: 120px;\n            }\n\n            .hp-bar-container {\n                position: relative;\n                width: 80px;\n                height: 16px;\n                background: rgba(0, 0, 0, 0.4);\n                border-radius: 8px;\n                overflow: hidden;\n                border: 1px solid rgba(255, 255, 255, 0.2);\n            }\n\n            .hp-bar-fill {\n                position: absolute;\n                top: 0;\n                left: 0;\n                height: 100%;\n                background: linear-gradient(90deg, #27ae60, #1e8449);\n                transition: width 0.3s ease, background 0.3s ease;\n                border-radius: 8px;\n            }\n\n            .hp-bar-fill.low {\n                background: linear-gradient(90deg, #e74c3c, #c0392b);\n                animation: hp-pulse 1s infinite;\n            }\n\n            .hp-bar-fill.medium {\n                background: linear-gradient(90deg, #f39c12, #d68910);\n            }\n\n            .hp-bar-fill.high {\n                background: linear-gradient(90deg, #27ae60, #1e8449);\n            }\n\n            .hp-bar-text {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                font-size: 0.7em;\n                font-weight: 600;\n                color: #fff;\n                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);\n                white-space: nowrap;\n            }\n\n            @keyframes hp-pulse {\n                0%, 100% { opacity: 1; }\n                50% { opacity: 0.6; }\n            }\n\n            /* Damage/Heal Flash Effects */\n            .maze-hp-flash {\n                position: fixed;\n                inset: 0;\n                pointer-events: none;\n                z-index: 9999;\n                animation: hp-flash 0.3s ease-out forwards;\n            }\n\n            .maze-hp-flash.damage {\n                background: radial-gradient(circle, rgba(231, 76, 60, 0.3) 0%, transparent 70%);\n            }\n\n            .maze-hp-flash.heal {\n                background: radial-gradient(circle, rgba(46, 204, 113, 0.3) 0%, transparent 70%);\n            }\n\n            @keyframes hp-flash {\n                from { opacity: 1; }\n                to { opacity: 0; }\n            }\n\n            /* Low HP Warning Border */\n            .mazemaster-maze-container.low-hp {\n                animation: low-hp-border 2s infinite;\n            }\n\n            @keyframes low-hp-border {\n                0%, 100% { box-shadow: inset 0 0 0 2px transparent; }\n                50% { box-shadow: inset 0 0 0 2px #e74c3c; }\n            }\n\n            /* ============================================= */\n            /* HP OVERLAY (upper-right of map) */\n            /* ============================================= */\n            .maze-hp-overlay {\n                position: absolute;\n                top: 8px;\n                right: 8px;\n                z-index: 100;\n                pointer-events: none;\n            }\n\n            .hp-overlay-bar {\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                padding: 6px 10px;\n                background: rgba(0, 0, 0, 0.6);\n                border-radius: 20px;\n                backdrop-filter: blur(4px);\n                border: 1px solid rgba(255, 255, 255, 0.15);\n            }\n\n            .hp-overlay-bar > i {\n                color: #e74c3c;\n                font-size: 14px;\n            }\n\n            .hp-overlay-bar-bg {\n                position: relative;\n                width: 70px;\n                height: 12px;\n                background: rgba(0, 0, 0, 0.5);\n                border-radius: 6px;\n                overflow: hidden;\n            }\n\n            .hp-overlay-bar-fill {\n                position: absolute;\n                top: 0;\n                left: 0;\n                height: 100%;\n                border-radius: 6px;\n                transition: width 0.3s ease, background 0.3s ease;\n            }\n\n            .hp-overlay-bar-fill.high {\n                background: linear-gradient(90deg, #27ae60, #2ecc71);\n            }\n\n            .hp-overlay-bar-fill.medium {\n                background: linear-gradient(90deg, #f39c12, #f1c40f);\n            }\n\n            .hp-overlay-bar-fill.low {\n                background: linear-gradient(90deg, #c0392b, #e74c3c);\n                animation: hp-pulse 1s infinite;\n            }\n\n            .hp-overlay-text {\n                font-size: 11px;\n                font-weight: 600;\n                color: #fff;\n                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);\n                white-space: nowrap;\n                min-width: 45px;\n                text-align: center;\n            }\n\n            /* ============================================= */\n            /* INVENTORY OVERLAY (upper-left of map) */\n            /* ============================================= */\n            .maze-inventory-overlay {\n                position: absolute;\n                top: 8px;\n                left: 8px;\n                z-index: 100;\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n                pointer-events: none;\n            }\n\n            .inv-overlay-item {\n                display: flex;\n                align-items: center;\n                gap: 4px;\n                padding: 4px 8px;\n                background: rgba(0, 0, 0, 0.6);\n                border-radius: 12px;\n                backdrop-filter: blur(4px);\n                border: 1px solid rgba(255, 255, 255, 0.1);\n                font-size: 12px;\n            }\n\n            .inv-overlay-item i {\n                font-size: 12px;\n                width: 14px;\n                text-align: center;\n            }\n\n            .inv-overlay-item span {\n                font-weight: 600;\n                color: #fff;\n                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);\n                min-width: 16px;\n                text-align: center;\n            }\n\n            .inv-overlay-item.execute {\n                border-color: rgba(231, 76, 60, 0.4);\n            }\n\n            .inv-overlay-item.execute i {\n                animation: star-glow 2s ease-in-out infinite;\n            }\n\n            @keyframes star-glow {\n                0%, 100% { filter: drop-shadow(0 0 2px #e74c3c); }\n                50% { filter: drop-shadow(0 0 6px #e74c3c); }\n            }\n\n            /* Hide items with 0 count */\n            .inv-overlay-item span:empty,\n            .inv-overlay-item[data-count="0"] {\n                display: none;\n            }\n\n            /* ============================================= */\n            /* EQUIPMENT OVERLAY (bottom-left of map) v1.5.0 */\n            /* ============================================= */\n            .maze-equipment-overlay {\n                position: absolute;\n                bottom: 8px;\n                left: 8px;\n                z-index: 100;\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n                background: rgba(0, 0, 0, 0.7);\n                border-radius: 8px;\n                padding: 8px;\n                backdrop-filter: blur(4px);\n                border: 1px solid rgba(255, 255, 255, 0.1);\n                min-width: 140px;\n            }\n\n            .equip-overlay-header {\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                font-size: 11px;\n                color: #e67e22;\n                font-weight: 600;\n                padding-bottom: 4px;\n                border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n            }\n\n            .equip-stats-summary {\n                font-size: 10px;\n                color: #95a5a6;\n                margin-left: auto;\n            }\n\n            .equip-stats-summary span {\n                margin-left: 4px;\n            }\n\n            #maze_equip_total_atk { color: #e74c3c; }\n            #maze_equip_total_def { color: #3498db; }\n            #maze_equip_total_crit { color: #f1c40f; }\n\n            .equip-slots {\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n            }\n\n            .equip-slot {\n                cursor: pointer;\n                transition: all 0.2s ease;\n            }\n\n            .equip-slot:hover {\n                transform: translateX(2px);\n            }\n\n            .equip-item {\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                padding: 4px 8px;\n                background: rgba(0, 0, 0, 0.4);\n                border-radius: 6px;\n                border: 1px solid rgba(255, 255, 255, 0.1);\n                font-size: 11px;\n            }\n\n            .equip-item.empty {\n                color: #7f8c8d;\n            }\n\n            .equip-item.equipped {\n                color: #2ecc71;\n                border-color: rgba(46, 204, 113, 0.3);\n            }\n\n            .equip-item i {\n                width: 14px;\n                text-align: center;\n            }\n\n            .equip-name {\n                flex: 1;\n            }\n\n            .equip-inventory-toggle {\n                margin-top: 4px;\n            }\n\n            .equip-toggle-btn {\n                width: 100%;\n                padding: 4px 8px;\n                font-size: 10px;\n                background: rgba(52, 152, 219, 0.2);\n                border: 1px solid rgba(52, 152, 219, 0.3);\n                border-radius: 4px;\n                color: #3498db;\n                cursor: pointer;\n                transition: all 0.2s ease;\n            }\n\n            .equip-toggle-btn:hover {\n                background: rgba(52, 152, 219, 0.3);\n            }\n\n            .equip-inventory-dropdown {\n                margin-top: 4px;\n                max-height: 150px;\n                overflow-y: auto;\n                background: rgba(0, 0, 0, 0.4);\n                border-radius: 4px;\n                padding: 4px;\n            }\n\n            .equip-inv-empty {\n                text-align: center;\n                font-size: 10px;\n                color: #7f8c8d;\n                padding: 8px;\n            }\n\n            .equip-inv-item {\n                display: flex;\n                align-items: center;\n                gap: 4px;\n                padding: 4px 6px;\n                margin-bottom: 2px;\n                background: rgba(0, 0, 0, 0.3);\n                border-radius: 4px;\n                font-size: 10px;\n                border-left: 2px solid transparent;\n            }\n\n            .equip-inv-item.rarity-common { border-left-color: #95a5a6; }\n            .equip-inv-item.rarity-uncommon { border-left-color: #2ecc71; }\n            .equip-inv-item.rarity-rare { border-left-color: #3498db; }\n            .equip-inv-item.rarity-epic { border-left-color: #9b59b6; }\n\n            .equip-inv-item .item-name {\n                flex: 1;\n                color: #ecf0f1;\n            }\n\n            .equip-inv-item .item-stats {\n                color: #7f8c8d;\n                font-size: 9px;\n            }\n\n            .equip-btn {\n                padding: 2px 6px;\n                font-size: 9px;\n                background: rgba(46, 204, 113, 0.2);\n                border: 1px solid rgba(46, 204, 113, 0.3);\n                border-radius: 3px;\n                color: #2ecc71;\n                cursor: pointer;\n            }\n\n            .equip-btn:hover {\n                background: rgba(46, 204, 113, 0.4);\n            }\n\n            /* Objectives Section */\n            .maze-objectives-section {\n                width: 550px;\n                max-width: 95vw;\n                padding: 8px 12px;\n                background: linear-gradient(135deg, rgba(52, 73, 94, 0.4) 0%, rgba(44, 62, 80, 0.4) 100%);\n                border-radius: 8px;\n                border: 1px solid rgba(255, 255, 255, 0.1);\n            }\n\n            .maze-objectives-section.hidden {\n                display: none;\n            }\n\n            .maze-objectives-section .objectives-header {\n                display: flex;\n                align-items: center;\n                gap: 6px;\n                font-size: 0.8em;\n                color: #95a5a6;\n                margin-bottom: 6px;\n            }\n\n            .maze-objectives-section .objectives-list {\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n            }\n\n            .maze-objectives-section .objective-item {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                font-size: 0.85em;\n                padding: 4px 8px;\n                background: rgba(0, 0, 0, 0.2);\n                border-radius: 4px;\n            }\n\n            .maze-objectives-section .objective-item i {\n                font-size: 0.9em;\n            }\n\n            .maze-objectives-section .objective-description {\n                flex: 1;\n            }\n\n            .maze-objectives-section .objective-progress {\n                font-weight: 500;\n                font-size: 0.9em;\n            }\n\n            .maze-objectives-section .objective-required i {\n                color: #e74c3c;\n            }\n\n            .maze-objectives-section .objective-optional i {\n                color: #95a5a6;\n            }\n\n            .maze-objectives-section .objective-complete {\n                opacity: 0.7;\n            }\n\n            .maze-objectives-section .objective-complete i {\n                color: #27ae60 !important;\n            }\n\n            .maze-objectives-section.objectives-flash {\n                animation: objectives-flash-anim 0.5s ease-out;\n            }\n\n            @keyframes objectives-flash-anim {\n                0%, 100% {\n                    border-color: rgba(255, 255, 255, 0.1);\n                }\n                50% {\n                    border-color: #e74c3c;\n                    box-shadow: 0 0 10px rgba(231, 76, 60, 0.5);\n                }\n            }\n\n            /* Player Overlay for Smooth Movement Animation */\n            .maze-player-overlay {\n                position: absolute;\n                top: 2px;\n                left: 2px;\n                pointer-events: none;\n                z-index: 10;\n                transition: transform 0.15s ease-out;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .maze-player-marker {\n                width: 60%;\n                height: 60%;\n                background: radial-gradient(circle, #4ecdc4 0%, #2d8f8f 100%);\n                border-radius: 50%;\n                box-shadow: 0 0 10px rgba(78, 205, 196, 0.6), 0 0 20px rgba(78, 205, 196, 0.3);\n                animation: player-pulse 1.5s ease-in-out infinite;\n            }\n\n            @keyframes player-pulse {\n                0%, 100% { transform: scale(1); opacity: 1; }\n                50% { transform: scale(1.1); opacity: 0.9; }\n            }\n\n            .maze-player-overlay.teleporting .maze-player-marker {\n                animation: teleport-flash 0.2s ease-out;\n            }\n\n            @keyframes teleport-flash {\n                0% { opacity: 1; transform: scale(1); }\n                50% { opacity: 0; transform: scale(0.2); }\n                100% { opacity: 1; transform: scale(1); }\n            }\n\n            /* Control Bar */\n            .maze-action-buttons {\n                display: flex;\n                gap: 6px;\n                justify-content: center;\n                flex-wrap: wrap;\n            }\n\n            .mazemaster-maze-inventory {\n                display: flex;\n                flex-wrap: wrap;\n                justify-content: space-evenly;\n                background: rgba(0, 0, 0, 0.3);\n                padding: 8px 12px;\n                border-radius: 6px;\n            }\n\n            .inventory-item {\n                display: flex;\n                align-items: center;\n                gap: 4px;\n                font-size: 0.9em;\n            }\n\n            /* Inventory item icon colors */\n            .inventory-item i.fa-key { color: #f1c40f; }\n            .inventory-item i.fa-user-ninja { color: #9b59b6; }\n            .inventory-item i.fa-bolt { color: #e74c3c; }\n            .inventory-item.execute i { color: #ffd700; text-shadow: 0 0 4px #ffd700; }\n            .inventory-item.floor-key i { color: #3498db; }\n            .inventory-item.portal-stone i { color: #9b59b6; }\n            .inventory-item.minion-bane i { color: #c0392b; }\n            .inventory-item.map-fragment i { color: #27ae60; }\n            .inventory-item.time-shard i { color: #f39c12; }\n            .inventory-item.void-walk i { color: #7f8c8d; }\n\n            /* Inventory expand icon */\n            .inventory-expand-icon {\n                margin-left: auto;\n                padding-left: 8px;\n                color: #888;\n                cursor: pointer;\n                transition: transform 0.2s;\n            }\n            .mazemaster-maze-inventory.expanded .inventory-expand-icon {\n                transform: rotate(180deg);\n            }\n            .mazemaster-maze-inventory {\n                cursor: pointer;\n            }\n\n            /* Inventory Drawer */\n            .maze-inventory-drawer {\n                position: absolute;\n                top: 100%;\n                left: 0;\n                right: 0;\n                background: rgba(26, 26, 46, 0.98);\n                border: 1px solid #444;\n                border-top: none;\n                border-radius: 0 0 8px 8px;\n                padding: 10px 12px;\n                z-index: 200;\n                max-height: 300px;\n                overflow-y: auto;\n                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);\n            }\n            .maze-inventory-drawer.hidden {\n                display: none;\n            }\n            .inventory-drawer-content {\n                display: flex;\n                flex-direction: column;\n                gap: 6px;\n            }\n            .inventory-drawer-item {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                padding: 6px 8px;\n                background: rgba(255, 255, 255, 0.05);\n                border-radius: 4px;\n            }\n            .inventory-drawer-item.empty {\n                opacity: 0.4;\n            }\n            .inventory-drawer-item i {\n                width: 20px;\n                text-align: center;\n            }\n            .inventory-drawer-item .item-name {\n                flex: 1;\n                font-size: 0.9em;\n            }\n            .inventory-drawer-item .item-count {\n                font-weight: bold;\n                min-width: 24px;\n                text-align: right;\n            }\n            /* Drawer item icon colors - match the bar */\n            .inventory-drawer-item i.fa-key { color: #f1c40f; }\n            .inventory-drawer-item i.fa-user-ninja { color: #9b59b6; }\n            .inventory-drawer-item i.fa-bolt { color: #e74c3c; }\n            .inventory-drawer-item.execute i { color: #ffd700; text-shadow: 0 0 4px #ffd700; }\n            .inventory-drawer-item.floor-key i { color: #3498db; }\n            .inventory-drawer-item.portal-stone i { color: #9b59b6; }\n            .inventory-drawer-item.minion-bane i { color: #c0392b; }\n            .inventory-drawer-item.map-fragment i { color: #27ae60; }\n            .inventory-drawer-item.time-shard i { color: #f39c12; }\n            .inventory-drawer-item.void-walk i { color: #7f8c8d; }\n\n            /* Usable items have click cursor and glow */\n            .inventory-item[data-usable="true"] {\n                cursor: pointer;\n                transition: transform 0.2s, box-shadow 0.2s;\n            }\n            .inventory-item[data-usable="true"]:hover {\n                transform: scale(1.1);\n                text-shadow: 0 0 8px currentColor;\n            }\n            .inventory-item.hidden { display: none; }\n\n            .mazemaster-maze-save-exit {\n                display: flex;\n                gap: 8px;\n                justify-content: center;\n                margin-top: auto;\n                padding-top: 10px;\n            }\n\n            /* Maze Area */\n            .mazemaster-maze-area {\n                position: relative; /* Required for action popup overlay positioning */\n                width: 100%;\n                height: 100%;\n                overflow: hidden;\n                cursor: grab;\n                user-select: none;\n                background: #0a0a1a;\n                border-radius: 8px;\n            }\n\n            .mazemaster-maze-grid-wrapper {\n                position: absolute;\n                top: 0;\n                left: 0;\n                /* Position controlled by JS transforms */\n            }\n\n            /* Circular D-Pad */\n            .maze-dpad {\n                position: absolute;\n                bottom: 60px;\n                right: 20px;\n                width: 140px;\n                height: 140px;\n                z-index: 100;\n            }\n\n            .maze-dpad.floating {\n                position: fixed;\n                z-index: 10001;\n                bottom: 100px;\n                right: 20px;\n            }\n\n            .dpad-ring {\n                position: relative;\n                width: 100%;\n                height: 100%;\n                border-radius: 50%;\n                background: radial-gradient(circle, #2c3e50 0%, #1a1a2e 100%);\n                border: 3px solid var(--theme-primary, #3498db);\n                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);\n            }\n\n            .dpad-btn {\n                position: absolute;\n                width: 40px;\n                height: 40px;\n                border-radius: 50%;\n                background: linear-gradient(to bottom, var(--theme-primary, #3498db), var(--theme-secondary, #2980b9));\n                border: 2px solid var(--theme-accent, #5dade2);\n                color: white;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: all 0.15s;\n                font-size: 1em;\n            }\n\n            .dpad-btn:hover {\n                filter: brightness(1.2);\n            }\n\n            .dpad-btn:active {\n                filter: brightness(0.9);\n            }\n\n            .dpad-up { top: 5px; left: 50%; transform: translateX(-50%); }\n            .dpad-up:hover { transform: translateX(-50%) scale(1.1); }\n            .dpad-up:active { transform: translateX(-50%) scale(0.95); }\n\n            .dpad-right { right: 5px; top: 50%; transform: translateY(-50%); }\n            .dpad-right:hover { transform: translateY(-50%) scale(1.1); }\n            .dpad-right:active { transform: translateY(-50%) scale(0.95); }\n\n            .dpad-down { bottom: 5px; left: 50%; transform: translateX(-50%); }\n            .dpad-down:hover { transform: translateX(-50%) scale(1.1); }\n            .dpad-down:active { transform: translateX(-50%) scale(0.95); }\n\n            .dpad-left { left: 5px; top: 50%; transform: translateY(-50%); }\n            .dpad-left:hover { transform: translateY(-50%) scale(1.1); }\n            .dpad-left:active { transform: translateY(-50%) scale(0.95); }\n\n            .dpad-center {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                width: 30px;\n                height: 30px;\n                border-radius: 50%;\n                background: #1a1a2e;\n                border: 2px solid #34495e;\n            }\n\n            /* Floor navigation buttons - appear on LEFT side of D-pad when on stairs */\n            .dpad-floor-up, .dpad-floor-down {\n                position: absolute;\n                width: 36px;\n                height: 36px;\n                border-radius: 8px;\n                font-size: 0.65em;\n                background: linear-gradient(to bottom, #27ae60, #1e8449);\n                border: 2px solid #2ecc71;\n                flex-direction: column;\n                gap: 1px;\n                z-index: 10;\n                box-shadow: 0 2px 8px rgba(46, 204, 113, 0.5);\n                left: -50px;\n            }\n\n            .dpad-floor-up {\n                top: 15px;\n            }\n            .dpad-floor-up:hover {\n                transform: scale(1.1);\n                box-shadow: 0 4px 12px rgba(46, 204, 113, 0.7);\n            }\n            .dpad-floor-up:active {\n                transform: scale(0.95);\n            }\n\n            .dpad-floor-down {\n                bottom: 15px;\n                background: linear-gradient(to bottom, #e67e22, #d35400);\n                border-color: #f39c12;\n                box-shadow: 0 2px 8px rgba(243, 156, 18, 0.5);\n            }\n            .dpad-floor-down:hover {\n                transform: scale(1.1);\n                box-shadow: 0 4px 12px rgba(243, 156, 18, 0.7);\n            }\n            .dpad-floor-down:active {\n                transform: scale(0.95);\n            }\n\n            .dpad-floor-up.hidden, .dpad-floor-down.hidden {\n                display: none !important;\n            }\n\n            .dpad-floor-up span, .dpad-floor-down span {\n                font-size: 0.65em;\n                font-weight: bold;\n            }\n\n            .dpad-drag-handle {\n                position: absolute;\n                bottom: -22px;\n                left: 50%;\n                transform: translateX(-50%);\n                padding: 3px 8px;\n                background: rgba(0, 0, 0, 0.5);\n                border-radius: 4px;\n                color: #666;\n                font-size: 0.75em;\n                cursor: grab;\n                display: none;\n            }\n\n            .maze-dpad.floating .dpad-drag-handle {\n                display: block;\n            }\n\n            .maze-dpad:not(.floating) .dpad-drag-handle {\n                display: none;\n            }\n\n            /* Rest button - positioned top-right corner, away from directional buttons */\n            .dpad-rest-btn {\n                position: absolute;\n                top: -15px;\n                right: -15px;\n                width: 36px;\n                height: 36px;\n                border-radius: 50%;\n                background: linear-gradient(135deg, #14b8a6, #0d9488);\n                border: 2px solid #2dd4bf;\n                color: #fff;\n                font-size: 14px;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                box-shadow: 0 2px 8px rgba(20, 184, 166, 0.4);\n                transition: all 0.2s ease;\n                z-index: 10;\n            }\n\n            .dpad-rest-btn:hover:not(:disabled) {\n                transform: scale(1.1);\n                box-shadow: 0 4px 12px rgba(20, 184, 166, 0.6);\n            }\n\n            .dpad-rest-btn:active:not(:disabled) {\n                transform: scale(0.95);\n            }\n\n            .dpad-rest-btn:disabled {\n                background: linear-gradient(135deg, #6b7280, #4b5563);\n                border-color: #9ca3af;\n                cursor: not-allowed;\n                opacity: 0.7;\n            }\n\n            .dpad-rest-btn .rest-cooldown-badge {\n                position: absolute;\n                bottom: -4px;\n                right: -4px;\n                min-width: 16px;\n                height: 16px;\n                padding: 0 4px;\n                background: #ef4444;\n                border-radius: 8px;\n                font-size: 10px;\n                font-weight: bold;\n                color: #fff;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            /* Void Walk active indicator */\n            .maze-dpad.void-walk-active .dpad-ring {\n                animation: void-walk-pulse 1s infinite;\n                border-color: #7f8c8d;\n            }\n            .maze-dpad.void-walk-active .dpad-btn {\n                background: linear-gradient(to bottom, #7f8c8d, #5d6d7e);\n                border-color: #95a5a6;\n            }\n            @keyframes void-walk-pulse {\n                0%, 100% { box-shadow: 0 4px 15px rgba(127, 140, 141, 0.5); }\n                50% { box-shadow: 0 4px 25px rgba(127, 140, 141, 0.8); }\n            }\n\n            .mazemaster-maze-grid {\n                display: grid;\n                gap: 0;\n                background: #333;\n                padding: 2px;\n                border-radius: 5px;\n                border: 2px solid #555;\n            }\n\n            .maze-cell {\n                width: ').concat(g,"px;\n                height: ").concat(g,"px;\n                background: #1a1a2e;\n                position: relative;\n                box-sizing: border-box;\n            }\n\n            .maze-cell.hidden {\n                background: #0a0a0a;\n            }\n\n            .maze-cell.completely-hidden {\n                background: transparent;\n                border: none !important;\n                visibility: hidden;\n            }\n\n            .maze-cell.wall-top { border-top: 2px solid #fff; }\n            .maze-cell.wall-right { border-right: 2px solid #fff; }\n            .maze-cell.wall-bottom { border-bottom: 2px solid #fff; }\n            .maze-cell.wall-left { border-left: 2px solid #fff; }\n\n            /* Player marker now handled by .maze-player-overlay for smooth animation */\n            .maze-cell.player {\n                /* Player position cell styling - marker is in overlay */\n            }\n\n            .maze-cell.exit::before {\n                content: '';\n                position: absolute;\n                top: 50%; left: 50%;\n                transform: translate(-50%, -50%);\n                width: 70%; height: 70%;\n                background: #27ae60;\n                border-radius: 3px;\n            }\n\n            .maze-cell.visited:not(.hidden) {\n                background: #1e2a4a;\n            }\n\n            /* Legacy arrow buttons (kept for backwards compatibility) */\n            .maze-arrow-btn {\n                display: none; /* Hide legacy buttons */\n            }\n\n            /* Action buttons */\n            .maze-action-btn {\n                padding: 8px 14px;\n                font-size: 0.85em;\n                border-radius: 5px;\n                display: inline-flex;\n                align-items: center;\n                justify-content: center;\n                gap: 6px;\n            }\n\n            .maze-exit-btn {\n                background: linear-gradient(to bottom, #555, #444) !important;\n            }\n\n            .maze-close-btn {\n                padding: 10px 28px;\n                font-size: 1em;\n            }\n\n            /* =====================================================\n               ACTION POPUP OVERLAY (over map)\n               ===================================================== */\n            .maze-action-popup {\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                background: rgba(0, 0, 0, 0.75);\n                z-index: 100;\n                backdrop-filter: blur(3px);\n                animation: popupFadeIn 0.2s ease-out;\n            }\n\n            @keyframes popupFadeIn {\n                from { opacity: 0; }\n                to { opacity: 1; }\n            }\n\n            .maze-action-popup-content {\n                background: linear-gradient(145deg, #2a2a3a, #1a1a2a);\n                border: 2px solid #4a4a6a;\n                border-radius: 12px;\n                padding: 20px 30px;\n                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 0 20px rgba(100, 100, 200, 0.2);\n                min-width: 200px;\n                max-width: 90%;\n            }\n\n            .maze-action-popup-buttons {\n                display: flex;\n                flex-direction: column;\n                gap: 10px;\n                align-items: stretch;\n            }\n\n            .maze-action-popup-buttons .menu_button,\n            .maze-action-popup-buttons .maze-confirm-btn {\n                padding: 12px 24px;\n                font-size: 1.1em;\n                font-weight: 600;\n                border-radius: 8px;\n                text-transform: uppercase;\n                letter-spacing: 0.5px;\n                transition: all 0.15s ease;\n                min-width: 150px;\n            }\n\n            .maze-action-popup-buttons .menu_button:hover,\n            .maze-action-popup-buttons .maze-confirm-btn:hover {\n                transform: scale(1.05);\n                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n            }\n\n            .maze-action-popup-buttons .maze-accept-btn {\n                background: linear-gradient(145deg, #2ecc71, #27ae60) !important;\n                border-color: #27ae60 !important;\n            }\n\n            .maze-action-popup-buttons .maze-slip-btn {\n                background: linear-gradient(145deg, #9b59b6, #8e44ad) !important;\n                border-color: #8e44ad !important;\n            }\n\n            .maze-cell.victory-glow {\n                animation: victoryPulse 1s infinite;\n            }\n\n            @keyframes victoryPulse {\n                0%, 100% { background: #27ae60; }\n                50% { background: #2ecc71; }\n            }\n\n            /* =====================================================\n               MOBILE / PORTRAIT LAYOUT (v1.2.0)\n               ===================================================== */\n            .layout-mobile .mazemaster-maze-container,\n            #mazemaster_maze_modal.layout-mobile .mazemaster-maze-container {\n                width: 100vw;\n                height: 100vh;\n                max-width: 100vw;\n                max-height: 100vh;\n                padding: 8px;\n                gap: 6px;\n                border-radius: 0;\n                margin: 0;\n            }\n\n            .layout-mobile .mazemaster-maze-top {\n                flex-direction: column;\n                max-height: none;\n                gap: 8px;\n            }\n\n            .layout-mobile .mazemaster-maze-hero {\n                width: 100%;\n                max-width: 100%;\n                min-width: unset;\n            }\n\n            .layout-mobile .mazemaster-maze-info-col {\n                width: 100%;\n            }\n\n            .layout-mobile .mazemaster-maze-buttons-col {\n                flex-direction: row;\n                width: 100%;\n                justify-content: center;\n            }\n\n            .layout-mobile .mazemaster-maze-stats-bar {\n                flex-wrap: wrap;\n                gap: 6px;\n                justify-content: center;\n            }\n\n            .layout-mobile .mazemaster-maze-inventory {\n                flex-wrap: wrap;\n                justify-content: center;\n            }\n\n            .layout-mobile .maze-action-buttons {\n                flex-wrap: wrap;\n                justify-content: center;\n            }\n\n            .layout-mobile .maze-dpad {\n                position: fixed;\n                bottom: 90px;\n                right: 10px;\n                z-index: 10000;\n            }\n\n            /* Make grid scrollable on mobile */\n            .layout-mobile .maze-grid-area {\n                overflow: auto;\n                max-height: 50vh;\n            }\n\n            /* Larger touch targets on mobile */\n            .layout-mobile .dpad-btn {\n                min-width: 50px;\n                min-height: 50px;\n            }\n\n            @media (max-width: 600px) {\n                .mazemaster-maze-hero {\n                    height: auto;\n                    min-height: 80px;\n                }\n\n                .maze-message-log {\n                    font-size: 0.85em;\n                    max-height: 80px;\n                }\n\n                .stats-item {\n                    font-size: 0.75em;\n                    padding: 3px 6px;\n                }\n\n                .inventory-item {\n                    padding: 4px 6px;\n                    font-size: 0.85em;\n                }\n            }\n        </style>\n    "),document.body.appendChild(f),console.log("[MazeMaster] Modal appended to body");const y=R.getRenderer();console.log("[MazeMaster] Renderer type:",(null==y||null===(c=y.constructor)||void 0===c?void 0:c.name)||"unknown");const v=document.getElementById("maze_grid_container");if(console.log("[MazeMaster] Grid container found:",!!v),v){v.innerHTML=y.getGridHTML(jt.size),console.log("[MazeMaster] Grid HTML inserted");const e=y.getPlayerOverlayHTML(g);e&&v.insertAdjacentHTML("beforeend",e),y.init(v,jt),console.log("[MazeMaster] Renderer initialized")}H(),console.log("[MazeMaster] showMazeModal() complete"),f.querySelectorAll(".dpad-btn").forEach((e=>{e.addEventListener("click",(()=>{const t=e.dataset.dir;"up"===t?Ai(0,-1):"down"===t?Ai(0,1):"left"===t?Ai(-1,0):"right"===t?Ai(1,0):"floor-up"===t?ye("up"):"floor-down"===t&&ye("down")})),e.addEventListener("touchend",(t=>{t.preventDefault(),e.click()}))})),he();const b=document.getElementById("maze_rest_btn");b&&(b.addEventListener("click",(()=>Q())),b.addEventListener("touchend",(e=>{e.preventDefault(),Q()}))),J(),ge();const z=document.getElementById("mazemaster_minimap_toggle");z&&z.addEventListener("click",(()=>function(){var e;if(null===(e=jt)||void 0===e||!e.minimap)return;jt.minimap.enabled=!jt.minimap.enabled;const t=document.getElementById("mazemaster_minimap_container");t&&(t.style.display=jt.minimap.enabled?"block":"none")}())),Ia();const _=document.getElementById("maze_inventory_wrapper"),x=document.getElementById("maze_inventory_btn"),k=document.getElementById("maze_inventory_menu");x&&k&&(x.addEventListener("click",(e=>{e.stopPropagation();!k.classList.contains("hidden")?(k.classList.add("hidden"),null==_||_.classList.remove("open")):(k.classList.remove("hidden"),null==_||_.classList.add("open"))})),document.addEventListener("click",(e=>{null!=_&&_.contains(e.target)||(k.classList.add("hidden"),null==_||_.classList.remove("open"))})));f.querySelectorAll('.inventory-menu-item[data-usable="true"]').forEach((e=>{e.addEventListener("click",(async t=>{t.stopPropagation();const a=e.dataset.item,n=e.dataset.hpItem;n?await ee(n):"portalStone"===a?await async function(){if(!jt||jt.isPaused)return!1;if(!jt.inventory.portalStone||jt.inventory.portalStone<=0)return console.log("[MazeMaster] No Portal Stones available"),!1;const e=[];for(const a of jt.visited){var t;const[n,o]=a.split(",").map(Number),i=null===(t=jt.grid[o])||void 0===t?void 0:t[n];null==i||!i.portal||n===jt.playerX&&o===jt.playerY||e.push({x:n,y:o,portal:i.portal})}if(0===e.length)return jt.currentMinion={name:"Portal Stone",imagePath:"",message:"No revealed portals to teleport to. Explore more to find portals first!"},Ii(),!1;if(1===e.length){const t=e[0];return await be(t.x,t.y),!0}const a=e[0];return await be(a.x,a.y),!0}():"mapFragment"===a?await async function(){if(!jt||jt.isPaused)return!1;if(!jt.inventory.mapFragment||jt.inventory.mapFragment<=0)return console.log("[MazeMaster] No Map Fragments available"),!1;const{playerX:e,playerY:t,grid:a,size:n}=jt;let o=0;for(let i=-1;i<=1;i++)for(let r=-1;r<=1;r++){const s=e+r,l=t+i;if(s>=0&&s<n&&l>=0&&l<n){const e="".concat(s,",").concat(l);jt.visited.has(e)||(jt.visited.add(e),a[l][s].visited=!0,o++)}}return await Hi("mapFragment",1),wi(),jt.currentMinion={name:"Map Fragment",imagePath:"",message:o>0?"The ancient map reveals ".concat(o," hidden area").concat(o>1?"s":"","!"):"The map shows only what you already knew."},Ii(),await Y("onItemRemove",{item:"mapFragment",count:1,total:jt.inventory.mapFragment}),!0}():"voidWalk"===a?function(){if(!jt||jt.isPaused)return!1;if(!jt.inventory.voidWalk||jt.inventory.voidWalk<=0)return console.log("[MazeMaster] No Void Walk available"),!1;if(jt.voidWalkActive)return console.log("[MazeMaster] Void Walk already active"),!1;jt.voidWalkActive=!0;const e=document.getElementById("maze_dpad");e&&e.classList.add("void-walk-active"),jt.currentMinion={name:"Void Walk",imagePath:"",message:"You become ethereal... Your next move can phase through walls!"},Ii()}():e.dataset.visItem&&await async function(e){var t;if(!jt.isOpen)return;if(!jt.inventory[e]||jt.inventory[e]<=0)return;const a=Xe(e);if(!a)return;const n=nt(e,(null===(t=jt.profile)||void 0===t?void 0:t.theme)||"fantasy");jt.visibility||(jt.visibility={baseRadius:1,tempBonus:0,tempMovesLeft:0,permBonus:0,floorRevealed:!1});const o=a.effect;if("tempVisibility"===o)await Hi(e),jt.visibility.tempBonus=a.visibilityBonus||2,jt.visibility.tempMovesLeft=a.duration||3,Si("Item","".concat(n," lit! +").concat(a.visibilityBonus||2," visibility for ").concat(a.duration||3," moves."));else if("revealFloor"===o){await Hi(e),jt.visibility.floorRevealed=!0;const t=jt.grid.length,a="".concat(jt.currentFloor,":");for(let e=0;e<t;e++)for(let n=0;n<t;n++)jt.visited.add("".concat(a).concat(n,",").concat(e));Si("Item","The ".concat(n," reveals the entire floor!"))}else if("permanentVisibility"===o||"sightPotion"===e){await Hi(e);const t=a.visibilityBonus||1;jt.visibility.permBonus=(jt.visibility.permBonus||0)+t,Si("Item","Your vision sharpens! Permanent +".concat(t," visibility."))}else if("revealMinions"===o||"crystalBall"===e){await Hi(e);const t=[],a=jt.grid.length,o="".concat(jt.currentFloor,":");for(let e=0;e<a;e++)for(let n=0;n<a;n++){const a=jt.grid[e][n];a.minion&&!a.minion.triggered&&(jt.visited.add("".concat(o).concat(n,",").concat(e)),t.push(a.minion.name||"Unknown"))}t.length>0?Si("Item","".concat(n," reveals ").concat(t.length," minion(s)!")):Si("Item","".concat(n," shows no minions remain on this floor."))}else if("passiveVisibility"===o||a.passive){const e=a.visibilityBonus||1;return void Si("Info","".concat(n," provides passive +").concat(e," visibility while held."))}renderMaze()}(e.dataset.visItem),null==k||k.classList.add("hidden"),null==_||_.classList.remove("open")}))}));const C=document.getElementById("maze_equip_toggle"),w=document.getElementById("maze_equipment_inventory");C&&w&&C.addEventListener("click",(()=>{const e="none"!==w.style.display;w.style.display=e?"none":"block",C.innerHTML=e?'<i class="fa-solid fa-backpack"></i> Backpack':'<i class="fa-solid fa-times"></i> Close'}));const E=f.querySelectorAll(".equip-slot");console.log("[MazeMaster] Found",E.length,"equipment slots to attach click handlers"),E.forEach((e=>{e.addEventListener("click",(t=>{var a,n;t.stopPropagation();const o=e.dataset.slot;console.log("[MazeMaster] Equipment slot clicked:",o,"Has item:",!(null===(a=jt.equipment)||void 0===a||!a[o])),null!==(n=jt.equipment)&&void 0!==n&&n[o]&&Ui(o)}))})),w&&w.addEventListener("click",(async e=>{const t=e.target.closest(".equip-btn");if(t){const e=t.dataset.itemId;e&&await async function(e){var t;const a=Oi(e);if(!a)return console.warn("[MazeMaster] Cannot equip unknown item: ".concat(e)),!1;const n=null===(t=jt.equipmentInventory)||void 0===t?void 0:t.indexOf(e);if(-1===n||void 0===n)return console.warn("[MazeMaster] Item not in inventory: ".concat(e)),!1;const o=jt.equipment[a.slot];o&&jt.equipmentInventory.push(o.id);return jt.equipmentInventory.splice(n,1),jt.equipment[a.slot]=a,Wi(),Si("Equipment","Equipped ".concat(a.name,"!")),await Y("onEquip",{itemId:a.id,name:a.name,slot:a.slot,attack:a.attack,defense:a.defense,critBonus:a.critBonus}),!0}(e)}})),pe(jt.profile);const S=document.getElementById("maze_close_btn");S&&(S.addEventListener("click",Ci),S.addEventListener("touchend",(e=>{e.preventDefault(),Ci()})));null===(m=document.getElementById("maze_power_btn"))||void 0===m||m.addEventListener("click",(()=>{!function(){const e=document.getElementById("maze_save_dialog");e&&e.remove();const t=document.createElement("div");t.id="maze_save_dialog",t.innerHTML='\n        <div class="maze-save-dialog-backdrop"></div>\n        <div class="maze-save-dialog-content">\n            <div class="maze-save-dialog-title">Do you wish to save?</div>\n            <div class="maze-save-dialog-buttons">\n                <button id="maze_save_yes" class="maze-save-btn maze-save-yes">Yes</button>\n                <button id="maze_save_no" class="maze-save-btn maze-save-no">No</button>\n                <button id="maze_save_cancel" class="maze-save-btn maze-save-cancel">Cancel</button>\n            </div>\n        </div>\n    ';const a=document.getElementById("mazemaster_maze_modal");a?a.appendChild(t):document.body.appendChild(t);document.getElementById("maze_save_yes").addEventListener("click",(()=>{t.remove(),es(),Ci(),ns()})),document.getElementById("maze_save_no").addEventListener("click",(()=>{t.remove(),Ci()})),document.getElementById("maze_save_cancel").addEventListener("click",(()=>{t.remove()})),t.querySelector(".maze-save-dialog-backdrop").addEventListener("click",(()=>{t.remove()}))}()}));const T=document.getElementById("maze_memory_btn"),I=document.getElementById("maze_memory_panel"),M=document.getElementById("maze_memory_backdrop"),P=document.getElementById("maze_memory_textarea"),D=document.getElementById("maze_memory_save"),A=document.getElementById("maze_memory_close"),B=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&P&&(jt.sessionNotes=P.value,es(),console.log("[MazeMaster] Session notes saved")),I&&(I.style.display="none"),M&&(M.style.display="none"),null==T||T.classList.remove("active")};null==T||T.addEventListener("click",(()=>{I&&M&&P&&(P.value=jt.sessionNotes||"",I.style.display="flex",M.style.display="block",null==T||T.classList.add("active"),P.focus())})),null==A||A.addEventListener("click",(()=>B(!0))),null==M||M.addEventListener("click",(()=>B(!0))),null==D||D.addEventListener("click",(()=>{P&&(jt.sessionNotes=P.value,es(),console.log("[MazeMaster] Session notes saved"),D.textContent="Saved!",setTimeout((()=>{D.textContent="Save Notes"}),1500))}));const L=document.getElementById("maze_player_btn"),q=document.getElementById("maze_player_panel"),N=document.getElementById("maze_player_backdrop"),O=document.getElementById("maze_player_close");console.log("[MazeMaster] Player button elements at attach time:",{playerBtn:!!L,playerPanel:!!q,playerBackdrop:!!N,playerCloseBtn:!!O}),null==L||L.addEventListener("click",(()=>{console.log("[MazeMaster] Player button clicked!"),Ji()})),null==O||O.addEventListener("click",(()=>Ji())),null==N||N.addEventListener("click",(()=>Ji()));const F=document.getElementById("maze_skills_btn"),W=document.getElementById("maze_skill_panel"),G=document.getElementById("maze_skill_backdrop"),j=document.getElementById("maze_skill_close");console.log("[MazeMaster] Skills button elements at attach time:",{skillsBtn:!!F,skillPanel:!!W,skillBackdrop:!!G,skillCloseBtn:!!j}),null==F||F.addEventListener("click",(()=>{console.log("[MazeMaster] Skills button clicked!"),nr()})),null==j||j.addEventListener("click",(()=>nr())),null==G||G.addEventListener("click",(()=>nr()));const K=document.getElementById("maze_quest_btn"),V=(document.getElementById("maze_quest_panel"),document.getElementById("maze_quest_backdrop")),X=document.getElementById("maze_quest_close");null==K||K.addEventListener("click",(()=>or())),null==X||X.addEventListener("click",(()=>or())),null==V||V.addEventListener("click",(()=>or())),document.querySelectorAll(".quest-tab").forEach((e=>{e.addEventListener("click",(e=>{document.querySelectorAll(".quest-tab").forEach((e=>e.classList.remove("active"))),e.target.classList.add("active");ir(e.target.dataset.questTab)}))})),null===(d=document.getElementById("quest_list_content"))||void 0===d||d.addEventListener("click",(e=>{const t=e.target.closest(".quest-accept-btn"),a=e.target.closest(".quest-abandon-btn");if(t){!function(e){if(!jt.quests)return!1;const t=jt.quests.available.findIndex((t=>t.questId===e));if(-1===t)return!1;if(jt.quests.active.length>=jt.quests.maxActive)return toastr.warning("Maximum active quests reached"),!1;const a=kt(e);!!a&&(jt.quests.available.splice(t,1),jt.quests.active.push({questId:e,progress:0,accepted:!0,startTurn:jt.turn||0}),toastr.success("Quest accepted: ".concat(a.name)))}(t.dataset.quest),ir("active")}if(a){!function(e){if(!jt.quests)return!1;const t=jt.quests.active.findIndex((t=>t.questId===e));if(-1===t)return!1;const a=kt(e);jt.quests.active.splice(t,1),toastr.info("Quest abandoned: ".concat((null==a?void 0:a.name)||e))}(a.dataset.quest),ir("active")}})),null===(u=document.getElementById("skill_tree_content"))||void 0===u||u.addEventListener("click",(async e=>{const t=e.target.closest(".skill-learn-btn");if(t){const e=t.dataset.skill;await async function(e){var t;const a=Zi(e);if(!a.canLearn)return{success:!1,newRank:0,message:a.reason};const n=ht(e),o=jt.skills.learned[e]||0,i=o+1;jt.character.skillPoints--,jt.skills.learned[e]=i,"active"===n.type&&0===o&&jt.skills.abilityBar.length<5&&jt.skills.abilityBar.push(e);const r=(null===(t=qt.maze.profiles)||void 0===t?void 0:t[jt.profileName])||{};r.onSkillLearn&&await Y(r.onSkillLearn,{skillId:e,skillName:n.name,rank:i,tree:n.tree});tr(),ar(),Qi();const s=1===i?"learned":"upgraded to rank ".concat(i);return addToMessageLog("".concat(n.name," ").concat(s,"!"),"success"),{success:!0,newRank:i,message:"".concat(n.name," ").concat(s)}}(e)}})),null===(p=document.getElementById("ability_bar"))||void 0===p||p.addEventListener("click",(async e=>{const t=e.target.closest(".ability-slot");if(t&&t.classList.contains("ready")){const e=t.dataset.skill;var a;if(e)if(null!==(a=Ht)&&void 0!==a&&a.isOpen&&"player"===Ht.currentTurn){const t=await er(e);!t.success||t.victory||t.escaped||(Ht.currentTurn="enemy",wn(),setTimeout((()=>Bn()),1e3))}else await $i(e,{inCombat:!1})}}))}function Ci(){jt.isOpen=!1,document.removeEventListener("keydown",Di,{capture:!0});const e=document.getElementById("mazemaster_maze_modal");e&&e.remove()}function wi(){R.getRenderer().render(jt)}function Ei(e){var t;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(!jt||!e)return;const n=(new Date).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}),o=a?"[".concat(a,"] "):"",i="".concat(n," - ").concat(o).concat(e);jt.sessionNotes?jt.sessionNotes+="\n"+i:jt.sessionNotes=i;const r=document.getElementById("maze_memory_textarea");r&&"none"!==(null===(t=document.getElementById("maze_memory_panel"))||void 0===t?void 0:t.style.display)&&(r.value=jt.sessionNotes,r.scrollTop=r.scrollHeight)}function Si(e,t){t&&(arguments.length>2&&void 0!==arguments[2]&&arguments[2]||jt.messageLog.push({speaker:e,message:t,timestamp:Date.now()}),Ti())}function Ti(){const e=document.getElementById("maze_message_log");e&&(e.innerHTML=jt.messageLog.map((e=>'\n        <div class="maze-message-entry">\n            <div class="maze-message-speaker">'.concat(Or(e.speaker),'</div>\n            <div class="maze-message-text">').concat(Or(e.message),"</div>\n        </div>\n    "))).join(""),e.scrollTop=e.scrollHeight)}function Ii(){const{currentMinion:e,isVictory:t,profile:a,messageLog:n}=jt,o=document.getElementById("maze_minion_img"),i=document.getElementById("maze_minion_name"),r=document.getElementById("maze_minion_role");if(t){a.winImage&&o&&(o.src=It(a.winImage),o.style.display=""),i&&(i.textContent="Victory!"),r&&(r.textContent="");const e=a.winMessage||"You escaped the maze!",t=n[n.length-1];t&&t.message===e||Si("Victory!",e)}else if(e&&(e.imagePath&&o?(o.src=It(e.imagePath),o.style.display="block"):o&&(o.style.display="none"),i&&(i.textContent=e.name||""),r&&(r.textContent=e.role||""),e.message)){const t=n[n.length-1];t&&t.message===e.message||Si(e.name||"Unknown",e.message)}Ti()}function Mi(e){var t;const a=document.getElementById("maze_generating_indicator");a&&a.classList.toggle("active",e),Gt=e,null!==(t=jt)&&void 0!==t&&t.isOpen&&wi()}function Pi(){var e,t,a,n,o;if(!jt.isOpen)return;const{playerX:i,playerY:r,grid:s}=jt,l=null===(e=s[r])||void 0===e?void 0:e[i];if(!l)return;const c=document.getElementById("room_info_name"),m=document.getElementById("room_info_desc");c&&(c.textContent=(null===(t=l.roomInfo)||void 0===t?void 0:t.name)||"Unknown Room");const d=jt.currentFloor||0,u="".concat(d,":").concat(i,",").concat(r);let p=(null===(a=jt.enhancedRooms)||void 0===a?void 0:a[u])||(null===(n=l.roomInfo)||void 0===n?void 0:n.enhancedDescription)||(null===(o=l.roomInfo)||void 0===o?void 0:o.description)||"...";if(l.secretPassage&&!l.secretPassage.revealed){const e=l.secretPassage.hintLevel||0,t=l.secretPassage.direction,a="top"===t?"north":"bottom"===t?"south":"left"===t?"west":"east";e>=3?p+=' <span style="color: #ffcc00;"><i class="fa-solid fa-eye"></i> A hidden passage is clearly visible to the '.concat(a,"!</span>"):e>=2?p+=' <span style="color: #aaaaaa;"><i class="fa-solid fa-question"></i> The '.concat(a," wall has suspicious cracks...</span>"):e>=1&&(p+=' <span style="color: #666666;"><i class="fa-solid fa-wind"></i> A faint draft from the '.concat(a,"...</span>"))}m&&(m.innerHTML=p);const h=document.getElementById("room_info_exits");if(h){const e=[],t=jt.size;if(!l.walls.top&&r>0){var g,f;const t=null===(g=s[r-1])||void 0===g?void 0:g[i],a=(null==t||null===(f=t.roomInfo)||void 0===f?void 0:f.name)||"Unknown";e.push("North  ".concat(a))}if(!l.walls.right&&i<t-1){var y,v;const t=null===(y=s[r])||void 0===y?void 0:y[i+1],a=(null==t||null===(v=t.roomInfo)||void 0===v?void 0:v.name)||"Unknown";e.push("East  ".concat(a))}if(!l.walls.bottom&&r<t-1){var b,z;const t=null===(b=s[r+1])||void 0===b?void 0:b[i],a=(null==t||null===(z=t.roomInfo)||void 0===z?void 0:z.name)||"Unknown";e.push("South  ".concat(a))}if(!l.walls.left&&i>0){var _,x;const t=null===(_=s[r])||void 0===_?void 0:_[i-1],a=(null==t||null===(x=t.roomInfo)||void 0===x?void 0:x.name)||"Unknown";e.push("West  ".concat(a))}if(l.staircase){var k,C,w,E;const t=l.staircase.targetFloor,a=l.staircase.targetX,n=l.staircase.targetY,o=(null===(k=jt.floorsData)||void 0===k||null===(k=k[t])||void 0===k?void 0:k.grid)||(null===(C=jt.floors)||void 0===C?void 0:C[t]),i=null==o||null===(w=o[n])||void 0===w?void 0:w[a],r=(null==i||null===(E=i.roomInfo)||void 0===E?void 0:E.name)||"Floor ".concat(t+1);"up"===l.staircase.direction?e.push('<i class="fa-solid fa-stairs"></i> Up  '.concat(r)):"down"===l.staircase.direction&&e.push('<i class="fa-solid fa-stairs"></i> Down  '.concat(r))}h.innerHTML=e.length?e.join("<br>"):"None"}const S=document.getElementById("room_info_occupants");if(S){const e=[];if(l.minion&&!l.minion.defeated&&!l.minion.triggered){const t=pn(l.minion.minionId);e.push((null==t?void 0:t.name)||"Unknown Entity")}l.chest&&!l.chest.opened&&e.push("locked"===l.chest.type?"Locked Chest":"Chest"),l.trap&&!l.trap.triggered&&e.push("Something feels off..."),S.textContent=e.length?e.join(", "):"None"}const T=document.getElementById("room_info_defeated");if(T){var I,M,P,D;const e=[];if(null!==(I=l.minion)&&void 0!==I&&I.defeated||null!==(M=l.minion)&&void 0!==M&&M.triggered){const t=pn(l.minion.minionId);e.push((null==t?void 0:t.name)||"Unknown")}null!==(P=l.chest)&&void 0!==P&&P.opened&&e.push("Opened Chest"),null!==(D=l.trap)&&void 0!==D&&D.triggered&&e.push("Triggered Trap"),T.textContent=e.length?e.join(", "):"None"}}function Di(e){if(!jt.isOpen||jt.isVictory)return;if(e.shiftKey&&("ArrowUp"===e.key||"ArrowDown"===e.key)){const t="ArrowUp"===e.key?"up":"down";return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),void ye(t)}let t=0,a=0;if("ArrowUp"===e.key)a=-1;else if("ArrowDown"===e.key)a=1;else if("ArrowLeft"===e.key)t=-1;else{if("ArrowRight"!==e.key)return;t=1}e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),Ai(t,a)}async function Ai(e,t){if(!jt.isOpen||jt.isVictory)return;if(jt.isPaused)return;if(Gt)return;const{playerX:a,playerY:n,grid:o,size:i}=jt,r=a+e,s=n+t;if(r<0||r>=i||s<0||s>=i)return;const l=o[n][a];let c=!1;if(1===e&&l.walls.right&&(c=!0),-1===e&&l.walls.left&&(c=!0),1===t&&l.walls.bottom&&(c=!0),-1===t&&l.walls.top&&(c=!0),!c){const o=Ua(a,n,1===e?"east":-1===e?"west":1===t?"south":"north");if(o){if(!await async function(e){const t=await Ga(e);return t.success?(Si("Door Unlocked",t.message),!0):(Si("Locked Door",t.message),!1)}(o))return}}if(c)if(jt.voidWalkActive)await async function(){var e;if(null!==(e=jt)&&void 0!==e&&e.voidWalkActive){jt.voidWalkActive=!1,await Hi("voidWalk",1);const e=document.getElementById("maze_dpad");e&&e.classList.remove("void-walk-active")}}(),c=!1;else{const i=1===e?"right":-1===e?"left":1===t?"bottom":"top",r=mi(l,i);if(!r.found)return r.attempted?void Si("Wall",r.message||"The wall seems solid..."):void 0;!function(e,t,a,n){var o;const i=e[a][t];if(!i.secretPassage||i.secretPassage.direction!==n)return!1;i.secretPassage.revealed=!0,i.walls[n]=!1;const r=i.secretPassage.targetCell,s={top:"bottom",bottom:"top",left:"right",right:"left"}[n];null!==(o=e[r.y])&&void 0!==o&&o[r.x]&&(e[r.y][r.x].walls[s]=!1)}(o,a,n,i),Si("Secret Found!","You discovered a hidden passage!"),await Y("onSecretFound",{x:a,y:n,direction:i}),c=!1}else jt.voidWalkActive&&function(){var e;if(null!==(e=jt)&&void 0!==e&&e.voidWalkActive){jt.voidWalkActive=!1;const e=document.getElementById("maze_dpad");e&&e.classList.remove("void-walk-active")}}();const m=o[s][r];if(void 0!==m.zoneId&&null!==m.zoneId){var d,u;const e=null===(d=jt.floorsData)||void 0===d?void 0:d[jt.currentFloor],t=null==e||null===(u=e.zones)||void 0===u?void 0:u[m.zoneId];if(t&&!t.isUnlocked){var p;if(null===(p=jt.questProfileMeta)||void 0===p||!p.questGatingEnabled)return void Si("Zone Locked",t.lockedMessage||"".concat(t.name," is sealed. Clear more rooms to unlock."));if(!Tt("zone",m.zoneId)){return void Si("Area Locked",function(e,t){var a,n;const o=St();if(!o)return"Area locked.";const i=o.quests.filter((a=>a.progressionType===e&&a.progressionTarget===t));if(0===i.length)return"Area locked.";const r=(null===(a=jt.quests)||void 0===a?void 0:a.completed)||[],s=i.filter((e=>!r.includes(e.questId)));if(0===s.length)return"Area unlocked!";const l=s.map((e=>{const t=kt(e.questId);return(null==t?void 0:t.name)||e.questId}));return"any"===(null===(n=jt.questProfileMeta)||void 0===n?void 0:n.gatingMode)?"Complete any: ".concat(l.join(" or ")):"Complete: ".concat(l.join(", "))}("zone",m.zoneId))}t.isUnlocked=!0}}const h=1===e?"right":-1===e?"left":1===t?"down":"up",g=1===e?"east":-1===e?"west":1===t?"south":"north";jt.playerX=r,jt.playerY=s,jt.playerDirection=g,Za("footstep"),on("player","player_walk",(()=>{}));if(ne(r,s,jt.grid.length),jt.moveCount++,jt.visibility&&(jt.visibility.tempMovesLeft>0&&(jt.visibility.tempMovesLeft--,jt.visibility.tempMovesLeft<=0&&(jt.visibility.tempBonus=0,Si("Info","Your torch burns out."))),jt.visibility.floorRevealed=!1),await async function(){if(!jt.isOpen||!jt.lighting)return;const e=Wa(),t=jt.lighting.lightRadius;let a=null;jt.lighting.torchMovesLeft>0&&(jt.lighting.torchMovesLeft--,jt.lighting.torchMovesLeft<=0&&(jt.lighting.activeLight=null,a="torch",Si("Torch Burned Out","Your torch has burned out."))),jt.lighting.sightPotionMovesLeft>0&&(jt.lighting.sightPotionMovesLeft--,jt.lighting.sightPotionMovesLeft<=0&&(a||(a="sightPotion"),Si("Vision Fading","Your enhanced sight fades away."))),Ya(),a&&e.onLightSourceExpire&&await W(substituteParams(e.onLightSourceExpire,{lightType:a}),"onLightSourceExpire"),jt.lighting.lightRadius!==t&&e.onVisionChange&&await W(substituteParams(e.onVisionChange,{newRadius:jt.lighting.lightRadius,previousRadius:t,source:"movement"}),"onVisionChange")}(),await ie("moves",1),await Y("onMove",{x:r,y:s,direction:h}),jt.restCooldown&&jt.restCooldown>0&&(jt.restCooldown--,J()),le(),fe(),async function(){var e;if(!jt)return;const t=se();if(jt.character){const e=10*Math.floor(t/10),a=jt.character.lastExplorationMilestone||0;if(e>a){const t=(e-a)/10*Ki.exploration10;await Xi(t,"exploration"),jt.character.lastExplorationMilestone=e,addToMessageLog("Exploration milestone! +".concat(t," XP"),"info")}}if(await wt("explore",null,t),null!==(e=jt.profile)&&void 0!==e&&e.objectives){for(const e of jt.profile.objectives)if("explore"===e.type){const a=jt.objectiveProgress[e.id];a&&!a.completed&&(a.current=t,t>=(e.count||100)&&(a.completed=!0,await Y("onObjectiveComplete",{objectiveId:e.id}),e.reward&&e.reward.trim()&&await W(e.reward)))}Ae(),De()}!jt.explorationComplete&&t>=100&&(jt.explorationComplete=!0,await Y("onExploreComplete",{percentage:100}))}(),ze(!0),wi(),Ma(),"function"==typeof window.mazeCenterOnPlayer&&window.mazeCenterOnPlayer(!0),await Qt(r,s),r===jt.exitX&&s===jt.exitY&&jt.currentFloor===jt.totalFloors-1)return void async function(){const e=jt.profile;if(!function(){var e;if(!jt||null===(e=jt.profile)||void 0===e||!e.objectives)return!0;const t=jt.profile.objectives,a=jt.objectiveProgress,n=t.filter((e=>e.required));return 0===n.length||n.every((e=>{var t;return null===(t=a[e.id])||void 0===t?void 0:t.completed}))}()){const t=e.mainMinion?pn(e.mainMinion):null;jt.currentMinion={name:(null==t?void 0:t.name)||"Exit",imagePath:(null==t?void 0:t.imagePath)||"",message:"You haven't completed all required objectives yet! Explore the maze to find what you need."},Ii();const a=document.querySelector(".maze-objectives-section");return void(a&&(a.classList.add("objectives-flash"),setTimeout((()=>a.classList.remove("objectives-flash")),500)))}if(!e.mainMinion||jt.exitEncounterDone)return void Rr();const t=pn(e.mainMinion);if(!t)return void Rr();jt.isPaused=!0,jt.currentMinion={name:t.name,imagePath:t.imagePath,message:"You've reached the exit... but first, face me!"},Ii();const a=e.mainMinionExitType||"messenger",n=e.mainMinionExitProfile;switch(a){case"messenger":await zi(2e3),jt.exitEncounterDone=!0,jt.isPaused=!1,Rr();break;case"battlebar":n?(jt.pendingEncounter={type:"exit_battlebar",profile:n},Io(n)):(jt.exitEncounterDone=!0,jt.isPaused=!1,Rr());break;case"prizewheel":if(n){const e=vn(n);e.error?(console.warn('[MazeMaster] Exit wheel profile "'.concat(n,'" failed to load: ').concat(e.error,". Winning maze.")),jt.exitEncounterDone=!0,jt.isPaused=!1,Rr()):(jt.pendingEncounter={type:"exit_wheel",profile:n},xn())}else jt.exitEncounterDone=!0,jt.isPaused=!1,Rr();break;case"turnbased":n?(jt.pendingEncounter={type:"exit_turnbased",profile:n},Cn(n)):(jt.exitEncounterDone=!0,jt.isPaused=!1,Rr());break;case"qte":n?(jt.pendingEncounter={type:"exit_qte",profile:n},On(n)):(jt.exitEncounterDone=!0,jt.isPaused=!1,Rr());break;case"dice":n?(jt.pendingEncounter={type:"exit_dice",profile:n},Xn(n)):(jt.exitEncounterDone=!0,jt.isPaused=!1,Rr());break;case"stealth":n?(jt.pendingEncounter={type:"exit_stealth",profile:n},ao(n)):(jt.exitEncounterDone=!0,jt.isPaused=!1,Rr());break;case"puzzle":n?(jt.pendingEncounter={type:"exit_puzzle",profile:n},lo(n)):(jt.exitEncounterDone=!0,jt.isPaused=!1,Rr());break;case"negotiation":n?(jt.pendingEncounter={type:"exit_negotiation",profile:n},yo(n)):(jt.exitEncounterDone=!0,jt.isPaused=!1,Rr());break;default:Rr()}}();const f=o[s][r];if(!f.chest||f.chest.opened)if(!f.minion||f.minion.triggered)if(!f.trap||f.trap.triggered)if(f.safeRoom&&!f.safeRoom.exhausted&&jt.hpEnabled&&jt.hp)!async function(e,t){var a;jt.isPaused=!0,jt.pendingSafeRoom={x:e,y:t};const n=jt.profile||{},o=null!==(a=n.safeRoomHealPercent)&&void 0!==a?a:100,i=n.safeRoomUseLLM&&n.enableLLM,r=jt.hp.max+jt.hp.maxBonus,s=jt.hp.current,l=s<r;let c=l?"A sanctuary of peace and healing. Rest here to restore ".concat(o,"% of your health."):"A sanctuary of peace. You are already at full health.";if(jt.currentMinion={name:"Safe Room",imagePath:"",message:c},Ii(),i){var m;const e=(null===(m=n.storyConfig)||void 0===m?void 0:m.mainStory)||"";Mi(!0);try{const t=await async function(e){let{baseMessage:t,mainStory:a,needsHealing:n,healPercent:o,currentHP:i,maxHP:r,theme:s}=e;const l="You are narrating a dungeon crawler game. The player has found a safe room (a healing sanctuary).\nTheme: ".concat(s,"\nStory context: ").concat(a||"A dangerous dungeon adventure","\nPlayer HP: ").concat(i,"/").concat(r,"\nNeeds healing: ").concat(n?"Yes":"No (already at full health)","\nHeal amount: ").concat(o,"%\n\nWrite a brief atmospheric description (2-3 sentences) of this safe haven. Make it match the theme. If they need healing, hint at the restorative nature of the room. Keep it immersive but concise.");try{const e=await fetch("/api/openai/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:l,max_tokens:150,temperature:.8})});if(e.ok){var c;return(null===(c=(await e.json()).choices)||void 0===c||null===(c=c[0])||void 0===c||null===(c=c.text)||void 0===c?void 0:c.trim())||t}}catch(e){console.error("[MazeMaster] LLM safe room message failed:",e)}return t}({baseMessage:c,mainStory:e,needsHealing:l,healPercent:o,currentHP:s,maxHP:r,theme:n.theme||"fantasy"});jt.currentMinion.message=t,Ii()}catch(e){console.error("[MazeMaster] Safe room message generation failed:",e)}finally{Mi(!1)}}!function(e,t){var a,n;let o="";o=e?'\n            <button id="maze_saferoom_heal" class="menu_button maze-confirm-btn" style="background: linear-gradient(135deg, #14b8a6, #2dd4bf);">\n                <i class="fa-solid fa-heart"></i> Heal ('.concat(t,'%)\n            </button>\n            <button id="maze_saferoom_ignore" class="menu_button maze-confirm-btn">Ignore</button>\n        '):'\n            <button id="maze_saferoom_ignore" class="menu_button maze-confirm-btn">Continue</button>\n        ';Tr(o),null===(a=document.getElementById("maze_saferoom_heal"))||void 0===a||a.addEventListener("click",vr),null===(n=document.getElementById("maze_saferoom_ignore"))||void 0===n||n.addEventListener("click",br)}(l,o)}(r,s);else{if(f.portal){if(await async function(e,t,a){if(!a)return!1;if(!a.bidirectional&&!a.isStart)return!1;const n=a.target;if(!n||null==n.x||null==n.y)return!1;await Y("onTeleport",{portalId:a.id,fromX:e,fromY:t,toX:n.x,toY:n.y}),jt.playerX=n.x,jt.playerY=n.y,jt.visited.add("".concat(jt.currentFloor,":").concat(n.x,",").concat(n.y)),ze(!1),fe(),await ie("teleportsUsed",1);const o=document.querySelector('.maze-cell[data-x="'.concat(e,'"][data-y="').concat(t,'"]')),i=document.querySelector('.maze-cell[data-x="'.concat(n.x,'"][data-y="').concat(n.y,'"]'));return o&&(o.classList.add("portal-flash"),setTimeout((()=>o.classList.remove("portal-flash")),300)),i&&(i.classList.add("portal-flash"),setTimeout((()=>i.classList.remove("portal-flash")),300)),console.log("[MazeMaster] Teleported from (".concat(e,",").concat(t,") to (").concat(n.x,",").concat(n.y,")")),!0}(r,s,f.portal)){wi(),Ma(),"function"==typeof window.mazeCenterOnPlayer&&window.mazeCenterOnPlayer(!0),await Qt(jt.playerX,jt.playerY);const e=o[jt.playerY][jt.playerX];if(e.chest&&!e.chest.opened)return void hr(e.chest,jt.playerX,jt.playerY);if(e.minion&&!e.minion.triggered)return void Bi(e.minion.minionId,jt.playerX,jt.playerY);if(e.trap&&!e.trap.triggered)return void Li(e.trap.trapId,jt.playerX,jt.playerY)}}await async function(){const e=jt.profile;if(!e.mainMinion)return;if(!e.mainMinionRandomChance)return;if(!e.mainMinionRandomMessages||0===e.mainMinionRandomMessages.length)return;if(100*Math.random()>e.mainMinionRandomChance)return;const t=pn(e.mainMinion);if(!t)return;const a=bi(e.mainMinionRandomMessages);if(!a)return;jt.currentMinion={name:t.name,imagePath:t.imagePath,message:"..."},Ii(),Mi(!0);let n=a;try{n=await Xt({minionName:t.name,minionDescription:t.description,baseMessage:a,mainStory:Zt(),currentMilestone:Jt(),minionType:t.type||"messenger"})}catch(e){console.error("[MazeMaster] Random message LLM generation error:",e)}Mi(!1),jt.currentMinion.message=n,Ii()}(),await function(){const e=jt.profile;if(!e.storyConfig||!e.storyConfig.milestones||0===e.storyConfig.milestones.length)return;const t=jt.size*jt.size,a=jt.visited.size,n=Math.floor(a/t*100);for(const t of e.storyConfig.milestones)if(n>=t.percent&&!jt.shownMilestones.has(t.percent)){var o;jt.shownMilestones.add(t.percent),Ei("Milestone ".concat(t.percent,"%: ").concat(null===(o=t.storyUpdate)||void 0===o?void 0:o.substring(0,50),"..."),"Story");const a=e.mainMinion?pn(e.mainMinion):null;return jt.currentMinion={name:(null==a?void 0:a.name)||"Story",imagePath:(null==a?void 0:a.imagePath)||"",message:t.storyUpdate},void Ii()}}(),await async function(){var e;if(!jt||!jt.movingMinions||0===jt.movingMinions.length)return;const{grid:t,size:a,playerX:n,playerY:o,moveCount:i}=jt,r=U(jt.profile),s=!1!==(null===(e=jt.profile)||void 0===e?void 0:e.enhancedMinionAI);for(const e of jt.movingMinions){var l,c,m,d;if(e.triggered)continue;if(!1===(null===(l=e.movement)||void 0===l?void 0:l.enhancedAI)||!s)continue;const a=null===(c=e.movement)||void 0===c?void 0:c.detectionRange,i=null===(m=e.movement)||void 0===m?void 0:m.chaseDuration,r=e.alertState||"idle";we(e,n,o,t,a,i),!1!==(null===(d=e.movement)||void 0===d?void 0:d.alertPack)&&"alerted"===e.alertState&&"alerted"!==r&&"chasing"!==r&&(Ee(e,jt.movingMinions,t),await Y("onMinionAlert",{minionId:e.minionId,alertState:e.alertState,x:e.x,y:e.y}))}for(const e of jt.movingMinions){var u,p,h,g;if(e.triggered)continue;if(i%((null===(u=e.movement)||void 0===u?void 0:u.speed)||1)!==0)continue;const l=!1!==(null===(p=e.movement)||void 0===p?void 0:p.enhancedAI)&&s,c=!1!==(null===(h=e.movement)||void 0===h?void 0:h.usePathfinding),m=l&&c?Se(e,t,a,n,o):xe(e,t,a,n,o,r);if(!m)continue;const d=e.x,f=e.y;if(await _e(d,f,m.x,m.y,e.alertState||"idle"),(null===(g=t[f][d].minion)||void 0===g?void 0:g.minionId)===e.minionId&&(t[f][d].minion=null),e.x=m.x,e.y=m.y,t[m.y][m.x].minion={minionId:e.minionId,triggered:!1,alertState:e.alertState},await Y("onEnemyMove",{minionId:e.minionId,fromX:d,fromY:f,toX:m.x,toY:m.y,alertState:e.alertState}),m.x===n&&m.y===o)return console.log("[MazeMaster] Moving minion ".concat(e.minionId," caught the player!")),e.triggered=!0,t[m.y][m.x].minion.triggered=!0,void Bi(e.minionId,m.x,m.y)}renderMaze()}(),jt.movingMinions&&jt.movingMinions.length>0&&wi()}else Li(f.trap.trapId,r,s);else Bi(f.minion.minionId,r,s);else hr(f.chest,r,s)}async function Bi(e,t,a){var n;const o=pn(e);if(!o)return void console.warn('[MazeMaster] Minion "'.concat(e,'" not found'));const i=jt.grid[a][t];if(null!==(n=i.minion)&&void 0!==n&&n.triggered)return void console.log("[MazeMaster] Minion at ".concat(t,",").concat(a," already triggered, skipping"));i.minion.triggered=!0,console.log("[MazeMaster] Marked minion at ".concat(t,",").concat(a," as triggered"));const r=o.type||"messenger";if(Ei("Encountered ".concat(o.name," (").concat(r,")"),"Encounter"),"messenger"!==r&&jt.inventory.minionBane>0){if(await async function(){var e;return!(null===(e=jt)||void 0===e||!e.inventory.minionBane||jt.inventory.minionBane<=0||(await Hi("minionBane",1),jt.currentMinion={name:"Minion Bane",imagePath:"",message:"Your Minion Bane flares with power, instantly vanquishing the foe!"},Ii(),0))}())return i.minion.defeated=!0,await ie("encountersWon",1),await Pe("defeat",e,1),await li(t,a),wi(),void setTimeout((()=>{jt.isPaused=!1,resetMazeHero()}),2e3)}await ie("encountersTotal",1),await Pe("defeat",e,1),jt.isPaused=!0,jt.currentMinion={name:o.name,imagePath:o.imagePath,message:"..."},Ii(),wi();const s=bi(o.messages)||"You encountered ".concat(o.name,"!");Mi(!0);let l=s;try{l=await Xt({minionName:o.name,minionDescription:o.description,baseMessage:s,mainStory:Zt(),currentMilestone:Jt(),minionType:o.type||"messenger"})}catch(e){console.error("[MazeMaster] LLM generation error:",e)}Mi(!1),jt.currentMinion.message=l,Ii(),o.encounterScript&&o.encounterScript.trim()&&(console.log("[MazeMaster] Executing encounter script for ".concat(o.name)),await W(o.encounterScript)),function(e,t,a,n){var o,i,r,s,l;console.log("[MazeMaster] showEncounterConfirmation called:",{minionId:e,x:t,y:a,encounterType:n});const c=pn(e);console.log("[MazeMaster] Minion data:",c);const m="messenger"!==n&&"merchant"!==n&&jt.inventory.stealth>0;jt.pendingConfirmation={type:n,minionId:e,x:t,y:a,canSlipAway:m},console.log("[MazeMaster] Set pendingConfirmation:",jt.pendingConfirmation);let d="";if("messenger"===n)d='<button id="maze_confirm_ok" class="menu_button maze-confirm-btn">OK</button>';else if("merchant"===n){const e=c.merchantItemCount||{min:2,max:4},t=e.min+Math.floor(Math.random()*(e.max-e.min+1)),a=wo(c.merchantItemPool||"Common Goods",t);jt.pendingConfirmation.offeredItems=a,jt.currentMinion.message="Take a look at my wares! I have ".concat(t," items that might interest you..."),Ii(),d='\n            <button id="maze_confirm_browse" class="menu_button maze-confirm-btn maze-accept-btn">Browse Wares</button>\n            <button id="maze_confirm_decline" class="menu_button maze-confirm-btn">No Thanks</button>\n        '}else{d='<button id="maze_confirm_action" class="menu_button maze-confirm-btn">'.concat({battlebar:"Fight!",prizewheel:"Spin!",turnbased:"Battle!",qte:"React!",dice:"Roll!",stealth:"Sneak!",puzzle:"Solve!",negotiation:"Negotiate!"}[n]||"Engage!","</button>"),m&&(d+='<button id="maze_confirm_slip" class="menu_button maze-confirm-btn maze-slip-btn">Slip Away</button>')}Tr(d),null===(o=document.getElementById("maze_confirm_ok"))||void 0===o||o.addEventListener("click",Mr),null===(i=document.getElementById("maze_confirm_action"))||void 0===i||i.addEventListener("click",Pr),null===(r=document.getElementById("maze_confirm_slip"))||void 0===r||r.addEventListener("click",Dr),null===(s=document.getElementById("maze_confirm_browse"))||void 0===s||s.addEventListener("click",Ar),null===(l=document.getElementById("maze_confirm_decline"))||void 0===l||l.addEventListener("click",Br)}(e,t,a,o.type||"messenger")}async function Li(e,t,a){var n;const o=fn(e);if(!o)return void console.warn('[MazeMaster] Trap "'.concat(e,'" not found'));const i=null!==(n=o.avoidChance)&&void 0!==n?n:0;if(i>0){const e=100*Math.random();if(e<i){console.log('[MazeMaster] Trap "'.concat(o.name,'" avoided (rolled ').concat(e.toFixed(1)," vs ").concat(i,"%)")),jt.grid[a][t].trap.triggered=!0,wi(),await ie("trapsAvoided",1);return Si("Trap Avoided",o.avoidMessage||"You skillfully avoided the ".concat(o.name,"!")),void(o.avoidScript&&o.avoidScript.trim()&&(console.log("[MazeMaster] Executing avoid script for ".concat(o.name)),await W(o.avoidScript)))}}jt.grid[a][t].trap.triggered=!0,wi(),Ei("Triggered trap: ".concat(o.name),"Trap"),await ie("trapsTriggered",1),jt.isPaused=!0,jt.currentMinion={name:o.name,imagePath:o.imagePath,message:"..."},Ii(),Mi(!0);const r=o.message||"You triggered a trap!";let s=r;try{s=await async function(e){const{trapName:t,baseMessage:a,mainStory:n}=e;if(!a)return"";if(!1===qt.llmEnabled)return a;if("function"!=typeof h)return a;const o=oe(),i="The player ".concat(o,' has triggered a trap called "').concat(t,'" in a maze.\n\n').concat(n?"Story Setting: ".concat(n,"\n\n"):"",'Based on this trap description: "').concat(a,'"\n\nWrite a short, dramatic narration of the trap being triggered (1-2 sentences, under 100 characters). Make it visceral and immediate. You may reference the player by name. Do not use quotation marks.');try{console.log("[MazeMaster] Generating LLM message for trap:",t);const e=await h(i,{quietToLoud:!1,skipWIAN:!0,skipWI:!0,max_length:80});if(e&&e.trim()){let t=e.trim();return t=t.replace(/^["']|["']$/g,""),t=t.replace(/^["""''']|["""''']$/g,""),console.log("[MazeMaster] Generated trap message:",t),t}}catch(e){console.error("[MazeMaster] Trap LLM generation failed:",e)}return a}({trapName:o.name,baseMessage:r,mainStory:Zt()})}catch(e){console.error("[MazeMaster] Trap LLM generation error:",e)}var l;Mi(!1),jt.currentMinion.message=s,Ii(),o.script&&o.script.trim()&&(console.log("[MazeMaster] Executing trap script for ".concat(o.name)),await W(o.script)),Tr('<button id="maze_trap_continue" class="menu_button maze-confirm-btn">Continue</button>'),null===(l=document.getElementById("maze_trap_continue"))||void 0===l||l.addEventListener("click",(()=>{Ir(),qi()}))}function qi(){jt.isPaused=!1,jt.pendingEncounter=null;const e=document.getElementById("maze_encounter_confirm");e&&(e.innerHTML="",e.style.display="none");const t=jt.profile;if(t.mainMinion){const e=pn(t.mainMinion);if(e)return jt.currentMinion={name:e.name,imagePath:e.imagePath,message:"Continue onward..."},void Ii()}jt.currentMinion={name:"The Maze",imagePath:"",message:"Find your way to the exit..."},Ii()}function Ri(){const e=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=document.getElementById(e);if(n&&(n.textContent=t),a){const e=document.getElementById(a);if(e){e.textContent=t;const a=e.closest(".inv-overlay-item");a&&(a.style.display=t>0?"":"none")}}},t={strike:"pow"},a=Qe();for(const o of a){const a=jt.inventory[o]||0,i=t[o]||o;e("maze_inv_".concat(i),a,"maze_ov_".concat(i)),t[o]&&e("maze_inv_".concat(o),a,"maze_ov_".concat(o));const r=Xe(o);if("equipment"===(null==r?void 0:r.type)){const e=it(o),t=document.getElementById("maze_inv_".concat(i))||document.getElementById("maze_inv_".concat(o));if(t&&e>0){var n;const a=nt(o,(null===(n=jt.profile)||void 0===n?void 0:n.theme)||"fantasy");t.title="".concat(a," (").concat(e," charges)")}}}}async function Ni(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(void 0!==jt.inventory[e]){var a;jt.inventory[e]+=t;for(let a=0;a<t;a++)ot(e);Ri(),void 0!==(null===(a=jt.stats)||void 0===a||null===(a=a.itemsCollected)||void 0===a?void 0:a[e])&&(jt.stats.itemsCollected[e]+=t),await Y("onItemAdd",{item:e,count:t,total:jt.inventory[e]}),await Pe("collect",e,t)}}async function Hi(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(void 0!==jt.inventory[e]){const a=jt.inventory[e];jt.inventory[e]=Math.max(0,a-t),Ri(),await Y("onItemRemove",{item:e,count:Math.min(a,t),total:jt.inventory[e]})}}function Oi(e){return ct[e]||null}function Fi(){const e={attack:0,defense:0,critBonus:0,specials:[]};if(!jt.equipment)return e;for(const t of["weapon","armor","accessory"]){const a=jt.equipment[t];a&&(e.attack+=a.attack||0,e.defense+=a.defense||0,e.critBonus+=a.critBonus||0,a.special&&e.specials.push(a.special))}return e}function Wi(){for(const t of["weapon","armor","accessory"]){var e;const a=document.getElementById("maze_equip_".concat(t)),n=null===(e=jt.equipment)||void 0===e?void 0:e[t];a&&(n?(a.innerHTML='\n                    <div class="equip-item equipped" data-item-id="'.concat(n.id,'" data-slot="').concat(t,'">\n                        <i class="fa-solid ').concat(n.icon,'"></i>\n                        <span class="equip-name">').concat(n.name,"</span>\n                    </div>\n                "),a.title="".concat(n.name,"\n+").concat(n.attack," ATK, +").concat(n.defense," DEF").concat(n.critBonus?", +".concat(n.critBonus,"% Crit"):"","\n").concat(n.description),a.classList.add("has-item")):(a.innerHTML='\n                    <div class="equip-item empty" data-slot="'.concat(t,'">\n                        <i class="fa-solid fa-plus"></i>\n                        <span class="equip-name">Empty</span>\n                    </div>\n                '),a.title="Empty ".concat(t," slot"),a.classList.remove("has-item")))}const t=Fi(),a=document.getElementById("maze_equip_total_atk"),n=document.getElementById("maze_equip_total_def"),o=document.getElementById("maze_equip_total_crit");a&&(a.textContent="+".concat(t.attack)),n&&(n.textContent="+".concat(t.defense)),o&&(o.textContent="+".concat(t.critBonus,"%")),function(){const e=document.getElementById("maze_equipment_inventory");if(!e)return;const t=jt.equipmentInventory||[];if(0===t.length)return void(e.innerHTML='<div class="equip-inv-empty">No equipment in backpack</div>');e.innerHTML=t.map((e=>{const t=Oi(e);if(!t)return"";const a="rarity-".concat(t.rarity);return'\n            <div class="equip-inv-item '.concat(a,'" data-item-id="').concat(e,'" title="').concat(t.description,'">\n                <i class="fa-solid ').concat(t.icon,'"></i>\n                <span class="item-name">').concat(t.name,'</span>\n                <span class="item-stats">+').concat(t.attack,"/").concat(t.defense,'</span>\n                <button class="equip-btn" data-action="equip" data-item-id="').concat(e,'">Equip</button>\n            </div>\n        ')})).join("")}()}function Yi(e,t){var a;const n=ct[e];if(!n)return{current:0,max:0};const o=n.maxDurability||10;if("absorb"===(null===(a=n.special)||void 0===a?void 0:a.type)){var i;const t=null===(i=jt.equipmentCharges)||void 0===i?void 0:i[e];return void 0!==t?{current:t,max:n.special.charges||o}:{current:n.special.charges||o,max:n.special.charges||o}}return jt.equipmentDurability||(jt.equipmentDurability={}),void 0===jt.equipmentDurability[e]&&(jt.equipmentDurability[e]=o),{current:jt.equipmentDurability[e],max:o}}function Ui(e){var t,a,n;console.log("[MazeMaster] showEquipmentModal called for slot:",e);const o=null===(t=jt.equipment)||void 0===t?void 0:t[e];if(console.log("[MazeMaster] Item in slot:",o),!o)return void console.log("[MazeMaster] No item found, returning");const i=document.getElementById("mazemaster_equip_modal");if(i&&i.remove(),!document.getElementById("mazemaster_equip_modal_styles")){const e=document.createElement("style");e.id="mazemaster_equip_modal_styles",e.textContent="\n        .equip-modal-overlay {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100vw;\n            height: 100vh;\n            background: rgba(0, 0, 0, 0.85);\n            z-index: 9999999;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n\n        .equip-modal-container {\n            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\n            border: 2px solid rgba(255, 255, 255, 0.1);\n            border-radius: 12px;\n            padding: 20px;\n            min-width: 320px;\n            max-width: 400px;\n            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);\n        }\n\n        .equip-modal-header {\n            display: flex;\n            align-items: center;\n            gap: 12px;\n            margin-bottom: 16px;\n            padding-bottom: 12px;\n            border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n        }\n\n        .equip-modal-icon {\n            font-size: 32px;\n            width: 48px;\n            height: 48px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            background: rgba(0, 0, 0, 0.3);\n            border-radius: 8px;\n        }\n\n        .equip-modal-icon.rarity-common { color: #9e9e9e; }\n        .equip-modal-icon.rarity-uncommon { color: #4caf50; }\n        .equip-modal-icon.rarity-rare { color: #2196f3; }\n        .equip-modal-icon.rarity-epic { color: #9c27b0; }\n        .equip-modal-icon.rarity-legendary { color: #ff9800; }\n\n        .equip-modal-title {\n            flex: 1;\n        }\n\n        .equip-modal-name {\n            font-size: 18px;\n            font-weight: bold;\n            color: #fff;\n            margin: 0;\n        }\n\n        .equip-modal-slot {\n            font-size: 12px;\n            color: #888;\n            text-transform: uppercase;\n        }\n\n        .equip-modal-stats {\n            display: grid;\n            grid-template-columns: repeat(3, 1fr);\n            gap: 8px;\n            margin-bottom: 16px;\n        }\n\n        .equip-modal-stat {\n            background: rgba(0, 0, 0, 0.3);\n            padding: 8px;\n            border-radius: 6px;\n            text-align: center;\n        }\n\n        .equip-modal-stat-value {\n            font-size: 20px;\n            font-weight: bold;\n        }\n\n        .equip-modal-stat-label {\n            font-size: 10px;\n            color: #888;\n            text-transform: uppercase;\n        }\n\n        .equip-modal-stat.attack .equip-modal-stat-value { color: #e74c3c; }\n        .equip-modal-stat.defense .equip-modal-stat-value { color: #3498db; }\n        .equip-modal-stat.crit .equip-modal-stat-value { color: #f1c40f; }\n\n        .equip-modal-durability {\n            background: rgba(0, 0, 0, 0.3);\n            padding: 12px;\n            border-radius: 8px;\n            margin-bottom: 16px;\n        }\n\n        .equip-modal-durability-header {\n            display: flex;\n            justify-content: space-between;\n            margin-bottom: 8px;\n        }\n\n        .equip-modal-durability-label {\n            font-size: 12px;\n            color: #888;\n            text-transform: uppercase;\n        }\n\n        .equip-modal-durability-value {\n            font-size: 14px;\n            font-weight: bold;\n        }\n\n        .equip-modal-durability-bar {\n            height: 8px;\n            background: rgba(0, 0, 0, 0.5);\n            border-radius: 4px;\n            overflow: hidden;\n        }\n\n        .equip-modal-durability-fill {\n            height: 100%;\n            background: linear-gradient(90deg, #e74c3c, #f39c12, #2ecc71);\n            transition: width 0.3s ease;\n        }\n\n        .equip-modal-durability-fill.low { background: #e74c3c; }\n        .equip-modal-durability-fill.medium { background: #f39c12; }\n        .equip-modal-durability-fill.high { background: #2ecc71; }\n\n        .equip-modal-special {\n            background: rgba(156, 39, 176, 0.2);\n            border: 1px solid rgba(156, 39, 176, 0.4);\n            padding: 10px;\n            border-radius: 6px;\n            margin-bottom: 16px;\n            font-size: 12px;\n            color: #ce93d8;\n        }\n\n        .equip-modal-description {\n            font-size: 13px;\n            color: #aaa;\n            margin-bottom: 16px;\n            font-style: italic;\n        }\n\n        .equip-modal-buttons {\n            display: flex;\n            gap: 8px;\n        }\n\n        .equip-modal-btn {\n            flex: 1;\n            padding: 10px 16px;\n            border: none;\n            border-radius: 6px;\n            cursor: pointer;\n            font-size: 13px;\n            font-weight: bold;\n            transition: all 0.2s ease;\n        }\n\n        .equip-modal-btn:hover:not(:disabled) {\n            transform: translateY(-2px);\n        }\n\n        .equip-modal-btn:disabled {\n            opacity: 0.5;\n            cursor: not-allowed;\n        }\n\n        .equip-modal-btn.unequip {\n            background: #95a5a6;\n            color: #fff;\n        }\n\n        .equip-modal-btn.unequip:hover:not(:disabled) {\n            background: #7f8c8d;\n        }\n\n        .equip-modal-btn.repair {\n            background: linear-gradient(135deg, #27ae60, #2ecc71);\n            color: #fff;\n        }\n\n        .equip-modal-btn.repair:hover:not(:disabled) {\n            background: linear-gradient(135deg, #229954, #27ae60);\n        }\n\n        .equip-modal-btn.close {\n            background: rgba(255, 255, 255, 0.1);\n            color: #888;\n        }\n\n        .equip-modal-btn.close:hover {\n            background: rgba(255, 255, 255, 0.2);\n            color: #fff;\n        }\n\n        .equip-modal-repair-info {\n            font-size: 11px;\n            color: #666;\n            text-align: center;\n            margin-top: 8px;\n        }\n    ",document.head.appendChild(e)}const r=Yi(o.id),s=r.max>0?r.current/r.max*100:100,l=s<=25?"low":s<=50?"medium":"high",c=(null===(a=jt.inventory)||void 0===a?void 0:a.repairKit)||0,m=r.current<r.max,d=c>0&&m,u=jt.theme||"fantasy",p=Xe("repairKit"),h=(null==p||null===(n=p.aliases)||void 0===n?void 0:n[u])||"Repair Kit";let g="";if(o.special){const e={fire:"Deals fire damage",backstab:"+".concat(o.special.value,"% backstab damage"),lifesteal:"Heals ".concat(o.special.value,"% of damage dealt"),absorb:"Absorbs ".concat(o.special.value," hits")};g='<div class="equip-modal-special"><i class="fa-solid fa-star"></i> Special: '.concat(e[o.special.type]||o.special.type,"</div>")}const f='\n        <div id="mazemaster_equip_modal" class="equip-modal-overlay">\n            <div class="equip-modal-container">\n                <div class="equip-modal-header">\n                    <div class="equip-modal-icon rarity-'.concat(o.rarity,'">\n                        <i class="fa-solid ').concat(o.icon,'"></i>\n                    </div>\n                    <div class="equip-modal-title">\n                        <h3 class="equip-modal-name">').concat(o.name,'</h3>\n                        <span class="equip-modal-slot">').concat(e,"  ").concat(o.rarity,'</span>\n                    </div>\n                </div>\n\n                <div class="equip-modal-stats">\n                    <div class="equip-modal-stat attack">\n                        <div class="equip-modal-stat-value">+').concat(o.attack,'</div>\n                        <div class="equip-modal-stat-label">Attack</div>\n                    </div>\n                    <div class="equip-modal-stat defense">\n                        <div class="equip-modal-stat-value">+').concat(o.defense,'</div>\n                        <div class="equip-modal-stat-label">Defense</div>\n                    </div>\n                    <div class="equip-modal-stat crit">\n                        <div class="equip-modal-stat-value">+').concat(o.critBonus,'%</div>\n                        <div class="equip-modal-stat-label">Crit</div>\n                    </div>\n                </div>\n\n                <div class="equip-modal-durability">\n                    <div class="equip-modal-durability-header">\n                        <span class="equip-modal-durability-label">Durability</span>\n                        <span class="equip-modal-durability-value">').concat(r.current," / ").concat(r.max,'</span>\n                    </div>\n                    <div class="equip-modal-durability-bar">\n                        <div class="equip-modal-durability-fill ').concat(l,'" style="width: ').concat(s,'%"></div>\n                    </div>\n                </div>\n\n                ').concat(g,'\n\n                <div class="equip-modal-description">').concat(o.description,'</div>\n\n                <div class="equip-modal-buttons">\n                    <button class="equip-modal-btn unequip" id="equip_modal_unequip">\n                        <i class="fa-solid fa-circle-minus"></i> Unequip\n                    </button>\n                    <button class="equip-modal-btn repair" id="equip_modal_repair" ').concat(d?"":"disabled",'>\n                        <i class="fa-solid fa-wrench"></i> Repair\n                    </button>\n                    <button class="equip-modal-btn close" id="equip_modal_close">\n                        <i class="fa-solid fa-times"></i>\n                    </button>\n                </div>\n\n                <div class="equip-modal-repair-info">\n                    ').concat(h,"s: ").concat(c," available").concat(m?"":" (fully repaired)","\n                </div>\n            </div>\n        </div>\n    ");document.body.insertAdjacentHTML("beforeend",f),console.log("[MazeMaster] Equipment modal HTML inserted"),document.getElementById("equip_modal_close").addEventListener("click",Gi),console.log("[MazeMaster] Equipment modal event handlers attached"),document.getElementById("equip_modal_unequip").addEventListener("click",(async()=>{await async function(e){var t;if(null===(t=jt.equipment)||void 0===t||!t[e])return!1;const a=jt.equipment[e];return jt.equipment[e]=null,jt.equipmentInventory||(jt.equipmentInventory=[]),jt.equipmentInventory.push(a.id),Wi(),Si("Equipment","Unequipped ".concat(a.name,".")),await Y("onUnequip",{itemId:a.id,name:a.name,slot:e}),!0}(e),Gi()})),document.getElementById("equip_modal_repair").addEventListener("click",(async()=>{await async function(e){var t,a,n;const o=null===(t=jt.equipment)||void 0===t?void 0:t[e];if(!o)return!1;const i=(null===(a=jt.inventory)||void 0===a?void 0:a.repairKit)||0;if(i<=0)return Si("Repair","No repair kits available!"),!1;const r=Yi(o.id);if(r.current>=r.max)return Si("Repair","".concat(o.name," is already fully repaired.")),!1;jt.inventory.repairKit--,jt.inventory.repairKit<=0&&delete jt.inventory.repairKit;const s=Xe("repairKit"),l=(null==s?void 0:s.repairAmount)||3,c=ct[o.id];if("absorb"===(null==c||null===(n=c.special)||void 0===n?void 0:n.type)){jt.equipmentCharges||(jt.equipmentCharges={});const e=c.special.charges||3;jt.equipmentCharges[o.id]=Math.min((jt.equipmentCharges[o.id]||0)+l,e);const t=jt.equipmentCharges[o.id];Si("Repair","Restored ".concat(o.name," to ").concat(t,"/").concat(e," charges!"))}else{jt.equipmentDurability||(jt.equipmentDurability={});const e=(null==c?void 0:c.maxDurability)||10;jt.equipmentDurability[o.id]=Math.min((jt.equipmentDurability[o.id]||e)+l,e);const t=jt.equipmentDurability[o.id];Si("Repair","Restored ".concat(o.name," to ").concat(t,"/").concat(e," durability!"))}return Ri(),Wi(),await Y("onRepair",{itemId:o.id,name:o.name,slot:e}),!0}(e),Gi(),Ui(e)})),document.getElementById("mazemaster_equip_modal").addEventListener("click",(e=>{"mazemaster_equip_modal"===e.target.id&&Gi()}))}function Gi(){const e=document.getElementById("mazemaster_equip_modal");e&&e.remove()}function ji(e){var t,a;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const o=null===(t=jt.equipment)||void 0===t?void 0:t[e];if(!o)return!1;const i=ct[o.id];if(!i)return!1;if("absorb"===(null===(a=i.special)||void 0===a?void 0:a.type))return!1;jt.equipmentDurability||(jt.equipmentDurability={});const r=i.maxDurability||10;return void 0===jt.equipmentDurability[o.id]&&(jt.equipmentDurability[o.id]=r),jt.equipmentDurability[o.id]-=n,jt.equipmentDurability[o.id]<=0?(Si("Equipment","Your ".concat(o.name," broke!")),jt.equipment[e]=null,delete jt.equipmentDurability[o.id],Wi(),!0):(jt.equipmentDurability[o.id]<=2&&Si("Warning","Your ".concat(o.name," is about to break!")),!1)}const Ki={combatVictory:25,combatDifficultyBonus:5,lockedChest:20,normalChest:10,exploration10:20,objectiveComplete:50,bossDefeat:75};function Vi(e){const t=e-1;return{maxHpBonus:5*t,attackBonus:1*t,defenseBonus:1*t,skillPoints:t}}async function Xi(e){var t,a;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unknown";var o;if(null===(t=jt)||void 0===t||!t.isOpen||e<=0)return{xpGained:0,leveledUp:!1,newLevel:(null===(o=jt)||void 0===o||null===(o=o.character)||void 0===o?void 0:o.level)||1};const i=jt.character;i.level;i.xp+=e;const r=(null===(a=qt.maze.profiles)||void 0===a?void 0:a[jt.profileName])||{};r.onXpGain&&await Y(r.onXpGain,{amount:e,source:n,totalXp:i.xp,level:i.level});let s=0;for(;i.xp>=i.xpToNextLevel;){i.xp-=i.xpToNextLevel,i.level++,i.skillPoints++,i.xpToNextLevel=(l=i.level+1,Math.floor(100*Math.pow(1.5,l-1))),s++;const e=Vi(i.level);if(jt.hpEnabled&&jt.hp){const t=jt.hp.max;jt.hp.max=100+e.maxHpBonus+(jt.hp.maxBonus||0),jt.hp.current=Math.min(jt.hp.current+(jt.hp.max-t),jt.hp.max),updateHpDisplay()}r.onLevelUp&&await Y(r.onLevelUp,{newLevel:i.level,skillPointsAvailable:i.skillPoints,stats:e}),addToMessageLog("Level Up! You are now level ".concat(i.level,"!"),"success"),Za("level_up");const t=document.querySelector(".maze-container")||document.querySelector("#mazemaster_grid");t&&en("level_up",t)}var l;return Qi(),{xpGained:e,leveledUp:s>0,levelsGained:s,newLevel:i.level}}function Qi(){var e;if(null===(e=jt)||void 0===e||!e.isOpen)return;const t=jt.character,a=Fi(),n=Vi(t.level);$("#player_level").text(t.level),$("#player_xp_current").text(t.xp),$("#player_xp_needed").text(t.xpToNextLevel);const o=t.xp/t.xpToNextLevel*100;$("#player_xp_fill").css("width","".concat(o,"%")),jt.hpEnabled&&jt.hp?$("#player_stat_hp").text("".concat(jt.hp.current,"/").concat(jt.hp.max)):$("#player_stat_hp").text("Disabled");const i=n.attackBonus+a.attack;$("#player_stat_atk").html("".concat(i,' <span class="stat-bonus">').concat(n.attackBonus>0?"(+".concat(n.attackBonus," lvl"):"").concat(a.attack>0?" +".concat(a.attack," eq)"):n.attackBonus>0?")":"","</span>"));const r=n.defenseBonus+a.defense;$("#player_stat_def").html("".concat(r,' <span class="stat-bonus">').concat(n.defenseBonus>0?"(+".concat(n.defenseBonus," lvl"):"").concat(a.defense>0?" +".concat(a.defense," eq)"):n.defenseBonus>0?")":"","</span>"));const s=5+a.critBonus;$("#player_stat_crit").html("".concat(s,"% ").concat(a.critBonus>0?'<span class="stat-bonus">(+'.concat(a.critBonus,"% eq)</span>"):"")),$("#player_skill_points").text(t.skillPoints);const l=["weapon","armor","accessory"].map((e=>{var t;const a=jt.equipment[e];return'\n            <div class="equip-slot-row">\n                <span class="equip-slot-icon"><i class="fa-solid '.concat({weapon:"fa-sword",armor:"fa-shield",accessory:"fa-ring"}[e],'"></i></span>\n                <span class="equip-slot-name">').concat(e,'</span>\n                <span class="equip-slot-item').concat(a?"":" empty",'">').concat(a?(null===(t=Oi(a))||void 0===t?void 0:t.name)||a:"Empty","</span>\n            </div>\n        ")})).join("");$("#player_equip_summary").html(l)}function Ji(){console.log("[MazeMaster] togglePlayerPanel() called");const e=document.getElementById("maze_player_panel"),t=document.getElementById("maze_player_backdrop"),a=document.getElementById("maze_player_btn");if(console.log("[MazeMaster] Player panel elements - panel:",!!e,"backdrop:",!!t,"btn:",!!a),!e||!t)return void console.warn("[MazeMaster] Player panel elements not found!");const n="none"!==e.style.display&&""!==e.style.display;if(console.log("[MazeMaster] Panel currently visible:",n,"display:",e.style.display),n)e.style.display="none",t.style.display="none",null==a||a.classList.remove("active"),console.log("[MazeMaster] Player panel hidden");else{var o;if(null!==(o=jt)&&void 0!==o&&o.isOpen){jt.character||(jt.character={level:1,xp:0,xpToNextLevel:100,skillPoints:0}),jt.equipment||(jt.equipment={weapon:null,armor:null,accessory:null}),jt.skills||(jt.skills={learned:{},active:{}});try{Qi()}catch(e){console.warn("[MazeMaster] Error updating player stats:",e)}}e.style.display="flex",t.style.display="block",null==a||a.classList.add("active"),console.log("[MazeMaster] Player panel shown")}}function Zi(e){var t;if(null===(t=jt)||void 0===t||!t.isOpen||!jt.skills)return{canLearn:!1,reason:"No active maze"};const a=ht(e);if(!a)return{canLearn:!1,reason:"Skill not found"};const n=jt.skills.learned[e]||0;if(n>=a.ranks.length)return{canLearn:!1,reason:"Skill already maxed"};if(jt.character.skillPoints<=0)return{canLearn:!1,reason:"No skill points available"};if(0===n&&a.prerequisites.length>0)for(const e of a.prerequisites)if(!jt.skills.learned[e]){const t=ht(e);return{canLearn:!1,reason:"Requires ".concat((null==t?void 0:t.name)||e)}}return{canLearn:!0,reason:null}}async function $i(e){var t,a,n;let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=function(e){var t;let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null===(t=jt)||void 0===t||!t.isOpen||!jt.skills)return{canUse:!1,reason:"No active maze"};const n=ht(e);if(!n)return{canUse:!1,reason:"Skill not found"};if(!jt.skills.learned[e])return{canUse:!1,reason:"Skill not learned"};if("passive"===n.type)return{canUse:!1,reason:"Passive skills cannot be activated"};const o=jt.skills.cooldowns[e]||0;return o>0?{canUse:!1,reason:"On cooldown (".concat(o," turns)")}:a||n.usableOutsideCombat?{canUse:!0,reason:null}:{canUse:!1,reason:"Only usable in combat"}}(e,null!==(t=o.inCombat)&&void 0!==t?t:(null===(a=Ht)||void 0===a?void 0:a.isOpen)||!1);if(!i.canUse)return{success:!1,effect:null,message:i.reason};const r=ht(e),s=jt.skills.learned[e],l=ft(e,s);let c=r.cooldown;const m=jt.skills.learned.magic_mana_surge||0;if(m>0){const e=ft("magic_mana_surge",m);c=Math.max(0,c-(e.cooldownReduction||0))}c>0&&(jt.skills.cooldowns[e]=c),r.duration&&jt.skills.activeEffects.push({skillId:e,effect:l,turnsRemaining:r.duration,data:o});const d=(null===(n=qt.maze.profiles)||void 0===n?void 0:n[jt.profileName])||{};return d.onSkillUse&&await Y(d.onSkillUse,{skillId:e,skillName:r.name,rank:s,effect:JSON.stringify(l)}),ar(),{success:!0,effect:l,message:"Used ".concat(r.name,"!")}}async function er(e){var t;if(null===(t=Ht)||void 0===t||!t.isOpen)return{success:!1,message:"Not in combat"};const a=await $i(e,{inCombat:!0});if(!a.success)return a;ht(e);const n=a.effect;let o=0,i=null;switch(e){case"magic_fireball":o=n.damage||20,Ht.enemyHP=Math.max(0,Ht.enemyHP-o),Sn(!1,!0),En('<span class="tb-log-burn">Fireball hits for '.concat(o," fire damage!</span>")),100*Math.random()<(n.burnChance||20)&&(rr("enemy","burning"),i="burning",En('<span class="tb-log-burn">The enemy is burning!</span>'));break;case"magic_arcane_blast":o=n.damage||50,Ht.enemyHP=Math.max(0,Ht.enemyHP-o),Sn(!1,!0),En('<span class="tb-log-crit">Arcane Blast deals '.concat(o," damage!</span>"));break;case"combat_power_strike":En('<span class="tb-log-damage">You prepare a powerful strike!</span>');break;case"combat_berserker":rr("player","enraged",3),En('<span class="tb-log-crit">You enter a berserker rage!</span>');break;case"combat_execution":Ht.enemyHP/Ht.enemyMaxHP*100<=20?(Ht.enemyHP=0,En('<span class="tb-log-crit">EXECUTION! You slay the weakened enemy!</span>')):En('<span class="tb-log-damage">Enemy HP too high for Execution (needs 20%)</span>');break;case"magic_ice_shield":rr("player","shielded",n.duration||2),En('<span class="tb-log-freeze">You conjure an Ice Shield!</span>');break;case"stealth_smoke_bomb":return En('<span class="tb-log-flee">You throw a smoke bomb and escape!</span>'),Ht.isVictory=!1,Ht.isDefeat=!1,ur(),Rn("fled"),{success:!0,escaped:!0,message:"Escaped with Smoke Bomb!"};case"stealth_assassinate":if(Ht.isFirstStrike){const e=n.killChance||50;100*Math.random()<e?(Ht.enemyHP=0,En('<span class="tb-log-crit">ASSASSINATE! Instant kill from the shadows!</span>')):(o=Math.round(.5*Ht.enemyMaxHP),Ht.enemyHP=Math.max(0,Ht.enemyHP-o),Sn(!1,!0),En('<span class="tb-log-damage">Assassination attempt: '.concat(o," damage!</span>")))}else En('<span class="tb-log-damage">Assassinate only works on first strike!</span>');break;case"stealth_vanish":En('<span class="tb-log-flee">You vanish into the shadows...</span>')}return pr(),Ht.enemyHP<=0?(await Ln(),{success:!0,damage:o,statusApplied:i,victory:!0}):{success:!0,damage:o,statusApplied:i,effect:n}}function tr(){var e;if(null===(e=jt)||void 0===e||!e.isOpen)return;const t=$("#skill_tree_content");if(!t.length)return;const a=jt.character.skillPoints;$("#skill_points_display").text(a);let n="";for(const[e,t]of Object.entries(ut)){const a=gt(e).sort(((e,t)=>e.tier-t.tier));n+='\n            <div class="skill-tree" data-tree="'.concat(e,'">\n                <div class="skill-tree-header" style="border-color: ').concat(t.color,';">\n                    <i class="fa-solid ').concat(t.icon,'" style="color: ').concat(t.color,';"></i>\n                    <span>').concat(t.name,'</span>\n                </div>\n                <div class="skill-tree-skills">\n        ');for(const e of a){const a=jt.skills.learned[e.id]||0,o=e.ranks.length,i=Zi(e.id),r=a>0?ft(e.id,a):e.ranks[0],s=a>0?"learned":i.canLearn?"available":"locked",l="active"===e.type?"fa-bolt":"fa-circle";n+='\n                <div class="skill-node '.concat(s,'" data-skill="').concat(e.id,'" style="--tree-color: ').concat(t.color,';">\n                    <div class="skill-node-header">\n                        <i class="fa-solid ').concat(l,'"></i>\n                        <span class="skill-name">').concat(e.name,'</span>\n                        <span class="skill-rank">').concat(a,"/").concat(o,'</span>\n                    </div>\n                    <div class="skill-node-desc">').concat(r.description,"</div>\n                    ").concat(e.cooldown>0?'<div class="skill-cooldown"><i class="fa-solid fa-clock"></i> '.concat(e.cooldown," turns</div>"):"","\n                    ").concat(i.canLearn?'<button class="skill-learn-btn" data-skill="'.concat(e.id,'">Learn</button>'):"","\n                    ").concat(i.canLearn||0!==a?"":'<div class="skill-locked-reason">'.concat(i.reason,"</div>"),"\n                </div>\n            ")}n+="</div></div>"}t.html(n)}function ar(){var e;if(null===(e=jt)||void 0===e||!e.isOpen)return;const t=$("#ability_bar");if(!t.length)return;let a="";const n=jt.skills.abilityBar||[];for(let e=0;e<5;e++){const t=n[e],o=e+1;if(t){const n=ht(t),i=(jt.skills.learned[t],jt.skills.cooldowns[t]||0),r=ut[n.tree];a+='\n                <div class="ability-slot '.concat(0===i?"ready":"on-cooldown",'" data-skill="').concat(t,'" data-slot="').concat(e,'" style="--ability-color: ').concat(r.color,';">\n                    <span class="ability-hotkey">').concat(o,'</span>\n                    <span class="ability-name">').concat(n.name,"</span>\n                    ").concat(i>0?'<span class="ability-cooldown">'.concat(i,"</span>"):"","\n                </div>\n            ")}else a+='\n                <div class="ability-slot empty" data-slot="'.concat(e,'">\n                    <span class="ability-hotkey">').concat(o,'</span>\n                    <span class="ability-empty">-</span>\n                </div>\n            ')}t.html(a)}function nr(){console.log("[MazeMaster] toggleSkillTreePanel() called");const e=document.getElementById("maze_skill_panel"),t=document.getElementById("maze_skill_backdrop"),a=document.getElementById("maze_skills_btn");if(console.log("[MazeMaster] Skill panel elements - panel:",!!e,"backdrop:",!!t,"btn:",!!a),!e||!t)return void console.warn("[MazeMaster] Skill panel elements not found!");const n="none"!==e.style.display&&""!==e.style.display;if(console.log("[MazeMaster] Panel currently visible:",n,"display:",e.style.display),n)e.style.display="none",t.style.display="none",null==a||a.classList.remove("active"),console.log("[MazeMaster] Skill panel hidden");else{var o;if(null!==(o=jt)&&void 0!==o&&o.isOpen){jt.character||(jt.character={level:1,xp:0,xpToNextLevel:100,skillPoints:0}),jt.skills||(jt.skills={learned:{},active:{}});try{tr()}catch(e){console.warn("[MazeMaster] Error updating skill tree:",e)}}e.style.display="flex",t.style.display="block",null==a||a.classList.add("active"),console.log("[MazeMaster] Skill panel shown")}}function or(){const e=document.getElementById("maze_quest_panel"),t=document.getElementById("maze_quest_backdrop"),a=document.getElementById("maze_quest_btn");if(!e||!t)return void console.warn("[MazeMaster] Quest panel elements not found!");"none"!==e.style.display&&""!==e.style.display?(e.style.display="none",t.style.display="none",null==a||a.classList.remove("active")):(ir("active"),e.style.display="flex",t.style.display="block",null==a||a.classList.add("active"))}function ir(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"active";const t=$("#quest_list_content");if(!t.length)return;jt.quests||(jt.quests={active:[],available:[],completed:[],maxActive:3});let a="";if("active"===e)if(0===jt.quests.active.length)a='<div class="quest-empty-message">No active quests. Check available quests!</div>';else for(const e of jt.quests.active){var n,o;const t=kt(e.questId);if(!t)continue;const i=xt(t.type),r=e.progress||0,s=(null===(n=t.objective)||void 0===n?void 0:n.count)||1,l=Math.min(100,r/s*100);a+='\n                    <div class="quest-card" data-quest="'.concat(e.questId,'">\n                        <div class="quest-card-header">\n                            <h4 class="quest-card-title">').concat(t.name,'</h4>\n                            <span class="quest-card-type"><i class="fa-solid ').concat(i.icon,'"></i> ').concat(i.name,'</span>\n                        </div>\n                        <div class="quest-card-description">').concat(t.description,'</div>\n                        <div class="quest-progress-bar">\n                            <div class="quest-progress-fill" style="width: ').concat(l,'%;"></div>\n                        </div>\n                        <div class="quest-progress-text">').concat(r," / ").concat(s,'</div>\n                        <div class="quest-rewards">\n                            ').concat(null!==(o=t.rewards)&&void 0!==o&&o.xp?'<span class="quest-reward-item"><i class="fa-solid fa-star"></i> '.concat(t.rewards.xp," XP</span>"):"",'\n                        </div>\n                        <div class="quest-actions">\n                            <button class="quest-abandon-btn" data-quest="').concat(e.questId,'">Abandon</button>\n                        </div>\n                    </div>\n                ')}else if("available"===e)if(0===jt.quests.available.length)a='<div class="quest-empty-message">No quests available at this time.</div>';else for(const e of jt.quests.available){var i,r,s;const t=kt(e.questId);if(!t)continue;const n=xt(t.type),o=(null===(i=t.objective)||void 0===i?void 0:i.count)||1;a+='\n                    <div class="quest-card" data-quest="'.concat(e.questId,'">\n                        <div class="quest-card-header">\n                            <h4 class="quest-card-title">').concat(t.name,'</h4>\n                            <span class="quest-card-type"><i class="fa-solid ').concat(n.icon,'"></i> ').concat(n.name,'</span>\n                        </div>\n                        <div class="quest-card-description">').concat(t.description,'</div>\n                        <div class="quest-progress-text">Objective: ').concat(o," ").concat((null===(r=t.objective)||void 0===r?void 0:r.target)||"progress",'</div>\n                        <div class="quest-rewards">\n                            ').concat(null!==(s=t.rewards)&&void 0!==s&&s.xp?'<span class="quest-reward-item"><i class="fa-solid fa-star"></i> '.concat(t.rewards.xp," XP</span>"):"",'\n                        </div>\n                        <div class="quest-actions">\n                            <button class="quest-accept-btn" data-quest="').concat(e.questId,'">Accept Quest</button>\n                        </div>\n                    </div>\n                ')}else if("completed"===e)if(0===jt.quests.completed.length)a='<div class="quest-empty-message">No quests completed yet.</div>';else for(const e of jt.quests.completed){const t=kt(e);if(!t)continue;const n=xt(t.type);a+='\n                    <div class="quest-card" data-quest="'.concat(e,'">\n                        <div class="quest-card-header">\n                            <h4 class="quest-card-title">').concat(t.name,'</h4>\n                            <span class="quest-completed-badge"><i class="fa-solid fa-check-circle"></i> Completed</span>\n                        </div>\n                        <div class="quest-card-description">').concat(t.description,'</div>\n                        <div class="quest-card-type"><i class="fa-solid ').concat(n.icon,'"></i> ').concat(n.name,"</div>\n                    </div>\n                ")}t.html(a)}function rr(e,t){var a;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null===(a=Ht)||void 0===a||!a.isOpen)return!1;const o=vt(t);if(!o)return!1;const i="player"===e?Ht.playerStatusEffects:Ht.enemyStatusEffects,r=i.find((e=>e.effectId===t));if(r)return r.turnsRemaining=Math.max(r.turnsRemaining,n||o.duration),!0;i.push({effectId:t,turnsRemaining:n||o.duration});return En("".concat("player"===e?"You":"Enemy"," ").concat(o.applyMessage)),pr(),!0}function sr(e,t){var a;if(null===(a=Ht)||void 0===a||!a.isOpen)return;const n="player"===e?Ht.playerStatusEffects:Ht.enemyStatusEffects,o=n.findIndex((e=>e.effectId===t));if(-1!==o){const a=vt(t);En("".concat("player"===e?"You":"Enemy"," ").concat(a.expireMessage)),n.splice(o,1),pr()}}function lr(e){var t;if(null===(t=Ht)||void 0===t||!t.isOpen)return!1;const a="player"===e?Ht.playerStatusEffects:Ht.enemyStatusEffects;for(const t of a){const a=vt(t.effectId);if(null!=a&&a.skipTurn){return En("".concat("player"===e?"You are":"Enemy is"," ").concat(a.tickMessage,"!")),!0}}return!1}function cr(e){var t;if(null===(t=Ht)||void 0===t||!t.isOpen)return 0;const a="player"===e?Ht.playerStatusEffects:Ht.enemyStatusEffects;let n=0;const o=[];for(const t of a){const a=vt(t.effectId);if(a){if("dot"===a.type&&a.dotPercent){const t="player"===e?Ht.playerMaxHP:Ht.enemyMaxHP,o=Math.max(1,Math.floor(t*a.dotPercent/100));n+=o;En("".concat("player"===e?"You take":"Enemy takes"," ").concat(o," ").concat(a.name.toLowerCase()," damage!"))}t.turnsRemaining--,t.turnsRemaining<=0&&o.push(t.effectId)}}for(const t of o)sr(e,t);return n}function mr(e){var t;const a={damageBonus:0,damageReduction:0};if(null===(t=Ht)||void 0===t||!t.isOpen)return a;const n="player"===e?Ht.playerStatusEffects:Ht.enemyStatusEffects;for(const e of n){const t=vt(e.effectId);t&&(t.damageBonus&&(a.damageBonus+=t.damageBonus),t.damageReduction&&"debuff"===t.type&&(a.damageReduction+=t.damageReduction))}return a}function dr(e){var t;const a={damageReduction:0};if(null===(t=Ht)||void 0===t||!t.isOpen)return a;const n="player"===e?Ht.playerStatusEffects:Ht.enemyStatusEffects;for(const e of n){const t=vt(e.effectId);t&&(t.damageReduction&&"buff"===t.type&&(a.damageReduction+=t.damageReduction))}return a}function ur(){Ht&&(Ht.playerStatusEffects=[],Ht.enemyStatusEffects=[])}function pr(){var e;if(null===(e=Ht)||void 0===e||!e.isOpen)return;const t=Ht.playerStatusEffects.map((e=>{const t=vt(e.effectId);return t?'<span class="status-effect-icon" style="color: '.concat(t.color,';" title="').concat(t.name," (").concat(e.turnsRemaining,' turns)">\n            <i class="fa-solid ').concat(t.icon,'"></i>\n        </span>'):""})).join(""),a=Ht.enemyStatusEffects.map((e=>{const t=vt(e.effectId);return t?'<span class="status-effect-icon" style="color: '.concat(t.color,';" title="').concat(t.name," (").concat(e.turnsRemaining,' turns)">\n            <i class="fa-solid ').concat(t.icon,'"></i>\n        </span>'):""})).join("");$("#tb_player_status_effects").html(t),$("#tb_enemy_status_effects").html(a)}async function hr(e,t,a){var n;jt.isPaused=!0,jt.pendingChest={chestData:e,x:t,y:a};let o="locked"===e.type,i=!1;o&&0===jt.inventory.key&&function(e){var t;if(null===(t=jt)||void 0===t||!t.fairness)return!1;const a=(null==e?void 0:e.fairness)||{};if(!1===a.enabled)return!1;if(!1===a.mercyUnlock)return!1;const n=jt.fairness,o=a.mercyUnlockThreshold||2;if(0===jt.inventory.key&&n.lockedChestsSkipped>=o)return console.log("[MazeMaster] Fairness: Mercy unlock triggered (".concat(n.lockedChestsSkipped," locked chests skipped)")),n.lockedChestsSkipped=0,Ei("Lucky break: Found the chest already unlocked!","Fairness"),!0;return!1}(jt.profile)&&(o=!1,i=!0,e.mercyUnlocked=!0);const r=jt.inventory.key>0;let s;s=i?"The lock on this chest is broken! Lucky you!":o?r?"A locked chest! Use a key to open it?":"A locked chest! You need a Key to open it.":"You found a chest!",jt.currentMinion={name:o?"Locked Chest":"Chest",imagePath:"",message:s},Ii();const l=(null===(n=jt.profile)||void 0===n||null===(n=n.storyConfig)||void 0===n?void 0:n.mainStory)||"";Mi(!0);try{const e=await async function(e){const{chestType:t,baseMessage:a,mainStory:n,hasKey:o}=e;if(!a)return"";if(!1===qt.llmEnabled)return a;if("function"!=typeof h)return a;const i="locked"===t?o?"a locked treasure chest - the player has a key to open it":"a locked treasure chest - the player lacks the key":"a treasure chest waiting to be opened",r=oe(),s="The player ".concat(r," has discovered ").concat(i," in a maze.\n\n").concat(n?"Story Setting: ".concat(n,"\n\n"):"",'Based on this chest discovery message: "').concat(a,'"\n\nWrite a short, atmospheric description of finding the chest (1-2 sentences, under 100 characters). Make it feel rewarding and mysterious. You may reference the player by name. Do not use quotation marks.');try{console.log("[MazeMaster] Generating LLM message for chest");const e=await h(s,{quietToLoud:!1,skipWIAN:!0,skipWI:!0,max_length:80});if(e&&e.trim()){let t=e.trim();return t=t.replace(/^["']|["']$/g,""),t=t.replace(/^["""''']|["""''']$/g,""),console.log("[MazeMaster] Generated chest message:",t),t}}catch(e){console.error("[MazeMaster] Chest LLM generation failed:",e)}return a}({chestType:o?"locked":"normal",baseMessage:s,mainStory:l,hasKey:r});jt.currentMinion.message=e,Ii()}catch(e){console.error("[MazeMaster] Chest message generation failed:",e)}finally{Mi(!1)}!function(e,t){var a,n,o;let i="";i=e?t?'\n                <button id="maze_chest_unlock" class="menu_button maze-confirm-btn">Unlock</button>\n                <button id="maze_chest_ignore" class="menu_button maze-confirm-btn">Ignore</button>\n            ':'\n                <button id="maze_chest_ignore" class="menu_button maze-confirm-btn">Continue</button>\n            ':'\n            <button id="maze_chest_open" class="menu_button maze-confirm-btn">Open</button>\n            <button id="maze_chest_ignore" class="menu_button maze-confirm-btn">Ignore</button>\n        ';Tr(i),null===(a=document.getElementById("maze_chest_open"))||void 0===a||a.addEventListener("click",gr),null===(n=document.getElementById("maze_chest_unlock"))||void 0===n||n.addEventListener("click",fr),null===(o=document.getElementById("maze_chest_ignore"))||void 0===o||o.addEventListener("click",yr)}(o,r)}function gr(){Ir();const{chestData:e,x:t,y:a}=jt.pendingChest||{};e&&(jt.grid[a][t].chest.opened=!0,wi(),"mimic"!==e.type?e.mercyUnlocked?zr(t,a):async function(e,t){jt.pendingChest=null;const a=jt.profile,n=jt.grid[t][e].chest,o=kr(a,!1);if(Za("chest_open"),n.guaranteedItems&&n.guaranteedItems.length>0)for(const e of n.guaranteedItems)void 0!==o[e]?o[e]++:o[e]=1;n.guaranteedFloorKey&&(o.floorKey=(o.floorKey||0)+1,console.log("[MazeMaster] Chest at (".concat(e,", ").concat(t,") gave guaranteed floor key")));Cr(o),Er(o,"Chest"),await Xi(Ki.normalChest,"chest"),await wt("fetch","chest",1),o.key>0&&await wt("fetch","key",o.key);_r(o);const i=Object.entries(o).filter((e=>{let[t,a]=e;return a>0})).map((e=>{let[t,a]=e;return"".concat(t,"x").concat(a)}));Ei("Opened chest: ".concat(i.length>0?i.join(", "):"empty"),"Loot"),await ie("chestsOpened",1),await Y("onChestOpen",{type:"normal",loot:JSON.stringify(o),x:e,y:t})}(t,a):Sr(t,a))}function fr(){Ir();const{chestData:e,x:t,y:a}=jt.pendingChest||{};e&&(Hi("key"),jt.grid[a][t].chest.opened=!0,wi(),"mimic"!==e.type?zr(t,a):Sr(t,a))}function yr(){var e;Ir(),"locked"===(null===(e=jt)||void 0===e||null===(e=e.pendingChest)||void 0===e||null===(e=e.chestData)||void 0===e?void 0:e.type)&&0===jt.inventory.key&&jt.fairness&&(jt.fairness.lockedChestsSkipped++,console.log("[MazeMaster] Fairness: Locked chest skipped (total: ".concat(jt.fairness.lockedChestsSkipped,")"))),jt.pendingChest=null,qi()}async function vr(){var e,t;Ir();const{x:a,y:n}=jt.pendingSafeRoom||{};if(void 0===a||void 0===n)return;const o=null!==(e=(jt.profile||{}).safeRoomHealPercent)&&void 0!==e?e:100;await V(o,!0,"safeRoom"),null!==(t=jt.grid[n])&&void 0!==t&&null!==(t=t[a])&&void 0!==t&&t.safeRoom&&(jt.grid[n][a].safeRoom.exhausted=!0),wi(),Si("Safe Room","You rest and recover ".concat(o,"% of your health.")),jt.pendingSafeRoom=null,qi()}function br(){Ir(),Si("Safe Room","You leave the sanctuary undisturbed. You can return later."),jt.pendingSafeRoom=null,qi()}async function zr(e,t){jt.pendingChest=null;const a=jt.profile,n=jt.grid[t][e].chest,o=kr(a,!0);if(Za("chest_unlock"),n.guaranteedItems&&n.guaranteedItems.length>0)for(const e of n.guaranteedItems)void 0!==o[e]?o[e]++:o[e]=1;n.guaranteedFloorKey&&(o.floorKey=(o.floorKey||0)+1,console.log("[MazeMaster] Locked chest at (".concat(e,", ").concat(t,") gave guaranteed floor key"))),Cr(o),Er(o,"Locked Chest"),await Xi(Ki.lockedChest,"lockedChest"),await wt("fetch","chest",1),o.key>0&&await wt("fetch","key",o.key),_r(o);const i=Object.entries(o).filter((e=>{let[t,a]=e;return a>0})).map((e=>{let[t,a]=e;return"".concat(t,"x").concat(a)}));Ei("Opened locked chest: ".concat(i.length>0?i.join(", "):"empty"),"Loot"),await ie("chestsOpened",1),await Y("onChestOpen",{type:"locked",loot:JSON.stringify(o),x:e,y:t})}function _r(e){var t;if(null===(t=jt)||void 0===t||!t.fairness)return;const a=jt.fairness;e.key>0?a.chestsWithoutKey=0:a.chestsWithoutKey++;e.healingPotion>0||e.greaterHealing>0||e.elixir>0?(a.chestsWithoutHealing=0,a.lastHealingFoundFloor=jt.currentFloor):a.chestsWithoutHealing++}const xr={key:{locked:40,unlocked:30},strike:{locked:60,unlocked:50},stealth:{locked:30,unlocked:0},execute:{locked:5,unlocked:0},floorKey:{locked:20,unlocked:10},portalStone:{locked:15,unlocked:8},minionBane:{locked:12,unlocked:5},mapFragment:{locked:25,unlocked:15},timeShard:{locked:10,unlocked:5},voidWalk:{locked:8,unlocked:3},healingPotion:{locked:35,unlocked:20,requiresHp:!0},greaterHealing:{locked:15,unlocked:8,requiresHp:!0},elixir:{locked:5,unlocked:2,requiresHp:!0},revivalCharm:{locked:3,unlocked:1,requiresHp:!0},heartCrystal:{locked:2,unlocked:.5,requiresHp:!0},torch:{locked:18,unlocked:10},lantern:{locked:8,unlocked:4},revealScroll:{locked:6,unlocked:3},sightPotion:{locked:4,unlocked:2},crystalBall:{locked:5,unlocked:2},ironGuard:{locked:8,unlocked:3}};function kr(e,t){var a;const n={},o=Qe();for(const e of o)n[e]=0;const i=e.chestLootMin||1,r=e.chestLootMax||2,s=i+Math.floor(Math.random()*(r-i+1)),l=U(e).chestLootMult||1,c={};for(const[a,n]of Object.entries(xr)){var m,d;if(n.requiresHp&&!1===e.hpEnabled){c[a]=0;continue}const o=a.charAt(0).toUpperCase()+a.slice(1),i=t?null!==(m=e["lockedChest".concat(o,"Chance")])&&void 0!==m?m:n.locked:null!==(d=e["chest".concat(o,"Chance")])&&void 0!==d?d:n.unlocked;c[a]=i*l}if(t){const t=1+(e.chestLockedBonusPercent||50)/100;for(const e of Object.keys(c))c[e]=Math.min(100,c[e]*t)}const u=e.fairness||{};if(!1!==u.enabled&&null!==(a=jt)&&void 0!==a&&a.fairness){const t=jt.fairness;if(t.chestsWithoutKey>=(u.keyPityThreshold||3)){const e=Math.min(50,15*t.chestsWithoutKey);c.key=Math.min(100,(c.key||0)+e),console.log("[MazeMaster] Fairness: Key pity active (+".concat(e,"% key chance)"))}if(!1!==e.hpEnabled&&jt.hpEnabled&&jt.hp){const e=jt.hp.current/(jt.hp.max+jt.hp.maxBonus);if(e<=(u.lowHpThreshold||.4)){const t=Math.round(40*(1-e));c.healingPotion=Math.min(100,(c.healingPotion||0)+t),c.greaterHealing=Math.min(100,(c.greaterHealing||0)+t/2),console.log("[MazeMaster] Fairness: Low HP pity (+".concat(t,"% healing chance)"))}if(t.chestsWithoutHealing>=(u.healingPityThreshold||4)){const e=Math.min(30,8*t.chestsWithoutHealing);c.healingPotion=Math.min(100,(c.healingPotion||0)+e),console.log("[MazeMaster] Fairness: Healing drought pity (+".concat(e,"%)"))}}}for(let t=0;t<s;t++)for(const[t,a]of Object.entries(c))a>0&&at(t,e)&&100*Math.random()<a&&n[t]++;return n}function Cr(e){for(const[t,a]of Object.entries(e))a>0&&Ni(t,a)}function wr(e,t){jt.currentMinion={name:t,imagePath:"",message:e},Ii()}function Er(e,t){var a;const n=[],o=(null===(a=jt.profile)||void 0===a?void 0:a.theme)||"fantasy";for(const[t,a]of Object.entries(e))if(a>0){const e=nt(t,o),i=(e.slice(-1).toLowerCase(),/[chxs]$/.test(e.toLowerCase())||e.toLowerCase().endsWith("sh")),r=a>1?i?"es":"s":"";n.push("".concat(a," ").concat(e).concat(r))}wr(n.length>0?"You found: ".concat(n.join(", "),"!"):"The chest was empty!",t),setTimeout((()=>qi()),2e3)}function Sr(e,t){jt.pendingChest=null;const a=aa();if(a.length>0){const e=a[Math.floor(Math.random()*a.length)];jt.pendingEncounter={type:"mimic_battlebar",profile:e},jt.currentMinion={name:"Mimic!",imagePath:"",message:"The chest was a mimic! Prepare to fight!"},Ii(),setTimeout((()=>{Io(e)}),1e3)}else wr("The chest was empty... and creepy.","Mimic"),setTimeout((()=>qi()),1500)}function Tr(e){const t=document.getElementById("maze_action_popup"),a=document.getElementById("maze_action_popup_buttons");if(!t||!a)return;a.innerHTML=e,t.style.display="flex";const n=document.getElementById("maze_encounter_confirm");n&&(n.style.display="none",n.innerHTML="")}function Ir(){const e=document.getElementById("maze_action_popup"),t=document.getElementById("maze_action_popup_buttons");e&&(e.style.display="none"),t&&(t.innerHTML="");const a=document.getElementById("maze_encounter_confirm");a&&(a.style.display="none",a.innerHTML="")}function Mr(){Ir(),jt.pendingConfirmation=null,qi()}function Pr(){console.log("[MazeMaster] handleConfirmAction called"),Ir();const e=jt.pendingConfirmation;if(console.log("[MazeMaster] pendingConfirmation:",e),!e)return void console.warn("[MazeMaster] No pending confirmation, returning");const t=pn(e.minionId);switch(console.log("[MazeMaster] Minion for encounter:",e.minionId,t),console.log("[MazeMaster] Encounter type:",e.type),jt.pendingConfirmation=null,e.type){case"battlebar":{const e=bi(t.battlebarProfiles);console.log("[MazeMaster] Battlebar profiles:",t.battlebarProfiles,"-> selected:",e),e?(jt.pendingEncounter={type:"battlebar",profile:e,minionName:t.name},Io(e,t.name)):(console.warn("[MazeMaster] No battlebar profile found, resuming maze"),qi());break}case"prizewheel":{const e=bi(t.wheelProfiles);if(console.log("[MazeMaster] Wheel profiles:",t.wheelProfiles,"-> selected:",e),e){const t=vn(e);t.error?(console.warn('[MazeMaster] Wheel profile "'.concat(e,'" failed to load: ').concat(t.error,". Resuming maze.")),qi()):(jt.pendingEncounter={type:"wheel",profile:e},xn())}else console.warn("[MazeMaster] No wheel profile found, resuming maze"),qi();break}case"turnbased":{const e=bi(t.turnbasedProfiles);console.log("[MazeMaster] Turnbased profiles:",t.turnbasedProfiles,"-> selected:",e),e?(jt.pendingEncounter={type:"turnbased",profile:e,minionName:t.name},console.log("[MazeMaster] Calling startTurnBased with profile:",e),Cn(e,t.name)):(console.warn("[MazeMaster] No turnbased profile found, resuming maze"),qi());break}case"qte":{const e=bi(t.qteProfiles);console.log("[MazeMaster] QTE profiles:",t.qteProfiles,"-> selected:",e),e?(jt.pendingEncounter={type:"qte",profile:e,minionName:t.name},console.log("[MazeMaster] Calling startQTE with profile:",e),On(e,t.name)):(console.warn("[MazeMaster] No QTE profile found, resuming maze"),qi());break}case"dice":{const e=bi(t.diceProfiles);console.log("[MazeMaster] Dice profiles:",t.diceProfiles,"-> selected:",e),e?(jt.pendingEncounter={type:"dice",profile:e,minionName:t.name},console.log("[MazeMaster] Calling startDice with profile:",e),Xn(e,t.name)):(console.warn("[MazeMaster] No dice profile found, resuming maze"),qi());break}case"stealth":{const e=bi(t.stealthProfiles);console.log("[MazeMaster] Stealth profiles:",t.stealthProfiles,"-> selected:",e),e?(jt.pendingEncounter={type:"stealth",profile:e,minionName:t.name},console.log("[MazeMaster] Calling startStealth with profile:",e),ao(e,t.name)):(console.warn("[MazeMaster] No stealth profile found, resuming maze"),qi());break}case"puzzle":{const e=bi(t.puzzleProfiles);console.log("[MazeMaster] Puzzle profiles:",t.puzzleProfiles,"-> selected:",e),e?(jt.pendingEncounter={type:"puzzle",profile:e,minionName:t.name},console.log("[MazeMaster] Calling startPuzzle with profile:",e),lo(e,t.name)):(console.warn("[MazeMaster] No puzzle profile found, resuming maze"),qi());break}case"negotiation":{const e=bi(t.negotiationProfiles);console.log("[MazeMaster] Negotiation profiles:",t.negotiationProfiles,"-> selected:",e),e?(jt.pendingEncounter={type:"negotiation",profile:e,minionName:t.name},console.log("[MazeMaster] Calling startNegotiation with profile:",e),yo(e,t.name)):(console.warn("[MazeMaster] No negotiation profile found, resuming maze"),qi());break}default:console.warn("[MazeMaster] Unknown encounter type: ".concat(e.type)),qi()}}function Dr(){Ir(),jt.inventory.stealth>0&&(Hi("stealth"),jt.pendingConfirmation=null,qi())}function Ar(){const e=jt.pendingConfirmation;e&&"merchant"===e.type&&(Ir(),function(e,t){const a=pn(e);if(!a)return;Co={isOpen:!0,minionId:e,minion:a,offeredItems:t,selectedItem:null};const n=document.getElementById("mazemaster_merchant_modal");if(n&&n.remove(),!document.getElementById("mazemaster_merchant_styles")){const e=document.createElement("style");e.id="mazemaster_merchant_styles",e.textContent="\n        .mazemaster-merchant-container {\n            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f1a 100%);\n            border: 2px solid #d4af37;\n            border-radius: 15px;\n            padding: 25px;\n            min-width: 400px;\n            max-width: 600px;\n            box-shadow: 0 0 40px rgba(212, 175, 55, 0.3);\n            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n            color: #e0e0e0;\n        }\n\n        .merchant-header {\n            text-align: center;\n            margin-bottom: 20px;\n        }\n\n        .merchant-title {\n            font-size: 1.8em;\n            font-weight: bold;\n            color: #d4af37;\n            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);\n            margin-bottom: 5px;\n        }\n\n        .merchant-subtitle {\n            font-size: 1em;\n            color: #aaa;\n            font-style: italic;\n        }\n\n        .merchant-items-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n            gap: 15px;\n            margin-bottom: 20px;\n            max-height: 400px;\n            overflow-y: auto;\n            padding: 10px;\n        }\n\n        .merchant-item-card {\n            background: rgba(0, 0, 0, 0.4);\n            border: 2px solid #444;\n            border-radius: 12px;\n            padding: 15px;\n            text-align: center;\n            cursor: pointer;\n            transition: all 0.3s ease;\n            position: relative;\n        }\n\n        .merchant-item-card:hover {\n            border-color: #d4af37;\n            transform: translateY(-2px);\n            box-shadow: 0 5px 20px rgba(212, 175, 55, 0.3);\n        }\n\n        .merchant-item-card.selected {\n            border-color: #4ade80;\n            background: rgba(74, 222, 128, 0.15);\n            box-shadow: 0 0 25px rgba(74, 222, 128, 0.4);\n        }\n\n        .merchant-item-card.selected::after {\n            content: '';\n            position: absolute;\n            top: 5px;\n            right: 8px;\n            font-size: 1.2em;\n            color: #4ade80;\n        }\n\n        .merchant-item-icon {\n            font-size: 2.5em;\n            margin-bottom: 10px;\n            display: block;\n        }\n\n        .merchant-item-name {\n            font-size: 1.1em;\n            font-weight: bold;\n            color: #d4af37;\n            margin-bottom: 5px;\n        }\n\n        .merchant-item-description {\n            font-size: 0.85em;\n            color: #888;\n            line-height: 1.3;\n        }\n\n        .merchant-footer {\n            display: flex;\n            gap: 15px;\n            justify-content: center;\n        }\n\n        .merchant-btn {\n            padding: 12px 25px;\n            border: none;\n            border-radius: 8px;\n            cursor: pointer;\n            font-size: 1em;\n            font-weight: bold;\n            transition: all 0.2s ease;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .merchant-take-btn {\n            background: linear-gradient(135deg, #27ae60 0%, #1e8449 100%);\n            color: white;\n        }\n\n        .merchant-take-btn:disabled {\n            background: #444;\n            cursor: not-allowed;\n            opacity: 0.6;\n        }\n\n        .merchant-take-btn:not(:disabled):hover {\n            transform: scale(1.05);\n            box-shadow: 0 0 15px rgba(39, 174, 96, 0.5);\n        }\n\n        .merchant-decline-btn {\n            background: linear-gradient(135deg, #7f8c8d 0%, #5a6c7d 100%);\n            color: white;\n        }\n\n        .merchant-decline-btn:hover {\n            transform: scale(1.05);\n            box-shadow: 0 0 15px rgba(127, 140, 141, 0.5);\n        }\n    ",document.head.appendChild(e)}document.body.insertAdjacentHTML("beforeend",'\n        <div id="mazemaster_merchant_modal" style="position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:999999;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.9);">\n            <div class="mazemaster-merchant-container">\n                <div class="merchant-header">\n                    <div id="merchant_title" class="merchant-title">Merchant Wares</div>\n                    <div id="merchant_subtitle" class="merchant-subtitle">Choose one item to take</div>\n                </div>\n\n                <div id="merchant_items" class="merchant-items-grid">\n                    \x3c!-- Items will be dynamically inserted here --\x3e\n                </div>\n\n                <div class="merchant-footer">\n                    <button id="merchant_take_btn" class="merchant-btn merchant-take-btn" disabled>\n                        <i class="fa-solid fa-hand"></i> Take Selected Item\n                    </button>\n                    <button id="merchant_decline_btn" class="merchant-btn merchant-decline-btn">\n                        <i class="fa-solid fa-xmark"></i> Leave Without Taking\n                    </button>\n                </div>\n            </div>\n        </div>\n    '),document.getElementById("merchant_title").textContent=a.name||"Merchant Wares";const o=document.getElementById("merchant_items");o.innerHTML=t.map(((e,t)=>'\n        <div class="merchant-item-card" data-item-index="'.concat(t,'" data-item-id="').concat(e.id,'">\n            <span class="merchant-item-icon">').concat(e.icon||"",'</span>\n            <div class="merchant-item-name">').concat(e.name,'</div>\n            <div class="merchant-item-description">').concat(e.description,"</div>\n        </div>\n    "))).join(""),o.querySelectorAll(".merchant-item-card").forEach((e=>{e.addEventListener("click",(()=>{o.querySelectorAll(".merchant-item-card").forEach((e=>e.classList.remove("selected"))),e.classList.add("selected"),Co.selectedItem=t[parseInt(e.dataset.itemIndex)],document.getElementById("merchant_take_btn").disabled=!1}))})),document.getElementById("merchant_take_btn").addEventListener("click",Eo),document.getElementById("merchant_decline_btn").addEventListener("click",So)}(e.minionId,e.offeredItems||[]))}function Br(){Ir(),jt.pendingConfirmation=null,qi()}function Lr(){jt.isVictory=!1,jt.isPaused=!0,Ei("DEFEAT! Adventure ended.","End"),ue(),me("lose"),Kt.maze[jt.profileName]={result:"lose",timestamp:Date.now()},document.getElementById("maze_minion_name").textContent="Defeat!",Si("Defeat!","You have been defeated...");const e=document.getElementById("maze_minion_img");e&&(e.style.display="none");const t=document.getElementById("maze_close_btn");t&&(t.style.display=""),jt.profile.loseCommand&&W(jt.profile.loseCommand),document.removeEventListener("keydown",Di,{capture:!0})}function qr(){jt.playerX=0,jt.playerY=0,jt.isPaused=!1,jt.pendingEncounter=null,wi(),fe();const e=jt.profile;if(e.mainMinion){const t=pn(e.mainMinion);if(t)return jt.currentMinion={name:t.name,imagePath:t.imagePath,message:"Back to the beginning with you!"},void Ii()}jt.currentMinion={name:"The Maze",imagePath:"",message:"Find your way to the exit..."},Ii()}async function Rr(){jt.isVictory=!0,Ei("VICTORY! Maze completed.","End"),ue(),me("win"),Kt.maze[jt.profileName]={result:"win",timestamp:Date.now()},Ii(),wi();const e=document.getElementById("maze_close_btn");e&&(e.style.display="");const t=document.querySelector(".mazemaster-maze-controls");t&&(t.style.display="none"),document.removeEventListener("keydown",Di,{capture:!0}),jt.profile.winCommand&&await W(jt.profile.winCommand),console.log('[MazeMaster] Maze "'.concat(jt.profileName,'" completed!')),await zi(2500),Ci();const a=document.querySelector('.mazemaster-tab[data-tab="game"]');a&&a.click()}function Nr(){var e,t,a,n,o,i,r,s,l,c,m,d,u,p,h,g,f,y,v,b,z,_,x,k,C,w,E,T,I,P,D,A,B,L,q,R,N,H,O,F,W,Y,U,G,j,K,V,X,Q,J,Z,$,ee,te,ae,ne,oe,ie,re,se,le,ce,me,de,ue,pe,he,ge,fe,ye,ve,be,ze,_e,xe,ke,Ce,we,Ee,Se,Te,Ie,Me,Pe,De,Ae,Be,Le,qe,Re,Ne,He,Oe,Fe,We,Ye,Ue,je,Ve,Je;const Ze=ea(),at=qt.currentProfile||"Tutorial - Learn the Wheel",nt=aa(),ot=qt.currentBattlebarProfile||"Tutorial - Learn Combat",it=na(ot)||{},rt=Pa(),st=qt.currentMazeProfile||"Tutorial - Learn the Basics",lt=Da(st)||{},ct=un(),mt=qt.activeGameConfig||"maze",dt=function(){const e=qt.combatMechanicsProfiles||{},t=Object.keys(e);return[...new Set(["default","aggressive","defensive","classic",...t])]}(),ut=qt.currentCombatMechanicsProfile||"default",pt=ka(ut)||Ge.default;return'\n        <div class="mazemaster-panel">\n            <div class="mazemaster-panel-header">\n                <h2><i class="fa-solid fa-gamepad"></i> MazeMaster</h2>\n            </div>\n            <div class="mazemaster-tabs">\n                <button class="mazemaster-tab active" data-tab="game">Game</button>\n                <button class="mazemaster-tab" data-tab="config">Config</button>\n                <button class="mazemaster-tab" data-tab="help">Help</button>\n            </div>\n            <div class="mazemaster-panel-content">\n                \x3c!-- GAME TAB --\x3e\n                <div class="mazemaster-tab-content active" id="mazemaster-tab-game">\n                    <div class="mazemaster-game-launch">\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Maze Profile</label>\n                            <select id="mazemaster_play_profile" class="mazemaster-select">\n                                '.concat(0===rt.length?'<option value="">No profiles</option>':"","\n                                ").concat(rt.map((e=>'<option value="'.concat(Or(e),'" ').concat(e===st?"selected":"",">").concat(Or(e),"</option>"))).join(""),'\n                            </select>\n                        </div>\n                        <button id="mazemaster_play_maze" class="menu_button menu_button_primary mazemaster-play-btn">\n                            <i class="fa-solid fa-play"></i> Play Maze\n                        </button>\n                    </div>\n\n                    \x3c!-- Maze Preview Panel --\x3e\n                    <div class="mazemaster-section" id="mazemaster_maze_preview">\n                        <div class="mazemaster-preview-header">\n                            <span class="preview-title" id="preview_title">Select a maze to see details</span>\n                        </div>\n                        <div class="mazemaster-preview-content" id="preview_content" style="display: none;">\n                            <div class="preview-story" id="preview_story"></div>\n                            <div class="preview-stats">\n                                <div class="stat-row"><span class="stat-label">Theme:</span><span class="stat-value" id="preview_theme"></span></div>\n                                <div class="stat-row"><span class="stat-label">Style:</span><span class="stat-value" id="preview_style"></span></div>\n                                <div class="stat-row"><span class="stat-label">Difficulty:</span><span class="stat-value" id="preview_difficulty"></span></div>\n                                <div class="stat-row"><span class="stat-label">Size:</span><span class="stat-value" id="preview_size"></span></div>\n                                <div class="stat-row"><span class="stat-label">HP:</span><span class="stat-value" id="preview_hp"></span></div>\n                                <div class="stat-row"><span class="stat-label">Permadeath:</span><span class="stat-value" id="preview_permadeath"></span></div>\n                                <div class="stat-row"><span class="stat-label">Combat:</span><span class="stat-value" id="preview_combat"></span></div>\n                                <div class="stat-row"><span class="stat-label">Vision:</span><span class="stat-value" id="preview_vision"></span></div>\n                            </div>\n                            <div class="preview-starting-items" id="preview_starting_items"></div>\n                        </div>\n                    </div>\n\n                    \x3c!-- LLM Generation Settings --\x3e\n                    <div class="mazemaster-section">\n                        <label class="mazemaster-label"><i class="fa-solid fa-brain"></i> LLM Message Generation</label>\n                        <div class="mazemaster-form-group">\n                            <label>Generation Preset</label>\n                            <select id="mazemaster_llm_preset" class="mazemaster-select">\n                                <option value="">(Use Current)</option>\n                                \x3c!-- Presets populated dynamically --\x3e\n                            </select>\n                        </div>\n                        <label class="mazemaster-checkbox-label">\n                            <input type="checkbox" id="mazemaster_llm_enabled" ').concat(!1!==qt.llmEnabled?"checked":"",'>\n                            Enable LLM message generation\n                        </label>\n                        <label class="mazemaster-checkbox-label">\n                            <input type="checkbox" id="mazemaster_close_chat" ').concat(!1!==qt.closeChatOnStart?"checked":"",'>\n                            Close current chat before starting (prevents context bleed)\n                        </label>\n                    </div>\n\n                    \x3c!-- D-Pad Settings --\x3e\n                    <div class="mazemaster-section">\n                        <label class="mazemaster-label"><i class="fa-solid fa-gamepad"></i> D-Pad Controls</label>\n                        <label class="mazemaster-checkbox-label">\n                            <input type="checkbox" id="mazemaster_dpad_enabled" ').concat(!1!==(null===(e=qt.dpadConfig)||void 0===e?void 0:e.enabled)?"checked":"",'>\n                            Enable D-Pad controls\n                        </label>\n                        <label class="mazemaster-checkbox-label">\n                            <input type="checkbox" id="mazemaster_dpad_floating" ').concat(!1!==(null===(t=qt.dpadConfig)||void 0===t?void 0:t.floating)?"checked":"",'>\n                            Floating D-Pad (draggable position)\n                        </label>\n                        <button id="mazemaster_dpad_reset" class="menu_button" style="margin-top: 6px;">\n                            <i class="fa-solid fa-rotate-left"></i> Reset D-Pad Position\n                        </button>\n                    </div>\n\n                    \x3c!-- Renderer Settings --\x3e\n                    <div class="mazemaster-section">\n                        <label class="mazemaster-label"><i class="fa-solid fa-cube"></i> Renderer</label>\n                        <select id="mazemaster_renderer_type" class="mazemaster-select">\n                            <option value="css-grid" ').concat("css-grid"===qt.rendererType?"selected":"",'>Classic (CSS Grid)</option>\n                            <option value="isometric" ').concat("isometric"===(qt.rendererType||"isometric")?"selected":"",'>Isometric 2.5D</option>\n                            <option value="canvas" ').concat("canvas"===qt.rendererType?"selected":"",'>Canvas (Experimental)</option>\n                        </select>\n                        <div class="mazemaster-help-small"><small>Isometric gives a 3D-like view. Requires restart of active maze.</small></div>\n                    </div>\n\n                    \x3c!-- Layout Mode --\x3e\n                    <div class="mazemaster-section">\n                        <label class="mazemaster-label"><i class="fa-solid fa-mobile-screen"></i> Layout Mode</label>\n                        <select id="mazemaster_layout_mode" class="mazemaster-select">\n                            <option value="auto" ').concat("auto"===qt.layoutMode?"selected":"",' disabled>Auto-detect (disabled)</option>\n                            <option value="desktop" ').concat("desktop"===(qt.layoutMode||"desktop")?"selected":"",'>Desktop (Horizontal)</option>\n                            <option value="mobile" ').concat("mobile"===qt.layoutMode?"selected":"",' disabled>Mobile (Vertical) (disabled)</option>\n                        </select>\n                        <div class="mazemaster-help-small"><small>Mobile layout stacks UI vertically for portrait screens.</small></div>\n                    </div>\n\n                    \x3c!-- Saved Games in Game Tab --\x3e\n                    <div class="mazemaster-section">\n                        <label class="mazemaster-label"><i class="fa-solid fa-floppy-disk"></i> Saved Games</label>\n                        <div id="mazemaster_game_tab_saves" class="mazemaster-saved-games-list">\n                            \x3c!-- Saved games rendered here --\x3e\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- CONFIG TAB --\x3e\n                <div class="mazemaster-tab-content" id="mazemaster-tab-config">\n                    \x3c!-- Reset Factory Defaults Button --\x3e\n                    <div class="mazemaster-section" style="background: #2a1a1a; border: 1px solid #ff6b6b; border-radius: 8px; padding: 10px; margin-bottom: 15px;">\n                        <button id="mazemaster_reset_factory" class="menu_button" style="width: 100%; background: #8b0000; color: white;">\n                            <i class="fa-solid fa-rotate-left"></i> Reset Factory Defaults (v2.0.1)\n                        </button>\n                        <div style="font-size: 11px; color: #ff9999; margin-top: 5px; text-align: center;">\n                            Clears all profiles and restores v2.0.1 factory defaults\n                        </div>\n                    </div>\n\n                    \x3c!-- Game Selector --\x3e\n                    <div class="mazemaster-game-selector">\n                        <button id="mazemaster_show_maze" class="menu_button mazemaster-game-btn ').concat("maze"===mt?"active":"",'">\n                            <i class="fa-solid fa-border-all"></i> Maze\n                        </button>\n                        <button id="mazemaster_show_wheel" class="menu_button mazemaster-game-btn ').concat("wheel"===mt?"active":"",'">\n                            <i class="fa-solid fa-dharmachakra"></i> Wheel\n                        </button>\n                        <button id="mazemaster_show_combat" class="menu_button mazemaster-game-btn ').concat("combat"===mt?"active":"",'">\n                            <i class="fa-solid fa-khanda"></i> Combat\n                        </button>\n                        <button id="mazemaster_show_minions" class="menu_button mazemaster-game-btn ').concat("minions"===mt?"active":"",'">\n                            <i class="fa-solid fa-ghost"></i> Minions\n                        </button>\n                        <button id="mazemaster_show_traps" class="menu_button mazemaster-game-btn ').concat("traps"===mt?"active":"",'">\n                            <i class="fa-solid fa-dungeon"></i> Traps\n                        </button>\n                    </div>\n                    \x3c!-- Second Row: Content --\x3e\n                    <div class="mazemaster-game-selector" style="margin-top: 4px;">\n                        <button id="mazemaster_show_themes" class="menu_button mazemaster-game-btn ').concat("themes"===mt?"active":"",'">\n                            <i class="fa-solid fa-palette"></i> Themes\n                        </button>\n                        <button id="mazemaster_show_styles" class="menu_button mazemaster-game-btn ').concat("styles"===mt?"active":"",'">\n                            <i class="fa-solid fa-city"></i> Styles\n                        </button>\n                        <button id="mazemaster_show_quests" class="menu_button mazemaster-game-btn ').concat("quests"===mt?"active":"",'">\n                            <i class="fa-solid fa-scroll"></i> Quests\n                        </button>\n                        <button id="mazemaster_show_items" class="menu_button mazemaster-game-btn ').concat("items"===mt?"active":"",'">\n                            <i class="fa-solid fa-wand-sparkles"></i> Items\n                        </button>\n                        <button id="mazemaster_show_factions" class="menu_button mazemaster-game-btn ').concat("factions"===mt?"active":"",'">\n                            <i class="fa-solid fa-users"></i> Factions\n                        </button>\n                    </div>\n                    \x3c!-- Third Row: Systems --\x3e\n                    <div class="mazemaster-game-selector" style="margin-top: 4px;">\n                        <button id="mazemaster_show_vision" class="menu_button mazemaster-game-btn ').concat("vision"===mt?"active":"",'">\n                            <i class="fa-solid fa-eye"></i> Vision\n                        </button>\n                        <button id="mazemaster_show_sound" class="menu_button mazemaster-game-btn ').concat("sound"===mt?"active":"",'">\n                            <i class="fa-solid fa-volume-high"></i> Sound\n                        </button>\n                    </div>\n\n                    \x3c!-- WHEEL CONFIG --\x3e\n                    <div id="mazemaster_wheel_config" class="mazemaster-game-config" style="').concat("wheel"===mt?"":"display: none;",'">\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Wheel Profile</label>\n                            <div class="mazemaster-profile-row">\n                                <select id="mazemaster_profile_select" class="mazemaster-select">\n                                    ').concat(0===Ze.length?'<option value="">No profiles</option>':"","\n                                    ").concat(Ze.map((e=>'<option value="'.concat(Or(e),'" ').concat(e===at?"selected":"",">").concat(Or(e),"</option>"))).join(""),'\n                                </select>\n                                <button id="mazemaster_new_profile_btn" class="menu_button menu_button_icon" title="New Profile">\n                                    <i class="fa-solid fa-plus"></i>\n                                </button>\n                                <button id="mazemaster_delete_profile_btn" class="menu_button menu_button_icon" title="Delete Profile">\n                                    <i class="fa-solid fa-trash"></i>\n                                </button>\n                                <button id="mazemaster_rename_profile_btn" class="menu_button menu_button_icon" title="Rename Profile">\n                                    <i class="fa-solid fa-pen"></i>\n                                </button>\n                                <button id="mazemaster_export_btn" class="menu_button menu_button_icon" title="Export Profile">\n                                    <i class="fa-solid fa-download"></i>\n                                </button>\n                                <button id="mazemaster_import_btn" class="menu_button menu_button_icon" title="Import Profile">\n                                    <i class="fa-solid fa-upload"></i>\n                                </button>\n                                <input type="file" id="mazemaster_import_file" accept=".json" style="display: none;">\n                                <button id="mazemaster_preview_wheel_btn" class="menu_button menu_button_icon" title="Preview Wheel">\n                                    <i class="fa-solid fa-eye"></i>\n                                </button>\n                            </div>\n                        </div>\n\n                        <div class="mazemaster-section mazemaster-profile-settings">\n                            <div class="mazemaster-profile-options">\n                                <label class="mazemaster-checkbox-label">\n                                    <input type="checkbox" id="mazemaster_randomize" ').concat(null!==(a=ta(at))&&void 0!==a&&a.randomize?"checked":"",'>\n                                    Randomize segment positions\n                                </label>\n                                <div class="mazemaster-difficulty-row">\n                                    <label>Difficulty:</label>\n                                    <select id="mazemaster_difficulty" class="mazemaster-select-small">\n                                        ').concat([1,2,3,4,5].map((e=>{var t;return'<option value="'.concat(e,'" ').concat(((null===(t=ta(at))||void 0===t?void 0:t.difficulty)||1)===e?"selected":"",">").concat(e,"</option>")})).join(""),'\n                                    </select>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Segments</label>\n                            <div id="mazemaster_segments_list" class="mazemaster-segments-list">\n                                \x3c!-- Segments rendered here --\x3e\n                            </div>\n                            <button id="mazemaster_add_segment_btn" class="menu_button mazemaster-add-btn">\n                                <i class="fa-solid fa-plus"></i> Add Segment\n                            </button>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <button id="mazemaster_save_btn" class="menu_button menu_button_primary mazemaster-save-btn">\n                                <i class="fa-solid fa-save"></i> Save Profile\n                            </button>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <div class="mazemaster-help">\n                                <div class="mazemaster-help-title">Usage:</div>\n                                <code>/wheel profile="profileName"</code>\n                                <div class="mazemaster-help-title">Sizes:</div>\n                                <ul>\n                                    <li><code>fraction</code> - Normal (1x)</li>\n                                    <li><code>halfseg</code> - Half (0.5x)</li>\n                                    <li><code>doubleseg</code> - Double (2x)</li>\n                                </ul>\n                                <small>halfseg count must equal doubleseg count</small>\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- COMBAT CONFIG (with sub-tabs) --\x3e\n                    <div id="mazemaster_combat_config" class="mazemaster-game-config" style="').concat("combat"===mt?"":"display: none;",'">\n                        \x3c!-- Combat Sub-tabs --\x3e\n                        <div class="mazemaster-combat-subtabs">\n                            <button class="combat-subtab active" data-combat="battlebar">Battlebar</button>\n                            <button class="combat-subtab" data-combat="turnbased">Turn-Based</button>\n                            <button class="combat-subtab" data-combat="qte">QTE</button>\n                            <button class="combat-subtab" data-combat="dice">Dice</button>\n                            <button class="combat-subtab" data-combat="stealth">Stealth</button>\n                            <button class="combat-subtab" data-combat="puzzle">Puzzle</button>\n                            <button class="combat-subtab" data-combat="negotiation">Negotiation</button>\n                            <button class="combat-subtab" data-combat="mechanics">Mechanics</button>\n                        </div>\n\n                        \x3c!-- BATTLEBAR SUB-TAB --\x3e\n                        <div id="combat_battlebar_content" class="combat-content active">\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Battlebar Profile</label>\n                            <div class="mazemaster-profile-row">\n                                <select id="mazemaster_bb_profile_select" class="mazemaster-select">\n                                    ').concat(0===nt.length?'<option value="">No profiles</option>':"","\n                                    ").concat(nt.map((e=>'<option value="'.concat(Or(e),'" ').concat(e===ot?"selected":"",">").concat(Or(e),"</option>"))).join(""),'\n                                </select>\n                                <button id="mazemaster_bb_new_profile_btn" class="menu_button menu_button_icon" title="New Profile">\n                                    <i class="fa-solid fa-plus"></i>\n                                </button>\n                                <button id="mazemaster_bb_delete_profile_btn" class="menu_button menu_button_icon" title="Delete Profile">\n                                    <i class="fa-solid fa-trash"></i>\n                                </button>\n                                <button id="mazemaster_bb_rename_profile_btn" class="menu_button menu_button_icon" title="Rename Profile">\n                                    <i class="fa-solid fa-pen"></i>\n                                </button>\n                                <button id="mazemaster_bb_export_btn" class="menu_button menu_button_icon" title="Export Profile">\n                                    <i class="fa-solid fa-download"></i>\n                                </button>\n                                <button id="mazemaster_bb_import_btn" class="menu_button menu_button_icon" title="Import Profile">\n                                    <i class="fa-solid fa-upload"></i>\n                                </button>\n                                <input type="file" id="mazemaster_bb_import_file" accept=".json" style="display: none;">\n                                <button id="mazemaster_preview_battlebar_btn" class="menu_button menu_button_icon" title="Preview Battlebar">\n                                    <i class="fa-solid fa-eye"></i>\n                                </button>\n                            </div>\n                        </div>\n\n                        <div class="mazemaster-section mazemaster-profile-settings">\n                            <div class="mazemaster-bb-settings">\n                                <div class="mazemaster-bb-row">\n                                    <div class="mazemaster-bb-field" style="flex: 2;">\n                                        <label>Difficulty <span id="mazemaster_bb_diff_val" style="opacity: 0.7;">(').concat(it.difficulty||5,')</span></label>\n                                        <input type="range" id="mazemaster_bb_difficulty" min="1" max="10" value="').concat(it.difficulty||5,'" style="width: 100%;">\n                                    </div>\n                                    <div class="mazemaster-bb-field">\n                                        <label>Damage</label>\n                                        <input type="number" id="mazemaster_bb_damage" min="0" max="100" value="').concat(it.damage||25,'" title="HP damage on loss">\n                                    </div>\n                                    <div class="mazemaster-bb-field">\n                                        <label>Hits to Win</label>\n                                        <input type="number" id="mazemaster_bb_hits" min="1" max="20" value="').concat(it.hitsToWin||5,'">\n                                    </div>\n                                    <div class="mazemaster-bb-field">\n                                        <label>Misses to Lose</label>\n                                        <input type="number" id="mazemaster_bb_misses" min="1" max="20" value="').concat(it.missesToLose||3,'">\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Main Title</label>\n                            <input type="text" id="mazemaster_bb_main_title" class="mazemaster-input" placeholder="e.g. Boss Battle!" value="').concat(Or(it.mainTitle||""),'">\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Commands</label>\n                            <div class="mazemaster-bb-commands">\n                                <div class="mazemaster-bb-command">\n                                    <label>On Hit:</label>\n                                    <textarea id="mazemaster_bb_hit_cmd" placeholder="/echo Hit!">').concat(Or(it.hitCommand||""),'</textarea>\n                                </div>\n                                <div class="mazemaster-bb-command">\n                                    <label>On Miss:</label>\n                                    <textarea id="mazemaster_bb_miss_cmd" placeholder="/echo Miss!">').concat(Or(it.missCommand||""),'</textarea>\n                                </div>\n                                <div class="mazemaster-bb-command">\n                                    <label>On Win:</label>\n                                    <textarea id="mazemaster_bb_win_cmd" placeholder="/echo Victory!">').concat(Or(it.winCommand||""),'</textarea>\n                                </div>\n                                <div class="mazemaster-bb-command">\n                                    <label>On Lose:</label>\n                                    <textarea id="mazemaster_bb_lose_cmd" placeholder="/echo Defeat!">').concat(Or(it.loseCommand||""),'</textarea>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Stages (click image to edit message)</label>\n                            <div id="mazemaster_bb_images_list" class="mazemaster-bb-images-list">\n                                \x3c!-- Images rendered here --\x3e\n                            </div>\n                            <button id="mazemaster_bb_add_image_btn" class="menu_button mazemaster-add-btn">\n                                <i class="fa-solid fa-plus"></i> Add Image\n                            </button>\n                            <input type="file" id="mazemaster_bb_image_file" accept="image/*" style="display: none;">\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Item Drops on Win (Maze Only)</label>\n                            <div class="mazemaster-row">\n                                <label>Key %</label>\n                                <input type="number" id="mazemaster_bb_key_drop" class="mazemaster-input-small" min="0" max="100" value="').concat(null!==(n=it.keyDropChance)&&void 0!==n?n:40,'">\n                            </div>\n                            <div class="mazemaster-row">\n                                <label>Strike %</label>\n                                <input type="number" id="mazemaster_bb_pow_drop" class="mazemaster-input-small" min="0" max="100" value="').concat(null!==(o=it.strikeDropChance)&&void 0!==o?o:20,'">\n                            </div>\n                            <div class="mazemaster-row">\n                                <label>Stealth %</label>\n                                <input type="number" id="mazemaster_bb_stealth_drop" class="mazemaster-input-small" min="0" max="100" value="').concat(null!==(i=it.stealthDropChance)&&void 0!==i?i:10,'">\n                            </div>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <button id="mazemaster_bb_save_btn" class="menu_button menu_button_primary mazemaster-save-btn">\n                                <i class="fa-solid fa-save"></i> Save Profile\n                            </button>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <div class="mazemaster-help">\n                                <div class="mazemaster-help-title">Usage:</div>\n                                <code>/battlebar profile="profileName"</code>\n                                <div class="mazemaster-help-title">Difficulty:</div>\n                                <ul>\n                                    <li><code>1</code> - Easy (large zone, slow)</li>\n                                    <li><code>5</code> - Medium</li>\n                                    <li><code>10</code> - Hard (small zone, fast)</li>\n                                </ul>\n                            </div>\n                        </div>\n                        </div>\x3c!-- End combat_battlebar_content --\x3e\n\n                        \x3c!-- TURN-BASED SUB-TAB --\x3e\n                        <div id="combat_turnbased_content" class="combat-content">\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Turn-Based Profile</label>\n                                <div class="mazemaster-profile-row">\n                                    <select id="mazemaster_tb_profile_select" class="mazemaster-select">\n                                        ').concat(0===ia().length?'<option value="">No profiles</option>':"","\n                                        ").concat(ia().map((e=>'<option value="'.concat(Or(e),'" ').concat(e===qt.currentTurnbasedProfile?"selected":"",">").concat(Or(e),"</option>"))).join(""),'\n                                    </select>\n                                    <button id="mazemaster_tb_new_profile_btn" class="menu_button menu_button_icon" title="New Profile">\n                                        <i class="fa-solid fa-plus"></i>\n                                    </button>\n                                    <button id="mazemaster_tb_delete_profile_btn" class="menu_button menu_button_icon" title="Delete Profile">\n                                        <i class="fa-solid fa-trash"></i>\n                                    </button>\n                                    <button id="mazemaster_tb_rename_profile_btn" class="menu_button menu_button_icon" title="Rename Profile">\n                                        <i class="fa-solid fa-pen"></i>\n                                    </button>\n                                    <button id="mazemaster_preview_turnbased_btn" class="menu_button menu_button_icon" title="Preview Turn-Based">\n                                        <i class="fa-solid fa-eye"></i>\n                                    </button>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Display</label>\n                                <div class="mazemaster-row">\n                                    <label>Title</label>\n                                    <input type="text" id="mazemaster_tb_main_title" class="mazemaster-input" placeholder="Combat!" value="">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label>Enemy Name</label>\n                                    <input type="text" id="mazemaster_tb_enemy_name" class="mazemaster-input" placeholder="Enemy" value="">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label>Description</label>\n                                    <textarea id="mazemaster_tb_description" class="mazemaster-input" rows="2" placeholder="A fierce battle awaits..."></textarea>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Combat Stats</label>\n                                <div class="mazemaster-combat-grid">\n                                    <div class="mazemaster-combat-col">\n                                        <strong style="color: #2ecc71;">Player</strong>\n                                        <div class="mazemaster-row">\n                                            <label>HP</label>\n                                            <input type="number" id="mazemaster_tb_player_hp" class="mazemaster-input-small" min="1" max="999" value="100">\n                                        </div>\n                                        <div class="mazemaster-row">\n                                            <label>Attack</label>\n                                            <input type="number" id="mazemaster_tb_player_attack" class="mazemaster-input-small" min="1" max="99" value="15">\n                                        </div>\n                                        <div class="mazemaster-row">\n                                            <label>Defense</label>\n                                            <input type="number" id="mazemaster_tb_player_defense" class="mazemaster-input-small" min="0" max="99" value="5">\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-combat-col">\n                                        <strong style="color: #e74c3c;">Enemy</strong>\n                                        <div class="mazemaster-row">\n                                            <label>HP</label>\n                                            <input type="number" id="mazemaster_tb_enemy_hp" class="mazemaster-input-small" min="1" max="999" value="50">\n                                        </div>\n                                        <div class="mazemaster-row">\n                                            <label>Attack</label>\n                                            <input type="number" id="mazemaster_tb_enemy_attack" class="mazemaster-input-small" min="1" max="99" value="8">\n                                        </div>\n                                        <div class="mazemaster-row">\n                                            <label>Defense</label>\n                                            <input type="number" id="mazemaster_tb_enemy_defense" class="mazemaster-input-small" min="0" max="99" value="2">\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Mechanics</label>\n                                <div class="mazemaster-bb-settings">\n                                    <div class="mazemaster-bb-row">\n                                        <div class="mazemaster-bb-field">\n                                            <label>Turn Order</label>\n                                            <select id="mazemaster_tb_turn_order" class="mazemaster-select">\n                                                <option value="player_first">Player First</option>\n                                                <option value="enemy_first">Enemy First</option>\n                                                <option value="random">Random</option>\n                                            </select>\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Flee Chance %</label>\n                                            <input type="number" id="mazemaster_tb_flee_chance" class="mazemaster-input-small" min="0" max="100" value="50">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Crit Chance %</label>\n                                            <input type="number" id="mazemaster_tb_crit_chance" class="mazemaster-input-small" min="0" max="100" value="15">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Crit Multiplier</label>\n                                            <input type="number" id="mazemaster_tb_crit_mult" class="mazemaster-input-small" min="1" max="5" step="0.1" value="1.5">\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-bb-row">\n                                        <div class="mazemaster-bb-field" style="flex: 2;">\n                                            <label>Difficulty <span id="mazemaster_tb_diff_val" style="opacity: 0.7;">(5)</span></label>\n                                            <input type="range" id="mazemaster_tb_difficulty" min="1" max="10" value="5" style="width: 100%;">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Damage on Loss</label>\n                                            <input type="number" id="mazemaster_tb_damage" class="mazemaster-input-small" min="0" max="100" value="15">\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">STScript Hooks</label>\n                                <div class="mazemaster-bb-commands">\n                                    <div class="mazemaster-bb-command">\n                                        <label>On Win:</label>\n                                        <textarea id="mazemaster_tb_on_win" placeholder="/echo Victory!"></textarea>\n                                    </div>\n                                    <div class="mazemaster-bb-command">\n                                        <label>On Lose:</label>\n                                        <textarea id="mazemaster_tb_on_lose" placeholder="/echo Defeat..."></textarea>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Item Drops on Win</label>\n                                <div class="mazemaster-bb-settings">\n                                    <div class="mazemaster-bb-row">\n                                        <div class="mazemaster-bb-field">\n                                            <label>Key %</label>\n                                            <input type="number" id="mazemaster_tb_key_drop" class="mazemaster-input-small" min="0" max="100" value="30">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Strike %</label>\n                                            <input type="number" id="mazemaster_tb_strike_drop" class="mazemaster-input-small" min="0" max="100" value="15">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Stealth %</label>\n                                            <input type="number" id="mazemaster_tb_stealth_drop" class="mazemaster-input-small" min="0" max="100" value="10">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Potion %</label>\n                                            <input type="number" id="mazemaster_tb_potion_drop" class="mazemaster-input-small" min="0" max="100" value="25">\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <button id="mazemaster_tb_save_btn" class="menu_button menu_button_primary mazemaster-save-btn">\n                                    <i class="fa-solid fa-save"></i> Save Profile\n                                </button>\n                            </div>\n                        </div>\x3c!-- End combat_turnbased_content --\x3e\n\n                        \x3c!-- QTE SUB-TAB --\x3e\n                        <div id="combat_qte_content" class="combat-content">\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">QTE Profile</label>\n                                <div class="mazemaster-profile-row">\n                                    <select id="mazemaster_qte_profile_select" class="mazemaster-select">\n                                        ').concat(0===la().length?'<option value="">No profiles</option>':"","\n                                        ").concat(la().map((e=>'<option value="'.concat(Or(e),'" ').concat(e===qt.currentQteProfile?"selected":"",">").concat(Or(e),"</option>"))).join(""),'\n                                    </select>\n                                    <button id="mazemaster_qte_new_profile_btn" class="menu_button menu_button_icon" title="New Profile">\n                                        <i class="fa-solid fa-plus"></i>\n                                    </button>\n                                    <button id="mazemaster_qte_delete_profile_btn" class="menu_button menu_button_icon" title="Delete Profile">\n                                        <i class="fa-solid fa-trash"></i>\n                                    </button>\n                                    <button id="mazemaster_qte_rename_profile_btn" class="menu_button menu_button_icon" title="Rename Profile">\n                                        <i class="fa-solid fa-pen"></i>\n                                    </button>\n                                    <button id="mazemaster_preview_qte_btn" class="menu_button menu_button_icon" title="Preview QTE">\n                                        <i class="fa-solid fa-eye"></i>\n                                    </button>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Display</label>\n                                <div class="mazemaster-row">\n                                    <label>Title</label>\n                                    <input type="text" id="mazemaster_qte_main_title" class="mazemaster-input" placeholder="Reaction Test" value="">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label>Description</label>\n                                    <textarea id="mazemaster_qte_description" class="mazemaster-input" rows="2" placeholder="Press the keys as they appear!"></textarea>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Sequence Settings</label>\n                                <div class="mazemaster-bb-settings">\n                                    <div class="mazemaster-bb-row">\n                                        <div class="mazemaster-bb-field">\n                                            <label>Min Length</label>\n                                            <input type="number" id="mazemaster_qte_seq_min" class="mazemaster-input-small" min="1" max="20" value="3">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Max Length</label>\n                                            <input type="number" id="mazemaster_qte_seq_max" class="mazemaster-input-small" min="1" max="20" value="5">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Time Window (ms)</label>\n                                            <input type="number" id="mazemaster_qte_time_base" class="mazemaster-input-small" min="500" max="5000" step="100" value="1500">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Min Time (ms)</label>\n                                            <input type="number" id="mazemaster_qte_time_min" class="mazemaster-input-small" min="200" max="2000" step="100" value="800">\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-bb-row">\n                                        <div class="mazemaster-bb-field" style="flex: 2;">\n                                            <label>Difficulty <span id="mazemaster_qte_diff_val" style="opacity: 0.7;">(5)</span></label>\n                                            <input type="range" id="mazemaster_qte_difficulty" min="1" max="10" value="5" style="width: 100%;">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Damage on Fail</label>\n                                            <input type="number" id="mazemaster_qte_damage" class="mazemaster-input-small" min="0" max="100" value="10">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Perfect Window %</label>\n                                            <input type="number" id="mazemaster_qte_perfect" class="mazemaster-input-small" min="10" max="50" value="30">\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Allowed Keys</label>\n                                <div style="display: flex; gap: 12px; flex-wrap: wrap;">\n                                    <label style="display: flex; align-items: center; gap: 4px;"><input type="checkbox" id="mazemaster_qte_key_w" checked> W</label>\n                                    <label style="display: flex; align-items: center; gap: 4px;"><input type="checkbox" id="mazemaster_qte_key_a" checked> A</label>\n                                    <label style="display: flex; align-items: center; gap: 4px;"><input type="checkbox" id="mazemaster_qte_key_s" checked> S</label>\n                                    <label style="display: flex; align-items: center; gap: 4px;"><input type="checkbox" id="mazemaster_qte_key_d" checked> D</label>\n                                    <label style="display: flex; align-items: center; gap: 4px;"><input type="checkbox" id="mazemaster_qte_key_space" checked> SPACE</label>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">STScript Hooks</label>\n                                <div class="mazemaster-bb-commands">\n                                    <div class="mazemaster-bb-command">\n                                        <label>On Complete:</label>\n                                        <textarea id="mazemaster_qte_on_complete" placeholder="/echo Quick reflexes!"></textarea>\n                                    </div>\n                                    <div class="mazemaster-bb-command">\n                                        <label>On Fail:</label>\n                                        <textarea id="mazemaster_qte_on_fail" placeholder="/echo Too slow..."></textarea>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <button id="mazemaster_qte_save_btn" class="menu_button menu_button_primary mazemaster-save-btn">\n                                    <i class="fa-solid fa-save"></i> Save Profile\n                                </button>\n                            </div>\n                        </div>\x3c!-- End combat_qte_content --\x3e\n\n                        \x3c!-- DICE SUB-TAB --\x3e\n                        <div id="combat_dice_content" class="combat-content">\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Dice Profile</label>\n                                <div class="mazemaster-profile-row">\n                                    <select id="mazemaster_dice_profile_select" class="mazemaster-select">\n                                        ').concat(0===da().length?'<option value="">No profiles</option>':"","\n                                        ").concat(da().map((e=>'<option value="'.concat(Or(e),'" ').concat(e===qt.currentDiceProfile?"selected":"",">").concat(Or(e),"</option>"))).join(""),'\n                                    </select>\n                                    <button id="mazemaster_dice_new_profile_btn" class="menu_button menu_button_icon" title="New Profile">\n                                        <i class="fa-solid fa-plus"></i>\n                                    </button>\n                                    <button id="mazemaster_dice_delete_profile_btn" class="menu_button menu_button_icon" title="Delete Profile">\n                                        <i class="fa-solid fa-trash"></i>\n                                    </button>\n                                    <button id="mazemaster_dice_rename_profile_btn" class="menu_button menu_button_icon" title="Rename Profile">\n                                        <i class="fa-solid fa-pen"></i>\n                                    </button>\n                                    <button id="mazemaster_preview_dice_btn" class="menu_button menu_button_icon" title="Preview Dice">\n                                        <i class="fa-solid fa-eye"></i>\n                                    </button>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Display</label>\n                                <div class="mazemaster-row">\n                                    <label>Title</label>\n                                    <input type="text" id="mazemaster_dice_main_title" class="mazemaster-input" placeholder="Skill Check" value="">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label>Description</label>\n                                    <textarea id="mazemaster_dice_description" class="mazemaster-input" rows="2" placeholder="Roll to beat the target!"></textarea>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Dice Settings</label>\n                                <div class="mazemaster-bb-settings">\n                                    <div class="mazemaster-bb-row">\n                                        <div class="mazemaster-bb-field">\n                                            <label>Dice Count</label>\n                                            <input type="number" id="mazemaster_dice_count" class="mazemaster-input-small" min="1" max="10" value="2">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Dice Type</label>\n                                            <select id="mazemaster_dice_type" class="mazemaster-select">\n                                                <option value="4">d4</option>\n                                                <option value="6" selected>d6</option>\n                                                <option value="8">d8</option>\n                                                <option value="10">d10</option>\n                                                <option value="12">d12</option>\n                                                <option value="20">d20</option>\n                                                <option value="100">d100</option>\n                                            </select>\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Target Number</label>\n                                            <input type="number" id="mazemaster_dice_target" class="mazemaster-input-small" min="1" max="100" value="7">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Modifier</label>\n                                            <input type="number" id="mazemaster_dice_modifier" class="mazemaster-input-small" min="-20" max="20" value="0">\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-bb-row">\n                                        <div class="mazemaster-bb-field" style="flex: 2;">\n                                            <label>Difficulty <span id="mazemaster_dice_diff_val" style="opacity: 0.7;">(5)</span></label>\n                                            <input type="range" id="mazemaster_dice_difficulty" min="1" max="10" value="5" style="width: 100%;">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Damage on Fail</label>\n                                            <input type="number" id="mazemaster_dice_damage" class="mazemaster-input-small" min="0" max="100" value="15">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Rerolls</label>\n                                            <input type="number" id="mazemaster_dice_rerolls" class="mazemaster-input-small" min="0" max="5" value="1">\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">STScript Hooks</label>\n                                <div class="mazemaster-bb-commands">\n                                    <div class="mazemaster-bb-command">\n                                        <label>On Success:</label>\n                                        <textarea id="mazemaster_dice_on_success" placeholder="/echo Success!"></textarea>\n                                    </div>\n                                    <div class="mazemaster-bb-command">\n                                        <label>On Fail:</label>\n                                        <textarea id="mazemaster_dice_on_fail" placeholder="/echo Failed the check..."></textarea>\n                                    </div>\n                                    <div class="mazemaster-bb-command">\n                                        <label>On Critical:</label>\n                                        <textarea id="mazemaster_dice_on_crit" placeholder="/echo Critical success!"></textarea>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <button id="mazemaster_dice_save_btn" class="menu_button menu_button_primary mazemaster-save-btn">\n                                    <i class="fa-solid fa-save"></i> Save Profile\n                                </button>\n                            </div>\n                        </div>\x3c!-- End combat_dice_content --\x3e\n\n                        \x3c!-- STEALTH SUB-TAB --\x3e\n                        <div id="combat_stealth_content" class="combat-content">\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Stealth Profile</label>\n                                <div class="mazemaster-profile-row">\n                                    <select id="mazemaster_stealth_profile_select" class="mazemaster-select">\n                                        ').concat(0===ha().length?'<option value="">No profiles</option>':"","\n                                        ").concat(ha().map((e=>'<option value="'.concat(Or(e),'" ').concat(e===qt.currentStealthProfile?"selected":"",">").concat(Or(e),"</option>"))).join(""),'\n                                    </select>\n                                    <button id="mazemaster_stealth_new_profile_btn" class="menu_button menu_button_icon" title="New Profile">\n                                        <i class="fa-solid fa-plus"></i>\n                                    </button>\n                                    <button id="mazemaster_stealth_delete_profile_btn" class="menu_button menu_button_icon" title="Delete Profile">\n                                        <i class="fa-solid fa-trash"></i>\n                                    </button>\n                                    <button id="mazemaster_stealth_rename_profile_btn" class="menu_button menu_button_icon" title="Rename Profile">\n                                        <i class="fa-solid fa-pen"></i>\n                                    </button>\n                                    <button id="mazemaster_preview_stealth_btn" class="menu_button menu_button_icon" title="Preview Stealth">\n                                        <i class="fa-solid fa-eye"></i>\n                                    </button>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Display</label>\n                                <div class="mazemaster-row">\n                                    <label>Title</label>\n                                    <input type="text" id="mazemaster_stealth_main_title" class="mazemaster-input" placeholder="Sneak Past" value="">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label>Guard Name</label>\n                                    <input type="text" id="mazemaster_stealth_guard_name" class="mazemaster-input" placeholder="Guard" value="">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label>Description</label>\n                                    <textarea id="mazemaster_stealth_description" class="mazemaster-input" rows="2" placeholder="Sneak past without being detected!"></textarea>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Stealth Settings</label>\n                                <div class="mazemaster-bb-settings">\n                                    <div class="mazemaster-bb-row">\n                                        <div class="mazemaster-bb-field">\n                                            <label>Sections</label>\n                                            <input type="number" id="mazemaster_stealth_sections" class="mazemaster-input-small" min="1" max="10" value="3" title="Areas to pass through">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Detection Limit</label>\n                                            <input type="number" id="mazemaster_stealth_detection_limit" class="mazemaster-input-small" min="50" max="200" value="100" title="Max detection before caught">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Base Detection</label>\n                                            <input type="number" id="mazemaster_stealth_base_detection" class="mazemaster-input-small" min="5" max="50" value="15" title="Detection gain when advancing">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Damage on Fail</label>\n                                            <input type="number" id="mazemaster_stealth_damage" class="mazemaster-input-small" min="0" max="100" value="20">\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-bb-row">\n                                        <div class="mazemaster-bb-field" style="flex: 2;">\n                                            <label>Difficulty <span id="mazemaster_stealth_diff_val" style="opacity: 0.7;">(5)</span></label>\n                                            <input type="range" id="mazemaster_stealth_difficulty" min="1" max="10" value="5" style="width: 100%;">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Hide Reduction</label>\n                                            <input type="number" id="mazemaster_stealth_hide_reduce" class="mazemaster-input-small" min="5" max="30" value="10" title="Detection reduced by Hide">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Distract Max</label>\n                                            <input type="number" id="mazemaster_stealth_distract_max" class="mazemaster-input-small" min="10" max="50" value="25" title="Max detection reduced by Distract">\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">STScript Hooks</label>\n                                <div class="mazemaster-bb-commands">\n                                    <div class="mazemaster-bb-command">\n                                        <label>On Success:</label>\n                                        <textarea id="mazemaster_stealth_on_success" placeholder="/echo You made it past!"></textarea>\n                                    </div>\n                                    <div class="mazemaster-bb-command">\n                                        <label>On Caught:</label>\n                                        <textarea id="mazemaster_stealth_on_caught" placeholder="/echo You\'ve been spotted!"></textarea>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <button id="mazemaster_stealth_save_btn" class="menu_button menu_button_primary mazemaster-save-btn">\n                                    <i class="fa-solid fa-save"></i> Save Profile\n                                </button>\n                            </div>\n                        </div>\x3c!-- End combat_stealth_content --\x3e\n\n                        \x3c!-- PUZZLE SUB-TAB --\x3e\n                        <div id="combat_puzzle_content" class="combat-content">\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Puzzle Profile</label>\n                                <div class="mazemaster-profile-row">\n                                    <select id="mazemaster_puzzle_profile_select" class="mazemaster-select">\n                                        ').concat(0===ya().length?'<option value="">No profiles</option>':"","\n                                        ").concat(ya().map((e=>'<option value="'.concat(Or(e),'" ').concat(e===qt.currentPuzzleProfile?"selected":"",">").concat(Or(e),"</option>"))).join(""),'\n                                    </select>\n                                    <button id="mazemaster_puzzle_new_profile_btn" class="menu_button menu_button_icon" title="New Profile">\n                                        <i class="fa-solid fa-plus"></i>\n                                    </button>\n                                    <button id="mazemaster_puzzle_delete_profile_btn" class="menu_button menu_button_icon" title="Delete Profile">\n                                        <i class="fa-solid fa-trash"></i>\n                                    </button>\n                                    <button id="mazemaster_puzzle_rename_profile_btn" class="menu_button menu_button_icon" title="Rename Profile">\n                                        <i class="fa-solid fa-pen"></i>\n                                    </button>\n                                    <button id="mazemaster_preview_puzzle_btn" class="menu_button menu_button_icon" title="Preview Puzzle">\n                                        <i class="fa-solid fa-eye"></i>\n                                    </button>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Display</label>\n                                <div class="mazemaster-row">\n                                    <label>Title</label>\n                                    <input type="text" id="mazemaster_puzzle_main_title" class="mazemaster-input" placeholder="Memory Puzzle" value="">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label>Description</label>\n                                    <textarea id="mazemaster_puzzle_description" class="mazemaster-input" rows="2" placeholder="Watch the sequence and repeat it!"></textarea>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Puzzle Settings</label>\n                                <div class="mazemaster-bb-settings">\n                                    <div class="mazemaster-bb-row">\n                                        <div class="mazemaster-bb-field">\n                                            <label>Grid Size</label>\n                                            <select id="mazemaster_puzzle_grid_size" class="mazemaster-select">\n                                                <option value="2">2x2</option>\n                                                <option value="3" selected>3x3</option>\n                                                <option value="4">4x4</option>\n                                                <option value="5">5x5</option>\n                                            </select>\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Sequence Length</label>\n                                            <input type="number" id="mazemaster_puzzle_seq_length" class="mazemaster-input-small" min="2" max="12" value="4">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Max Mistakes</label>\n                                            <input type="number" id="mazemaster_puzzle_max_mistakes" class="mazemaster-input-small" min="1" max="10" value="5">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Hints</label>\n                                            <input type="number" id="mazemaster_puzzle_hints" class="mazemaster-input-small" min="0" max="5" value="3">\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-bb-row">\n                                        <div class="mazemaster-bb-field" style="flex: 2;">\n                                            <label>Difficulty <span id="mazemaster_puzzle_diff_val" style="opacity: 0.7;">(5)</span></label>\n                                            <input type="range" id="mazemaster_puzzle_difficulty" min="1" max="10" value="5" style="width: 100%;">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Damage on Fail</label>\n                                            <input type="number" id="mazemaster_puzzle_damage" class="mazemaster-input-small" min="0" max="100" value="15">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Time Limit (sec)</label>\n                                            <input type="number" id="mazemaster_puzzle_time_limit" class="mazemaster-input-small" min="0" max="300" value="60" title="0 = no limit">\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">STScript Hooks</label>\n                                <div class="mazemaster-bb-commands">\n                                    <div class="mazemaster-bb-command">\n                                        <label>On Solve:</label>\n                                        <textarea id="mazemaster_puzzle_on_solve" placeholder="/echo Puzzle solved!"></textarea>\n                                    </div>\n                                    <div class="mazemaster-bb-command">\n                                        <label>On Fail:</label>\n                                        <textarea id="mazemaster_puzzle_on_fail" placeholder="/echo Too many mistakes..."></textarea>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <button id="mazemaster_puzzle_save_btn" class="menu_button menu_button_primary mazemaster-save-btn">\n                                    <i class="fa-solid fa-save"></i> Save Profile\n                                </button>\n                            </div>\n                        </div>\x3c!-- End combat_puzzle_content --\x3e\n\n                        \x3c!-- NEGOTIATION SUB-TAB --\x3e\n                        <div id="combat_negotiation_content" class="combat-content">\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Negotiation Profile</label>\n                                <div class="mazemaster-profile-row">\n                                    <select id="mazemaster_negotiation_profile_select" class="mazemaster-select">\n                                        ').concat(0===za().length?'<option value="">No profiles</option>':"","\n                                        ").concat(za().map((e=>'<option value="'.concat(Or(e),'" ').concat(e===qt.currentNegotiationProfile?"selected":"",">").concat(Or(e),"</option>"))).join(""),'\n                                    </select>\n                                    <button id="mazemaster_negotiation_new_profile_btn" class="menu_button menu_button_icon" title="New Profile">\n                                        <i class="fa-solid fa-plus"></i>\n                                    </button>\n                                    <button id="mazemaster_negotiation_delete_profile_btn" class="menu_button menu_button_icon" title="Delete Profile">\n                                        <i class="fa-solid fa-trash"></i>\n                                    </button>\n                                    <button id="mazemaster_negotiation_rename_profile_btn" class="menu_button menu_button_icon" title="Rename Profile">\n                                        <i class="fa-solid fa-pen"></i>\n                                    </button>\n                                    <button id="mazemaster_preview_negotiation_btn" class="menu_button menu_button_icon" title="Preview Negotiation">\n                                        <i class="fa-solid fa-eye"></i>\n                                    </button>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Display</label>\n                                <div class="mazemaster-row">\n                                    <label>Title</label>\n                                    <input type="text" id="mazemaster_negotiate_main_title" class="mazemaster-input" placeholder="Negotiation" value="">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label>NPC Name</label>\n                                    <input type="text" id="mazemaster_negotiate_npc_name" class="mazemaster-input" placeholder="Merchant" value="">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label>Description</label>\n                                    <textarea id="mazemaster_negotiate_description" class="mazemaster-input" rows="2" placeholder="Convince them to help you..."></textarea>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Negotiation Settings</label>\n                                <div class="mazemaster-bb-settings">\n                                    <div class="mazemaster-bb-row">\n                                        <div class="mazemaster-bb-field">\n                                            <label>Favor Target</label>\n                                            <input type="number" id="mazemaster_negotiate_favor_target" class="mazemaster-input-small" min="25" max="100" value="75" title="Favor needed to win">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Starting Favor</label>\n                                            <input type="number" id="mazemaster_negotiate_starting_favor" class="mazemaster-input-small" min="0" max="75" value="25">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Max Turns</label>\n                                            <input type="number" id="mazemaster_negotiate_max_turns" class="mazemaster-input-small" min="3" max="20" value="6">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Damage on Fail</label>\n                                            <input type="number" id="mazemaster_negotiate_damage" class="mazemaster-input-small" min="0" max="100" value="10">\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-bb-row">\n                                        <div class="mazemaster-bb-field" style="flex: 2;">\n                                            <label>Difficulty <span id="mazemaster_negotiate_diff_val" style="opacity: 0.7;">(5)</span></label>\n                                            <input type="range" id="mazemaster_negotiate_difficulty" min="1" max="10" value="5" style="width: 100%;">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Persuade Avg</label>\n                                            <input type="number" id="mazemaster_negotiate_persuade" class="mazemaster-input-small" min="5" max="30" value="12" title="Average favor from Persuade">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Flatter Avg</label>\n                                            <input type="number" id="mazemaster_negotiate_flatter" class="mazemaster-input-small" min="5" max="25" value="10" title="Average favor from Flatter">\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">NPC Personality</label>\n                                <div class="mazemaster-bb-settings">\n                                    <div class="mazemaster-bb-row">\n                                        <div class="mazemaster-bb-field">\n                                            <label>Starting Mood</label>\n                                            <select id="mazemaster_negotiate_mood" class="mazemaster-select">\n                                                <option value="hostile">Hostile (-favor)</option>\n                                                <option value="unfriendly" selected>Unfriendly</option>\n                                                <option value="neutral">Neutral</option>\n                                                <option value="friendly">Friendly (+favor)</option>\n                                            </select>\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Intimidate Risk</label>\n                                            <select id="mazemaster_negotiate_intimidate" class="mazemaster-select">\n                                                <option value="low">Low (safe)</option>\n                                                <option value="medium" selected>Medium</option>\n                                                <option value="high">High (risky)</option>\n                                            </select>\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Bribe Cost</label>\n                                            <select id="mazemaster_negotiate_bribe_cost" class="mazemaster-select">\n                                                <option value="key">Key</option>\n                                                <option value="gold" selected>Gold (10)</option>\n                                                <option value="potion">Potion</option>\n                                            </select>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">STScript Hooks</label>\n                                <div class="mazemaster-bb-commands">\n                                    <div class="mazemaster-bb-command">\n                                        <label>On Success:</label>\n                                        <textarea id="mazemaster_negotiate_on_success" placeholder="/echo They agreed to help!"></textarea>\n                                    </div>\n                                    <div class="mazemaster-bb-command">\n                                        <label>On Fail:</label>\n                                        <textarea id="mazemaster_negotiate_on_fail" placeholder="/echo Negotiations broke down..."></textarea>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <button id="mazemaster_negotiate_save_btn" class="menu_button menu_button_primary mazemaster-save-btn">\n                                    <i class="fa-solid fa-save"></i> Save Profile\n                                </button>\n                            </div>\n                        </div>\x3c!-- End combat_negotiation_content --\x3e\n\n                        \x3c!-- MECHANICS SUB-TAB (v1.6.0) --\x3e\n                        <div id="combat_mechanics_content" class="combat-content">\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">Combat Mechanics Profile</label>\n                                <div class="mazemaster-profile-row">\n                                    <select id="mazemaster_cm_profile_select" class="mazemaster-select">\n                                        ').concat(0===dt.length?'<option value="">No profiles</option>':"","\n                                        ").concat(dt.map((e=>'<option value="'.concat(Or(e),'" ').concat(e===ut?"selected":"",">").concat(Or(e),"</option>"))).join(""),'\n                                    </select>\n                                    <button id="mazemaster_cm_new_profile_btn" class="menu_button menu_button_icon" title="New Profile">\n                                        <i class="fa-solid fa-plus"></i>\n                                    </button>\n                                    <button id="mazemaster_cm_delete_profile_btn" class="menu_button menu_button_icon" title="Delete Profile">\n                                        <i class="fa-solid fa-trash"></i>\n                                    </button>\n                                    <button id="mazemaster_cm_rename_profile_btn" class="menu_button menu_button_icon" title="Rename Profile">\n                                        <i class="fa-solid fa-pen"></i>\n                                    </button>\n                                </div>\n                            </div>\n\n                            \x3c!-- Combo System --\x3e\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">\n                                    <input type="checkbox" id="mazemaster_cm_combo_enabled" ').concat(pt.comboEnabled?"checked":"",'>\n                                    Combo System\n                                </label>\n                                <div class="mazemaster-bb-settings">\n                                    <div class="mazemaster-bb-row">\n                                        <div class="mazemaster-bb-field">\n                                            <label>Bonus per Hit (%)</label>\n                                            <input type="number" id="mazemaster_cm_combo_bonus" min="1" max="25" value="').concat(pt.comboBonusPerHit||5,'">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Max Bonus (%)</label>\n                                            <input type="number" id="mazemaster_cm_combo_max" min="10" max="100" value="').concat(pt.maxComboBonus||50,'">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Decay Turns</label>\n                                            <input type="number" id="mazemaster_cm_combo_decay" min="1" max="10" value="').concat(pt.comboDecayTurns||2,'">\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-bb-row">\n                                        <div class="mazemaster-bb-field" style="display: flex; align-items: center; gap: 8px;">\n                                            <input type="checkbox" id="mazemaster_cm_combo_reset_miss" ').concat(!1!==pt.comboResetOnMiss?"checked":"",'>\n                                            <label style="margin: 0;">Reset on Miss</label>\n                                        </div>\n                                        <div class="mazemaster-bb-field" style="display: flex; align-items: center; gap: 8px;">\n                                            <input type="checkbox" id="mazemaster_cm_combo_reset_damage" ').concat(pt.comboResetOnDamage?"checked":"",'>\n                                            <label style="margin: 0;">Reset on Damage</label>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            \x3c!-- Block System --\x3e\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">\n                                    <input type="checkbox" id="mazemaster_cm_block_enabled" ').concat(pt.blockEnabled?"checked":"",'>\n                                    Block System\n                                </label>\n                                <div class="mazemaster-bb-settings">\n                                    <div class="mazemaster-bb-row">\n                                        <div class="mazemaster-bb-field">\n                                            <label>Damage Reduction (%)</label>\n                                            <input type="number" id="mazemaster_cm_block_reduction" min="10" max="100" value="').concat(Math.round(100*(pt.blockDamageReduction||.5)),'">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Break Threshold</label>\n                                            <input type="number" id="mazemaster_cm_block_threshold" min="0" max="100" value="').concat(pt.blockBreakThreshold||0,'" title="Damage to break block (0=never)">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Perfect Block (%)</label>\n                                            <input type="number" id="mazemaster_cm_perfect_block" min="50" max="100" value="').concat(Math.round(100*(pt.perfectBlockReduction||.8)),'">\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            \x3c!-- Parry System --\x3e\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">\n                                    <input type="checkbox" id="mazemaster_cm_parry_enabled" ').concat(pt.parryEnabled?"checked":"",'>\n                                    Parry System\n                                </label>\n                                <div class="mazemaster-bb-settings">\n                                    <div class="mazemaster-bb-row">\n                                        <div class="mazemaster-bb-field">\n                                            <label>Window (sec)</label>\n                                            <input type="number" id="mazemaster_cm_parry_window" min="0.1" max="2" step="0.1" value="').concat(pt.parryWindow||.5,'">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Counter Multiplier</label>\n                                            <input type="number" id="mazemaster_cm_parry_mult" min="1" max="3" step="0.1" value="').concat(pt.parryDamageMultiplier||1.5,'">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Stun Duration</label>\n                                            <input type="number" id="mazemaster_cm_parry_stun" min="0" max="5" value="').concat(pt.parryStunDuration||1,'">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Difficulty</label>\n                                            <select id="mazemaster_cm_parry_diff" class="mazemaster-select">\n                                                <option value="easy" ').concat("easy"===pt.parryDifficulty?"selected":"",'>Easy</option>\n                                                <option value="normal" ').concat("normal"!==pt.parryDifficulty&&pt.parryDifficulty?"":"selected",'>Normal</option>\n                                                <option value="hard" ').concat("hard"===pt.parryDifficulty?"selected":"",'>Hard</option>\n                                            </select>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            \x3c!-- Counter System --\x3e\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">\n                                    <input type="checkbox" id="mazemaster_cm_counter_enabled" ').concat(!1!==pt.counterEnabled?"checked":"",'>\n                                    Counter-Attack\n                                </label>\n                                <div class="mazemaster-bb-settings">\n                                    <div class="mazemaster-bb-row">\n                                        <div class="mazemaster-bb-field">\n                                            <label>Damage Bonus (%)</label>\n                                            <input type="number" id="mazemaster_cm_counter_bonus" min="0" max="100" value="').concat(pt.counterDamageBonus||25,'">\n                                        </div>\n                                        <div class="mazemaster-bb-field">\n                                            <label>Crit Bonus (%)</label>\n                                            <input type="number" id="mazemaster_cm_counter_crit" min="0" max="50" value="').concat(pt.counterCritBonus||15,'">\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            \x3c!-- STScript Hooks --\x3e\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label">STScript Hooks</label>\n                                <div class="mazemaster-bb-commands">\n                                    <div class="mazemaster-bb-command">\n                                        <label>On Combo Increase:</label>\n                                        <textarea id="mazemaster_cm_on_combo" placeholder="/echo Combo {{comboCount}}x! +{{totalBonus}}% damage">').concat(Or(pt.onComboIncrease||""),'</textarea>\n                                    </div>\n                                    <div class="mazemaster-bb-command">\n                                        <label>On Combo Break:</label>\n                                        <textarea id="mazemaster_cm_on_combo_break" placeholder="/echo Combo broken at {{finalCombo}}x!">').concat(Or(pt.onComboBreak||""),'</textarea>\n                                    </div>\n                                    <div class="mazemaster-bb-command">\n                                        <label>On Block Success:</label>\n                                        <textarea id="mazemaster_cm_on_block" placeholder="/echo Blocked {{damageBlocked}} damage!">').concat(Or(pt.onBlockSuccess||""),'</textarea>\n                                    </div>\n                                    <div class="mazemaster-bb-command">\n                                        <label>On Parry Success:</label>\n                                        <textarea id="mazemaster_cm_on_parry" placeholder="/echo Parried {{enemyName}}! Counter: {{counterDamage}}">').concat(Or(pt.onParrySuccess||""),'</textarea>\n                                    </div>\n                                    <div class="mazemaster-bb-command">\n                                        <label>On Counter Attack:</label>\n                                        <textarea id="mazemaster_cm_on_counter" placeholder="/echo Counter hit for {{damage}}!">').concat(Or(pt.onCounterAttack||""),'</textarea>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <button id="mazemaster_cm_save_btn" class="menu_button menu_button_primary mazemaster-save-btn">\n                                    <i class="fa-solid fa-save"></i> Save Profile\n                                </button>\n                            </div>\n                        </div>\x3c!-- End combat_mechanics_content --\x3e\n\n                    </div>\x3c!-- End mazemaster_combat_config --\x3e\n\n                    \x3c!-- MAZE CONFIG --\x3e\n                    <div id="mazemaster_maze_config" class="mazemaster-game-config" style="').concat("maze"===mt?"":"display: none;",'">\n                        \x3c!-- Profile Selection --\x3e\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Maze Profile</label>\n                            <div class="mazemaster-profile-row">\n                                <select id="mazemaster_maze_profile_select" class="mazemaster-select">\n                                    ').concat(0===rt.length?'<option value="">No profiles</option>':"","\n                                    ").concat(rt.map((e=>'<option value="'.concat(Or(e),'" ').concat(e===st?"selected":"",">").concat(Or(e),"</option>"))).join(""),'\n                                </select>\n                                <button id="mazemaster_maze_new_profile_btn" class="menu_button menu_button_icon" title="New Profile">\n                                    <i class="fa-solid fa-plus"></i>\n                                </button>\n                                <button id="mazemaster_maze_delete_profile_btn" class="menu_button menu_button_icon" title="Delete Profile">\n                                    <i class="fa-solid fa-trash"></i>\n                                </button>\n                                <button id="mazemaster_maze_rename_profile_btn" class="menu_button menu_button_icon" title="Rename Profile">\n                                    <i class="fa-solid fa-pen"></i>\n                                </button>\n                            </div>\n                        </div>\n\n                        \x3c!-- Grid Size and Difficulty --\x3e\n                        <div class="mazemaster-inline-row">\n                            <div class="mazemaster-section mazemaster-flex-1">\n                                <label class="mazemaster-label">Grid Size</label>\n                                <select id="mazemaster_maze_size" class="mazemaster-select">\n                                    <option value="5" ').concat(5===(lt.gridSize||10)?"selected":"",'>5x5</option>\n                                    <option value="6" ').concat(6===(lt.gridSize||10)?"selected":"",'>6x6</option>\n                                    <option value="7" ').concat(7===(lt.gridSize||10)?"selected":"",'>7x7</option>\n                                    <option value="8" ').concat(8===(lt.gridSize||10)?"selected":"",'>8x8</option>\n                                    <option value="9" ').concat(9===(lt.gridSize||10)?"selected":"",'>9x9</option>\n                                    <option value="10" ').concat(10===(lt.gridSize||10)?"selected":"",'>10x10</option>\n                                    <option value="11" ').concat(11===(lt.gridSize||10)?"selected":"",'>11x11</option>\n                                    <option value="12" ').concat(12===(lt.gridSize||10)?"selected":"",'>12x12</option>\n                                    <option value="13" ').concat(13===(lt.gridSize||10)?"selected":"",'>13x13</option>\n                                    <option value="14" ').concat(14===(lt.gridSize||10)?"selected":"",'>14x14</option>\n                                    <option value="15" ').concat(15===(lt.gridSize||10)?"selected":"",'>15x15</option>\n                                    <option value="16" ').concat(16===(lt.gridSize||10)?"selected":"",'>16x16</option>\n                                    <option value="17" ').concat(17===(lt.gridSize||10)?"selected":"",'>17x17</option>\n                                    <option value="18" ').concat(18===(lt.gridSize||10)?"selected":"",'>18x18</option>\n                                    <option value="19" ').concat(19===(lt.gridSize||10)?"selected":"",'>19x19</option>\n                                    <option value="20" ').concat(20===(lt.gridSize||10)?"selected":"",'>20x20</option>\n                                </select>\n                            </div>\n                            <div class="mazemaster-section mazemaster-flex-1">\n                                <label class="mazemaster-label">Difficulty</label>\n                                <select id="mazemaster_maze_difficulty" class="mazemaster-select">\n                                    ').concat(tt(lt.difficulty||"normal"),'\n                                </select>\n                            </div>\n                        </div>\n                        <div class="mazemaster-help-small"><small>Difficulty affects encounter density, trap frequency, loot, and starting inventory</small></div>\n\n                        <div class="mazemaster-flex-row">\n                            <div class="mazemaster-section mazemaster-flex-1">\n                                <label class="mazemaster-label">Theme</label>\n                                <select id="mazemaster_maze_theme" class="mazemaster-select">\n                                    ').concat(et(lt.theme||"fantasy"),'\n                                </select>\n                            </div>\n                            <div class="mazemaster-section mazemaster-flex-1">\n                                <label class="mazemaster-label">Map Style</label>\n                                <select id="mazemaster_maze_mapstyle" class="mazemaster-select">\n                                    ').concat(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"maze";return $e().map((t=>{const a=t===e?"selected":"";return'<option value="'.concat(t,'" ').concat(a,">").concat(function(e){return{maze:"Classic Maze",dungeon:"Dungeon",city:"City Streets",forest:"Forest",spaceship:"Spaceship",spacestation:"Space Station",outpost:"Outpost",college:"College Campus",apartment:"Apartment Complex",neotokyo:"Neo Tokyo",arena:"Battle Arena",hospital:"Hospital",highrise:"Abandoned Highrise"}[e]||e.charAt(0).toUpperCase()+e.slice(1)}(t),"</option>")})).join("\n")}(lt.mapStyle||"maze"),'\n                                </select>\n                            </div>\n                            <div class="mazemaster-section mazemaster-flex-1">\n                                <label class="mazemaster-label">Floors</label>\n                                <select id="mazemaster_maze_floors" class="mazemaster-select">\n                                    <option value="1" ').concat(1===(lt.floors||1)?"selected":"",'>1 Floor</option>\n                                    <option value="2" ').concat(2===(lt.floors||1)?"selected":"",'>2 Floors</option>\n                                    <option value="3" ').concat(3===(lt.floors||1)?"selected":"",'>3 Floors</option>\n                                    <option value="4" ').concat(4===(lt.floors||1)?"selected":"",'>4 Floors</option>\n                                    <option value="5" ').concat(5===(lt.floors||1)?"selected":"",'>5 Floors</option>\n                                </select>\n                            </div>\n                        </div>\n                        <div class="mazemaster-help-small"><small>Theme affects flavor text and item names. Map style changes the generation algorithm. Floors adds vertical navigation with staircases.</small></div>\n\n                        <div class="mazemaster-row" style="margin-top: 8px;">\n                            <label style="font-size: 0.85em; color: var(--SmartThemeBodyColor); margin-bottom: 4px; display: block;">Map Visibility</label>\n                            <div class="mazemaster-radio-group" style="display: flex; gap: 12px; flex-wrap: wrap;">\n                                <label class="mazemaster-radio-label" style="display: flex; align-items: center; gap: 4px; cursor: pointer;">\n                                    <input type="radio" name="mazemaster_map_visibility" value="showAll" ').concat("showAll"===lt.mapVisibility||!lt.mapVisibility&&!1===lt.fogOfWar?"checked":"",'>\n                                    <span>Show Full</span>\n                                </label>\n                                <label class="mazemaster-radio-label" style="display: flex; align-items: center; gap: 4px; cursor: pointer;">\n                                    <input type="radio" name="mazemaster_map_visibility" value="fogOfWar" ').concat("fogOfWar"===lt.mapVisibility||!lt.mapVisibility&&!1!==lt.fogOfWar?"checked":"",'>\n                                    <span>Fog of War</span>\n                                </label>\n                                <label class="mazemaster-radio-label" style="display: flex; align-items: center; gap: 4px; cursor: pointer;">\n                                    <input type="radio" name="mazemaster_map_visibility" value="hideUnexplored" ').concat("hideUnexplored"===lt.mapVisibility?"checked":"",'>\n                                    <span>Hide Unexplored</span>\n                                </label>\n                            </div>\n                        </div>\n\n                        \x3c!-- COLLAPSIBLE: Minimap Settings --\x3e\n                        <div class="mazemaster-collapsible ').concat(Ta().enabled?"expanded":"",'">\n                            <button class="mazemaster-collapsible-header" data-target="minimap_settings_section">\n                                <i class="fa-solid fa-chevron-right mazemaster-collapse-icon"></i>\n                                <span>Minimap</span>\n                                <span class="mazemaster-collapse-hint">(').concat(Ta().enabled?"enabled":"disabled",')</span>\n                            </button>\n                            <div id="minimap_settings_section" class="mazemaster-collapsible-content" style="display: ').concat(Ta().enabled?"block":"none",';">\n                                <div class="mazemaster-section">\n                                    <div class="mazemaster-flex-row" style="gap: 10px;">\n                                        <div class="mazemaster-section mazemaster-flex-1">\n                                            <label class="mazemaster-checkbox-label">\n                                                <input type="checkbox" id="mazemaster_minimap_enabled" ').concat(Ta().enabled?"checked":"",'>\n                                                <span>Enable Minimap</span>\n                                            </label>\n                                        </div>\n                                        <div class="mazemaster-section mazemaster-flex-1">\n                                            <label class="mazemaster-label">Position</label>\n                                            <select id="mazemaster_minimap_position" class="mazemaster-select">\n                                                <option value="top-left" ').concat("top-left"===Ta().position?"selected":"",'>Top Left</option>\n                                                <option value="top-right" ').concat("top-right"===Ta().position?"selected":"",'>Top Right</option>\n                                                <option value="bottom-left" ').concat("bottom-left"===Ta().position?"selected":"",'>Bottom Left</option>\n                                                <option value="bottom-right" ').concat("bottom-right"===Ta().position?"selected":"",'>Bottom Right</option>\n                                            </select>\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-flex-row" style="gap: 10px; margin-top: 8px;">\n                                        <div class="mazemaster-section mazemaster-flex-1">\n                                            <label class="mazemaster-label">Size (px)</label>\n                                            <input type="number" id="mazemaster_minimap_size" class="mazemaster-input" value="').concat(Ta().size,'" min="80" max="300" step="10">\n                                        </div>\n                                        <div class="mazemaster-section mazemaster-flex-1">\n                                            <label class="mazemaster-label">Opacity</label>\n                                            <input type="range" id="mazemaster_minimap_opacity" class="mazemaster-range" value="').concat(100*Ta().opacity,'" min="20" max="100" step="5">\n                                            <span class="mazemaster-range-value">').concat(Math.round(100*Ta().opacity),'%</span>\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-flex-row" style="gap: 10px; margin-top: 8px;">\n                                        <div class="mazemaster-section mazemaster-flex-1">\n                                            <label class="mazemaster-checkbox-label">\n                                                <input type="checkbox" id="mazemaster_minimap_show_markers" ').concat(!1!==Ta().showMarkers?"checked":"",'>\n                                                <span>Show Markers</span>\n                                            </label>\n                                        </div>\n                                        <div class="mazemaster-section mazemaster-flex-1">\n                                            <label class="mazemaster-checkbox-label">\n                                                <input type="checkbox" id="mazemaster_minimap_show_minions" ').concat(!1!==Ta().showMinions?"checked":"",'>\n                                                <span>Show Minions</span>\n                                            </label>\n                                        </div>\n                                        <div class="mazemaster-section mazemaster-flex-1">\n                                            <label class="mazemaster-checkbox-label">\n                                                <input type="checkbox" id="mazemaster_minimap_show_chests" ').concat(!1!==Ta().showChests?"checked":"",'>\n                                                <span>Show Chests</span>\n                                            </label>\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-help-small" style="margin-top: 6px;"><small>The minimap shows a bird\'s eye view of the maze. Click to place markers, or use the toggle button in the maze UI.</small></div>\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- v1.4.0 BSP Configuration --\x3e\n                        <div class="mazemaster-collapsible ').concat((null===(r=lt.bspConfig)||void 0===r?void 0:r.zoneCount)>1||(null===(s=lt.bspConfig)||void 0===s?void 0:s.secretDensity)>0?"expanded":"",'">\n                            <button class="mazemaster-collapsible-header" data-target="bsp_config_section">\n                                <i class="fa-solid fa-chevron-right mazemaster-collapse-icon"></i>\n                                <span>Zone & Secret Settings</span>\n                                <span class="mazemaster-collapse-hint">(BSP dungeon generation)</span>\n                            </button>\n                            <div id="bsp_config_section" class="mazemaster-collapsible-content" style="display: ').concat((null===(l=lt.bspConfig)||void 0===l?void 0:l.zoneCount)>1||(null===(c=lt.bspConfig)||void 0===c?void 0:c.secretDensity)>0?"block":"none",';">\n                                <div class="mazemaster-flex-row" style="gap: 10px;">\n                                    <div class="mazemaster-section mazemaster-flex-1">\n                                        <label class="mazemaster-label">Zone Count</label>\n                                        <select id="mazemaster_bsp_zone_count" class="mazemaster-select">\n                                            <option value="1" ').concat(1===((null===(m=lt.bspConfig)||void 0===m?void 0:m.zoneCount)||1)?"selected":"",'>1 (No zones)</option>\n                                            <option value="2" ').concat(2===((null===(d=lt.bspConfig)||void 0===d?void 0:d.zoneCount)||1)?"selected":"",'>2 Zones</option>\n                                            <option value="3" ').concat(3===((null===(u=lt.bspConfig)||void 0===u?void 0:u.zoneCount)||1)?"selected":"",'>3 Zones</option>\n                                            <option value="4" ').concat(4===((null===(p=lt.bspConfig)||void 0===p?void 0:p.zoneCount)||1)?"selected":"",'>4 Zones</option>\n                                            <option value="5" ').concat(5===((null===(h=lt.bspConfig)||void 0===h?void 0:h.zoneCount)||1)?"selected":"",'>5 Zones</option>\n                                        </select>\n                                    </div>\n                                    <div class="mazemaster-section mazemaster-flex-1">\n                                        <label class="mazemaster-label">Secret Passages</label>\n                                        <select id="mazemaster_bsp_secret_density" class="mazemaster-select">\n                                            <option value="0" ').concat(0===((null===(g=lt.bspConfig)||void 0===g?void 0:g.secretDensity)||0)?"selected":"",'>None</option>\n                                            <option value="0.02" ').concat(.02==((null===(f=lt.bspConfig)||void 0===f?void 0:f.secretDensity)||0)?"selected":"",'>Low (2%)</option>\n                                            <option value="0.05" ').concat(.05==((null===(y=lt.bspConfig)||void 0===y?void 0:y.secretDensity)||0)?"selected":"",'>Medium (5%)</option>\n                                            <option value="0.08" ').concat(.08==((null===(v=lt.bspConfig)||void 0===v?void 0:v.secretDensity)||0)?"selected":"",'>High (8%)</option>\n                                        </select>\n                                    </div>\n                                </div>\n                                <div class="mazemaster-flex-row" style="gap: 10px; margin-top: 8px;">\n                                    <div class="mazemaster-section mazemaster-flex-1">\n                                        <label class="mazemaster-checkbox-label">\n                                            <input type="checkbox" id="mazemaster_bsp_zones_require_clear" ').concat(!1!==(null===(b=lt.bspConfig)||void 0===b?void 0:b.zonesRequireClear)?"checked":"",'>\n                                            <span>Zones require room clearing</span>\n                                        </label>\n                                    </div>\n                                    <div class="mazemaster-section mazemaster-flex-1">\n                                        <label class="mazemaster-checkbox-label">\n                                            <input type="checkbox" id="mazemaster_bsp_secret_hints" ').concat(!1!==(null===(z=lt.bspConfig)||void 0===z?void 0:z.secretHints)?"checked":"",'>\n                                            <span>Show secret hints</span>\n                                        </label>\n                                    </div>\n                                </div>\n                                <div class="mazemaster-flex-row" style="gap: 10px; margin-top: 8px;">\n                                    <div class="mazemaster-section mazemaster-flex-1">\n                                        <label class="mazemaster-checkbox-label">\n                                            <input type="checkbox" id="mazemaster_bsp_floor_scaling" ').concat(!1!==(null===(_=lt.bspConfig)||void 0===_?void 0:_.floorComplexityScaling)?"checked":"",'>\n                                            <span>Scale complexity per floor</span>\n                                        </label>\n                                    </div>\n                                </div>\n                                <div class="mazemaster-help-small" style="margin-top: 6px;"><small>Zones create Metroidvania-style progression. Clear rooms to unlock the next zone. Secrets are hidden passages found by bumping walls.</small></div>\n                            </div>\n                        </div>\n\n                        \x3c!-- COLLAPSIBLE: Teleport Portals --\x3e\n                        <div class="mazemaster-collapsible ').concat(lt.portals&&lt.portals.length>0?"expanded":"",'">\n                            <button class="mazemaster-collapsible-header" data-target="portals_section">\n                                <i class="fa-solid fa-chevron-right mazemaster-collapse-icon"></i>\n                                <span>Teleport Portals</span>\n                                <span class="mazemaster-collapse-hint">(').concat((lt.portals||[]).length,' portal pairs)</span>\n                            </button>\n                            <div id="portals_section" class="mazemaster-collapsible-content" style="display: ').concat(lt.portals&&lt.portals.length>0?"block":"none",';">\n                                <div class="mazemaster-section">\n                                    <div class="mazemaster-help-small"><small>Add portals that teleport the player between two points. Leave coordinates blank for random placement.</small></div>\n                                    <div id="mazemaster_portals_list" class="mazemaster-portals-list">\n                                        ').concat((lt.portals||[]).map(((e,t)=>{var a,n,o,i;return'\n                                            <div class="mazemaster-portal-item" data-portal-index="'.concat(t,'">\n                                                <div class="portal-header">\n                                                    <span class="portal-color" style="background: ').concat(e.color||"#9b59b6",'"></span>\n                                                    <span class="portal-name">').concat(Or(e.id||"Portal "+(t+1)),'</span>\n                                                    <button class="menu_button remove-portal-btn" data-index="').concat(t,'" title="Remove Portal">\n                                                        <i class="fa-solid fa-trash"></i>\n                                                    </button>\n                                                </div>\n                                                <div class="portal-details">\n                                                    <div class="portal-row">\n                                                        <label>ID:</label>\n                                                        <input type="text" class="portal-id mazemaster-input" value="').concat(Or(e.id||""),'" placeholder="portal1">\n                                                    </div>\n                                                    <div class="portal-row">\n                                                        <label>Color:</label>\n                                                        <input type="color" class="portal-color-input" value="').concat(e.color||"#9b59b6",'">\n                                                    </div>\n                                                    <div class="portal-row">\n                                                        <label>Bidirectional:</label>\n                                                        <input type="checkbox" class="portal-bidirectional" ').concat(!1!==e.bidirectional?"checked":"",'>\n                                                    </div>\n                                                    <div class="portal-row coords-row">\n                                                        <span>Start: X</span>\n                                                        <input type="number" class="portal-start-x mazemaster-input" value="').concat(null!==(a=e.startX)&&void 0!==a?a:"",'" placeholder="auto" min="0">\n                                                        <span>Y</span>\n                                                        <input type="number" class="portal-start-y mazemaster-input" value="').concat(null!==(n=e.startY)&&void 0!==n?n:"",'" placeholder="auto" min="0">\n                                                    </div>\n                                                    <div class="portal-row coords-row">\n                                                        <span>End: X</span>\n                                                        <input type="number" class="portal-end-x mazemaster-input" value="').concat(null!==(o=e.endX)&&void 0!==o?o:"",'" placeholder="auto" min="0">\n                                                        <span>Y</span>\n                                                        <input type="number" class="portal-end-y mazemaster-input" value="').concat(null!==(i=e.endY)&&void 0!==i?i:"",'" placeholder="auto" min="0">\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        ')})).join(""),'\n                                    </div>\n                                    <button id="mazemaster_add_portal_btn" class="menu_button">\n                                        <i class="fa-solid fa-plus"></i> Add Portal Pair\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- COLLAPSIBLE: Objectives --\x3e\n                        <div class="mazemaster-collapsible ').concat(lt.objectives&&lt.objectives.length>0?"expanded":"",'">\n                            <button class="mazemaster-collapsible-header" data-target="objectives_section">\n                                <i class="fa-solid fa-chevron-right mazemaster-collapse-icon"></i>\n                                <span>Objectives</span>\n                                <span class="mazemaster-collapse-hint">(').concat((lt.objectives||[]).length,' objectives)</span>\n                            </button>\n                            <div id="objectives_section" class="mazemaster-collapsible-content" style="display: ').concat(lt.objectives&&lt.objectives.length>0?"block":"none",';">\n                                <div class="mazemaster-section">\n                                    <div class="mazemaster-help-small"><small>Define objectives the player must complete. Required objectives must be done before exiting.</small></div>\n                                    <div id="mazemaster_objectives_list" class="mazemaster-objectives-list">\n                                        ').concat((lt.objectives||[]).map(((e,t)=>'\n                                            <div class="mazemaster-objective-item" data-objective-index="'.concat(t,'">\n                                                <div class="objective-config-header">\n                                                    <span class="objective-name">').concat(Or(e.description||e.id||"Objective "+(t+1)),'</span>\n                                                    <button class="menu_button remove-objective-btn" data-index="').concat(t,'" title="Remove Objective">\n                                                        <i class="fa-solid fa-trash"></i>\n                                                    </button>\n                                                </div>\n                                                <div class="objective-config-details">\n                                                    <div class="objective-config-row">\n                                                        <label>ID:</label>\n                                                        <input type="text" class="objective-id mazemaster-input" value="').concat(Or(e.id||""),'" placeholder="obj1">\n                                                    </div>\n                                                    <div class="objective-config-row">\n                                                        <label>Type:</label>\n                                                        <select class="objective-type mazemaster-select">\n                                                            <option value="collect" ').concat("collect"===e.type?"selected":"",'>Collect Item</option>\n                                                            <option value="defeat" ').concat("defeat"===e.type?"selected":"",'>Defeat Minion</option>\n                                                            <option value="explore" ').concat("explore"===e.type?"selected":"",'>Explore %</option>\n                                                        </select>\n                                                    </div>\n                                                    <div class="objective-config-row objective-target-row" style="display: ').concat("explore"!==e.type?"flex":"none",';">\n                                                        <label>Target:</label>\n                                                        <input type="text" class="objective-target mazemaster-input" value="').concat(Or(e.target||""),'" placeholder="').concat("collect"===e.type?"key, strike, stealth...":"minion ID",'">\n                                                    </div>\n                                                    <div class="objective-config-row">\n                                                        <label>Count:</label>\n                                                        <input type="number" class="objective-count mazemaster-input" value="').concat(e.count||1,'" min="1" placeholder="').concat("explore"===e.type?"% to explore":"amount",'">\n                                                    </div>\n                                                    <div class="objective-config-row">\n                                                        <label>Description:</label>\n                                                        <input type="text" class="objective-description mazemaster-input" value="').concat(Or(e.description||""),'" placeholder="Find 3 Keys">\n                                                    </div>\n                                                    <div class="objective-config-row">\n                                                        <label>Required:</label>\n                                                        <input type="checkbox" class="objective-required" ').concat(e.required?"checked":"",'>\n                                                    </div>\n                                                    <div class="objective-config-row">\n                                                        <label>Reward Script:</label>\n                                                        <input type="text" class="objective-reward mazemaster-input" value="').concat(Or(e.reward||""),'" placeholder="/echo Objective complete!">\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        '))).join(""),'\n                                    </div>\n                                    <button id="mazemaster_add_objective_btn" class="menu_button">\n                                        <i class="fa-solid fa-plus"></i> Add Objective\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- COLLAPSIBLE: Main Minion --\x3e\n                        <div class="mazemaster-collapsible ').concat(lt.mainMinion?"expanded":"",'">\n                            <button class="mazemaster-collapsible-header" data-target="main_minion_section">\n                                <i class="fa-solid fa-chevron-right mazemaster-collapse-icon"></i>\n                                <span>Main Minion</span>\n                                <span class="mazemaster-collapse-hint">(narrator/boss)</span>\n                            </button>\n                            <div id="main_minion_section" class="mazemaster-collapsible-content" style="display: ').concat(lt.mainMinion?"block":"none",';">\n                                <div class="mazemaster-section">\n                                    <select id="mazemaster_maze_main_minion" class="mazemaster-select">\n                                        <option value="">None</option>\n                                        ').concat(ct.map((e=>{const t=pn(e);return'<option value="'.concat(Or(e),'" ').concat(lt.mainMinion===e?"selected":"",">").concat(Or((null==t?void 0:t.name)||e),"</option>")})).join(""),'\n                                    </select>\n                                    <div class="mazemaster-help-small"><small>The main minion narrates the maze and guards the exit</small></div>\n                                </div>\n\n                                <div id="mazemaster_main_minion_settings" class="mazemaster-subsection" style="display: ').concat(lt.mainMinion?"block":"none",';">\n                                    <div class="mazemaster-section">\n                                        <label class="mazemaster-label">Intro Message</label>\n                                        <input type="text" id="mazemaster_maze_intro_message" class="mazemaster-input" placeholder="Welcome to my maze..." value="').concat(Or(lt.mainMinionIntroMessage||""),'">\n                                    </div>\n\n                                    <div class="mazemaster-inline-row">\n                                        <div class="mazemaster-section mazemaster-flex-1">\n                                            <label class="mazemaster-label">Random Msg %</label>\n                                            <input type="number" id="mazemaster_maze_random_chance" class="mazemaster-input" min="0" max="100" value="').concat(lt.mainMinionRandomChance||15,'">\n                                        </div>\n                                    </div>\n\n                                    <div class="mazemaster-section">\n                                        <label class="mazemaster-label">Random Messages (one per line)</label>\n                                        <textarea id="mazemaster_maze_random_messages" class="mazemaster-textarea" rows="2" placeholder="You\'re still here?&#10;Getting lost yet?">').concat(Or((lt.mainMinionRandomMessages||[]).join("\n")),'</textarea>\n                                    </div>\n\n                                    <div class="mazemaster-section">\n                                        <label class="mazemaster-label">Exit Encounter</label>\n                                        <div class="mazemaster-help-small"><small>What happens when the player reaches the exit</small></div>\n                                        <select id="mazemaster_maze_exit_type" class="mazemaster-select">\n                                            <option value="messenger" ').concat("messenger"===(lt.mainMinionExitType||"messenger")?"selected":"",'>Message Only (no challenge)</option>\n                                            <option value="battlebar" ').concat("battlebar"===lt.mainMinionExitType?"selected":"",'>Battlebar Fight</option>\n                                            <option value="prizewheel" ').concat("prizewheel"===lt.mainMinionExitType?"selected":"",'>Prize Wheel</option>\n                                            <option value="turnbased" ').concat("turnbased"===lt.mainMinionExitType?"selected":"",'>Turn-Based Combat</option>\n                                            <option value="qte" ').concat("qte"===lt.mainMinionExitType?"selected":"",'>QTE Combat</option>\n                                            <option value="dice" ').concat("dice"===lt.mainMinionExitType?"selected":"",'>Dice Combat</option>\n                                            <option value="stealth" ').concat("stealth"===lt.mainMinionExitType?"selected":"",'>Stealth</option>\n                                            <option value="puzzle" ').concat("puzzle"===lt.mainMinionExitType?"selected":"",'>Puzzle</option>\n                                            <option value="negotiation" ').concat("negotiation"===lt.mainMinionExitType?"selected":"",'>Negotiation</option>\n                                        </select>\n                                    </div>\n\n                                    <div id="mazemaster_exit_profile_section" class="mazemaster-section" style="display: ').concat(lt.mainMinionExitType&&"messenger"!==lt.mainMinionExitType?"block":"none",';">\n                                        <label class="mazemaster-label">Exit Game Profile</label>\n                                        <div class="mazemaster-help-small"><small>Which Battlebar/Wheel profile to use for the exit boss</small></div>\n                                        <select id="mazemaster_maze_exit_profile" class="mazemaster-select">\n                                            <option value="">Select...</option>\n                                        </select>\n                                    </div>\n\n                                    <div class="mazemaster-section">\n                                        <button id="mazemaster_maze_story_btn" class="menu_button">\n                                            <i class="fa-solid fa-book"></i> Story Milestones\n                                        </button>\n                                        <div class="mazemaster-help-small"><small>Configure story text shown as player progresses</small></div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- COLLAPSIBLE: Encounters --\x3e\n                        <div class="mazemaster-collapsible expanded">\n                            <button class="mazemaster-collapsible-header" data-target="encounters_section">\n                                <i class="fa-solid fa-chevron-right mazemaster-collapse-icon"></i>\n                                <span>Encounters</span>\n                                <span class="mazemaster-collapse-hint">(minions & traps)</span>\n                            </button>\n                            <div id="encounters_section" class="mazemaster-collapsible-content" style="display: block;">\n                                <div class="mazemaster-section">\n                                    <label class="mazemaster-label">Minion Encounters</label>\n                                    <div id="mazemaster_maze_encounters_list" class="mazemaster-encounters-list">\n                                        \x3c!-- Encounter rows rendered here --\x3e\n                                    </div>\n                                    <button id="mazemaster_add_encounter_btn" class="menu_button mazemaster-add-btn">\n                                        <i class="fa-solid fa-plus"></i> Add Minion\n                                    </button>\n                                </div>\n\n                                <div class="mazemaster-section">\n                                    <label class="mazemaster-label">Trap Tiles</label>\n                                    <div id="mazemaster_maze_traps_list" class="mazemaster-encounters-list">\n                                        \x3c!-- Trap encounter rows rendered here --\x3e\n                                    </div>\n                                    <button id="mazemaster_add_trap_encounter_btn" class="menu_button mazemaster-add-btn">\n                                        <i class="fa-solid fa-plus"></i> Add Trap\n                                    </button>\n                                </div>\n\n                                <div class="mazemaster-section">\n                                    <button id="mazemaster_intelligent_distribute" class="menu_button mazemaster-distribute-btn">\n                                        <i class="fa-solid fa-wand-magic-sparkles"></i> Intelligent Distribute\n                                    </button>\n                                    <div class="mazemaster-help-small">\n                                        <small>Auto-sets tile percentages based on minion types</small>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-section">\n                                    <label class="mazemaster-label">On Battlebar Loss</label>\n                                    <select id="mazemaster_maze_loss_action" class="mazemaster-select">\n                                        <option value="continue" ').concat("continue"===(lt.onBattlebarLoss||"continue")?"selected":"",'>Continue (skip encounter)</option>\n                                        <option value="respawn" ').concat("respawn"===lt.onBattlebarLoss?"selected":"",'>Respawn at Start</option>\n                                        <option value="gameover" ').concat("gameover"===lt.onBattlebarLoss?"selected":"",'>Game Over</option>\n                                    </select>\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- COLLAPSIBLE: Quests --\x3e\n                        <div class="mazemaster-collapsible">\n                            <button class="mazemaster-collapsible-header" data-target="quests_section">\n                                <i class="fa-solid fa-chevron-right mazemaster-collapse-icon"></i>\n                                <span>Quests</span>\n                            </button>\n                            <div id="quests_section" class="mazemaster-collapsible-content" style="display: none;">\n                                <div class="mazemaster-section">\n                                    <label class="mazemaster-label">Quest Pool</label>\n                                    <div class="mazemaster-help-small" style="margin-bottom: 8px;">\n                                        <small>Quests that can appear in this maze. Each quest has a % chance to be active.</small>\n                                    </div>\n                                    <div id="mazemaster_maze_quests_list" class="mazemaster-encounters-list">\n                                        \x3c!-- Quest pool rows rendered here --\x3e\n                                    </div>\n                                    <button id="mazemaster_add_quest_pool_btn" class="menu_button mazemaster-add-btn">\n                                        <i class="fa-solid fa-plus"></i> Add Quest\n                                    </button>\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- COLLAPSIBLE: Chests & Loot --\x3e\n                        <div class="mazemaster-collapsible">\n                            <button class="mazemaster-collapsible-header" data-target="chests_section">\n                                <i class="fa-solid fa-chevron-right mazemaster-collapse-icon"></i>\n                                <span>Chests & Loot</span>\n                            </button>\n                            <div id="chests_section" class="mazemaster-collapsible-content" style="display: none;">\n                                <div class="mazemaster-section">\n                                    <label class="mazemaster-label">Chest Image</label>\n                                    <div class="mazemaster-row" style="gap: 10px; align-items: center;">\n                                        <div class="mazemaster-chest-preview" style="width: 50px; height: 50px; border-radius: 5px; overflow: hidden; background: rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center;">\n                                            ').concat(lt.chestImage?'<img id="mazemaster_chest_preview_img" src="'.concat(It(lt.chestImage),'" style="width: 100%; height: 100%; object-fit: cover;">'):'<i id="mazemaster_chest_preview_icon" class="fa-solid fa-box" style="color: #888;"></i>','\n                                        </div>\n                                        <button id="mazemaster_chest_image_btn" class="menu_button menu_button_icon" title="Upload Chest Image">\n                                            <i class="fa-solid fa-upload"></i>\n                                        </button>\n                                        <input type="file" id="mazemaster_chest_image_file" accept="image/*" style="display: none;">\n                                        <small style="color: #888;">Custom chest appearance</small>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-section">\n                                    <label class="mazemaster-label">Chest Distribution</label>\n                                    <div class="mazemaster-grid-2col">\n                                        <div class="mazemaster-row">\n                                            <label>Chest Tiles %</label>\n                                            <input type="number" id="mazemaster_maze_chest_percent" class="mazemaster-input-small" min="0" max="50" value="').concat(lt.chestTilePercent||10,'">\n                                        </div>\n                                        <div class="mazemaster-row">\n                                            <label>Locked %</label>\n                                            <input type="number" id="mazemaster_maze_locked_percent" class="mazemaster-input-small" min="0" max="100" value="').concat(lt.chestLockedPercent||30,'">\n                                        </div>\n                                        <div class="mazemaster-row">\n                                            <label>Locked Bonus %</label>\n                                            <input type="number" id="mazemaster_maze_locked_bonus" class="mazemaster-input-small" min="0" max="200" value="').concat(lt.chestLockedBonusPercent||50,'">\n                                        </div>\n                                        <div class="mazemaster-row">\n                                            <label>Mimic %</label>\n                                            <input type="number" id="mazemaster_maze_mimic_percent" class="mazemaster-input-small" min="0" max="100" value="').concat(lt.chestMimicPercent||15,'">\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-section">\n                                    <label class="mazemaster-label">Loot per Chest</label>\n                                    <div class="mazemaster-row">\n                                        <input type="number" id="mazemaster_maze_loot_min" class="mazemaster-input-small" min="1" max="10" value="').concat(lt.chestLootMin||1,'" style="width:50px">\n                                        <span>to</span>\n                                        <input type="number" id="mazemaster_maze_loot_max" class="mazemaster-input-small" min="1" max="10" value="').concat(lt.chestLootMax||2,'" style="width:50px">\n                                        <span>items</span>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-section">\n                                    <label class="mazemaster-label">Regular Chest Loot %</label>\n                                    <div class="mazemaster-grid-4col">\n                                        <div class="mazemaster-row"><label>Key</label><input type="number" id="mazemaster_maze_chest_key" class="mazemaster-input-small" min="0" max="100" value="').concat(lt.chestKeyChance||30,'"></div>\n                                        <div class="mazemaster-row"><label>Strike</label><input type="number" id="mazemaster_maze_chest_pow" class="mazemaster-input-small" min="0" max="100" value="').concat(lt.chestStrikeChance||50,'"></div>\n                                        <div class="mazemaster-row"><label>Stealth</label><input type="number" id="mazemaster_maze_chest_stealth" class="mazemaster-input-small" min="0" max="100" value="').concat(lt.chestStealthChance||0,'"></div>\n                                        <div class="mazemaster-row"><label>Execute</label><input type="number" id="mazemaster_maze_chest_execute" class="mazemaster-input-small" min="0" max="100" value="').concat(lt.chestExecuteChance||0,'"></div>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-section">\n                                    <label class="mazemaster-label">Locked Chest Loot %</label>\n                                    <div class="mazemaster-grid-4col">\n                                        <div class="mazemaster-row"><label>Key</label><input type="number" id="mazemaster_maze_locked_key" class="mazemaster-input-small" min="0" max="100" value="').concat(lt.lockedChestKeyChance||40,'"></div>\n                                        <div class="mazemaster-row"><label>Strike</label><input type="number" id="mazemaster_maze_locked_pow" class="mazemaster-input-small" min="0" max="100" value="').concat(lt.lockedChestStrikeChance||60,'"></div>\n                                        <div class="mazemaster-row"><label>Stealth</label><input type="number" id="mazemaster_maze_locked_stealth" class="mazemaster-input-small" min="0" max="100" value="').concat(lt.lockedChestStealthChance||30,'"></div>\n                                        <div class="mazemaster-row"><label>Execute</label><input type="number" id="mazemaster_maze_locked_execute" class="mazemaster-input-small" min="0" max="100" value="').concat(lt.lockedChestExecuteChance||5,'"></div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- COLLAPSIBLE: Victory & Loss --\x3e\n                        <div class="mazemaster-collapsible">\n                            <button class="mazemaster-collapsible-header" data-target="victory_section">\n                                <i class="fa-solid fa-chevron-right mazemaster-collapse-icon"></i>\n                                <span>Victory & Loss</span>\n                            </button>\n                            <div id="victory_section" class="mazemaster-collapsible-content" style="display: none;">\n                                <div class="mazemaster-section">\n                                    <label class="mazemaster-label">Victory Message</label>\n                                    <input type="text" id="mazemaster_maze_win_message" class="mazemaster-input" placeholder="You escaped the maze!" value="').concat(Or(lt.winMessage||""),'">\n                                </div>\n\n                                <div class="mazemaster-section">\n                                    <label class="mazemaster-label">Victory Image</label>\n                                    <div class="mazemaster-maze-win-image-row">\n                                        <div class="mazemaster-maze-win-image-preview">\n                                            ').concat(lt.winImage?'<img id="maze_win_image_preview" src="'.concat(Or(lt.winImage),'" alt="Victory">'):'<div id="maze_win_image_preview" class="no-image">No image</div>','\n                                        </div>\n                                        <button id="mazemaster_maze_win_image_btn" class="menu_button">\n                                            <i class="fa-solid fa-upload"></i> Upload\n                                        </button>\n                                    </div>\n                                    <input type="file" id="mazemaster_maze_win_image_file" accept="image/*" style="display: none;">\n                                </div>\n\n                                <div class="mazemaster-section">\n                                    <label class="mazemaster-label">Win Command</label>\n                                    <textarea id="mazemaster_maze_win_cmd" class="mazemaster-textarea" rows="2" placeholder="/echo Victory!">').concat(Or(lt.winCommand||""),'</textarea>\n                                </div>\n\n                                <div class="mazemaster-section">\n                                    <label class="mazemaster-label">Lose Command</label>\n                                    <textarea id="mazemaster_maze_lose_cmd" class="mazemaster-textarea" rows="2" placeholder="/echo Defeated...">').concat(Or(lt.loseCommand||""),'</textarea>\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- COLLAPSIBLE: Starting Inventory --\x3e\n                        <div class="mazemaster-collapsible">\n                            <button class="mazemaster-collapsible-header" data-target="starting_inv_section">\n                                <i class="fa-solid fa-chevron-right mazemaster-collapse-icon"></i>\n                                <span>Starting Inventory</span>\n                            </button>\n                            <div id="starting_inv_section" class="mazemaster-collapsible-content" style="display: none;">\n                                <div class="mazemaster-section">\n                                    <label style="font-size: 0.8em; color: var(--SmartThemeEmColor);">Keys</label>\n                                    <div class="mazemaster-grid-4col">\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-key" style="color:#f1c40f;"></i> Key</label><input type="number" id="mazemaster_start_key" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(x=lt.startingInventory)||void 0===x?void 0:x.key)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-dungeon" style="color:#9b59b6;"></i> Floor Key</label><input type="number" id="mazemaster_start_floorKey" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(k=lt.startingInventory)||void 0===k?void 0:k.floorKey)||0,'"></div>\n                                    </div>\n                                    <label style="font-size: 0.8em; color: var(--SmartThemeEmColor); margin-top: 8px;">Combat Items</label>\n                                    <div class="mazemaster-grid-4col">\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-bolt" style="color:#e74c3c;"></i> Strike</label><input type="number" id="mazemaster_start_strike" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(C=lt.startingInventory)||void 0===C?void 0:C.strike)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-user-ninja" style="color:#3498db;"></i> Stealth</label><input type="number" id="mazemaster_start_stealth" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(w=lt.startingInventory)||void 0===w?void 0:w.stealth)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-skull" style="color:#8e44ad;"></i> Execute</label><input type="number" id="mazemaster_start_execute" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(E=lt.startingInventory)||void 0===E?void 0:E.execute)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-crosshairs" style="color:#e67e22;"></i> Minion Bane</label><input type="number" id="mazemaster_start_minionBane" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(T=lt.startingInventory)||void 0===T?void 0:T.minionBane)||0,'"></div>\n                                    </div>\n                                    <label style="font-size: 0.8em; color: var(--SmartThemeEmColor); margin-top: 8px;">Exploration Items</label>\n                                    <div class="mazemaster-grid-4col">\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-portal-enter" style="color:#9b59b6;"></i> Portal Stone</label><input type="number" id="mazemaster_start_portalStone" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(I=lt.startingInventory)||void 0===I?void 0:I.portalStone)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-map" style="color:#27ae60;"></i> Map Fragment</label><input type="number" id="mazemaster_start_mapFragment" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(P=lt.startingInventory)||void 0===P?void 0:P.mapFragment)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-ghost" style="color:#1abc9c;"></i> Void Walk</label><input type="number" id="mazemaster_start_voidWalk" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(D=lt.startingInventory)||void 0===D?void 0:D.voidWalk)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-clock-rotate-left" style="color:#3498db;"></i> Time Shard</label><input type="number" id="mazemaster_start_timeShard" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(A=lt.startingInventory)||void 0===A?void 0:A.timeShard)||0,'"></div>\n                                    </div>\n                                    <label style="font-size: 0.8em; color: var(--SmartThemeEmColor); margin-top: 8px;">HP Items</label>\n                                    <div class="mazemaster-grid-4col">\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-flask" style="color:#e74c3c;"></i> Potion</label><input type="number" id="mazemaster_start_healingPotion" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(B=lt.startingInventory)||void 0===B?void 0:B.healingPotion)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-flask" style="color:#9b59b6;"></i> Greater</label><input type="number" id="mazemaster_start_greaterHealing" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(L=lt.startingInventory)||void 0===L?void 0:L.greaterHealing)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-vial" style="color:#f1c40f;"></i> Elixir</label><input type="number" id="mazemaster_start_elixir" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(q=lt.startingInventory)||void 0===q?void 0:q.elixir)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-heart-circle-plus" style="color:#e91e63;"></i> Revival</label><input type="number" id="mazemaster_start_revivalCharm" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(R=lt.startingInventory)||void 0===R?void 0:R.revivalCharm)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-gem" style="color:#e91e63;"></i> Heart Crystal</label><input type="number" id="mazemaster_start_heartCrystal" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(N=lt.startingInventory)||void 0===N?void 0:N.heartCrystal)||0,'"></div>\n                                    </div>\n                                    <label style="font-size: 0.8em; color: var(--SmartThemeEmColor); margin-top: 8px;">Vision Items</label>\n                                    <div class="mazemaster-grid-4col">\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-fire" style="color:#e67e22;"></i> Torch</label><input type="number" id="mazemaster_start_torch" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(H=lt.startingInventory)||void 0===H?void 0:H.torch)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-regular fa-lightbulb" style="color:#f1c40f;"></i> Lantern</label><input type="number" id="mazemaster_start_lantern" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(O=lt.startingInventory)||void 0===O?void 0:O.lantern)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-scroll" style="color:#3498db;"></i> Reveal Scroll</label><input type="number" id="mazemaster_start_revealScroll" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(F=lt.startingInventory)||void 0===F?void 0:F.revealScroll)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-eye" style="color:#9b59b6;"></i> Sight Potion</label><input type="number" id="mazemaster_start_sightPotion" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(W=lt.startingInventory)||void 0===W?void 0:W.sightPotion)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-crystal-ball" style="color:#1abc9c;"></i> Crystal Ball</label><input type="number" id="mazemaster_start_crystalBall" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(Y=lt.startingInventory)||void 0===Y?void 0:Y.crystalBall)||0,'"></div>\n                                    </div>\n                                    <label style="font-size: 0.8em; color: var(--SmartThemeEmColor); margin-top: 8px;">Equipment - Weapons</label>\n                                    <div class="mazemaster-grid-4col">\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-sword" style="color:#8B4513;"></i> Rusty Sword</label><input type="number" id="mazemaster_start_weapon_rusty_sword" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(U=lt.startingInventory)||void 0===U?void 0:U.weapon_rusty_sword)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-sword" style="color:#708090;"></i> Iron Sword</label><input type="number" id="mazemaster_start_weapon_iron_sword" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(G=lt.startingInventory)||void 0===G?void 0:G.weapon_iron_sword)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-sword" style="color:#C0C0C0;"></i> Steel Blade</label><input type="number" id="mazemaster_start_weapon_steel_blade" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(j=lt.startingInventory)||void 0===j?void 0:j.weapon_steel_blade)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-sword" style="color:#9b59b6;"></i> Enchanted Blade</label><input type="number" id="mazemaster_start_weapon_enchanted_blade" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(K=lt.startingInventory)||void 0===K?void 0:K.weapon_enchanted_blade)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-khanda" style="color:#2c3e50;"></i> Shadow Dagger</label><input type="number" id="mazemaster_start_weapon_shadow_dagger" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(V=lt.startingInventory)||void 0===V?void 0:V.weapon_shadow_dagger)||0,'"></div>\n                                    </div>\n                                    <label style="font-size: 0.8em; color: var(--SmartThemeEmColor); margin-top: 8px;">Equipment - Armor</label>\n                                    <div class="mazemaster-grid-4col">\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-vest" style="color:#8B4513;"></i> Leather Armor</label><input type="number" id="mazemaster_start_armor_leather" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(X=lt.startingInventory)||void 0===X?void 0:X.armor_leather)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-shield" style="color:#708090;"></i> Chainmail</label><input type="number" id="mazemaster_start_armor_chainmail" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(Q=lt.startingInventory)||void 0===Q?void 0:Q.armor_chainmail)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-shield-halved" style="color:#C0C0C0;"></i> Plate Armor</label><input type="number" id="mazemaster_start_armor_plate" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(J=lt.startingInventory)||void 0===J?void 0:J.armor_plate)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-shield-halved" style="color:#7f8c8d;"></i> Iron Guard</label><input type="number" id="mazemaster_start_ironGuard" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(Z=lt.startingInventory)||void 0===Z?void 0:Z.ironGuard)||0,'"></div>\n                                    </div>\n                                    <label style="font-size: 0.8em; color: var(--SmartThemeEmColor); margin-top: 8px;">Equipment - Accessories</label>\n                                    <div class="mazemaster-grid-4col">\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-ring" style="color:#e74c3c;"></i> Ring of Power</label><input type="number" id="mazemaster_start_accessory_ring_power" class="mazemaster-input-small" min="0" max="99" value="').concat((null===($=lt.startingInventory)||void 0===$?void 0:$.accessory_ring_power)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-gem" style="color:#3498db;"></i> Amulet of Protection</label><input type="number" id="mazemaster_start_accessory_amulet_protection" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(ee=lt.startingInventory)||void 0===ee?void 0:ee.accessory_amulet_protection)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-clover" style="color:#27ae60;"></i> Lucky Charm</label><input type="number" id="mazemaster_start_accessory_lucky_charm" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(te=lt.startingInventory)||void 0===te?void 0:te.accessory_lucky_charm)||0,'"></div>\n                                        <div class="mazemaster-row"><label><i class="fa-solid fa-droplet" style="color:#8e44ad;"></i> Vampiric Pendant</label><input type="number" id="mazemaster_start_accessory_vampiric_pendant" class="mazemaster-input-small" min="0" max="99" value="').concat((null===(ae=lt.startingInventory)||void 0===ae?void 0:ae.accessory_vampiric_pendant)||0,'"></div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- COLLAPSIBLE: Find Early Items --\x3e\n                        <div class="mazemaster-collapsible">\n                            <button class="mazemaster-collapsible-header" data-target="find_early_section">\n                                <i class="fa-solid fa-chevron-right mazemaster-collapse-icon"></i>\n                                <span>Find Early Items</span>\n                            </button>\n                            <div id="find_early_section" class="mazemaster-collapsible-content" style="display: none;">\n                                <div class="mazemaster-help-small"><small>Guarantee items in chests near the starting position. Great for ensuring vision or healing items are available early.</small></div>\n                                <div class="mazemaster-section">\n                                    <div class="mazemaster-grid-3col" style="margin-bottom: 8px;">\n                                        <div class="mazemaster-row"><label>Search Radius</label><input type="number" id="mazemaster_findearly_radius" class="mazemaster-input-small" min="1" max="10" value="').concat((null===(ne=lt.findEarly)||void 0===ne?void 0:ne.radius)||4,'" title="Manhattan distance from start to search for chests"></div>\n                                        <div class="mazemaster-row"><label>Items/Chest</label><input type="number" id="mazemaster_findearly_perchest" class="mazemaster-input-small" min="1" max="5" value="').concat((null===(oe=lt.findEarly)||void 0===oe?void 0:oe.itemsPerChest)||1,'" title="Max guaranteed items per chest"></div>\n                                        <div></div>\n                                    </div>\n                                    <label class="mazemaster-label">Items to Place Near Start</label>\n                                    <div id="mazemaster_findearly_items_container" class="mazemaster-grid-5col" style="gap: 4px;">\n                                        \x3c!-- v1.9.0: Dynamically generated from item profiles --\x3e\n                                        ').concat(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=Qe();let a="";for(const n of t){const t=Xe(n);if(!t)continue;const o=e.includes(n)?"checked":"",i=t.icon||"fa-box",r=t.iconColor||"#888",s=t.name.length>10?t.name.substring(0,8)+"...":t.name;a+='<label class="mazemaster-checkbox-label"><input type="checkbox" id="mazemaster_findearly_'.concat(n,'" ').concat(o,'><i class="fa-solid ').concat(i,'" style="color:').concat(r,';"></i> ').concat(s,"</label>")}return a}((null===(ie=lt.findEarly)||void 0===ie?void 0:ie.items)||[]),'\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- COLLAPSIBLE: Item Pool (v1.8.0) --\x3e\n                        <div class="mazemaster-collapsible">\n                            <button class="mazemaster-collapsible-header" data-target="item_pool_section">\n                                <i class="fa-solid fa-chevron-right mazemaster-collapse-icon"></i>\n                                <span><i class="fa-solid fa-box-open"></i> Item Pool</span>\n                            </button>\n                            <div id="item_pool_section" class="mazemaster-collapsible-content" style="display: none;">\n                                <div class="mazemaster-help-small"><small>Restrict which items can drop from chests and combat. STScript commands (/mazeitem) bypass this filter.</small></div>\n                                <div class="mazemaster-section">\n                                    <div class="mazemaster-row" style="margin-bottom: 8px;">\n                                        <label style="display: flex; align-items: center; gap: 8px;">\n                                            <input type="checkbox" id="mazemaster_itempool_enabled" ').concat(null!==(re=lt.itemPool)&&void 0!==re&&re.enabled?"checked":"",'>\n                                            <span>Enable Item Pool Restrictions</span>\n                                        </label>\n                                    </div>\n                                    <div id="mazemaster_itempool_items" style="display: ').concat(null!==(se=lt.itemPool)&&void 0!==se&&se.enabled?"block":"none",';">\n                                        <div style="display: flex; gap: 8px; margin-bottom: 8px;">\n                                            <button id="mazemaster_itempool_all" class="menu_button menu_button_icon" type="button" title="Select All"><i class="fa-solid fa-check-double"></i></button>\n                                            <button id="mazemaster_itempool_none" class="menu_button menu_button_icon" type="button" title="Clear All"><i class="fa-solid fa-xmark"></i></button>\n                                            <button id="mazemaster_itempool_core" class="menu_button menu_button_icon" type="button" title="Core Items Only"><i class="fa-solid fa-star"></i></button>\n                                        </div>\n                                        <label class="mazemaster-label" style="font-size: 0.8em; color: var(--SmartThemeEmColor);">Keys & Combat</label>\n                                        <div class="mazemaster-grid-4col" style="gap: 4px; margin-bottom: 8px;">\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="key" ').concat(null!==(le=lt.itemPool)&&void 0!==le&&null!==(le=le.items)&&void 0!==le&&le.includes("key")?"checked":"",'><i class="fa-solid fa-key" style="color:#f1c40f;"></i> Key</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="floorKey" ').concat(null!==(ce=lt.itemPool)&&void 0!==ce&&null!==(ce=ce.items)&&void 0!==ce&&ce.includes("floorKey")?"checked":"",'><i class="fa-solid fa-dungeon" style="color:#9b59b6;"></i> Floor Key</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="strike" ').concat(null!==(me=lt.itemPool)&&void 0!==me&&null!==(me=me.items)&&void 0!==me&&me.includes("strike")?"checked":"",'><i class="fa-solid fa-bolt" style="color:#e67e22;"></i> Strike</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="stealth" ').concat(null!==(de=lt.itemPool)&&void 0!==de&&null!==(de=de.items)&&void 0!==de&&de.includes("stealth")?"checked":"",'><i class="fa-solid fa-user-ninja" style="color:#2ecc71;"></i> Stealth</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="execute" ').concat(null!==(ue=lt.itemPool)&&void 0!==ue&&null!==(ue=ue.items)&&void 0!==ue&&ue.includes("execute")?"checked":"",'><i class="fa-solid fa-skull" style="color:#e74c3c;"></i> Execute</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="minionBane" ').concat(null!==(pe=lt.itemPool)&&void 0!==pe&&null!==(pe=pe.items)&&void 0!==pe&&pe.includes("minionBane")?"checked":"",'><i class="fa-solid fa-ghost" style="color:#8e44ad;"></i> Minion Bane</label>\n                                        </div>\n                                        <label class="mazemaster-label" style="font-size: 0.8em; color: var(--SmartThemeEmColor);">Exploration</label>\n                                        <div class="mazemaster-grid-4col" style="gap: 4px; margin-bottom: 8px;">\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="portalStone" ').concat(null!==(he=lt.itemPool)&&void 0!==he&&null!==(he=he.items)&&void 0!==he&&he.includes("portalStone")?"checked":"",'><i class="fa-solid fa-door-open" style="color:#3498db;"></i> Portal Stone</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="mapFragment" ').concat(null!==(ge=lt.itemPool)&&void 0!==ge&&null!==(ge=ge.items)&&void 0!==ge&&ge.includes("mapFragment")?"checked":"",'><i class="fa-solid fa-map" style="color:#1abc9c;"></i> Map Fragment</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="voidWalk" ').concat(null!==(fe=lt.itemPool)&&void 0!==fe&&null!==(fe=fe.items)&&void 0!==fe&&fe.includes("voidWalk")?"checked":"",'><i class="fa-solid fa-cloud" style="color:#95a5a6;"></i> Void Walk</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="timeShard" ').concat(null!==(ye=lt.itemPool)&&void 0!==ye&&null!==(ye=ye.items)&&void 0!==ye&&ye.includes("timeShard")?"checked":"",'><i class="fa-solid fa-hourglass-half" style="color:#f39c12;"></i> Time Shard</label>\n                                        </div>\n                                        <label class="mazemaster-label" style="font-size: 0.8em; color: var(--SmartThemeEmColor);">HP & Healing</label>\n                                        <div class="mazemaster-grid-4col" style="gap: 4px; margin-bottom: 8px;">\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="healingPotion" ').concat(null!==(ve=lt.itemPool)&&void 0!==ve&&null!==(ve=ve.items)&&void 0!==ve&&ve.includes("healingPotion")?"checked":"",'><i class="fa-solid fa-flask" style="color:#e74c3c;"></i> Healing</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="greaterHealing" ').concat(null!==(be=lt.itemPool)&&void 0!==be&&null!==(be=be.items)&&void 0!==be&&be.includes("greaterHealing")?"checked":"",'><i class="fa-solid fa-flask" style="color:#9b59b6;"></i> Greater</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="elixir" ').concat(null!==(ze=lt.itemPool)&&void 0!==ze&&null!==(ze=ze.items)&&void 0!==ze&&ze.includes("elixir")?"checked":"",'><i class="fa-solid fa-flask" style="color:#f1c40f;"></i> Elixir</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="revivalCharm" ').concat(null!==(_e=lt.itemPool)&&void 0!==_e&&null!==(_e=_e.items)&&void 0!==_e&&_e.includes("revivalCharm")?"checked":"",'><i class="fa-solid fa-heart-pulse" style="color:#e74c3c;"></i> Revival</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="heartCrystal" ').concat(null!==(xe=lt.itemPool)&&void 0!==xe&&null!==(xe=xe.items)&&void 0!==xe&&xe.includes("heartCrystal")?"checked":"",'><i class="fa-solid fa-heart" style="color:#e74c3c;"></i> Heart Crystal</label>\n                                        </div>\n                                        <label class="mazemaster-label" style="font-size: 0.8em; color: var(--SmartThemeEmColor);">Vision</label>\n                                        <div class="mazemaster-grid-4col" style="gap: 4px; margin-bottom: 8px;">\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="torch" ').concat(null!==(ke=lt.itemPool)&&void 0!==ke&&null!==(ke=ke.items)&&void 0!==ke&&ke.includes("torch")?"checked":"",'><i class="fa-solid fa-fire" style="color:#f39c12;"></i> Torch</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="lantern" ').concat(null!==(Ce=lt.itemPool)&&void 0!==Ce&&null!==(Ce=Ce.items)&&void 0!==Ce&&Ce.includes("lantern")?"checked":"",'><i class="fa-solid fa-lightbulb" style="color:#f1c40f;"></i> Lantern</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="revealScroll" ').concat(null!==(we=lt.itemPool)&&void 0!==we&&null!==(we=we.items)&&void 0!==we&&we.includes("revealScroll")?"checked":"",'><i class="fa-solid fa-scroll" style="color:#9b59b6;"></i> Reveal Scroll</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="sightPotion" ').concat(null!==(Ee=lt.itemPool)&&void 0!==Ee&&null!==(Ee=Ee.items)&&void 0!==Ee&&Ee.includes("sightPotion")?"checked":"",'><i class="fa-solid fa-eye" style="color:#1abc9c;"></i> Sight Potion</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="crystalBall" ').concat(null!==(Se=lt.itemPool)&&void 0!==Se&&null!==(Se=Se.items)&&void 0!==Se&&Se.includes("crystalBall")?"checked":"",'><i class="fa-solid fa-circle" style="color:#8e44ad;"></i> Crystal Ball</label>\n                                        </div>\n                                        <label class="mazemaster-label" style="font-size: 0.8em; color: var(--SmartThemeEmColor);">Weapons</label>\n                                        <div class="mazemaster-grid-4col" style="gap: 4px; margin-bottom: 8px;">\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="weapon_rusty_sword" ').concat(null!==(Te=lt.itemPool)&&void 0!==Te&&null!==(Te=Te.items)&&void 0!==Te&&Te.includes("weapon_rusty_sword")?"checked":"",'><i class="fa-solid fa-sword" style="color:#95a5a6;"></i> Rusty Sword</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="weapon_iron_sword" ').concat(null!==(Ie=lt.itemPool)&&void 0!==Ie&&null!==(Ie=Ie.items)&&void 0!==Ie&&Ie.includes("weapon_iron_sword")?"checked":"",'><i class="fa-solid fa-sword" style="color:#7f8c8d;"></i> Iron Sword</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="weapon_steel_blade" ').concat(null!==(Me=lt.itemPool)&&void 0!==Me&&null!==(Me=Me.items)&&void 0!==Me&&Me.includes("weapon_steel_blade")?"checked":"",'><i class="fa-solid fa-sword" style="color:#3498db;"></i> Steel Blade</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="weapon_enchanted_blade" ').concat(null!==(Pe=lt.itemPool)&&void 0!==Pe&&null!==(Pe=Pe.items)&&void 0!==Pe&&Pe.includes("weapon_enchanted_blade")?"checked":"",'><i class="fa-solid fa-sword" style="color:#9b59b6;"></i> Enchanted Blade</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="weapon_shadow_dagger" ').concat(null!==(De=lt.itemPool)&&void 0!==De&&null!==(De=De.items)&&void 0!==De&&De.includes("weapon_shadow_dagger")?"checked":"",'><i class="fa-solid fa-khanda" style="color:#2c3e50;"></i> Shadow Dagger</label>\n                                        </div>\n                                        <label class="mazemaster-label" style="font-size: 0.8em; color: var(--SmartThemeEmColor);">Armor</label>\n                                        <div class="mazemaster-grid-4col" style="gap: 4px; margin-bottom: 8px;">\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="armor_leather" ').concat(null!==(Ae=lt.itemPool)&&void 0!==Ae&&null!==(Ae=Ae.items)&&void 0!==Ae&&Ae.includes("armor_leather")?"checked":"",'><i class="fa-solid fa-vest" style="color:#8b4513;"></i> Leather Armor</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="armor_chainmail" ').concat(null!==(Be=lt.itemPool)&&void 0!==Be&&null!==(Be=Be.items)&&void 0!==Be&&Be.includes("armor_chainmail")?"checked":"",'><i class="fa-solid fa-shield" style="color:#7f8c8d;"></i> Chainmail</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="armor_plate" ').concat(null!==(Le=lt.itemPool)&&void 0!==Le&&null!==(Le=Le.items)&&void 0!==Le&&Le.includes("armor_plate")?"checked":"",'><i class="fa-solid fa-shield-halved" style="color:#3498db;"></i> Plate Armor</label>\n                                        </div>\n                                        <label class="mazemaster-label" style="font-size: 0.8em; color: var(--SmartThemeEmColor);">Accessories</label>\n                                        <div class="mazemaster-grid-4col" style="gap: 4px;">\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="accessory_ring_power" ').concat(null!==(qe=lt.itemPool)&&void 0!==qe&&null!==(qe=qe.items)&&void 0!==qe&&qe.includes("accessory_ring_power")?"checked":"",'><i class="fa-solid fa-ring" style="color:#e74c3c;"></i> Ring of Power</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="accessory_amulet_protection" ').concat(null!==(Re=lt.itemPool)&&void 0!==Re&&null!==(Re=Re.items)&&void 0!==Re&&Re.includes("accessory_amulet_protection")?"checked":"",'><i class="fa-solid fa-gem" style="color:#3498db;"></i> Amulet of Protection</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="accessory_lucky_charm" ').concat(null!==(Ne=lt.itemPool)&&void 0!==Ne&&null!==(Ne=Ne.items)&&void 0!==Ne&&Ne.includes("accessory_lucky_charm")?"checked":"",'><i class="fa-solid fa-clover" style="color:#27ae60;"></i> Lucky Charm</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="accessory_vampiric_pendant" ').concat(null!==(He=lt.itemPool)&&void 0!==He&&null!==(He=He.items)&&void 0!==He&&He.includes("accessory_vampiric_pendant")?"checked":"",'><i class="fa-solid fa-droplet" style="color:#8e44ad;"></i> Vampiric Pendant</label>\n                                            <label class="mazemaster-checkbox-label"><input type="checkbox" data-pool-item="ironGuard" ').concat(null!==(Oe=lt.itemPool)&&void 0!==Oe&&null!==(Oe=Oe.items)&&void 0!==Oe&&Oe.includes("ironGuard")?"checked":"",'><i class="fa-solid fa-shield-halved" style="color:#7f8c8d;"></i> Iron Guard</label>\n                                        </div>\n                                        <div id="mazemaster_itempool_custom" style="margin-top: 8px;">\n                                            \x3c!-- Custom items dynamically populated --\x3e\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- COLLAPSIBLE: HP System Settings --\x3e\n                        <div class="mazemaster-collapsible">\n                            <button class="mazemaster-collapsible-header" data-target="hp_settings_section">\n                                <i class="fa-solid fa-chevron-right mazemaster-collapse-icon"></i>\n                                <span>HP System Settings</span>\n                            </button>\n                            <div id="hp_settings_section" class="mazemaster-collapsible-content" style="display: none;">\n                                <div class="mazemaster-section">\n                                    <div class="mazemaster-row" style="margin-bottom: 8px;">\n                                        <label style="display: flex; align-items: center; gap: 8px;">\n                                            <input type="checkbox" id="mazemaster_hp_enabled" ').concat(!1!==lt.hpEnabled?"checked":"",'>\n                                            <span>Enable HP System</span>\n                                        </label>\n                                    </div>\n                                    <div class="mazemaster-grid-4col">\n                                        <div class="mazemaster-row"><label>Max HP</label><input type="number" id="mazemaster_hp_max" class="mazemaster-input-small" min="1" max="999" value="').concat(lt.maxHP||100,'"></div>\n                                        <div class="mazemaster-row"><label>Dmg Mult</label><input type="number" id="mazemaster_hp_battlebar_mult" class="mazemaster-input-small" min="0" max="10" step="0.1" value="').concat(null!==(Fe=lt.battlebarDamageMultiplier)&&void 0!==Fe?Fe:1,'" title="Multiplier for battlebar damage"></div>\n                                        <div class="mazemaster-row"><label>Diff Mult</label><input type="number" id="mazemaster_hp_battlebar_diff" class="mazemaster-input-small" min="0.1" max="3" step="0.1" value="').concat(null!==(We=lt.battlebarDifficultyMultiplier)&&void 0!==We?We:1,'" title="Multiplier for battlebar difficulty (speed/zone size)"></div>\n                                        <div class="mazemaster-row"><label>Respawn HP%</label><input type="number" id="mazemaster_hp_respawn" class="mazemaster-input-small" min="1" max="100" value="').concat(lt.respawnHPPercent||50,'"></div>\n                                    </div>\n                                    <div class="mazemaster-row" style="margin-top: 8px;">\n                                        <label>On Death</label>\n                                        <select id="mazemaster_hp_ondeath" class="mazemaster-select" style="width: auto;">\n                                            <option value="respawn" ').concat("respawn"===(lt.onDeath||"respawn")?"selected":"",'>Respawn at Start (100% HP)</option>\n                                            <option value="respawnPenalty" ').concat("respawnPenalty"===(lt.onDeath||"respawn")?"selected":"",'>Respawn at Start (Penalty HP%)</option>\n                                            <option value="gameover" ').concat("gameover"===(lt.onDeath||"respawn")?"selected":"",'>Game Over</option>\n                                        </select>\n                                    </div>\n\n                                    <label style="font-size: 0.8em; color: var(--SmartThemeEmColor); margin-top: 12px;">Safe Rooms</label>\n                                    <div class="mazemaster-grid-3col">\n                                        <div class="mazemaster-row"><label>Count/Floor</label><input type="number" id="mazemaster_saferoom_count" class="mazemaster-input-small" min="0" max="20" value="').concat(null!==(Ye=lt.safeRoomCount)&&void 0!==Ye?Ye:3,'"></div>\n                                        <div class="mazemaster-row"><label>Heal %</label><input type="number" id="mazemaster_saferoom_heal" class="mazemaster-input-small" min="1" max="100" value="').concat(null!==(Ue=lt.safeRoomHealPercent)&&void 0!==Ue?Ue:100,'"></div>\n                                        <div class="mazemaster-row">\n                                            <label style="display: flex; align-items: center; gap: 4px;">\n                                                <input type="checkbox" id="mazemaster_saferoom_llm" ').concat(lt.safeRoomUseLLM?"checked":"",'>\n                                                <span>LLM Messages</span>\n                                            </label>\n                                        </div>\n                                    </div>\n\n                                    <label style="font-size: 0.8em; color: var(--SmartThemeEmColor); margin-top: 12px;">LLM Enhancement</label>\n                                    <div class="mazemaster-row" style="margin-bottom: 4px;">\n                                        <label style="display: flex; align-items: center; gap: 8px;">\n                                            <input type="checkbox" id="mazemaster_llm_enhance_rooms" ').concat(!1!==lt.llmEnhanceRooms?"checked":"",'>\n                                            <span>Enhance Room Descriptions</span>\n                                        </label>\n                                        <small style="color: var(--SmartThemeEmColor); margin-left: 24px;">LLM generates unique descriptions on first entry</small>\n                                    </div>\n\n                                    <label style="font-size: 0.8em; color: var(--SmartThemeEmColor); margin-top: 12px;">Rest Mechanic</label>\n                                    <div class="mazemaster-row" style="margin-bottom: 4px;">\n                                        <label style="display: flex; align-items: center; gap: 8px;">\n                                            <input type="checkbox" id="mazemaster_rest_enabled" ').concat(!1!==lt.restEnabled?"checked":"",'>\n                                            <span>Enable Rest Button</span>\n                                        </label>\n                                    </div>\n                                    <div class="mazemaster-grid-3col">\n                                        <div class="mazemaster-row"><label>Heal %</label><input type="number" id="mazemaster_rest_heal" class="mazemaster-input-small" min="1" max="100" value="').concat(null!==(je=lt.restHealPercent)&&void 0!==je?je:20,'"></div>\n                                        <div class="mazemaster-row"><label>Cooldown (turns)</label><input type="number" id="mazemaster_rest_cooldown" class="mazemaster-input-small" min="0" max="99" value="').concat(null!==(Ve=lt.restCooldown)&&void 0!==Ve?Ve:3,'"></div>\n                                        <div class="mazemaster-row"><label>Interrupt %</label><input type="number" id="mazemaster_rest_interrupt" class="mazemaster-input-small" min="0" max="100" value="').concat(null!==(Je=lt.restInterruptChance)&&void 0!==Je?Je:0,'"></div>\n                                    </div>\n                                    <div class="mazemaster-row" style="margin-top: 4px;">\n                                        <label>Interrupt Script <small>(empty = random encounter)</small></label>\n                                        <input type="text" id="mazemaster_rest_interrupt_script" class="mazemaster-input" value="').concat(Or(lt.restInterruptScript||""),'" placeholder="/echo You were ambushed!">\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- COLLAPSIBLE: STScript Hooks --\x3e\n                        <div class="mazemaster-collapsible">\n                            <button class="mazemaster-collapsible-header" data-target="hooks_section">\n                                <i class="fa-solid fa-chevron-right mazemaster-collapse-icon"></i>\n                                <span>STScript Hooks</span>\n                                <span class="mazemaster-collapse-hint">(advanced)</span>\n                            </button>\n                            <div id="hooks_section" class="mazemaster-collapsible-content" style="display: none;">\n                                <div class="mazemaster-help-small"><small>Run STScript commands when events occur. Use {{variable}} placeholders for event data.</small></div>\n\n                                <div class="mazemaster-hooks-group">\n                                    <label class="mazemaster-hooks-label">Movement</label>\n                                    <div class="mazemaster-hooks-items">\n                                        <div class="hook-item">\n                                            <label>On Move</label>\n                                            <input type="text" id="mazemaster_hook_onMove" class="mazemaster-input" value="').concat(Or(lt.onMove||""),'" placeholder="{{x}}, {{y}}, {{direction}}">\n                                        </div>\n                                        <div class="hook-item">\n                                            <label>On Milestone</label>\n                                            <input type="text" id="mazemaster_hook_onMilestone" class="mazemaster-input" value="').concat(Or(lt.onMilestone||""),'" placeholder="{{percentage}}">\n                                        </div>\n                                        <div class="hook-item">\n                                            <label>On Explore Complete</label>\n                                            <input type="text" id="mazemaster_hook_onExploreComplete" class="mazemaster-input" value="').concat(Or(lt.onExploreComplete||""),'" placeholder="Fires at 100%">\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-hooks-group">\n                                    <label class="mazemaster-hooks-label">Items</label>\n                                    <div class="mazemaster-hooks-items">\n                                        <div class="hook-item">\n                                            <label>On Item Add</label>\n                                            <input type="text" id="mazemaster_hook_onItemAdd" class="mazemaster-input" value="').concat(Or(lt.onItemAdd||""),'" placeholder="{{item}}, {{count}}, {{total}}">\n                                        </div>\n                                        <div class="hook-item">\n                                            <label>On Item Remove</label>\n                                            <input type="text" id="mazemaster_hook_onItemRemove" class="mazemaster-input" value="').concat(Or(lt.onItemRemove||""),'" placeholder="{{item}}, {{count}}, {{remaining}}">\n                                        </div>\n                                        <div class="hook-item">\n                                            <label>On Chest Open</label>\n                                            <input type="text" id="mazemaster_hook_onChestOpen" class="mazemaster-input" value="').concat(Or(lt.onChestOpen||""),'" placeholder="{{type}}, {{loot}}">\n                                        </div>\n                                        <div class="hook-item">\n                                            <label>On Trade</label>\n                                            <input type="text" id="mazemaster_hook_onTrade" class="mazemaster-input" value="').concat(Or(lt.onTrade||""),'" placeholder="{{given}}, {{received}}">\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-hooks-group">\n                                    <label class="mazemaster-hooks-label">Special Tiles</label>\n                                    <div class="mazemaster-hooks-items">\n                                        <div class="hook-item">\n                                            <label>On Enemy Move</label>\n                                            <input type="text" id="mazemaster_hook_onEnemyMove" class="mazemaster-input" value="').concat(Or(lt.onEnemyMove||""),'" placeholder="{{minionId}}, {{fromX}}, {{fromY}}, {{toX}}, {{toY}}">\n                                        </div>\n                                        <div class="hook-item">\n                                            <label>On Teleport</label>\n                                            <input type="text" id="mazemaster_hook_onTeleport" class="mazemaster-input" value="').concat(Or(lt.onTeleport||""),'" placeholder="{{portalId}}, {{fromX}}, {{fromY}}, {{toX}}, {{toY}}">\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-hooks-group">\n                                    <label class="mazemaster-hooks-label">Objectives</label>\n                                    <div class="mazemaster-hooks-items">\n                                        <div class="hook-item">\n                                            <label>On Progress</label>\n                                            <input type="text" id="mazemaster_hook_onObjectiveProgress" class="mazemaster-input" value="').concat(Or(lt.onObjectiveProgress||""),'" placeholder="{{objectiveId}}, {{current}}, {{target}}">\n                                        </div>\n                                        <div class="hook-item">\n                                            <label>On Complete</label>\n                                            <input type="text" id="mazemaster_hook_onObjectiveComplete" class="mazemaster-input" value="').concat(Or(lt.onObjectiveComplete||""),'" placeholder="{{objectiveId}}">\n                                        </div>\n                                        <div class="hook-item">\n                                            <label>On All Complete</label>\n                                            <input type="text" id="mazemaster_hook_onAllObjectivesComplete" class="mazemaster-input" value="').concat(Or(lt.onAllObjectivesComplete||""),'" placeholder="All required done">\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-hooks-group">\n                                    <label class="mazemaster-hooks-label">Stats</label>\n                                    <div class="mazemaster-hooks-items">\n                                        <div class="hook-item">\n                                            <label>On Stat Update</label>\n                                            <input type="text" id="mazemaster_hook_onStatUpdate" class="mazemaster-input" value="').concat(Or(lt.onStatUpdate||""),'" placeholder="{{statName}}, {{value}}">\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- Save Button --\x3e\n                        <div class="mazemaster-section">\n                            <button id="mazemaster_maze_save_btn" class="menu_button menu_button_primary mazemaster-save-btn">\n                                <i class="fa-solid fa-save"></i> Save Profile\n                            </button>\n                        </div>\n\n                        \x3c!-- Saved Games --\x3e\n                        <div class="mazemaster-collapsible">\n                            <button class="mazemaster-collapsible-header" data-target="saved_games_section">\n                                <i class="fa-solid fa-chevron-right mazemaster-collapse-icon"></i>\n                                <span>Saved Games</span>\n                            </button>\n                            <div id="saved_games_section" class="mazemaster-collapsible-content" style="display: none;">\n                                <div id="mazemaster_saved_games_list" class="mazemaster-saved-games-list">\n                                    \x3c!-- Saved games rendered here --\x3e\n                                </div>\n                            </div>\n                        </div>\n\n                        \x3c!-- Usage Help --\x3e\n                        <div class="mazemaster-section">\n                            <div class="mazemaster-help">\n                                <div class="mazemaster-help-title">Usage:</div>\n                                <code>/maze profile="profileName"</code>\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- MINIONS CONFIG --\x3e\n                    <div id="mazemaster_minions_config" class="mazemaster-game-config" style="').concat("minions"===mt?"":"display: none;",'">\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Minion Profile</label>\n                            <div class="mazemaster-profile-row">\n                                <select id="mazemaster_minion_profile_select" class="mazemaster-select">\n                                    <option value="">-- Show All Minions --</option>\n                                    ').concat(Object.keys(qt.minionProfiles||{}).map((e=>'<option value="'.concat(Or(e),'">').concat(Or(e),"</option>"))).join(""),'\n                                </select>\n                                <button id="mazemaster_minion_profile_save_btn" class="menu_button menu_button_icon" title="Save Current as Profile">\n                                    <i class="fa-solid fa-floppy-disk"></i>\n                                </button>\n                                <button id="mazemaster_minion_profile_load_btn" class="menu_button menu_button_icon" title="Load Profile">\n                                    <i class="fa-solid fa-folder-open"></i>\n                                </button>\n                                <button id="mazemaster_minion_profile_delete_btn" class="menu_button menu_button_icon" title="Delete Profile">\n                                    <i class="fa-solid fa-trash"></i>\n                                </button>\n                            </div>\n                            <div class="mazemaster-help-small"><small>Save/load sets of minions as profiles</small></div>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Minions</label>\n                            <div id="mazemaster_minions_list" class="mazemaster-minions-list">\n                                \x3c!-- Minions rendered here --\x3e\n                            </div>\n                            <button id="mazemaster_add_minion_btn" class="menu_button mazemaster-add-btn">\n                                <i class="fa-solid fa-plus"></i> Add Minion\n                            </button>\n                            <input type="file" id="mazemaster_minion_image_file" accept="image/*" style="display: none;">\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <div class="mazemaster-help">\n                                <div class="mazemaster-help-title">Usage:</div>\n                                <code>/mazeminion name="MinionName" message="Hello!"</code>\n                                <p><small>Sets the minion display in an active maze game.</small></p>\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- TRAPS CONFIG --\x3e\n                    <div id="mazemaster_traps_config" class="mazemaster-game-config" style="').concat("traps"===mt?"":"display: none;",'">\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Trap Profile</label>\n                            <div class="mazemaster-profile-row">\n                                <select id="mazemaster_trap_profile_select" class="mazemaster-select">\n                                    <option value="">(Current Traps)</option>\n                                    ').concat(Object.keys(qt.trapProfiles||{}).map((e=>'<option value="'.concat(Or(e),'">').concat(Or(e),"</option>"))).join(""),'\n                                </select>\n                                <button id="mazemaster_trap_profile_save_btn" class="menu_button menu_button_icon" title="Save Current as Profile">\n                                    <i class="fa-solid fa-floppy-disk"></i>\n                                </button>\n                                <button id="mazemaster_trap_profile_load_btn" class="menu_button menu_button_icon" title="Load Profile">\n                                    <i class="fa-solid fa-folder-open"></i>\n                                </button>\n                                <button id="mazemaster_trap_profile_delete_btn" class="menu_button menu_button_icon" title="Delete Profile">\n                                    <i class="fa-solid fa-trash"></i>\n                                </button>\n                            </div>\n                            <div class="mazemaster-help-small"><small>Save/load sets of traps as profiles</small></div>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Traps</label>\n                            <div id="mazemaster_traps_list" class="mazemaster-traps-list">\n                                \x3c!-- Traps rendered here --\x3e\n                            </div>\n                            <button id="mazemaster_add_trap_btn" class="menu_button mazemaster-add-btn">\n                                <i class="fa-solid fa-plus"></i> Add Trap\n                            </button>\n                            <input type="file" id="mazemaster_trap_image_file" accept="image/*" style="display: none;">\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <div class="mazemaster-help">\n                                <div class="mazemaster-help-title">Traps:</div>\n                                <p><small>Traps can be placed on maze tiles. When a player steps on a trap, it shows the image/message and runs the script.</small></p>\n                                <p><small>Add traps to maze profiles in the Maze tab under "Trap Tiles".</small></p>\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- THEMES CONFIG --\x3e\n                    <div id="mazemaster_themes_config" class="mazemaster-game-config" style="').concat("themes"===mt?"":"display: none;",'">\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Custom Theme</label>\n                            <div class="mazemaster-profile-row">\n                                <select id="mazemaster_theme_profile_select" class="mazemaster-select">\n                                    <option value="">(New Theme)</option>\n                                    ').concat(Ba().map((e=>{const t=La(e),a=t&&t.displayName?t.displayName:e,n=S[e]&&!(qt.customThemes||{})[e]?"".concat(a," (Default)"):a;return'<option value="'.concat(Or(e),'">').concat(Or(n),"</option>")})).join(""),'\n                                </select>\n                                <button id="mazemaster_theme_new_btn" class="menu_button menu_button_icon" title="New Theme">\n                                    <i class="fa-solid fa-plus"></i>\n                                </button>\n                                <button id="mazemaster_theme_delete_btn" class="menu_button menu_button_icon" title="Delete Theme">\n                                    <i class="fa-solid fa-trash"></i>\n                                </button>\n                                <button id="mazemaster_theme_save_btn" class="menu_button menu_button_icon" title="Save Theme">\n                                    <i class="fa-solid fa-floppy-disk"></i>\n                                </button>\n                            </div>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Basic Info</label>\n                            <div class="mazemaster-form-group">\n                                <div class="mazemaster-row">\n                                    <label style="width: 100px;">Theme ID</label>\n                                    <input type="text" id="mazemaster_theme_name" class="mazemaster-input" placeholder="my-horror" style="flex: 1;">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 100px;">Display Name</label>\n                                    <input type="text" id="mazemaster_theme_display" class="mazemaster-input" placeholder="My Horror Theme" style="flex: 1;">\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Atmosphere (for LLM)</label>\n                            <div class="mazemaster-form-group">\n                                <div class="mazemaster-row">\n                                    <label style="width: 100px;">Tags</label>\n                                    <input type="text" id="mazemaster_theme_tags" class="mazemaster-input" placeholder="dark, gothic, supernatural, dread" style="flex: 1;">\n                                </div>\n                                <small style="color: var(--SmartThemeEmColor); margin-left: 108px;">Comma-separated mood tags passed to LLM</small>\n                                <div class="mazemaster-row" style="margin-top: 8px;">\n                                    <label style="width: 100px;">Description</label>\n                                    <textarea id="mazemaster_theme_atmosphere" class="mazemaster-textarea" rows="2" placeholder="A pervasive sense of dread hangs in the air..." style="flex: 1;"></textarea>\n                                </div>\n                                <small style="color: var(--SmartThemeEmColor); margin-left: 108px;">Atmospheric description passed to LLM for room generation</small>\n                            </div>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Room Name Adjectives</label>\n                            <div class="mazemaster-form-group">\n                                <input type="text" id="mazemaster_theme_adjectives" class="mazemaster-input" placeholder="Haunted, Cursed, Blood-Stained, Rotting, Whispering">\n                                <small style="color: var(--SmartThemeEmColor);">30% chance to appear in procedurally generated room names</small>\n                            </div>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Room Types (for BSP generation)</label>\n                            <div class="mazemaster-form-group">\n                                <div class="mazemaster-row">\n                                    <label style="width: 100px;">Small (4)</label>\n                                    <input type="text" id="mazemaster_theme_rooms_small" class="mazemaster-input" placeholder="closet, cell, alcove" style="flex: 1;">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 100px;">Medium (9)</label>\n                                    <input type="text" id="mazemaster_theme_rooms_medium" class="mazemaster-input" placeholder="morgue, ritual-room, nursery" style="flex: 1;">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 100px;">Large (>9)</label>\n                                    <input type="text" id="mazemaster_theme_rooms_large" class="mazemaster-input" placeholder="cathedral, asylum-ward, crypt" style="flex: 1;">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 100px;">Special</label>\n                                    <input type="text" id="mazemaster_theme_rooms_special" class="mazemaster-input" placeholder="elder-shrine, boss-lair" style="flex: 1;">\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Flavor Messages</label>\n                            <div class="mazemaster-form-group">\n                                <div class="mazemaster-row">\n                                    <label style="width: 100px;">Chest Find</label>\n                                    <input type="text" id="mazemaster_theme_flavor_chest" class="mazemaster-input" placeholder="You find a decrepit chest..." style="flex: 1;">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 100px;">Trap Trigger</label>\n                                    <input type="text" id="mazemaster_theme_flavor_trap" class="mazemaster-input" placeholder="A hidden danger springs forth!" style="flex: 1;">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 100px;">Victory</label>\n                                    <input type="text" id="mazemaster_theme_flavor_victory" class="mazemaster-input" placeholder="You emerge victorious!" style="flex: 1;">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 100px;">Defeat</label>\n                                    <input type="text" id="mazemaster_theme_flavor_defeat" class="mazemaster-input" placeholder="Darkness claims you..." style="flex: 1;">\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Theme Colors</label>\n                            <div class="mazemaster-form-group">\n                                <div class="mazemaster-row">\n                                    <label>Primary</label>\n                                    <input type="color" id="mazemaster_theme_color_primary" value="#8b0000">\n                                    <label style="margin-left: 16px;">Secondary</label>\n                                    <input type="color" id="mazemaster_theme_color_secondary" value="#2d1f1f">\n                                    <label style="margin-left: 16px;">Accent</label>\n                                    <input type="color" id="mazemaster_theme_color_accent" value="#ff4444">\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- STYLES CONFIG --\x3e\n                    <div id="mazemaster_styles_config" class="mazemaster-game-config" style="').concat("styles"===mt?"":"display: none;",'">\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Custom Map Style</label>\n                            <div class="mazemaster-profile-row">\n                                <select id="mazemaster_style_profile_select" class="mazemaster-select">\n                                    <option value="">(New Style)</option>\n                                    ').concat(qa().map((e=>{const t=Ra(e),a=t&&t.displayName?t.displayName:e,n=M[e]&&!(qt.customStyles||{})[e]?"".concat(a," (Default)"):a;return'<option value="'.concat(Or(e),'">').concat(Or(n),"</option>")})).join(""),'\n                                </select>\n                                <button id="mazemaster_style_new_btn" class="menu_button menu_button_icon" title="New Style">\n                                    <i class="fa-solid fa-plus"></i>\n                                </button>\n                                <button id="mazemaster_style_delete_btn" class="menu_button menu_button_icon" title="Delete Style">\n                                    <i class="fa-solid fa-trash"></i>\n                                </button>\n                                <button id="mazemaster_style_save_btn" class="menu_button menu_button_icon" title="Save Style">\n                                    <i class="fa-solid fa-floppy-disk"></i>\n                                </button>\n                            </div>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Basic Info</label>\n                            <div class="mazemaster-form-group">\n                                <div class="mazemaster-row">\n                                    <label style="width: 100px;">Style ID</label>\n                                    <input type="text" id="mazemaster_style_name" class="mazemaster-input" placeholder="haunted-house" style="flex: 1;">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 100px;">Display Name</label>\n                                    <input type="text" id="mazemaster_style_display" class="mazemaster-input" placeholder="Haunted House" style="flex: 1;">\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">BSP Generation Rules</label>\n                            <div class="mazemaster-form-group">\n                                <div class="mazemaster-row">\n                                    <label style="width: 120px;">Min Room Size</label>\n                                    <input type="number" id="mazemaster_style_bsp_minroom" class="mazemaster-input-small" min="2" max="5" value="2">\n                                    <label style="width: 120px; margin-left: 16px;">Max Room Size</label>\n                                    <input type="number" id="mazemaster_style_bsp_maxroom" class="mazemaster-input-small" min="2" max="8" value="5">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 120px;">Corridor Width</label>\n                                    <input type="number" id="mazemaster_style_bsp_corridor" class="mazemaster-input-small" min="1" max="3" value="1">\n                                    <label style="width: 120px; margin-left: 16px;">Room Padding</label>\n                                    <input type="number" id="mazemaster_style_bsp_padding" class="mazemaster-input-small" min="0" max="3" value="1">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 120px;">Min Split Size</label>\n                                    <input type="number" id="mazemaster_style_bsp_minsplit" class="mazemaster-input-small" min="3" max="8" value="4">\n                                    <label style="width: 120px; margin-left: 16px;">Split Variance</label>\n                                    <input type="number" id="mazemaster_style_bsp_variance" class="mazemaster-input-small" min="0" max="0.5" step="0.05" value="0.3">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 120px;">Extra Connections</label>\n                                    <input type="number" id="mazemaster_style_bsp_connections" class="mazemaster-input-small" min="0" max="1" step="0.1" value="0.1">\n                                    <label style="width: 120px; margin-left: 16px;">Branch Chance</label>\n                                    <input type="number" id="mazemaster_style_bsp_branch" class="mazemaster-input-small" min="0" max="1" step="0.1" value="0.3">\n                                </div>\n                                <div class="mazemaster-row" style="margin-top: 8px;">\n                                    <label class="mazemaster-checkbox-label">\n                                        <input type="checkbox" id="mazemaster_style_bsp_grid">\n                                        Grid Alignment (City-style)\n                                    </label>\n                                    <label class="mazemaster-checkbox-label" style="margin-left: 16px;">\n                                        <input type="checkbox" id="mazemaster_style_bsp_winding">\n                                        Winding Corridors (Organic)\n                                    </label>\n                                    <label class="mazemaster-checkbox-label" style="margin-left: 16px;">\n                                        <input type="checkbox" id="mazemaster_style_bsp_modular">\n                                        Modular Rooms (Spaceship)\n                                    </label>\n                                    <label class="mazemaster-checkbox-label" style="margin-left: 16px;">\n                                        <input type="checkbox" id="mazemaster_style_bsp_square">\n                                        Prefer Square Rooms\n                                    </label>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Common Room Names (2 exits)</label>\n                            <div class="mazemaster-form-group">\n                                <div class="mazemaster-row">\n                                    <label style="width: 80px;">Prefixes</label>\n                                    <input type="text" id="mazemaster_style_common_prefixes" class="mazemaster-input" placeholder="Dusty, Narrow, Dim, Long" style="flex: 1;">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 80px;">Nouns</label>\n                                    <input type="text" id="mazemaster_style_common_nouns" class="mazemaster-input" placeholder="Corridor, Passage, Hallway, Path" style="flex: 1;">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 80px;">Descriptions</label>\n                                    <textarea id="mazemaster_style_common_desc" class="mazemaster-textarea" rows="2" placeholder="One description per line..." style="flex: 1;"></textarea>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Junction Room Names (3+ exits)</label>\n                            <div class="mazemaster-form-group">\n                                <div class="mazemaster-row">\n                                    <label style="width: 80px;">Prefixes</label>\n                                    <input type="text" id="mazemaster_style_junction_prefixes" class="mazemaster-input" placeholder="Central, Open, Wide" style="flex: 1;">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 80px;">Nouns</label>\n                                    <input type="text" id="mazemaster_style_junction_nouns" class="mazemaster-input" placeholder="Hub, Crossroads, Junction" style="flex: 1;">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 80px;">Descriptions</label>\n                                    <textarea id="mazemaster_style_junction_desc" class="mazemaster-textarea" rows="2" placeholder="One description per line..." style="flex: 1;"></textarea>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Dead End Room Names (1 exit)</label>\n                            <div class="mazemaster-form-group">\n                                <div class="mazemaster-row">\n                                    <label style="width: 80px;">Prefixes</label>\n                                    <input type="text" id="mazemaster_style_deadend_prefixes" class="mazemaster-input" placeholder="Cramped, Forgotten, Hidden" style="flex: 1;">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 80px;">Nouns</label>\n                                    <input type="text" id="mazemaster_style_deadend_nouns" class="mazemaster-input" placeholder="Alcove, Nook, Corner" style="flex: 1;">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 80px;">Descriptions</label>\n                                    <textarea id="mazemaster_style_deadend_desc" class="mazemaster-textarea" rows="2" placeholder="One description per line..." style="flex: 1;"></textarea>\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Special Room Names</label>\n                            <div class="mazemaster-form-group">\n                                <div class="mazemaster-row">\n                                    <label style="width: 80px;">Start</label>\n                                    <input type="text" id="mazemaster_style_start_names" class="mazemaster-input" placeholder="Entry Point, Starting Chamber" style="flex: 1;">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 80px;">Staircase</label>\n                                    <input type="text" id="mazemaster_style_staircase_names" class="mazemaster-input" placeholder="Spiral Stairs, Stone Steps" style="flex: 1;">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 80px;">Portal</label>\n                                    <input type="text" id="mazemaster_style_portal_names" class="mazemaster-input" placeholder="Teleport Pad, Warp Gate" style="flex: 1;">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 80px;">Chest</label>\n                                    <input type="text" id="mazemaster_style_chest_names" class="mazemaster-input" placeholder="Treasury, Storage Room" style="flex: 1;">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 80px;">Minion</label>\n                                    <input type="text" id="mazemaster_style_minion_names" class="mazemaster-input" placeholder="Guard Post, Monster Den" style="flex: 1;">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 80px;">Trap</label>\n                                    <input type="text" id="mazemaster_style_trap_names" class="mazemaster-input" placeholder="Danger Zone, Trapped Area" style="flex: 1;">\n                                </div>\n                                <div class="mazemaster-row">\n                                    <label style="width: 80px;">Exit</label>\n                                    <input type="text" id="mazemaster_style_exit_names" class="mazemaster-input" placeholder="Exit Gate, Final Door" style="flex: 1;">\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- QUESTS CONFIG --\x3e\n                    <div id="mazemaster_quests_config" class="mazemaster-game-config" style="').concat("quests"===mt?"":"display: none;",'">\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Quest Profile</label>\n                            <div class="mazemaster-profile-row">\n                                <select id="mazemaster_quest_profile_select" class="mazemaster-select">\n                                    <option value="">(Default Quests)</option>\n                                    ').concat(function(){const e=Object.keys(Ke),t=Object.keys(qt.questProfiles||{});return[...new Set([...e,...t])].sort()}().map((e=>'<option value="'.concat(Or(e),'">').concat(Or(e),"</option>"))).join(""),'\n                                </select>\n                                <button id="mazemaster_quest_profile_new_btn" class="menu_button menu_button_icon" title="New Profile">\n                                    <i class="fa-solid fa-plus"></i>\n                                </button>\n                                <button id="mazemaster_quest_profile_delete_btn" class="menu_button menu_button_icon" title="Delete Profile">\n                                    <i class="fa-solid fa-trash"></i>\n                                </button>\n                                <button id="mazemaster_quest_profile_save_btn" class="menu_button menu_button_icon" title="Save Profile">\n                                    <i class="fa-solid fa-floppy-disk"></i>\n                                </button>\n                            </div>\n                        </div>\n\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Quest Templates</label>\n                            <p style="color: #888; font-size: 12px; margin: 0 0 8px 0;">Define quests that can be added to maze profiles</p>\n                            <button id="mazemaster_quest_add_btn" class="menu_button" style="margin-bottom: 12px;">\n                                <i class="fa-solid fa-plus"></i> Add Quest\n                            </button>\n                            <div id="mazemaster_quest_list" class="mazemaster-quest-template-list">\n                                \x3c!-- Quest templates populated here --\x3e\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- ITEMS CONFIG (v1.6.0) --\x3e\n                    <div id="mazemaster_items_config" class="mazemaster-game-config" style="').concat("items"===mt?"":"display: none;",'">\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label"><i class="fa-solid fa-wand-sparkles"></i> Custom Item Builder</label>\n                            <p style="color: #888; font-size: 12px; margin: 0 0 8px 0;">Create custom consumables, equipment, and quest items</p>\n                            <div class="mazemaster-profile-row" style="margin-bottom: 12px;">\n                                <button id="mazemaster_item_add_btn" class="menu_button">\n                                    <i class="fa-solid fa-plus"></i> Add Item\n                                </button>\n                                <button id="mazemaster_items_export_btn" class="menu_button menu_button_icon" title="Export Items">\n                                    <i class="fa-solid fa-download"></i>\n                                </button>\n                                <button id="mazemaster_items_import_btn" class="menu_button menu_button_icon" title="Import Items">\n                                    <i class="fa-solid fa-upload"></i>\n                                </button>\n                                <input type="file" id="mazemaster_items_import_file" accept=".json" style="display: none;">\n                            </div>\n                        </div>\n\n                        \x3c!-- Item Editor Panel (hidden by default) --\x3e\n                        <div id="mazemaster_item_editor" class="mazemaster-section mazemaster-item-editor" style="display: none;">\n                            <input type="hidden" id="mazemaster_item_edit_id" value="">\n                            <div class="mazemaster-bb-settings">\n                                <div class="mazemaster-bb-row">\n                                    <div class="mazemaster-bb-field" style="flex: 2;">\n                                        <label>Name</label>\n                                        <input type="text" id="mazemaster_item_name" class="mazemaster-input" placeholder="Fire Scroll">\n                                    </div>\n                                    <div class="mazemaster-bb-field">\n                                        <label>Type</label>\n                                        <select id="mazemaster_item_type" class="mazemaster-select">\n                                            <option value="key">Key</option>\n                                            <option value="potion">Potion</option>\n                                            <option value="equipment">Equipment (Armor)</option>\n                                            <option value="special">Special (Combat)</option>\n                                            <option value="exploration">Exploration</option>\n                                            <option value="vision">Vision</option>\n                                            <option value="boost">HP Boost</option>\n                                            <option value="consumable">Consumable</option>\n                                            <option value="quest">Quest Item</option>\n                                        </select>\n                                    </div>\n                                    <div class="mazemaster-bb-field">\n                                        <label>Rarity</label>\n                                        <select id="mazemaster_item_rarity" class="mazemaster-select">\n                                            <option value="common">Common</option>\n                                            <option value="uncommon">Uncommon</option>\n                                            <option value="rare">Rare</option>\n                                            <option value="epic">Epic</option>\n                                            <option value="legendary">Legendary</option>\n                                        </select>\n                                    </div>\n                                </div>\n                                <div class="mazemaster-bb-row">\n                                    <div class="mazemaster-bb-field">\n                                        <label>Icon (FontAwesome)</label>\n                                        <input type="text" id="mazemaster_item_icon" class="mazemaster-input" placeholder="fa-fire" value="fa-box">\n                                    </div>\n                                    <div class="mazemaster-bb-field">\n                                        <label>Subtype</label>\n                                        <select id="mazemaster_item_subtype" class="mazemaster-select">\n                                            <option value="">None</option>\n                                            <option value="weapon">Weapon</option>\n                                            <option value="armor">Armor</option>\n                                            <option value="accessory">Accessory</option>\n                                        </select>\n                                    </div>\n                                    <div class="mazemaster-bb-field">\n                                        <label>Loot Weight</label>\n                                        <input type="number" id="mazemaster_item_loot_weight" class="mazemaster-input" min="1" max="100" value="20">\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-bb-field" style="margin-top: 8px;">\n                                <label>Description</label>\n                                <textarea id="mazemaster_item_description" class="mazemaster-textarea" placeholder="Deals fire damage to an enemy"></textarea>\n                            </div>\n\n                            \x3c!-- Equipment Stats (shown only for equipment type) --\x3e\n                            <div id="mazemaster_item_equip_stats" class="mazemaster-bb-settings" style="margin-top: 8px;">\n                                <label class="mazemaster-label">Equipment Stats</label>\n                                <div class="mazemaster-bb-row">\n                                    <div class="mazemaster-bb-field">\n                                        <label>Attack</label>\n                                        <input type="number" id="mazemaster_item_attack" class="mazemaster-input" min="0" max="100" value="0">\n                                    </div>\n                                    <div class="mazemaster-bb-field">\n                                        <label>Defense</label>\n                                        <input type="number" id="mazemaster_item_defense" class="mazemaster-input" min="0" max="100" value="0">\n                                    </div>\n                                    <div class="mazemaster-bb-field">\n                                        <label>Crit Bonus %</label>\n                                        <input type="number" id="mazemaster_item_crit" class="mazemaster-input" min="0" max="50" value="0">\n                                    </div>\n                                </div>\n                            </div>\n\n                            \x3c!-- v1.7.0: Equipment Armor/Shield Settings --\x3e\n                            <div id="mazemaster_item_armor_settings" class="mazemaster-bb-settings" style="margin-top: 8px; display: none;">\n                                <label class="mazemaster-label">Armor Settings (v1.7.0)</label>\n                                <div class="mazemaster-bb-row">\n                                    <div class="mazemaster-bb-field">\n                                        <label>Charges</label>\n                                        <input type="number" id="mazemaster_item_charges" class="mazemaster-input" min="1" max="99" value="3">\n                                    </div>\n                                    <div class="mazemaster-bb-field">\n                                        <label>Absorb %</label>\n                                        <input type="number" id="mazemaster_item_absorb_percent" class="mazemaster-input" min="1" max="100" value="100">\n                                    </div>\n                                    <div class="mazemaster-bb-field">\n                                        <label style="display: flex; align-items: center; gap: 5px;">\n                                            <input type="checkbox" id="mazemaster_item_auto_use" checked> Auto-Use\n                                        </label>\n                                    </div>\n                                </div>\n                                <div class="mazemaster-bb-row">\n                                    <label class="mazemaster-label" style="margin-bottom: 4px;">Triggers:</label>\n                                    <label style="display: flex; align-items: center; gap: 5px; margin-right: 15px;">\n                                        <input type="checkbox" id="mazemaster_item_trigger_combat" checked> Combat\n                                    </label>\n                                    <label style="display: flex; align-items: center; gap: 5px;">\n                                        <input type="checkbox" id="mazemaster_item_trigger_trap" checked> Traps\n                                    </label>\n                                </div>\n                            </div>\n\n                            \x3c!-- v1.7.0: Potion Settings --\x3e\n                            <div id="mazemaster_item_potion_settings" class="mazemaster-bb-settings" style="margin-top: 8px; display: none;">\n                                <label class="mazemaster-label">Potion Settings (v1.7.0)</label>\n                                <div class="mazemaster-bb-row">\n                                    <div class="mazemaster-bb-field">\n                                        <label>Heal Amount</label>\n                                        <input type="number" id="mazemaster_item_heal_amount" class="mazemaster-input" min="1" max="100" value="25">\n                                    </div>\n                                    <div class="mazemaster-bb-field">\n                                        <label style="display: flex; align-items: center; gap: 5px;">\n                                            <input type="checkbox" id="mazemaster_item_heal_is_percent" checked> Is Percent\n                                        </label>\n                                    </div>\n                                </div>\n                            </div>\n\n                            \x3c!-- v1.7.0: Vision Settings --\x3e\n                            <div id="mazemaster_item_vision_settings" class="mazemaster-bb-settings" style="margin-top: 8px; display: none;">\n                                <label class="mazemaster-label">Vision Settings (v1.7.0)</label>\n                                <div class="mazemaster-bb-row">\n                                    <div class="mazemaster-bb-field">\n                                        <label>Visibility Bonus</label>\n                                        <input type="number" id="mazemaster_item_visibility_bonus" class="mazemaster-input" min="1" max="10" value="1">\n                                    </div>\n                                    <div class="mazemaster-bb-field">\n                                        <label>Duration (moves)</label>\n                                        <input type="number" id="mazemaster_item_duration" class="mazemaster-input" min="0" max="99" value="0" placeholder="0 = permanent">\n                                    </div>\n                                    <div class="mazemaster-bb-field">\n                                        <label style="display: flex; align-items: center; gap: 5px;">\n                                            <input type="checkbox" id="mazemaster_item_is_passive"> Passive\n                                        </label>\n                                    </div>\n                                </div>\n                            </div>\n\n                            \x3c!-- v1.7.0: Theme Aliases --\x3e\n                            <div id="mazemaster_item_aliases_section" class="mazemaster-bb-settings" style="margin-top: 8px;">\n                                <label class="mazemaster-label">Theme Aliases (v1.7.0)</label>\n                                <p style="font-size: 11px; color: #888; margin: 4px 0 8px;">Display different item names based on maze theme</p>\n                                <div class="mazemaster-aliases-grid" style="display: grid; grid-template-columns: 100px 1fr; gap: 4px 8px;">\n                                    <label>Fantasy:</label>\n                                    <input type="text" id="mazemaster_item_alias_fantasy" class="mazemaster-input" placeholder="Iron Key">\n                                    <label>Horror:</label>\n                                    <input type="text" id="mazemaster_item_alias_horror" class="mazemaster-input" placeholder="Cursed Key">\n                                    <label>Sci-Fi:</label>\n                                    <input type="text" id="mazemaster_item_alias_scifi" class="mazemaster-input" placeholder="Access Card">\n                                    <label>Action:</label>\n                                    <input type="text" id="mazemaster_item_alias_action" class="mazemaster-input" placeholder="Master Key">\n                                    <label>Cyberpunk:</label>\n                                    <input type="text" id="mazemaster_item_alias_cyberpunk" class="mazemaster-input" placeholder="Access Chip">\n                                    <label>Western:</label>\n                                    <input type="text" id="mazemaster_item_alias_western" class="mazemaster-input" placeholder="Skeleton Key">\n                                    <label>Noir:</label>\n                                    <input type="text" id="mazemaster_item_alias_noir" class="mazemaster-input" placeholder="Lockpick">\n                                    <label>Post-Apoc:</label>\n                                    <input type="text" id="mazemaster_item_alias_postapoc" class="mazemaster-input" placeholder="Vault Key">\n                                    <label>Comedy:</label>\n                                    <input type="text" id="mazemaster_item_alias_comedy" class="mazemaster-input" placeholder="Big Key">\n                                </div>\n                            </div>\n\n                            \x3c!-- Effects Section --\x3e\n                            <div class="mazemaster-section" style="margin-top: 12px;">\n                                <label class="mazemaster-label">Effects</label>\n                                <div id="mazemaster_item_effects_list" class="mazemaster-effects-list">\n                                    \x3c!-- Effects added dynamically --\x3e\n                                </div>\n                                <button id="mazemaster_item_add_effect_btn" class="menu_button menu_button_icon" style="margin-top: 8px;">\n                                    <i class="fa-solid fa-plus"></i> Add Effect\n                                </button>\n                            </div>\n\n                            \x3c!-- Loot Sources --\x3e\n                            <div class="mazemaster-bb-settings" style="margin-top: 8px;">\n                                <label class="mazemaster-label">Loot Sources</label>\n                                <div class="mazemaster-bb-row" style="gap: 15px;">\n                                    <label style="display: flex; align-items: center; gap: 5px;">\n                                        <input type="checkbox" id="mazemaster_item_source_chest" checked> Chests\n                                    </label>\n                                    <label style="display: flex; align-items: center; gap: 5px;">\n                                        <input type="checkbox" id="mazemaster_item_source_combat"> Combat\n                                    </label>\n                                    <label style="display: flex; align-items: center; gap: 5px;">\n                                        <input type="checkbox" id="mazemaster_item_source_shop"> Shop\n                                    </label>\n                                    <label style="display: flex; align-items: center; gap: 5px;">\n                                        <input type="checkbox" id="mazemaster_item_source_quest"> Quest\n                                    </label>\n                                </div>\n                            </div>\n\n                            \x3c!-- STScript Hooks --\x3e\n                            <div class="mazemaster-section" style="margin-top: 12px;">\n                                <label class="mazemaster-label">STScript Hooks</label>\n                                <div class="mazemaster-bb-commands">\n                                    <div class="mazemaster-bb-command">\n                                        <label>On Use:</label>\n                                        <textarea id="mazemaster_item_on_use" placeholder="/echo Used {{itemName}}!"></textarea>\n                                    </div>\n                                    <div class="mazemaster-bb-command">\n                                        <label>On Equip:</label>\n                                        <textarea id="mazemaster_item_on_equip" placeholder="/echo Equipped {{itemName}}"></textarea>\n                                    </div>\n                                </div>\n                            </div>\n\n                            \x3c!-- Save/Cancel Buttons --\x3e\n                            <div class="mazemaster-profile-row" style="margin-top: 12px;">\n                                <button id="mazemaster_item_save_btn" class="menu_button menu_button_primary">\n                                    <i class="fa-solid fa-save"></i> Save Item\n                                </button>\n                                <button id="mazemaster_item_cancel_btn" class="menu_button">\n                                    <i class="fa-solid fa-times"></i> Cancel\n                                </button>\n                            </div>\n                        </div>\n\n                        \x3c!-- v1.7.0: Default Items Browser --\x3e\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label"><i class="fa-solid fa-box-open"></i> Built-in Items (22)</label>\n                            <p style="font-size: 11px; color: #888; margin: 4px 0 8px;">Click to view/customize. Customizations are saved as overrides.</p>\n                            <div id="mazemaster_default_items_list" class="mazemaster-items-list" style="max-height: 200px; overflow-y: auto;">\n                                \x3c!-- Default items populated by renderDefaultItemsList() --\x3e\n                            </div>\n                        </div>\n\n                        \x3c!-- Items List --\x3e\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Custom Items (').concat(Object.keys(qt.customItems||{}).length,')</label>\n                            <div id="mazemaster_items_list" class="mazemaster-items-list">\n                                \x3c!-- Custom items populated by renderCustomItemsList() --\x3e\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- FACTIONS CONFIG (v1.6.0) --\x3e\n                    <div id="mazemaster_factions_config" class="mazemaster-game-config" style="').concat("factions"===mt?"":"display: none;",'">\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label"><i class="fa-solid fa-users"></i> Faction Profiles</label>\n                            <div class="mazemaster-profile-row">\n                                <select id="mazemaster_faction_profile_select" class="mazemaster-select">\n                                    <option value="">(Default Factions)</option>\n                                </select>\n                                <button id="mazemaster_faction_profile_new_btn" class="menu_button menu_button_icon" title="New Profile">\n                                    <i class="fa-solid fa-plus"></i>\n                                </button>\n                                <button id="mazemaster_faction_profile_delete_btn" class="menu_button menu_button_icon" title="Delete Profile">\n                                    <i class="fa-solid fa-trash"></i>\n                                </button>\n                                <button id="mazemaster_faction_profile_save_btn" class="menu_button menu_button_icon" title="Save Profile">\n                                    <i class="fa-solid fa-floppy-disk"></i>\n                                </button>\n                            </div>\n                        </div>\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Factions</label>\n                            <p style="color: #888; font-size: 12px; margin: 0 0 8px 0;">Define factions and reputation tiers</p>\n                            <button id="mazemaster_faction_add_btn" class="menu_button" style="margin-bottom: 12px;">\n                                <i class="fa-solid fa-plus"></i> Add Faction\n                            </button>\n                            <div id="mazemaster_factions_list" class="mazemaster-factions-list">\n                                \x3c!-- Factions populated here --\x3e\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- VISION CONFIG (v1.6.0) --\x3e\n                    <div id="mazemaster_vision_config" class="mazemaster-game-config" style="').concat("vision"===mt?"":"display: none;",'">\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label"><i class="fa-solid fa-eye"></i> Vision Profiles</label>\n                            <div class="mazemaster-profile-row">\n                                <select id="mazemaster_vision_profile_select" class="mazemaster-select">\n                                    <option value="">(Default Vision)</option>\n                                </select>\n                                <button id="mazemaster_vision_profile_new_btn" class="menu_button menu_button_icon" title="New Profile">\n                                    <i class="fa-solid fa-plus"></i>\n                                </button>\n                                <button id="mazemaster_vision_profile_delete_btn" class="menu_button menu_button_icon" title="Delete Profile">\n                                    <i class="fa-solid fa-trash"></i>\n                                </button>\n                                <button id="mazemaster_vision_profile_save_btn" class="menu_button menu_button_icon" title="Save Profile">\n                                    <i class="fa-solid fa-floppy-disk"></i>\n                                </button>\n                            </div>\n                        </div>\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Visibility Settings</label>\n                            <div class="mazemaster-row">\n                                <label>Base Visibility</label>\n                                <input type="number" id="mazemaster_vision_base" class="mazemaster-input" min="1" max="10" value="1">\n                            </div>\n                            <div class="mazemaster-row">\n                                <label>Torch Bonus</label>\n                                <input type="number" id="mazemaster_vision_torch" class="mazemaster-input" min="0" max="10" value="2">\n                            </div>\n                            <div class="mazemaster-row">\n                                <label>Torch Duration (moves)</label>\n                                <input type="number" id="mazemaster_vision_torch_duration" class="mazemaster-input" min="1" max="20" value="3">\n                            </div>\n                            <div class="mazemaster-row">\n                                <label>Lantern Bonus</label>\n                                <input type="number" id="mazemaster_vision_lantern" class="mazemaster-input" min="0" max="10" value="1">\n                            </div>\n                        </div>\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Ambient Light Modifiers</label>\n                            <div class="mazemaster-row">\n                                <label>Dark</label>\n                                <input type="number" id="mazemaster_vision_dark" class="mazemaster-input" min="-5" max="0" value="-1">\n                            </div>\n                            <div class="mazemaster-row">\n                                <label>Dim</label>\n                                <input type="number" id="mazemaster_vision_dim" class="mazemaster-input" min="-5" max="5" value="0">\n                            </div>\n                            <div class="mazemaster-row">\n                                <label>Bright</label>\n                                <input type="number" id="mazemaster_vision_bright" class="mazemaster-input" min="0" max="5" value="1">\n                            </div>\n                        </div>\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">STScript Hooks</label>\n                            <div class="mazemaster-row">\n                                <label>On Vision Change</label>\n                                <input type="text" id="mazemaster_vision_hook_change" class="mazemaster-input" placeholder="/echo Vision changed">\n                            </div>\n                            <div class="mazemaster-row">\n                                <label>On Light Change</label>\n                                <input type="text" id="mazemaster_vision_hook_light" class="mazemaster-input" placeholder="/echo Light changed">\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- SOUND CONFIG (v1.6.0) --\x3e\n                    <div id="mazemaster_sound_config" class="mazemaster-game-config" style="').concat("sound"===mt?"":"display: none;",'">\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label"><i class="fa-solid fa-volume-high"></i> Sound Settings</label>\n                            <label class="mazemaster-checkbox-label">\n                                <input type="checkbox" id="mazemaster_sound_enabled" checked> Enable Sound Effects\n                            </label>\n                            <div class="mazemaster-row">\n                                <label>Master Volume</label>\n                                <input type="range" id="mazemaster_sound_master" class="mazemaster-range" min="0" max="100" value="80">\n                                <span id="mazemaster_sound_master_value">80%</span>\n                            </div>\n                        </div>\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Category Volumes</label>\n                            <div class="mazemaster-row">\n                                <label>Combat</label>\n                                <input type="range" id="mazemaster_sound_combat" class="mazemaster-range" min="0" max="100" value="80">\n                                <span id="mazemaster_sound_combat_value">80%</span>\n                            </div>\n                            <div class="mazemaster-row">\n                                <label>UI</label>\n                                <input type="range" id="mazemaster_sound_ui" class="mazemaster-range" min="0" max="100" value="60">\n                                <span id="mazemaster_sound_ui_value">60%</span>\n                            </div>\n                            <div class="mazemaster-row">\n                                <label>Ambient</label>\n                                <input type="range" id="mazemaster_sound_ambient" class="mazemaster-range" min="0" max="100" value="40">\n                                <span id="mazemaster_sound_ambient_value">40%</span>\n                            </div>\n                        </div>\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Sound Profile</label>\n                            <div class="mazemaster-profile-row">\n                                <select id="mazemaster_sound_profile_select" class="mazemaster-select">\n                                    <option value="">(Default Sounds)</option>\n                                </select>\n                                <button id="mazemaster_sound_profile_new_btn" class="menu_button menu_button_icon" title="New Profile">\n                                    <i class="fa-solid fa-plus"></i>\n                                </button>\n                                <button id="mazemaster_sound_profile_delete_btn" class="menu_button menu_button_icon" title="Delete Profile">\n                                    <i class="fa-solid fa-trash"></i>\n                                </button>\n                            </div>\n                        </div>\n                        <div class="mazemaster-section">\n                            <label class="mazemaster-label">Custom Sounds</label>\n                            <p style="color: #888; font-size: 12px; margin: 0 0 8px 0;">Define custom sound effects for events</p>\n                            <button id="mazemaster_sound_add_btn" class="menu_button" style="margin-bottom: 12px;">\n                                <i class="fa-solid fa-plus"></i> Add Sound\n                            </button>\n                            <div id="mazemaster_sounds_list" class="mazemaster-sounds-list">\n                                \x3c!-- Custom sounds populated here --\x3e\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- HELP TAB --\x3e\n                <div class="mazemaster-tab-content" id="mazemaster-tab-help">\n                    \x3c!-- Help Sub-tabs --\x3e\n                    <div class="mazemaster-help-subtabs">\n                        <button class="help-subtab active" data-help="commands">\n                            <i class="fa-solid fa-terminal"></i> Commands\n                        </button>\n                        <button class="help-subtab" data-help="macros">\n                            <i class="fa-solid fa-dice"></i> Macros\n                        </button>\n                        <button class="help-subtab" data-help="hooks">\n                            <i class="fa-solid fa-bolt"></i> STScript Hooks\n                        </button>\n                    </div>\n\n                    \x3c!-- COMMANDS SUB-TAB --\x3e\n                    <div id="help_commands_content" class="help-content active">\n                        <div class="mazemaster-help-reference">\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label"><i class="fa-solid fa-gamepad"></i> Game Commands</label>\n                                <div class="mazemaster-help-category">\n                                    <div class="mazemaster-help-title">Wheel &amp; Battlebar</div>\n                                    <div class="mazemaster-command-list">\n                                        <div class="mazemaster-command">\n                                            <code>/wheel [profile="name"]</code>\n                                            <span>Open the wheel using specified or current profile</span>\n                                        </div>\n                                        <div class="mazemaster-command">\n                                            <code>/battlebar [profile="name"]</code>\n                                            <span>Start a battlebar challenge (difficulty 1-10)</span>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-help-category">\n                                    <div class="mazemaster-help-title">Maze Controls</div>\n                                    <div class="mazemaster-command-list">\n                                        <div class="mazemaster-command">\n                                            <code>/maze [profile="name"]</code>\n                                            <span>Start a maze using the specified or current profile</span>\n                                        </div>\n                                        <div class="mazemaster-command">\n                                            <code>/mazeminion [name="x"] [message="x"]</code>\n                                            <span>Set minion display in active maze</span>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-help-category">\n                                    <div class="mazemaster-help-title">Maze Info</div>\n                                    <div class="mazemaster-command-list">\n                                        <div class="mazemaster-command">\n                                            <code>/mazestats</code>\n                                            <span>Returns maze statistics as JSON (moves, encounters, chests, etc.)</span>\n                                        </div>\n                                        <div class="mazemaster-command">\n                                            <code>/mazeexplore</code>\n                                            <span>Returns exploration percentage (0-100)</span>\n                                        </div>\n                                        <div class="mazemaster-command">\n                                            <code>/mazeobjective [id="name"]</code>\n                                            <span>Get objective progress (all or specific by ID)</span>\n                                        </div>\n                                        <div class="mazemaster-command">\n                                            <code>/mazefloor</code>\n                                            <span>Returns current/total floor info as JSON</span>\n                                        </div>\n                                        <div class="mazemaster-command">\n                                            <code>/mazepersonastats [persona="x"]</code>\n                                            <span>Get maze stats for a persona (current if omitted)</span>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-help-category">\n                                    <div class="mazemaster-help-title">Maze Settings</div>\n                                    <div class="mazemaster-command-list">\n                                        <div class="mazemaster-command">\n                                            <code>/mazedifficulty [tier="x"]</code>\n                                            <span>Get/set difficulty (easy/normal/hard/nightmare)</span>\n                                        </div>\n                                        <div class="mazemaster-command">\n                                            <code>/mazetheme [theme="x"]</code>\n                                            <span>Get/set theme (fantasy/horror/scifi/action)</span>\n                                        </div>\n                                        <div class="mazemaster-command">\n                                            <code>/mazemapstyle [style="x"]</code>\n                                            <span>Get/set map style (maze/dungeon/city/forest/spaceship)</span>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label"><i class="fa-solid fa-heart"></i> HP System</label>\n                                <div class="mazemaster-command-list">\n                                    <div class="mazemaster-command">\n                                        <code>/mazehp [set=N]</code>\n                                        <span>Get HP status as JSON, or set HP to value</span>\n                                    </div>\n                                    <div class="mazemaster-command">\n                                        <code>/mazeheal [amount=N] [percent=true]</code>\n                                        <span>Heal player (absolute or % of max)</span>\n                                    </div>\n                                    <div class="mazemaster-command">\n                                        <code>/mazedamage [amount=N] [source="x"]</code>\n                                        <span>Deal damage with optional source for hooks</span>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label"><i class="fa-solid fa-box-open"></i> Inventory</label>\n                                <div class="mazemaster-command-list">\n                                    <div class="mazemaster-command">\n                                        <code>/mazeitem action="add" item="x" [amount=N]</code>\n                                        <span>Add item(s) to inventory by name or number</span>\n                                    </div>\n                                    <div class="mazemaster-command">\n                                        <code>/mazeitem action="remove" item="x" [amount=N]</code>\n                                        <span>Remove item(s) from inventory</span>\n                                    </div>\n                                    <div class="mazemaster-command">\n                                        <code>/mazeitem action="list"</code>\n                                        <span>List all available items with IDs</span>\n                                    </div>\n                                </div>\n                                <div class="mazemaster-help-category">\n                                    <div class="mazemaster-help-title">Item Reference</div>\n                                    <div class="mazemaster-command-list">\n                                        <div class="mazemaster-item-ref"><span class="item-num">1-4</span> <strong>Core:</strong> key, stealth, strike, execute</div>\n                                        <div class="mazemaster-item-ref"><span class="item-num">5-10</span> <strong>Special:</strong> floorKey, portalStone, minionBane, mapFragment, timeShard, voidWalk</div>\n                                        <div class="mazemaster-item-ref"><span class="item-num">11-15</span> <strong>HP:</strong> healingPotion (25%), greaterHealing (50%), elixir (100%), revivalCharm, heartCrystal (+10 max)</div>\n                                        <div class="mazemaster-item-ref"><span class="item-num">16-20</span> <strong>Vision:</strong> torch (+2 for 3 moves), lantern (+1 passive), revealScroll (full floor), sightPotion (+1 perm), crystalBall (show minions)</div>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label"><i class="fa-solid fa-swords"></i> Combat Modes</label>\n                                <div class="mazemaster-command-list">\n                                    <div class="mazemaster-command">\n                                        <code>/turnbased [profile="name"]</code>\n                                        <span>Start turn-based combat encounter</span>\n                                    </div>\n                                    <div class="mazemaster-command">\n                                        <code>/qte [profile="name"]</code>\n                                        <span>Start Quick-Time Event challenge</span>\n                                    </div>\n                                    <div class="mazemaster-command">\n                                        <code>/dice [profile="name"]</code>\n                                        <span>Start dice roll challenge</span>\n                                    </div>\n                                    <div class="mazemaster-command">\n                                        <code>/stealth [profile="name"]</code>\n                                        <span>Start stealth encounter</span>\n                                    </div>\n                                    <div class="mazemaster-command">\n                                        <code>/puzzle [profile="name"]</code>\n                                        <span>Start puzzle/sequence challenge</span>\n                                    </div>\n                                    <div class="mazemaster-command">\n                                        <code>/negotiate [profile="name"]</code>\n                                        <span>Start negotiation encounter</span>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- MACROS SUB-TAB --\x3e\n                    <div id="help_macros_content" class="help-content">\n                        <div class="mazemaster-help-reference">\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label"><i class="fa-solid fa-dice"></i> MazeMaster Macros</label>\n                                <p class="mazemaster-help-intro">Macros are processed in STScript hooks before execution. Use them to add randomness to your hooks.</p>\n\n                                <div class="mazemaster-help-category">\n                                    <div class="mazemaster-help-title">Dice Roll Macro</div>\n                                    <div class="mazemaster-macro-doc">\n                                        <code class="macro-syntax">{{roll:XdY+Z}}</code>\n                                        <p>Rolls X dice with Y sides and adds Z modifier. Standard dice notation.</p>\n                                        <div class="mazemaster-examples">\n                                            <div class="example-title">Examples:</div>\n                                            <div class="example"><code>{{roll:1d6}}</code> - Roll one 6-sided die (1-6)</div>\n                                            <div class="example"><code>{{roll:2d6}}</code> - Roll two 6-sided dice (2-12)</div>\n                                            <div class="example"><code>{{roll:1d20}}</code> - Roll one 20-sided die (1-20)</div>\n                                            <div class="example"><code>{{roll:2d6+3}}</code> - Roll 2d6 and add 3 (5-15)</div>\n                                            <div class="example"><code>{{roll:1d8-2}}</code> - Roll 1d8 and subtract 2 (-1 to 6)</div>\n                                            <div class="example"><code>{{roll:3d10+5}}</code> - Roll 3d10 and add 5 (8-35)</div>\n                                        </div>\n                                        <div class="example-usage">\n                                            <div class="example-title">In Hook:</div>\n                                            <code>/echo Dealt {{roll:2d6+3}} damage!</code>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-help-category">\n                                    <div class="mazemaster-help-title">Random Number Macro</div>\n                                    <div class="mazemaster-macro-doc">\n                                        <code class="macro-syntax">{{random:MIN:MAX}}</code>\n                                        <p>Generates a random integer between MIN and MAX (inclusive).</p>\n                                        <div class="mazemaster-examples">\n                                            <div class="example-title">Examples:</div>\n                                            <div class="example"><code>{{random:1:10}}</code> - Random 1-10</div>\n                                            <div class="example"><code>{{random:50:100}}</code> - Random 50-100</div>\n                                            <div class="example"><code>{{random:1:100}}</code> - Random 1-100</div>\n                                            <div class="example"><code>{{random:0:1}}</code> - Coin flip (0 or 1)</div>\n                                        </div>\n                                        <div class="example-usage">\n                                            <div class="example-title">In Hook:</div>\n                                            <code>/echo Found {{random:10:50}} gold coins!</code>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-help-category">\n                                    <div class="mazemaster-help-title">Template Variables</div>\n                                    <div class="mazemaster-macro-doc">\n                                        <code class="macro-syntax">{{variableName}}</code>\n                                        <p>Hooks receive context-specific variables that are substituted before execution.</p>\n                                        <div class="mazemaster-examples">\n                                            <div class="example-title">Common Variables:</div>\n                                            <div class="example"><code>{{x}}</code>, <code>{{y}}</code> - Player coordinates</div>\n                                            <div class="example"><code>{{direction}}</code> - Movement direction</div>\n                                            <div class="example"><code>{{amount}}</code> - Damage/heal amount</div>\n                                            <div class="example"><code>{{source}}</code> - What caused the event</div>\n                                            <div class="example"><code>{{hp}}</code>, <code>{{maxHp}}</code> - Current/max HP</div>\n                                            <div class="example"><code>{{item}}</code> - Item name</div>\n                                            <div class="example"><code>{{floor}}</code> - Current floor number</div>\n                                        </div>\n                                        <p class="note">See the Hooks tab for complete variable lists per hook.</p>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-help-category">\n                                    <div class="mazemaster-help-title">Combining Macros</div>\n                                    <div class="mazemaster-macro-doc">\n                                        <p>You can combine macros with variables and use multiple macros in one hook:</p>\n                                        <div class="mazemaster-examples">\n                                            <div class="example-title">Advanced Examples:</div>\n                                            <div class="example"><code>/echo {{source}} deals {{roll:2d6}} damage!</code></div>\n                                            <div class="example"><code>/setvar key=loot value={{random:1:100}}</code></div>\n                                            <div class="example"><code>/echo Roll: {{roll:1d20}} | Gold: {{random:10:50}}</code></div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- STSCRIPT HOOKS SUB-TAB --\x3e\n                    <div id="help_hooks_content" class="help-content">\n                        <div class="mazemaster-help-reference">\n                            <div class="mazemaster-section">\n                                <label class="mazemaster-label"><i class="fa-solid fa-bolt"></i> STScript Hooks</label>\n                                <p class="mazemaster-help-intro">Hooks are STScript commands that fire on game events. Configure them in maze profile settings. Variables in <code>{{braces}}</code> are automatically substituted.</p>\n\n                                <div class="mazemaster-help-category">\n                                    <div class="mazemaster-help-title"><i class="fa-solid fa-shoe-prints"></i> Movement Hooks</div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onMove</code></div>\n                                        <div class="hook-desc">Fires each time the player moves to a new cell.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{x}}</code> - New X coordinate,\n                                            <code>{{y}}</code> - New Y coordinate,\n                                            <code>{{direction}}</code> - Direction moved (up/down/left/right)\n                                        </div>\n                                        <div class="hook-example"><code>/echo Moved {{direction}} to ({{x}}, {{y}})</code></div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onTeleport</code></div>\n                                        <div class="hook-desc">Fires when player teleports via portal or item.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{x}}</code> - Destination X,\n                                            <code>{{y}}</code> - Destination Y,\n                                            <code>{{source}}</code> - Teleport source (portal/portalStone)\n                                        </div>\n                                        <div class="hook-example"><code>/echo Warped to ({{x}}, {{y}}) via {{source}}!</code></div>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-help-category">\n                                    <div class="mazemaster-help-title"><i class="fa-solid fa-heart"></i> HP System Hooks</div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onDamage</code></div>\n                                        <div class="hook-desc">Fires when player takes damage.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{amount}}</code> - Damage taken,\n                                            <code>{{source}}</code> - Damage source,\n                                            <code>{{hp}}</code> - HP after damage,\n                                            <code>{{maxHp}}</code> - Maximum HP\n                                        </div>\n                                        <div class="hook-example"><code>/echo Took {{amount}} damage from {{source}}! HP: {{hp}}/{{maxHp}}</code></div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onHeal</code></div>\n                                        <div class="hook-desc">Fires when player is healed.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{amount}}</code> - HP restored,\n                                            <code>{{source}}</code> - Heal source,\n                                            <code>{{hp}}</code> - HP after heal,\n                                            <code>{{maxHp}}</code> - Maximum HP\n                                        </div>\n                                        <div class="hook-example"><code>/echo Healed {{amount}} HP! Now at {{hp}}/{{maxHp}}</code></div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onPlayerDeath</code></div>\n                                        <div class="hook-desc">Fires when HP reaches 0.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{source}}</code> - What killed the player\n                                        </div>\n                                        <div class="hook-example"><code>/echo Defeated by {{source}}...</code></div>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-help-category">\n                                    <div class="mazemaster-help-title"><i class="fa-solid fa-box-open"></i> Item Hooks</div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onItemAdd</code></div>\n                                        <div class="hook-desc">Fires when item is added to inventory.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{item}}</code> - Item ID,\n                                            <code>{{count}}</code> - Amount added,\n                                            <code>{{total}}</code> - New total\n                                        </div>\n                                        <div class="hook-example"><code>/echo Found {{count}}x {{item}}! (Total: {{total}})</code></div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onItemRemove</code></div>\n                                        <div class="hook-desc">Fires when item is removed or used.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{item}}</code> - Item ID,\n                                            <code>{{count}}</code> - Amount removed,\n                                            <code>{{total}}</code> - Remaining total\n                                        </div>\n                                        <div class="hook-example"><code>/echo Used {{item}}! ({{total}} left)</code></div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onChestOpen</code></div>\n                                        <div class="hook-desc">Fires when opening a chest.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{x}}</code> - Chest X,\n                                            <code>{{y}}</code> - Chest Y,\n                                            <code>{{loot}}</code> - What was found\n                                        </div>\n                                        <div class="hook-example"><code>/echo Opened chest at ({{x}},{{y}}) - Found {{loot}}!</code></div>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-help-category">\n                                    <div class="mazemaster-help-title"><i class="fa-solid fa-shield"></i> Equipment Hooks</div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onEquip</code></div>\n                                        <div class="hook-desc">Fires when equipping an item.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{itemId}}</code> - Equipment ID,\n                                            <code>{{name}}</code> - Item name,\n                                            <code>{{slot}}</code> - Slot (weapon/armor/accessory),\n                                            <code>{{attack}}</code> - Attack bonus,\n                                            <code>{{defense}}</code> - Defense bonus\n                                        </div>\n                                        <div class="hook-example"><code>/echo Equipped {{name}} (+{{attack}} ATK)</code></div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onUnequip</code></div>\n                                        <div class="hook-desc">Fires when unequipping an item.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{itemId}}</code>, <code>{{name}}</code>, <code>{{slot}}</code>\n                                        </div>\n                                        <div class="hook-example"><code>/echo Removed {{name}} from {{slot}}</code></div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onEquipmentFound</code></div>\n                                        <div class="hook-desc">Fires when equipment drops from combat.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{itemId}}</code>, <code>{{name}}</code>, <code>{{slot}}</code>,\n                                            <code>{{rarity}}</code> - common/uncommon/rare/epic/legendary\n                                        </div>\n                                        <div class="hook-example"><code>/echo Found {{rarity}} {{name}}!</code></div>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-help-category">\n                                    <div class="mazemaster-help-title"><i class="fa-solid fa-star"></i> Progression Hooks</div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onXpGain</code></div>\n                                        <div class="hook-desc">Fires when XP is gained.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{amount}}</code> - XP gained,\n                                            <code>{{source}}</code> - Source (combat/quest/etc),\n                                            <code>{{totalXp}}</code> - Total XP,\n                                            <code>{{level}}</code> - Current level\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onLevelUp</code></div>\n                                        <div class="hook-desc">Fires when player levels up.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{newLevel}}</code> - New level,\n                                            <code>{{skillPointsAvailable}}</code> - Available skill points,\n                                            <code>{{stats}}</code> - Player stats\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onSkillLearn</code></div>\n                                        <div class="hook-desc">Fires when learning a skill.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{skillId}}</code>, <code>{{skillName}}</code>, <code>{{rank}}</code>, <code>{{tree}}</code>\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onSkillUse</code></div>\n                                        <div class="hook-desc">Fires when using a skill.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{skillId}}</code>, <code>{{skillName}}</code>, <code>{{rank}}</code>, <code>{{effect}}</code>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-help-category">\n                                    <div class="mazemaster-help-title"><i class="fa-solid fa-bullseye"></i> Objective Hooks</div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onObjectiveProgress</code></div>\n                                        <div class="hook-desc">Fires when progress is made on an objective.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{objectiveId}}</code> - Objective ID,\n                                            <code>{{current}}</code> - Current progress,\n                                            <code>{{target}}</code> - Target value\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onObjectiveComplete</code></div>\n                                        <div class="hook-desc">Fires when an objective is completed.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{objectiveId}}</code> - Completed objective ID\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onAllObjectivesComplete</code></div>\n                                        <div class="hook-desc">Fires when all objectives are completed.</div>\n                                        <div class="hook-vars"><strong>Variables:</strong> None</div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onExploreComplete</code></div>\n                                        <div class="hook-desc">Fires when 100% exploration is reached.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{percentage}}</code> - Always 100\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-help-category">\n                                    <div class="mazemaster-help-title"><i class="fa-solid fa-skull"></i> Enemy Hooks</div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onEnemyMove</code></div>\n                                        <div class="hook-desc">Fires when a minion moves.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{minionId}}</code> - Minion identifier,\n                                            <code>{{x}}</code> - New X,\n                                            <code>{{y}}</code> - New Y,\n                                            <code>{{state}}</code> - AI state (patrol/suspicious/alerted/chasing)\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onMinionAlert</code></div>\n                                        <div class="hook-desc">Fires when a minion becomes alerted.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{minionId}}</code>, <code>{{x}}</code>, <code>{{y}}</code>,\n                                            <code>{{alertLevel}}</code> - New alert level\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onRoomClear</code></div>\n                                        <div class="hook-desc">Fires when a room is cleared of enemies.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{roomId}}</code>, <code>{{roomType}}</code>, <code>{{x}}</code>, <code>{{y}}</code>\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-help-category">\n                                    <div class="mazemaster-help-title"><i class="fa-solid fa-map"></i> Zone &amp; Quest Hooks</div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onZoneUnlock</code></div>\n                                        <div class="hook-desc">Fires when a zone is unlocked.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{zoneId}}</code>, <code>{{zoneName}}</code>\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onSecretFound</code></div>\n                                        <div class="hook-desc">Fires when a secret passage is discovered.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{x}}</code>, <code>{{y}}</code>, <code>{{direction}}</code>\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onQuestComplete</code></div>\n                                        <div class="hook-desc">Fires when a quest is completed.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{questId}}</code>, <code>{{questName}}</code>\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onQuestProgression</code></div>\n                                        <div class="hook-desc">Fires when quest progress is made.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{questId}}</code>, <code>{{step}}</code>, <code>{{totalSteps}}</code>\n                                        </div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onStatUpdate</code></div>\n                                        <div class="hook-desc">Fires when any stat is updated.</div>\n                                        <div class="hook-vars">\n                                            <strong>Variables:</strong>\n                                            <code>{{statName}}</code> - Name of stat,\n                                            <code>{{value}}</code> - New value\n                                        </div>\n                                    </div>\n                                </div>\n\n                                <div class="mazemaster-help-category">\n                                    <div class="mazemaster-help-title"><i class="fa-solid fa-swords"></i> Combat Mode Hooks</div>\n                                    <p class="hook-section-note">These hooks are defined in combat profiles (Turn-based, QTE, etc.):</p>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onTurnStart</code></div>\n                                        <div class="hook-desc">Fires at the start of each combat turn.</div>\n                                        <div class="hook-vars"><strong>Variables:</strong> <code>{{turn}}</code> - Turn number</div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onAttack</code></div>\n                                        <div class="hook-desc">Fires when player attacks.</div>\n                                        <div class="hook-vars"><strong>Variables:</strong> <code>{{attacker}}</code></div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onDefend</code></div>\n                                        <div class="hook-desc">Fires when player defends.</div>\n                                        <div class="hook-vars"><strong>Variables:</strong> <code>{{defender}}</code></div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onPlayerHit</code></div>\n                                        <div class="hook-desc">Fires when player successfully hits enemy.</div>\n                                        <div class="hook-vars"><strong>Variables:</strong> <code>{{damage}}</code></div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onEnemyHit</code></div>\n                                        <div class="hook-desc">Fires when enemy hits player.</div>\n                                        <div class="hook-vars"><strong>Variables:</strong> <code>{{enemy}}</code>, <code>{{damage}}</code></div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onWin</code></div>\n                                        <div class="hook-desc">Fires when combat is won.</div>\n                                        <div class="hook-vars"><strong>Variables:</strong> None (use to grant rewards)</div>\n                                        <div class="hook-example"><code>/mazeitem action="add" item="key" | /mazeheal amount=20</code></div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onLose</code></div>\n                                        <div class="hook-desc">Fires when combat is lost.</div>\n                                        <div class="hook-vars"><strong>Variables:</strong> None (use for penalties)</div>\n                                        <div class="hook-example"><code>/mazedamage amount=10 | /echo Defeated...</code></div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onFlee</code></div>\n                                        <div class="hook-desc">Fires when player flees combat.</div>\n                                        <div class="hook-vars"><strong>Variables:</strong> None</div>\n                                    </div>\n                                    <div class="mazemaster-hook-doc">\n                                        <div class="hook-name"><code>onItem</code></div>\n                                        <div class="hook-desc">Fires when player uses item in combat.</div>\n                                        <div class="hook-vars"><strong>Variables:</strong> <code>{{item}}</code></div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class="mazemaster-section mazemaster-version-info">\n                        <label class="mazemaster-label"><i class="fa-solid fa-circle-info"></i> Version Info</label>\n                        <div class="mazemaster-help">\n                            <p><strong>MazeMaster v1.8.0</strong></p>\n                            <p><small>HP System, Combat Modes, Multi-floor Dungeons, STScript Hooks, Dice/Random Macros, Equipment System, XP &amp; Leveling, Skills, Quests</small></p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <style>\n            .mazemaster-panel {\n                display: flex;\n                flex-direction: column;\n                height: 100%;\n            }\n\n            .mazemaster-panel-header {\n                padding: 10px 15px;\n                border-bottom: 1px solid var(--SmartThemeBorderColor, #555);\n            }\n\n            .mazemaster-panel-header h2 {\n                margin: 0;\n                font-size: 1.2em;\n                display: flex;\n                align-items: center;\n                gap: 10px;\n            }\n\n            .mazemaster-tabs {\n                display: flex;\n                border-bottom: 1px solid var(--SmartThemeBorderColor, #555);\n                padding: 0 10px;\n            }\n\n            .mazemaster-tab {\n                padding: 8px 16px;\n                background: transparent;\n                border: none;\n                border-bottom: 2px solid transparent;\n                cursor: pointer;\n                color: var(--SmartThemeBodyColor);\n                font-size: 0.9em;\n            }\n\n            .mazemaster-tab:hover {\n                background: rgba(255, 255, 255, 0.05);\n            }\n\n            .mazemaster-tab.active {\n                border-bottom-color: var(--SmartThemeQuoteColor, #4a7c59);\n                color: var(--SmartThemeQuoteColor, #4a7c59);\n            }\n\n            .mazemaster-panel-content {\n                flex: 1;\n                overflow-y: auto;\n                padding: 15px;\n            }\n\n            .mazemaster-tab-content {\n                display: none;\n            }\n\n            .mazemaster-tab-content.active {\n                display: block;\n            }\n\n            /* Combat sub-tabs */\n            .mazemaster-combat-subtabs {\n                display: flex;\n                gap: 4px;\n                margin-bottom: 12px;\n                flex-wrap: wrap;\n                padding-bottom: 10px;\n                border-bottom: 1px solid var(--SmartThemeBorderColor, #444);\n            }\n\n            .combat-subtab {\n                padding: 6px 12px;\n                background: var(--SmartThemeBlurTintColor, rgba(0,0,0,0.3));\n                border: 1px solid var(--SmartThemeBorderColor, #555);\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 0.85em;\n                color: var(--SmartThemeBodyColor);\n                transition: all 0.15s ease;\n            }\n\n            .combat-subtab:hover {\n                background: rgba(255, 255, 255, 0.1);\n            }\n\n            .combat-subtab.active {\n                background: var(--SmartThemeQuoteColor, #4a7c59);\n                color: var(--SmartThemeBodyColor);\n                border-color: var(--SmartThemeQuoteColor, #4a7c59);\n            }\n\n            .combat-content {\n                display: none;\n            }\n\n            .combat-content.active {\n                display: block;\n            }\n\n            /* Help Sub-tabs (same pattern as combat) */\n            .mazemaster-help-subtabs {\n                display: flex;\n                gap: 4px;\n                margin-bottom: 12px;\n                flex-wrap: wrap;\n                padding-bottom: 10px;\n                border-bottom: 1px solid var(--SmartThemeBorderColor, #444);\n            }\n\n            .help-subtab {\n                padding: 6px 12px;\n                background: var(--SmartThemeBlurTintColor, rgba(0,0,0,0.3));\n                border: 1px solid var(--SmartThemeBorderColor, #555);\n                border-radius: 4px;\n                cursor: pointer;\n                font-size: 0.85em;\n                color: var(--SmartThemeBodyColor);\n                transition: all 0.15s ease;\n            }\n\n            .help-subtab:hover {\n                background: rgba(255, 255, 255, 0.1);\n            }\n\n            .help-subtab.active {\n                background: var(--SmartThemeQuoteColor, #4a7c59);\n                color: var(--SmartThemeBodyColor);\n                border-color: var(--SmartThemeQuoteColor, #4a7c59);\n            }\n\n            .help-subtab i {\n                margin-right: 4px;\n            }\n\n            .help-content {\n                display: none;\n            }\n\n            .help-content.active {\n                display: block;\n            }\n\n            /* Hook Documentation Styles */\n            .mazemaster-help-intro {\n                margin-bottom: 15px;\n                padding: 10px;\n                background: rgba(0, 0, 0, 0.2);\n                border-radius: 6px;\n                font-size: 0.9em;\n                color: #aaa;\n            }\n\n            .mazemaster-hook-doc {\n                background: rgba(0, 0, 0, 0.15);\n                padding: 10px;\n                margin-bottom: 8px;\n                border-radius: 4px;\n                border-left: 3px solid var(--SmartThemeQuoteColor, #4a7c59);\n            }\n\n            .hook-name code {\n                font-size: 1em;\n                color: #f1c40f;\n                background: rgba(0, 0, 0, 0.3);\n                padding: 3px 8px;\n                border-radius: 4px;\n            }\n\n            .hook-desc {\n                margin: 6px 0;\n                font-size: 0.9em;\n                color: #ccc;\n            }\n\n            .hook-vars {\n                font-size: 0.85em;\n                color: #aaa;\n                margin: 6px 0;\n            }\n\n            .hook-vars code {\n                background: rgba(0, 0, 0, 0.3);\n                padding: 1px 5px;\n                border-radius: 3px;\n                color: #e8c170;\n                font-size: 0.9em;\n            }\n\n            .hook-example {\n                margin-top: 6px;\n                padding: 6px 10px;\n                background: rgba(0, 0, 0, 0.3);\n                border-radius: 4px;\n            }\n\n            .hook-example code {\n                color: #7bed9f;\n                font-size: 0.85em;\n            }\n\n            .hook-section-note {\n                font-size: 0.85em;\n                color: #888;\n                margin-bottom: 10px;\n                font-style: italic;\n            }\n\n            /* Macro Documentation Styles */\n            .mazemaster-macro-doc {\n                background: rgba(0, 0, 0, 0.15);\n                padding: 12px;\n                margin-bottom: 10px;\n                border-radius: 6px;\n            }\n\n            .macro-syntax {\n                display: block;\n                font-size: 1.1em;\n                color: #f1c40f;\n                background: rgba(0, 0, 0, 0.4);\n                padding: 8px 12px;\n                border-radius: 4px;\n                margin-bottom: 8px;\n            }\n\n            .mazemaster-examples {\n                margin: 10px 0;\n                padding: 10px;\n                background: rgba(0, 0, 0, 0.2);\n                border-radius: 4px;\n            }\n\n            .example-title {\n                font-weight: 600;\n                color: #aaa;\n                margin-bottom: 6px;\n                font-size: 0.85em;\n            }\n\n            .example {\n                padding: 3px 0;\n                font-size: 0.9em;\n            }\n\n            .example code {\n                background: rgba(0, 0, 0, 0.3);\n                padding: 2px 6px;\n                border-radius: 3px;\n                color: #e8c170;\n            }\n\n            .example-usage {\n                margin-top: 10px;\n                padding: 8px 10px;\n                background: rgba(74, 124, 89, 0.2);\n                border-radius: 4px;\n                border-left: 3px solid var(--SmartThemeQuoteColor, #4a7c59);\n            }\n\n            .example-usage code {\n                color: #7bed9f;\n            }\n\n            .note {\n                color: #888;\n                font-size: 0.85em;\n                font-style: italic;\n            }\n\n            .mazemaster-version-info {\n                margin-top: 15px;\n                padding-top: 15px;\n                border-top: 1px solid rgba(255, 255, 255, 0.1);\n            }\n\n            .mazemaster-section {\n                margin-bottom: 15px;\n            }\n\n            /* Maze Preview Panel Styles */\n            #mazemaster_maze_preview {\n                background: rgba(0, 0, 0, 0.3);\n                border-radius: 8px;\n                padding: 12px;\n                margin-top: 10px;\n            }\n            .mazemaster-preview-header {\n                margin-bottom: 8px;\n            }\n            .preview-title {\n                font-weight: bold;\n                color: #f1c40f;\n                font-size: 1.05em;\n            }\n            .preview-story {\n                font-style: italic;\n                color: #aaa;\n                margin-bottom: 10px;\n                line-height: 1.4;\n                padding: 8px;\n                background: rgba(0,0,0,0.2);\n                border-radius: 4px;\n                border-left: 3px solid #f1c40f;\n            }\n            .preview-stats {\n                display: grid;\n                grid-template-columns: 1fr 1fr;\n                gap: 6px;\n            }\n            .preview-stats .stat-row {\n                display: flex;\n                gap: 8px;\n            }\n            .preview-stats .stat-label {\n                color: #888;\n                font-size: 0.85em;\n            }\n            .preview-stats .stat-value {\n                color: #fff;\n                font-weight: bold;\n                font-size: 0.85em;\n            }\n            .preview-starting-items {\n                margin-top: 8px;\n                padding-top: 8px;\n                border-top: 1px solid rgba(255,255,255,0.1);\n                color: #9b59b6;\n                font-size: 0.85em;\n            }\n\n            .mazemaster-label {\n                display: block;\n                font-weight: bold;\n                margin-bottom: 5px;\n                font-size: 0.9em;\n            }\n\n            .mazemaster-profile-row {\n                display: flex;\n                gap: 5px;\n            }\n\n            .mazemaster-profile-row select {\n                flex: 1;\n            }\n\n            .mazemaster-select {\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 4px;\n                padding: 6px 8px;\n                color: var(--SmartThemeBodyColor);\n            }\n\n            .mazemaster-segments-list {\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n                margin-bottom: 10px;\n                max-height: 300px;\n                overflow-y: auto;\n            }\n\n            .mazemaster-segment-item {\n                background: rgba(0, 0, 0, 0.2);\n                border-radius: 5px;\n                padding: 10px;\n            }\n\n            .mazemaster-segment-row {\n                display: flex;\n                gap: 8px;\n                margin-bottom: 8px;\n                align-items: center;\n            }\n\n            .mazemaster-segment-row:last-child {\n                margin-bottom: 0;\n            }\n\n            .mazemaster-segment-field {\n                flex: 1;\n                display: flex;\n                flex-direction: column;\n                gap: 2px;\n            }\n\n            .mazemaster-segment-field label {\n                font-size: 0.7em;\n                opacity: 0.7;\n            }\n\n            .mazemaster-segment-field input:not([type="checkbox"]),\n            .mazemaster-segment-field select,\n            .mazemaster-segment-field textarea {\n                width: 100%;\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 4px;\n                padding: 5px 8px;\n                color: var(--SmartThemeBodyColor);\n                font-size: 0.85em;\n            }\n\n            .mazemaster-segment-field textarea {\n                min-height: 40px;\n                resize: vertical;\n                font-family: monospace;\n            }\n\n            .mazemaster-segment-field.small {\n                flex: 0 0 80px;\n            }\n\n            .mazemaster-segment-field.tiny {\n                flex: 0 0 100px;\n                overflow: visible;\n            }\n\n            .mazemaster-segment-checkbox {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                font-size: 0.85em;\n                cursor: pointer;\n                white-space: nowrap;\n                padding: 5px;\n                margin: 0;\n            }\n\n            .mazemaster-segment-checkbox input[type="checkbox"] {\n                width: 18px;\n                height: 18px;\n                min-width: 18px;\n                min-height: 18px;\n                cursor: pointer;\n                pointer-events: auto;\n                margin: 0;\n                flex-shrink: 0;\n            }\n\n            .mazemaster-profile-settings {\n                background: rgba(0, 0, 0, 0.15);\n                padding: 10px;\n                border-radius: 5px;\n            }\n\n            .mazemaster-profile-options {\n                display: flex;\n                flex-direction: column;\n                gap: 10px;\n            }\n\n            .mazemaster-checkbox-label {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                cursor: pointer;\n                font-size: 0.9em;\n            }\n\n            .mazemaster-checkbox-label input[type="checkbox"] {\n                width: 16px;\n                height: 16px;\n                cursor: pointer;\n            }\n\n            .mazemaster-difficulty-row {\n                display: flex;\n                align-items: center;\n                gap: 10px;\n                font-size: 0.9em;\n            }\n\n            .mazemaster-select-small {\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 4px;\n                padding: 4px 8px;\n                color: var(--SmartThemeBodyColor);\n                width: 60px;\n            }\n\n            .mazemaster-segment-delete {\n                padding: 5px 8px;\n            }\n\n            .mazemaster-add-btn,\n            .mazemaster-save-btn {\n                width: 100%;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 5px;\n            }\n\n            .mazemaster-distribute-btn {\n                width: 100%;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 8px;\n                background: linear-gradient(135deg, #9b59b6, #8e44ad) !important;\n                color: #fff !important;\n            }\n\n            .mazemaster-distribute-btn:hover {\n                background: linear-gradient(135deg, #8e44ad, #7d3c98) !important;\n            }\n\n            .mazemaster-help-small {\n                margin-top: 5px;\n                color: #888;\n                text-align: center;\n            }\n\n            /* Help Tab Styles */\n            .mazemaster-help-reference {\n                padding: 5px;\n            }\n\n            .mazemaster-help-category {\n                margin-bottom: 16px;\n                padding: 10px;\n                background: rgba(0, 0, 0, 0.2);\n                border-radius: 6px;\n            }\n\n            .mazemaster-help-category .mazemaster-help-title {\n                font-weight: 600;\n                margin-bottom: 8px;\n                color: var(--SmartThemeQuoteColor, #4a7c59);\n                border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n                padding-bottom: 5px;\n            }\n\n            .mazemaster-command-list {\n                display: flex;\n                flex-direction: column;\n                gap: 6px;\n            }\n\n            .mazemaster-command {\n                display: flex;\n                flex-wrap: wrap;\n                gap: 8px;\n                align-items: baseline;\n                padding: 4px 0;\n            }\n\n            .mazemaster-command code {\n                background: rgba(0, 0, 0, 0.3);\n                padding: 3px 8px;\n                border-radius: 4px;\n                font-family: \'Consolas\', \'Monaco\', monospace;\n                font-size: 0.85em;\n                color: #e8c170;\n                white-space: nowrap;\n            }\n\n            .mazemaster-command span {\n                color: #aaa;\n                font-size: 0.85em;\n            }\n\n            .mazemaster-item-ref {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                padding: 3px 0;\n                font-size: 0.85em;\n            }\n\n            .mazemaster-item-ref .item-num {\n                display: inline-flex;\n                align-items: center;\n                justify-content: center;\n                width: 20px;\n                height: 20px;\n                background: var(--SmartThemeQuoteColor, #4a7c59);\n                border-radius: 4px;\n                font-weight: bold;\n                font-size: 0.8em;\n            }\n\n            .mazemaster-item-ref code {\n                background: rgba(0, 0, 0, 0.3);\n                padding: 2px 6px;\n                border-radius: 3px;\n                font-family: \'Consolas\', \'Monaco\', monospace;\n                color: #e8c170;\n            }\n\n            .mazemaster-hooks-list {\n                margin: 8px 0;\n                padding-left: 20px;\n            }\n\n            .mazemaster-hooks-list li {\n                margin: 4px 0;\n                font-size: 0.85em;\n            }\n\n            .mazemaster-hooks-list code {\n                background: rgba(0, 0, 0, 0.3);\n                padding: 2px 6px;\n                border-radius: 3px;\n                font-family: \'Consolas\', \'Monaco\', monospace;\n                color: #e8c170;\n            }\n\n            .menu_button_primary {\n                background: var(--SmartThemeQuoteColor, #4a7c59) !important;\n            }\n\n            .mazemaster-help {\n                background: rgba(0, 0, 0, 0.2);\n                padding: 10px;\n                border-radius: 5px;\n                font-size: 0.85em;\n            }\n\n            .mazemaster-help-title {\n                font-weight: bold;\n                margin-bottom: 5px;\n                margin-top: 10px;\n            }\n\n            .mazemaster-help-title:first-child {\n                margin-top: 0;\n            }\n\n            .mazemaster-help code {\n                background: rgba(0, 0, 0, 0.3);\n                padding: 2px 6px;\n                border-radius: 3px;\n                font-family: monospace;\n                font-size: 0.9em;\n            }\n\n            .mazemaster-help ul {\n                margin: 5px 0;\n                padding-left: 20px;\n            }\n\n            .mazemaster-help li {\n                margin: 3px 0;\n            }\n\n            .mazemaster-help small {\n                opacity: 0.7;\n                display: block;\n                margin-top: 5px;\n            }\n\n            .mazemaster-empty-state {\n                text-align: center;\n                padding: 15px;\n                opacity: 0.6;\n            }\n\n            /* Game Selector */\n            .mazemaster-game-selector {\n                display: flex;\n                gap: 10px;\n                margin-bottom: 15px;\n            }\n\n            .mazemaster-game-btn {\n                flex: 1;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 8px;\n                padding: 10px;\n                border-radius: 5px;\n                transition: all 0.2s;\n            }\n\n            .mazemaster-game-btn.active {\n                background: var(--SmartThemeQuoteColor, #4a7c59) !important;\n                color: white;\n            }\n\n            .mazemaster-game-config {\n                animation: fadeIn 0.2s ease;\n            }\n\n            @keyframes fadeIn {\n                from { opacity: 0; }\n                to { opacity: 1; }\n            }\n\n            /* Battlebar Styles */\n            .mazemaster-bb-settings {\n                display: flex;\n                flex-direction: column;\n                gap: 10px;\n            }\n\n            .mazemaster-bb-row {\n                display: flex;\n                gap: 10px;\n            }\n\n            .mazemaster-bb-field {\n                flex: 1;\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n            }\n\n            .mazemaster-bb-field label {\n                font-size: 0.8em;\n                opacity: 0.8;\n            }\n\n            .mazemaster-bb-field input,\n            .mazemaster-bb-field select {\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 4px;\n                padding: 6px 8px;\n                color: var(--SmartThemeBodyColor);\n            }\n\n            .mazemaster-bb-commands {\n                display: flex;\n                flex-direction: column;\n                gap: 10px;\n            }\n\n            .mazemaster-bb-command {\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n            }\n\n            .mazemaster-bb-command label {\n                font-size: 0.85em;\n                font-weight: bold;\n            }\n\n            .mazemaster-bb-command textarea {\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 4px;\n                padding: 8px;\n                color: var(--SmartThemeBodyColor);\n                font-family: monospace;\n                font-size: 0.85em;\n                min-height: 40px;\n                resize: vertical;\n            }\n\n            .mazemaster-bb-images-list {\n                display: flex;\n                flex-wrap: wrap;\n                gap: 10px;\n                margin-bottom: 10px;\n            }\n\n            .mazemaster-input {\n                width: 100%;\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 4px;\n                padding: 8px 10px;\n                color: var(--SmartThemeBodyColor, #fff);\n                font-size: 1em;\n            }\n\n            .mazemaster-input::placeholder {\n                color: var(--SmartThemeBodyColor, #888);\n                opacity: 0.6;\n            }\n\n            .mazemaster-bb-image-item {\n                position: relative;\n                width: 120px;\n                display: flex;\n                flex-direction: column;\n                border-radius: 5px;\n                overflow: hidden;\n                border: 2px solid var(--SmartThemeBorderColor, #444);\n                cursor: pointer;\n                background: rgba(0, 0, 0, 0.2);\n            }\n\n            .mazemaster-bb-image-item:hover {\n                border-color: var(--SmartThemeQuoteColor, #888);\n            }\n\n            .mazemaster-bb-image-item img {\n                width: 100%;\n                height: 80px;\n                object-fit: cover;\n            }\n\n            .mazemaster-bb-image-item .bb-image-index {\n                position: absolute;\n                top: 2px;\n                left: 2px;\n                background: rgba(0, 0, 0, 0.7);\n                color: white;\n                font-size: 0.7em;\n                padding: 2px 5px;\n                border-radius: 3px;\n            }\n\n            .mazemaster-bb-image-item .bb-image-message {\n                padding: 4px 6px;\n                font-size: 0.7em;\n                color: var(--SmartThemeBodyColor, #aaa);\n                text-align: center;\n                overflow: hidden;\n                text-overflow: ellipsis;\n                white-space: nowrap;\n                max-height: 20px;\n            }\n\n            .mazemaster-bb-image-item .bb-image-delete {\n                position: absolute;\n                top: 2px;\n                right: 2px;\n                background: rgba(231, 76, 60, 0.9);\n                color: white;\n                border: none;\n                width: 20px;\n                height: 20px;\n                border-radius: 50%;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                font-size: 0.7em;\n            }\n\n            .mazemaster-bb-image-item .bb-image-delete:hover {\n                background: #c0392b;\n            }\n\n            /* Game Tab Styles */\n            .mazemaster-game-launch {\n                display: flex;\n                flex-direction: column;\n                gap: 15px;\n                padding: 10px 0;\n            }\n\n            .mazemaster-play-btn {\n                width: 100%;\n                padding: 15px 20px;\n                font-size: 1.2em;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 10px;\n            }\n\n            /* Maze Config Styles */\n            .mazemaster-textarea {\n                width: 100%;\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 4px;\n                padding: 8px 10px;\n                color: var(--SmartThemeBodyColor, #fff);\n                font-family: monospace;\n                font-size: 0.9em;\n                min-height: 60px;\n                resize: vertical;\n            }\n\n            .mazemaster-maze-win-image-row {\n                display: flex;\n                gap: 10px;\n                align-items: flex-start;\n            }\n\n            .mazemaster-maze-win-image-preview {\n                width: 80px;\n                height: 80px;\n                border-radius: 5px;\n                border: 2px solid var(--SmartThemeBorderColor, #444);\n                overflow: hidden;\n                background: rgba(0, 0, 0, 0.2);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .mazemaster-maze-win-image-preview img {\n                width: 100%;\n                height: 100%;\n                object-fit: cover;\n            }\n\n            .mazemaster-maze-win-image-preview .no-image {\n                font-size: 0.7em;\n                opacity: 0.5;\n                text-align: center;\n            }\n\n            /* Maze Subsection Styles */\n            .mazemaster-subsection {\n                background: rgba(0, 0, 0, 0.15);\n                border-left: 3px solid var(--SmartThemeQuoteColor, #666);\n                padding: 10px;\n                margin: 10px 0;\n                border-radius: 0 5px 5px 0;\n            }\n\n            /* Encounters List Styles */\n            .mazemaster-encounters-list {\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n                margin-bottom: 10px;\n            }\n\n            .mazemaster-encounter-row {\n                display: flex;\n                gap: 8px;\n                align-items: center;\n            }\n\n            .mazemaster-encounter-row select {\n                flex: 1;\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 4px;\n                padding: 6px 8px;\n                color: var(--SmartThemeBodyColor);\n            }\n\n            .mazemaster-encounter-row input[type="number"] {\n                width: 60px;\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 4px;\n                padding: 6px 8px;\n                color: var(--SmartThemeBodyColor);\n                text-align: center;\n            }\n\n            .mazemaster-encounter-row .encounter-remove-btn {\n                padding: 5px 8px;\n            }\n\n            /* Maze Cell Minion Indicators */\n            .maze-cell.has-minion:not(.hidden)::before {\n                content: \'?\';\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                font-size: 0.7em;\n                color: #f39c12;\n                font-weight: bold;\n                z-index: 1;\n            }\n\n            .maze-cell.minion-triggered:not(.hidden)::before {\n                content: \'\\2713\';\n                color: #27ae60;\n            }\n\n            /* Moving Minion Indicators */\n            .maze-cell.minion-moving:not(.hidden):not(.minion-triggered)::before {\n                animation: minion-move-pulse 0.8s ease-in-out infinite;\n            }\n\n            .maze-cell.minion-chase:not(.hidden):not(.minion-triggered)::before {\n                content: \'\\f06d\';\n                font-family: \'Font Awesome 6 Free\';\n                font-weight: 900;\n                color: #e74c3c;\n            }\n\n            .maze-cell.minion-patrol:not(.hidden):not(.minion-triggered)::before {\n                content: \'\\f554\';\n                font-family: \'Font Awesome 6 Free\';\n                font-weight: 900;\n                color: #9b59b6;\n            }\n\n            /* v1.5.0: Enhanced Minion AI Alert States */\n            .maze-cell.minion-suspicious:not(.hidden):not(.minion-triggered)::before {\n                content: \'?\';\n                font-family: inherit;\n                font-weight: bold;\n                color: #f39c12;\n                animation: minion-suspicious-pulse 1s ease-in-out infinite;\n            }\n\n            .maze-cell.minion-alerted:not(.hidden):not(.minion-triggered)::before {\n                content: \'!\';\n                font-family: inherit;\n                font-weight: bold;\n                color: #e74c3c;\n                animation: minion-alert-flash 0.5s ease-in-out infinite;\n            }\n\n            .maze-cell.minion-arriving:not(.hidden)::before {\n                animation: minion-arrive 0.2s ease-out forwards;\n            }\n\n            @keyframes minion-suspicious-pulse {\n                0%, 100% {\n                    transform: translate(-50%, -50%) scale(1);\n                    opacity: 0.8;\n                }\n                50% {\n                    transform: translate(-50%, -50%) scale(1.2);\n                    opacity: 1;\n                }\n            }\n\n            @keyframes minion-alert-flash {\n                0%, 100% {\n                    transform: translate(-50%, -50%);\n                    opacity: 1;\n                }\n                50% {\n                    transform: translate(-50%, -50%);\n                    opacity: 0.5;\n                }\n            }\n\n            @keyframes minion-arrive {\n                0% {\n                    transform: translate(-50%, -50%) scale(0.5);\n                    opacity: 0;\n                }\n                100% {\n                    transform: translate(-50%, -50%) scale(1);\n                    opacity: 1;\n                }\n            }\n\n            @keyframes minion-move-pulse {\n                0%, 100% {\n                    transform: translate(-50%, -50%) scale(1);\n                    opacity: 1;\n                }\n                50% {\n                    transform: translate(-50%, -50%) scale(1.15);\n                    opacity: 0.8;\n                }\n            }\n\n            /* Maze Cell Chest Indicators */\n            .maze-cell.has-chest:not(.hidden)::before {\n                content: \'\\f187\';\n                font-family: \'Font Awesome 6 Free\';\n                font-weight: 900;\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                font-size: 0.6em;\n                color: #f39c12;\n                z-index: 1;\n            }\n\n            .maze-cell.chest-locked:not(.hidden)::before {\n                color: #95a5a6;\n            }\n\n            .maze-cell.chest-opened:not(.hidden)::before {\n                color: #666;\n                opacity: 0.5;\n            }\n\n            /* Hide default icon when custom chest image is used */\n            .maze-cell.has-custom-chest::before {\n                display: none !important;\n            }\n\n            /* Maze Cell Trap Indicators */\n            .maze-cell.has-trap:not(.hidden)::before {\n                content: \'\\f6e2\';\n                font-family: \'Font Awesome 6 Free\';\n                font-weight: 900;\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                font-size: 0.6em;\n                color: #e74c3c;\n                z-index: 1;\n            }\n\n            .maze-cell.trap-triggered:not(.hidden)::before {\n                color: #666;\n                opacity: 0.5;\n            }\n\n            /* Safe Room Indicators */\n            .maze-cell.safe-room:not(.hidden) {\n                background: radial-gradient(circle, rgba(45, 212, 191, 0.4), transparent 70%);\n            }\n\n            .maze-cell.safe-room:not(.hidden)::before {\n                content: \'\\f004\';\n                font-family: \'Font Awesome 6 Free\';\n                font-weight: 900;\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                font-size: 0.6em;\n                color: #2dd4bf;\n                z-index: 1;\n                animation: saferoom-pulse 2s ease-in-out infinite;\n                text-shadow: 0 0 8px rgba(45, 212, 191, 0.8);\n            }\n\n            @keyframes saferoom-pulse {\n                0%, 100% { opacity: 0.7; transform: translate(-50%, -50%) scale(1); }\n                50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }\n            }\n\n            /* Portal Indicators */\n            .maze-cell.has-portal:not(.hidden)::before {\n                content: \'\\f111\';\n                font-family: \'Font Awesome 6 Free\';\n                font-weight: 900;\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                font-size: 0.7em;\n                color: var(--portal-color, #9b59b6);\n                z-index: 1;\n                animation: portal-pulse 1.2s ease-in-out infinite;\n                text-shadow: 0 0 8px var(--portal-color, #9b59b6);\n            }\n\n            .maze-cell.portal-exit-only:not(.hidden)::before {\n                opacity: 0.5;\n                animation: none;\n            }\n\n            .maze-cell.portal-flash {\n                animation: teleport-flash 0.3s ease-out;\n            }\n\n            @keyframes portal-pulse {\n                0%, 100% {\n                    opacity: 0.7;\n                    transform: translate(-50%, -50%) scale(1);\n                }\n                50% {\n                    opacity: 1;\n                    transform: translate(-50%, -50%) scale(1.2);\n                }\n            }\n\n            @keyframes teleport-flash {\n                0% {\n                    background: rgba(155, 89, 182, 0.8);\n                    box-shadow: 0 0 20px rgba(155, 89, 182, 0.8);\n                }\n                100% {\n                    background: rgba(0, 0, 0, 0.4);\n                    box-shadow: none;\n                }\n            }\n\n            /* Staircase Indicators (v1.2.0) */\n            .maze-cell.has-staircase:not(.hidden)::before {\n                content: \'\\f54b\';\n                font-family: \'Font Awesome 6 Free\';\n                font-weight: 900;\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                font-size: 0.8em;\n                color: #3498db;\n                z-index: 1;\n                text-shadow: 0 0 4px rgba(52, 152, 219, 0.6);\n            }\n\n            .maze-cell.staircase-up:not(.hidden)::before {\n                content: \'\\f148\';\n                color: #27ae60;\n                text-shadow: 0 0 4px rgba(39, 174, 96, 0.6);\n            }\n\n            .maze-cell.staircase-down:not(.hidden)::before {\n                content: \'\\f149\';\n                color: #e67e22;\n                text-shadow: 0 0 4px rgba(230, 126, 34, 0.6);\n            }\n\n            .maze-cell.staircase-locked:not(.hidden)::after {\n                content: \'\\f023\';\n                font-family: \'Font Awesome 6 Free\';\n                font-weight: 900;\n                position: absolute;\n                top: 2px;\n                right: 2px;\n                font-size: 0.45em;\n                color: #e74c3c;\n                z-index: 2;\n            }\n\n            /* Inventory Display */\n            .mazemaster-maze-inventory {\n                display: flex;\n                justify-content: center;\n                gap: 12px;\n                padding: 6px 12px;\n                background: rgba(0, 0, 0, 0.4);\n                border-radius: 6px;\n                margin-bottom: 8px;\n            }\n\n            .inventory-item {\n                display: flex;\n                align-items: center;\n                gap: 4px;\n                font-size: 0.85em;\n                color: #fff;\n            }\n\n            .inventory-item i { font-size: 0.9em; }\n            .inventory-item i.fa-key { color: #f1c40f; }\n            .inventory-item i.fa-user-ninja { color: #9b59b6; }\n            .inventory-item i.fa-bolt { color: #e74c3c; }\n            .inventory-item.execute i.fa-star { color: #ffd700; text-shadow: 0 0 5px #ffd700; }\n            .inventory-item.execute { font-weight: bold; }\n\n            /* Encounter Confirmation Buttons */\n            .maze-confirm-buttons {\n                margin-top: 8px;\n                display: flex;\n                gap: 8px;\n                justify-content: center;\n            }\n\n            .maze-confirm-btn {\n                padding: 8px 16px;\n                font-size: 0.9em;\n                font-weight: bold;\n                border-radius: 6px;\n                background: linear-gradient(to bottom, #3498db, #2980b9);\n                color: #fff;\n                border: 2px solid #5dade2;\n                box-shadow: 0 2px 8px rgba(52, 152, 219, 0.4);\n                transition: all 0.2s;\n            }\n\n            .maze-confirm-btn:hover {\n                background: linear-gradient(to bottom, #5dade2, #3498db);\n                transform: scale(1.05);\n                box-shadow: 0 4px 12px rgba(52, 152, 219, 0.6);\n            }\n\n            .maze-slip-btn {\n                background: linear-gradient(to bottom, #9b59b6, #8e44ad);\n                border-color: #bb8fce;\n                box-shadow: 0 2px 8px rgba(155, 89, 182, 0.4);\n            }\n\n            .maze-slip-btn:hover {\n                background: linear-gradient(to bottom, #bb8fce, #9b59b6);\n                box-shadow: 0 4px 12px rgba(155, 89, 182, 0.6);\n            }\n\n            .maze-accept-btn {\n                background: linear-gradient(to bottom, #27ae60, #1e8449);\n                border-color: #58d68d;\n                box-shadow: 0 2px 8px rgba(39, 174, 96, 0.4);\n            }\n\n            .maze-accept-btn:hover {\n                background: linear-gradient(to bottom, #58d68d, #27ae60);\n                box-shadow: 0 4px 12px rgba(39, 174, 96, 0.6);\n            }\n\n            /* Battlebar Action Buttons */\n            .mazemaster-bb-action-buttons {\n                display: flex;\n                gap: 10px;\n                justify-content: center;\n                flex-wrap: wrap;\n                width: 100%;\n                max-width: 400px;\n            }\n\n            .mazemaster-bb-strike-btn,\n            .mazemaster-bb-execute-btn {\n                flex: 1;\n                min-width: 120px;\n                max-width: 180px;\n                padding: 12px 15px;\n                font-size: 1em;\n                border-radius: 10px;\n                cursor: pointer;\n                font-weight: bold;\n                border: none;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                gap: 8px;\n                transition: transform 0.1s, box-shadow 0.1s;\n            }\n\n            .mazemaster-bb-strike-btn {\n                background: linear-gradient(to bottom, #e74c3c, #c0392b);\n                color: #fff;\n                box-shadow: 0 4px 10px rgba(231, 76, 60, 0.3);\n            }\n\n            .mazemaster-bb-strike-btn:hover {\n                background: linear-gradient(to bottom, #c0392b, #a93226);\n                transform: scale(1.02);\n            }\n\n            .mazemaster-bb-execute-btn {\n                background: linear-gradient(135deg, #ffd700, #ffaa00);\n                color: #000;\n                text-shadow: 0 1px 0 rgba(255,255,255,0.5);\n                box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);\n            }\n\n            .mazemaster-bb-execute-btn:hover {\n                background: linear-gradient(135deg, #ffea00, #ffc400);\n                box-shadow: 0 4px 20px rgba(255, 215, 0, 0.6);\n                transform: scale(1.02);\n            }\n\n            /* Encounter Percent Label */\n            .encounter-percent-label {\n                font-size: 0.9em;\n                color: #888;\n            }\n\n            .encounter-percent-input {\n                width: 50px;\n            }\n\n            /* Small input for config rows */\n            .mazemaster-input-small {\n                width: 60px;\n                padding: 4px 8px;\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 4px;\n                color: var(--SmartThemeBodyColor);\n            }\n\n            /* Grid layout for config rows */\n            .mazemaster-row {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                margin-bottom: 6px;\n            }\n\n            .mazemaster-row label {\n                min-width: 90px;\n                font-size: 0.85em;\n                color: var(--SmartThemeBodyColor);\n                opacity: 0.9;\n            }\n\n            /* Two-column grid for percentage fields */\n            .mazemaster-grid-2col {\n                display: grid;\n                grid-template-columns: 1fr 1fr;\n                gap: 8px 16px;\n            }\n\n            .mazemaster-grid-2col .mazemaster-row {\n                margin-bottom: 0;\n            }\n\n            .mazemaster-grid-2col .mazemaster-row label {\n                min-width: 80px;\n            }\n\n            /* Three-column grid for loot percentages */\n            .mazemaster-grid-3col {\n                display: grid;\n                grid-template-columns: repeat(3, 1fr);\n                gap: 8px;\n            }\n\n            .mazemaster-grid-3col .mazemaster-row {\n                flex-direction: column;\n                align-items: flex-start;\n                gap: 4px;\n                margin-bottom: 0;\n            }\n\n            .mazemaster-grid-3col .mazemaster-row label {\n                min-width: auto;\n                font-size: 0.8em;\n                opacity: 0.8;\n            }\n\n            .mazemaster-grid-3col .mazemaster-input-small {\n                width: 100%;\n            }\n\n            /* 4-column grid */\n            .mazemaster-grid-4col {\n                display: grid;\n                grid-template-columns: repeat(4, 1fr);\n                gap: 8px;\n            }\n\n            .mazemaster-grid-4col .mazemaster-row {\n                flex-direction: column;\n                align-items: flex-start;\n                gap: 2px;\n                margin-bottom: 0;\n            }\n\n            .mazemaster-grid-4col .mazemaster-row label {\n                min-width: auto;\n                font-size: 0.75em;\n                opacity: 0.8;\n            }\n\n            .mazemaster-grid-4col .mazemaster-input-small {\n                width: 100%;\n            }\n\n            /* 5-column grid (for Find Early checkboxes) */\n            .mazemaster-grid-5col {\n                display: grid;\n                grid-template-columns: repeat(5, 1fr);\n                gap: 6px;\n            }\n\n            .mazemaster-checkbox-label {\n                display: flex;\n                align-items: center;\n                gap: 4px;\n                font-size: 0.8em;\n                padding: 4px 6px;\n                background: rgba(0, 0, 0, 0.15);\n                border-radius: 4px;\n                cursor: pointer;\n                transition: background 0.2s;\n            }\n\n            .mazemaster-checkbox-label:hover {\n                background: rgba(0, 0, 0, 0.25);\n            }\n\n            .mazemaster-checkbox-label input[type="checkbox"] {\n                margin: 0;\n            }\n\n            /* Collapsible Sections */\n            .mazemaster-collapsible {\n                margin-bottom: 8px;\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 6px;\n                overflow: hidden;\n            }\n\n            .mazemaster-collapsible-header {\n                width: 100%;\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                padding: 10px 12px;\n                background: rgba(0, 0, 0, 0.2);\n                border: none;\n                cursor: pointer;\n                text-align: left;\n                font-size: 0.95em;\n                font-weight: 500;\n                color: inherit;\n                transition: background 0.2s;\n            }\n\n            .mazemaster-collapsible-header:hover {\n                background: rgba(0, 0, 0, 0.3);\n            }\n\n            .mazemaster-collapse-icon {\n                font-size: 0.8em;\n                transition: transform 0.2s;\n            }\n\n            .mazemaster-collapsible.expanded .mazemaster-collapse-icon {\n                transform: rotate(90deg);\n            }\n\n            .mazemaster-collapse-hint {\n                font-size: 0.8em;\n                opacity: 0.6;\n                margin-left: auto;\n            }\n\n            .mazemaster-collapsible-content {\n                padding: 12px;\n                border-top: 1px solid var(--SmartThemeBorderColor, #444);\n                background: rgba(0, 0, 0, 0.1);\n            }\n\n            .mazemaster-collapsible-content .mazemaster-section:last-child {\n                margin-bottom: 0;\n            }\n\n            /* Portal Config List */\n            .mazemaster-portals-list {\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n                margin-bottom: 10px;\n            }\n\n            .mazemaster-portal-item {\n                background: rgba(0, 0, 0, 0.2);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 6px;\n                overflow: hidden;\n            }\n\n            .mazemaster-portal-item .portal-header {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                padding: 8px 10px;\n                background: rgba(0, 0, 0, 0.2);\n                border-bottom: 1px solid var(--SmartThemeBorderColor, #444);\n            }\n\n            .mazemaster-portal-item .portal-color {\n                width: 16px;\n                height: 16px;\n                border-radius: 50%;\n                flex-shrink: 0;\n            }\n\n            .mazemaster-portal-item .portal-name {\n                flex: 1;\n                font-weight: 500;\n            }\n\n            .mazemaster-portal-item .portal-details {\n                padding: 10px;\n                display: flex;\n                flex-direction: column;\n                gap: 6px;\n            }\n\n            .mazemaster-portal-item .portal-row {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n\n            .mazemaster-portal-item .portal-row label {\n                width: 90px;\n                font-size: 0.85em;\n                color: var(--SmartThemeBodyColor, #ccc);\n            }\n\n            .mazemaster-portal-item .portal-row input[type="text"],\n            .mazemaster-portal-item .portal-row input[type="number"] {\n                flex: 1;\n                max-width: 80px;\n            }\n\n            .mazemaster-portal-item .coords-row {\n                gap: 4px;\n            }\n\n            .mazemaster-portal-item .coords-row span {\n                font-size: 0.8em;\n                color: var(--SmartThemeBodyColor, #999);\n            }\n\n            .mazemaster-portal-item .coords-row input {\n                width: 50px !important;\n                max-width: 50px !important;\n            }\n\n            .mazemaster-portal-item .portal-color-input {\n                width: 32px;\n                height: 24px;\n                padding: 0;\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                cursor: pointer;\n            }\n\n            .mazemaster-portal-item .remove-portal-btn {\n                padding: 4px 8px;\n                font-size: 0.8em;\n            }\n\n            /* Objectives Config List */\n            .mazemaster-objectives-list {\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n                margin-bottom: 10px;\n            }\n\n            .mazemaster-objective-item {\n                background: rgba(0, 0, 0, 0.2);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 6px;\n                overflow: hidden;\n            }\n\n            .mazemaster-objective-item .objective-config-header {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                padding: 8px 10px;\n                background: rgba(0, 0, 0, 0.2);\n                border-bottom: 1px solid var(--SmartThemeBorderColor, #444);\n            }\n\n            .mazemaster-objective-item .objective-name {\n                flex: 1;\n                font-weight: 500;\n            }\n\n            .mazemaster-objective-item .objective-config-details {\n                padding: 10px;\n                display: flex;\n                flex-direction: column;\n                gap: 6px;\n            }\n\n            .mazemaster-objective-item .objective-config-row {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n\n            .mazemaster-objective-item .objective-config-row label {\n                width: 100px;\n                font-size: 0.85em;\n                color: var(--SmartThemeBodyColor, #ccc);\n            }\n\n            .mazemaster-objective-item .objective-config-row input[type="text"],\n            .mazemaster-objective-item .objective-config-row input[type="number"],\n            .mazemaster-objective-item .objective-config-row select {\n                flex: 1;\n            }\n\n            .mazemaster-objective-item .remove-objective-btn {\n                padding: 4px 8px;\n                font-size: 0.8em;\n            }\n\n            /* STScript Hooks Config */\n            .mazemaster-hooks-group {\n                margin-top: 12px;\n            }\n\n            .mazemaster-hooks-group:first-of-type {\n                margin-top: 8px;\n            }\n\n            .mazemaster-hooks-label {\n                display: block;\n                font-size: 0.85em;\n                font-weight: 500;\n                color: #3498db;\n                margin-bottom: 6px;\n                padding-bottom: 4px;\n                border-bottom: 1px solid rgba(52, 152, 219, 0.3);\n            }\n\n            .mazemaster-hooks-items {\n                display: flex;\n                flex-direction: column;\n                gap: 6px;\n            }\n\n            .mazemaster-hooks-items .hook-item {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n\n            .mazemaster-hooks-items .hook-item > label {\n                width: 120px;\n                flex-shrink: 0;\n                font-size: 0.85em;\n                color: var(--SmartThemeBodyColor, #ccc);\n            }\n\n            .mazemaster-hooks-items .hook-item input {\n                flex: 1;\n            }\n\n            /* Inline row */\n            .mazemaster-inline-row {\n                display: flex;\n                gap: 12px;\n            }\n\n            .mazemaster-flex-1 {\n                flex: 1;\n            }\n\n            /* Saved Games */\n            .mazemaster-saved-games-list {\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n            }\n\n            .mazemaster-saved-game {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 8px 12px;\n                background: rgba(0, 0, 0, 0.2);\n                border-radius: 4px;\n            }\n\n            .mazemaster-saved-game-info {\n                display: flex;\n                flex-direction: column;\n                gap: 2px;\n            }\n\n            .mazemaster-saved-game-name {\n                font-weight: 500;\n            }\n\n            .mazemaster-saved-game-details {\n                font-size: 0.8em;\n                opacity: 0.7;\n            }\n\n            .mazemaster-saved-game-actions {\n                display: flex;\n                gap: 6px;\n            }\n\n            .mazemaster-no-saves {\n                text-align: center;\n                opacity: 0.6;\n                padding: 12px;\n                font-style: italic;\n            }\n\n            /* Side-by-side sections */\n            .mazemaster-section-row {\n                display: grid;\n                grid-template-columns: 1fr 1fr;\n                gap: 16px;\n            }\n\n            .mazemaster-section-row .mazemaster-section {\n                margin-bottom: 0;\n            }\n\n            /* Minions Config Styles */\n            .mazemaster-minions-list {\n                display: flex;\n                flex-direction: column;\n                gap: 10px;\n                margin-bottom: 10px;\n            }\n\n            .mazemaster-minion-card {\n                display: flex;\n                gap: 10px;\n                align-items: center;\n                padding: 10px;\n                background: rgba(0, 0, 0, 0.2);\n                border-radius: 5px;\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n            }\n\n            .mazemaster-minion-card .minion-image {\n                width: 50px;\n                height: 50px;\n                border-radius: 5px;\n                overflow: hidden;\n                background: rgba(0, 0, 0, 0.3);\n                flex-shrink: 0;\n                position: relative;\n                cursor: pointer;\n            }\n\n            .mazemaster-minion-card .minion-image img {\n                width: 100%;\n                height: 100%;\n                object-fit: cover;\n            }\n\n            .mazemaster-minion-card .minion-image:hover {\n                outline: 2px solid var(--SmartThemeQuoteColor, #e74c3c);\n                outline-offset: 2px;\n            }\n\n            .mazemaster-minion-card .minion-image::after {\n                content: \'\\f030\';\n                font-family: \'Font Awesome 6 Free\';\n                font-weight: 900;\n                position: absolute;\n                bottom: 2px;\n                right: 2px;\n                font-size: 10px;\n                color: white;\n                background: rgba(0, 0, 0, 0.6);\n                padding: 2px 4px;\n                border-radius: 3px;\n                opacity: 0;\n                transition: opacity 0.2s;\n            }\n\n            .mazemaster-minion-card .minion-image:hover::after {\n                opacity: 1;\n            }\n\n            .mazemaster-minion-card .minion-info {\n                flex: 1;\n            }\n\n            .mazemaster-minion-card .minion-row {\n                display: flex;\n                gap: 8px;\n                margin-bottom: 8px;\n            }\n\n            .mazemaster-minion-card .minion-name-input {\n                flex: 1;\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 4px;\n                padding: 6px 8px;\n                color: var(--SmartThemeBodyColor);\n            }\n\n            .mazemaster-minion-card .minion-type-select {\n                width: 110px;\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 4px;\n                padding: 6px 8px;\n                color: var(--SmartThemeBodyColor);\n            }\n\n            .mazemaster-minion-card .minion-profiles {\n                margin-top: 8px;\n            }\n\n            .mazemaster-minion-card .minion-profiles label {\n                display: block;\n                font-size: 0.85em;\n                color: var(--SmartThemeQuoteColor);\n                margin-bottom: 4px;\n            }\n\n            .mazemaster-minion-card .minion-profiles select {\n                width: 100%;\n                min-height: 60px;\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 4px;\n                padding: 4px;\n                color: var(--SmartThemeBodyColor);\n            }\n\n            .mazemaster-minion-card .minion-profiles textarea {\n                width: 100%;\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 4px;\n                padding: 6px 8px;\n                color: var(--SmartThemeBodyColor);\n                resize: vertical;\n            }\n\n            .mazemaster-minion-card .merchant-range-row {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n            }\n\n            .mazemaster-minion-card .merchant-range-row span {\n                color: var(--SmartThemeBodyColor);\n                opacity: 0.8;\n            }\n\n            .mazemaster-minion-card .minion-encounter-script {\n                margin-top: 10px;\n                padding-top: 10px;\n                border-top: 1px solid var(--SmartThemeBorderColor, #333);\n            }\n\n            .mazemaster-minion-card .minion-encounter-script label {\n                display: block;\n                font-size: 0.85em;\n                color: var(--SmartThemeQuoteColor);\n                margin-bottom: 4px;\n            }\n\n            .mazemaster-minion-card .minion-encounter-script textarea {\n                width: 100%;\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 4px;\n                padding: 6px 8px;\n                color: var(--SmartThemeBodyColor);\n                resize: vertical;\n                font-family: monospace;\n            }\n\n            .mazemaster-minion-card .minion-delete-btn {\n                padding: 5px 8px;\n                flex-shrink: 0;\n                align-self: flex-start;\n            }\n\n            /* Minion Movement Settings */\n            .mazemaster-minion-card .minion-movement-settings {\n                margin-top: 8px;\n                padding-top: 8px;\n                border-top: 1px solid var(--SmartThemeBorderColor, #444);\n            }\n\n            .mazemaster-minion-card .minion-movement-settings > label {\n                display: block;\n                font-size: 0.85em;\n                color: var(--SmartThemeBodyColor, #999);\n                margin-bottom: 4px;\n            }\n\n            .mazemaster-minion-card .movement-row {\n                display: flex;\n                gap: 8px;\n                margin-bottom: 6px;\n            }\n\n            .mazemaster-minion-card .minion-movement-type {\n                flex: 1;\n            }\n\n            .mazemaster-minion-card .movement-params {\n                display: flex;\n                gap: 12px;\n                flex-wrap: wrap;\n            }\n\n            .mazemaster-minion-card .movement-param {\n                display: flex;\n                align-items: center;\n                gap: 4px;\n                font-size: 0.85em;\n            }\n\n            .mazemaster-minion-card .movement-param span {\n                color: var(--SmartThemeBodyColor, #999);\n            }\n\n            .mazemaster-minion-card .movement-param input {\n                width: 50px;\n            }\n\n            /* TRAP CARD STYLES */\n            .mazemaster-traps-list {\n                display: flex;\n                flex-direction: column;\n                gap: 10px;\n                margin-bottom: 10px;\n                max-height: 400px;\n                overflow-y: auto;\n            }\n\n            .mazemaster-trap-card {\n                display: flex;\n                gap: 10px;\n                background: rgba(0, 0, 0, 0.2);\n                border-radius: 8px;\n                padding: 10px;\n                align-items: flex-start;\n            }\n\n            .mazemaster-trap-card .trap-image {\n                width: 80px;\n                height: 80px;\n                flex-shrink: 0;\n                border-radius: 6px;\n                overflow: hidden;\n                background: rgba(0, 0, 0, 0.3);\n                position: relative;\n                cursor: pointer;\n            }\n\n            .mazemaster-trap-card .trap-image img {\n                width: 100%;\n                height: 100%;\n                object-fit: cover;\n            }\n\n            .mazemaster-trap-card .trap-image:hover {\n                outline: 2px solid var(--SmartThemeQuoteColor, #e74c3c);\n                outline-offset: 2px;\n            }\n\n            .mazemaster-trap-card .trap-image::after {\n                content: \'\\f030\';\n                font-family: \'Font Awesome 6 Free\';\n                font-weight: 900;\n                position: absolute;\n                bottom: 4px;\n                right: 4px;\n                font-size: 12px;\n                color: white;\n                background: rgba(0, 0, 0, 0.6);\n                padding: 3px 5px;\n                border-radius: 3px;\n                opacity: 0;\n                transition: opacity 0.2s;\n            }\n\n            .mazemaster-trap-card .trap-image:hover::after {\n                opacity: 1;\n            }\n\n            .mazemaster-trap-card .trap-no-image {\n                width: 100%;\n                height: 100%;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: var(--SmartThemeBodyColor);\n                opacity: 0.5;\n                font-size: 24px;\n            }\n\n            .mazemaster-trap-card .trap-info {\n                flex: 1;\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n            }\n\n            .mazemaster-trap-card .trap-row {\n                display: flex;\n                gap: 8px;\n            }\n\n            .mazemaster-trap-card .trap-name-input {\n                flex: 1;\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 4px;\n                padding: 6px 8px;\n                color: var(--SmartThemeBodyColor);\n            }\n\n            .mazemaster-trap-card .trap-message-row,\n            .mazemaster-trap-card .trap-script-row {\n                display: flex;\n                flex-direction: column;\n                gap: 4px;\n            }\n\n            .mazemaster-trap-card .trap-message-row label,\n            .mazemaster-trap-card .trap-script-row label {\n                font-size: 0.75em;\n                opacity: 0.7;\n            }\n\n            .mazemaster-trap-card .trap-message-input,\n            .mazemaster-trap-card .trap-script-input {\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 4px;\n                padding: 6px 8px;\n                color: var(--SmartThemeBodyColor);\n                resize: vertical;\n                font-family: inherit;\n            }\n\n            .mazemaster-trap-card .trap-delete-btn {\n                padding: 5px 8px;\n                flex-shrink: 0;\n                align-self: flex-start;\n            }\n\n            /* QUEST TEMPLATE STYLES (v1.5.0) */\n            .mazemaster-quest-template-list {\n                display: flex;\n                flex-direction: column;\n                gap: 10px;\n                max-height: 400px;\n                overflow-y: auto;\n            }\n\n            .mazemaster-quest-template-card {\n                background: rgba(0, 0, 0, 0.2);\n                border: 1px solid #444;\n                border-radius: 8px;\n                padding: 12px;\n            }\n\n            .mazemaster-quest-template-card:hover {\n                border-color: #e91e63;\n            }\n\n            .quest-template-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                margin-bottom: 8px;\n            }\n\n            .quest-template-title {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                color: #fff;\n                font-weight: bold;\n            }\n\n            .quest-template-title i {\n                color: #e91e63;\n            }\n\n            .quest-default-badge {\n                font-size: 10px;\n                background: rgba(233, 30, 99, 0.2);\n                color: #e91e63;\n                padding: 2px 6px;\n                border-radius: 8px;\n                font-weight: normal;\n            }\n\n            .quest-template-actions {\n                display: flex;\n                gap: 4px;\n            }\n\n            .quest-template-info {\n                display: flex;\n                gap: 12px;\n                margin-bottom: 6px;\n                font-size: 12px;\n            }\n\n            .quest-template-type {\n                color: #888;\n            }\n\n            .quest-template-objective {\n                color: #aaa;\n            }\n\n            .quest-template-reward {\n                color: #f1c40f;\n            }\n\n            .quest-template-reward i {\n                margin-right: 4px;\n            }\n\n            .quest-template-description {\n                font-size: 12px;\n                color: #888;\n                font-style: italic;\n            }\n\n            /* Quest Editor Dialog */\n            .mazemaster-quest-editor-dialog {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                z-index: 10100;\n            }\n\n            .mazemaster-quest-editor-backdrop {\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.7);\n            }\n\n            .mazemaster-quest-editor-content {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                background: var(--SmartThemeBlurTintColor, #1a1a2e);\n                border: 2px solid #e91e63;\n                border-radius: 12px;\n                width: 90%;\n                max-width: 500px;\n                max-height: 80vh;\n                overflow-y: auto;\n            }\n\n            .mazemaster-quest-editor-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 12px 16px;\n                border-bottom: 1px solid rgba(233, 30, 99, 0.3);\n                background: rgba(233, 30, 99, 0.1);\n                border-radius: 10px 10px 0 0;\n            }\n\n            .mazemaster-quest-editor-header h3 {\n                margin: 0;\n                color: #e91e63;\n                font-size: 16px;\n            }\n\n            .quest-editor-close {\n                background: none;\n                border: none;\n                color: #888;\n                font-size: 24px;\n                cursor: pointer;\n                padding: 0;\n                width: 28px;\n                height: 28px;\n            }\n\n            .quest-editor-close:hover {\n                color: #e91e63;\n            }\n\n            .mazemaster-quest-editor-body {\n                padding: 16px;\n                display: flex;\n                flex-direction: column;\n                gap: 12px;\n            }\n\n            .mazemaster-quest-editor-footer {\n                padding: 12px 16px;\n                border-top: 1px solid #333;\n                display: flex;\n                justify-content: flex-end;\n                gap: 8px;\n            }\n\n            /* v1.6.0: Custom Items List Styles */\n            .mazemaster-items-list,\n            .mazemaster-factions-list,\n            .mazemaster-sounds-list {\n                display: flex;\n                flex-direction: column;\n                gap: 10px;\n                max-height: 400px;\n                overflow-y: auto;\n            }\n\n            .mazemaster-item-card,\n            .mazemaster-faction-card {\n                background: rgba(0, 0, 0, 0.2);\n                border: 1px solid #444;\n                border-radius: 8px;\n                padding: 12px;\n            }\n\n            .mazemaster-item-card:hover,\n            .mazemaster-faction-card:hover {\n                border-color: #9c27b0;\n            }\n\n            .mazemaster-item-header,\n            .mazemaster-faction-header {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                margin-bottom: 6px;\n            }\n\n            .mazemaster-item-name,\n            .mazemaster-faction-name {\n                color: #fff;\n                font-weight: bold;\n            }\n\n            .mazemaster-item-type {\n                color: #888;\n                font-size: 12px;\n            }\n\n            .mazemaster-item-desc,\n            .mazemaster-faction-desc {\n                font-size: 12px;\n                color: #888;\n                margin-bottom: 8px;\n            }\n\n            .mazemaster-item-actions,\n            .mazemaster-faction-actions {\n                display: flex;\n                gap: 4px;\n                justify-content: flex-end;\n            }\n\n            /* v1.6.0: Item Editor Styles */\n            .mazemaster-item-editor {\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid #9c27b0;\n                border-radius: 8px;\n                padding: 15px;\n            }\n\n            .mazemaster-effects-list {\n                display: flex;\n                flex-direction: column;\n                gap: 8px;\n            }\n\n            .mazemaster-effect-row {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                padding: 8px;\n                background: rgba(0, 0, 0, 0.2);\n                border-radius: 4px;\n            }\n\n            .mazemaster-effect-row select,\n            .mazemaster-effect-row input {\n                padding: 4px;\n                background: rgba(255, 255, 255, 0.1);\n                border: 1px solid #555;\n                border-radius: 4px;\n                color: #fff;\n            }\n\n            /* v1.6.0: Vision/Sound slider styles */\n            .mazemaster-range {\n                flex: 1;\n                accent-color: #9c27b0;\n            }\n\n            /* v1.6.0: Minimap Styles */\n            .mazemaster-minimap {\n                position: absolute;\n                z-index: 100;\n                background: rgba(0, 0, 0, 0.8);\n                border: 2px solid #9c27b0;\n                border-radius: 8px;\n                overflow: hidden;\n                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);\n            }\n\n            .mazemaster-minimap-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 5px 10px;\n                background: rgba(156, 39, 176, 0.3);\n                font-size: 12px;\n                color: #fff;\n            }\n\n            .mazemaster-minimap-header span {\n                display: flex;\n                align-items: center;\n                gap: 5px;\n            }\n\n            .mazemaster-minimap-btn {\n                background: none;\n                border: none;\n                color: #fff;\n                cursor: pointer;\n                padding: 2px 6px;\n                font-size: 11px;\n                opacity: 0.7;\n            }\n\n            .mazemaster-minimap-btn:hover {\n                opacity: 1;\n            }\n\n            #mazemaster_minimap_canvas {\n                display: block;\n            }\n\n            /* Story Milestones Modal */\n            .mazemaster-story-modal {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.7);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 10000;\n            }\n\n            .mazemaster-story-modal-content {\n                background: var(--SmartThemeBlurTintColor, #1a1a1a);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 10px;\n                padding: 20px;\n                width: 90%;\n                max-width: 600px;\n                max-height: 80vh;\n                overflow-y: auto;\n            }\n\n            .mazemaster-story-modal-content h3 {\n                margin: 0 0 15px 0;\n                display: flex;\n                align-items: center;\n                gap: 10px;\n            }\n\n            .mazemaster-story-textarea {\n                width: 100%;\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 4px;\n                padding: 8px;\n                color: var(--SmartThemeBodyColor);\n                resize: vertical;\n                font-family: inherit;\n            }\n\n            .mazemaster-milestones-list {\n                display: flex;\n                flex-direction: column;\n                gap: 10px;\n                margin-bottom: 10px;\n                max-height: 200px;\n                overflow-y: auto;\n            }\n\n            .mazemaster-milestone-row {\n                display: flex;\n                gap: 10px;\n                align-items: flex-start;\n                background: rgba(0, 0, 0, 0.2);\n                padding: 10px;\n                border-radius: 6px;\n            }\n\n            .milestone-percent {\n                display: flex;\n                align-items: center;\n                gap: 4px;\n                flex-shrink: 0;\n            }\n\n            .milestone-percent-input {\n                width: 50px;\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 4px;\n                padding: 6px;\n                color: var(--SmartThemeBodyColor);\n                text-align: center;\n            }\n\n            .milestone-text-input {\n                flex: 1;\n                background: rgba(0, 0, 0, 0.3);\n                border: 1px solid var(--SmartThemeBorderColor, #444);\n                border-radius: 4px;\n                padding: 6px;\n                color: var(--SmartThemeBodyColor);\n                resize: vertical;\n                font-family: inherit;\n            }\n\n            .mazemaster-story-modal-buttons {\n                display: flex;\n                gap: 10px;\n                justify-content: flex-end;\n                margin-top: 15px;\n            }\n        </style>\n    ')}function Hr(){var e;const t=document.getElementById("mazemaster_segments_list");if(!t)return;const a=ta(null===(e=document.getElementById("mazemaster_profile_select"))||void 0===e?void 0:e.value),n=(null==a?void 0:a.segments)||[];0!==n.length?(t.innerHTML=n.map(((e,t)=>'\n        <div class="mazemaster-segment-item" data-index="'.concat(t,'">\n            <div class="mazemaster-segment-row">\n                <div class="mazemaster-segment-field small">\n                    <label>Trigger</label>\n                    <input type="text" class="seg-trigger" value="').concat(Or(e.trigger||""),'" placeholder="com1">\n                </div>\n                <div class="mazemaster-segment-field">\n                    <label>Display Text</label>\n                    <input type="text" class="seg-text" value="').concat(Or(e.text||""),'" placeholder="Prize name">\n                </div>\n                <div class="mazemaster-segment-field small">\n                    <label>Size</label>\n                    <select class="seg-size">\n                        ').concat(b.map((t=>'<option value="'.concat(t,'" ').concat(e.size===t?"selected":"",">").concat(t,"</option>"))).join(""),'\n                    </select>\n                </div>\n                <button class="menu_button menu_button_icon mazemaster-segment-delete" title="Delete">\n                    <i class="fa-solid fa-trash"></i>\n                </button>\n            </div>\n            <div class="mazemaster-segment-row">\n                <div class="mazemaster-segment-field">\n                    <label>STScript Command</label>\n                    <textarea class="seg-command" placeholder="/echo You won!">').concat(Or(e.command||""),'</textarea>\n                </div>\n                <div class="mazemaster-segment-field tiny">\n                    <label>&nbsp;</label>\n                    <label class="mazemaster-segment-checkbox">\n                        <input type="checkbox" class="seg-respin" ').concat(e.respin?"checked":"",">\n                        Respin\n                    </label>\n                </div>\n            </div>\n        </div>\n    "))).join(""),t.querySelectorAll(".mazemaster-segment-delete").forEach((e=>{e.addEventListener("click",(e=>{e.target.closest(".mazemaster-segment-item").remove()}))}))):t.innerHTML='<div class="mazemaster-empty-state">No segments. Click "Add Segment" to create one.</div>'}function Or(e){const t=document.createElement("div");return t.textContent=e||"",t.innerHTML}function Fr(){var e;const t=document.getElementById("mazemaster_bb_images_list");if(!t)return;const a=null===(e=document.getElementById("mazemaster_bb_profile_select"))||void 0===e?void 0:e.value;if(!a)return void(t.innerHTML='<div class="mazemaster-empty-state">Select or create a profile first.</div>');const n=(na(a)||{}).images||[];0!==n.length?(t.innerHTML=n.map(((e,t)=>'\n        <div class="mazemaster-bb-image-item" data-index="'.concat(t,'" title="Click to edit stage message">\n            <img src="/').concat(e.path,'" alt="').concat(Or(e.stageMessage||""),'">\n            <span class="bb-image-index">').concat(t,'</span>\n            <div class="bb-image-message">').concat(Or(e.stageMessage||"(no message)"),'</div>\n            <button class="bb-image-delete" title="Delete">\n                <i class="fa-solid fa-times"></i>\n            </button>\n        </div>\n    '))).join(""),t.querySelectorAll(".mazemaster-bb-image-item").forEach((e=>{e.addEventListener("click",(async t=>{var n;if(t.target.closest(".bb-image-delete"))return;const o=parseInt(e.dataset.index),i=na(a)||{},r=i.images||[],s=(null===(n=r[o])||void 0===n?void 0:n.stageMessage)||"",l=await u("Stage ".concat(o," Message:"),p.INPUT,s);null!=l&&(r[o].stageMessage=l,oa(a,i),Fr())}))})),t.querySelectorAll(".bb-image-delete").forEach((e=>{e.addEventListener("click",(async e=>{e.stopPropagation();const t=e.target.closest(".mazemaster-bb-image-item"),n=parseInt(t.dataset.index);if(!await u("Delete stage ".concat(n,"?"),p.CONFIRM))return;const o=na(a)||{};o.images=(o.images||[]).filter(((e,t)=>t!==n)),oa(a,o),Fr()}))}))):t.innerHTML='<div class="mazemaster-empty-state">No stages. Add images to create stages.</div>'}function Wr(){var e,t,a,n,o,r,s,l,c,m;const d=null===(e=document.getElementById("mazemaster_maze_profile_select"))||void 0===e?void 0:e.value,u=Da(d)||{},p=document.getElementById("mazemaster_maze_size");p&&(p.value=u.gridSize||10);const h=document.getElementById("mazemaster_maze_floors");h&&(h.value=u.floors||1);const g=document.getElementById("mazemaster_maze_difficulty");g&&(g.value=u.difficulty||"normal");const f=document.getElementById("mazemaster_maze_theme");f&&(f.value=u.theme||"fantasy");const y=document.getElementById("mazemaster_maze_mapstyle");y&&(y.value=u.mapStyle||"maze");const v=document.getElementById("mazemaster_maze_win_cmd");v&&(v.value=u.winCommand||"");const b=document.getElementById("mazemaster_maze_lose_cmd");b&&(b.value=u.loseCommand||"");const z=document.getElementById("mazemaster_maze_win_message");z&&(z.value=u.winMessage||"");const _=document.getElementById("mazemaster_maze_main_minion");if(_){const e=un();_.innerHTML='<option value="">None</option>'+e.map((e=>{const t=pn(e);return'<option value="'.concat(Or(e),'" ').concat(u.mainMinion===e?"selected":"",">").concat(Or((null==t?void 0:t.name)||e),"</option>")})).join("")}const x=document.getElementById("mazemaster_main_minion_settings");x&&(x.style.display=u.mainMinion?"block":"none");const k=document.getElementById("mazemaster_maze_intro_message");k&&(k.value=u.mainMinionIntroMessage||"");const C=document.getElementById("mazemaster_maze_random_chance");C&&(C.value=u.mainMinionRandomChance||15);const w=document.getElementById("mazemaster_maze_random_messages");w&&(w.value=(u.mainMinionRandomMessages||[]).join("\n"));const E=document.getElementById("mazemaster_maze_exit_type");E&&(E.value=u.mainMinionExitType||"messenger"),Yr(u.mainMinionExitType||"messenger",u.mainMinionExitProfile);const S=document.getElementById("mazemaster_maze_loss_action");S&&(S.value=u.onBattlebarLoss||"continue");const T=document.querySelector(".mazemaster-maze-win-image-preview");T&&(u.winImage?T.innerHTML='<img id="maze_win_image_preview" src="'.concat(u.winImage,'" alt="Victory">'):T.innerHTML='<div id="maze_win_image_preview" class="no-image">No image</div>');const I=document.getElementById("mazemaster_maze_chest_percent");I&&(I.value=u.chestTilePercent||10);const M=document.getElementById("mazemaster_maze_locked_percent");M&&(M.value=u.chestLockedPercent||30);const P=document.getElementById("mazemaster_maze_locked_bonus");P&&(P.value=u.chestLockedBonusPercent||50);const D=document.getElementById("mazemaster_maze_mimic_percent");D&&(D.value=u.chestMimicPercent||15);const A=document.getElementById("mazemaster_maze_loot_min");A&&(A.value=u.chestLootMin||1);const B=document.getElementById("mazemaster_maze_loot_max");B&&(B.value=u.chestLootMax||2);const L=document.getElementById("mazemaster_maze_chest_key");L&&(L.value=u.chestKeyChance||30);const q=document.getElementById("mazemaster_maze_chest_pow");q&&(q.value=u.chestStrikeChance||50);const R=document.getElementById("mazemaster_maze_chest_stealth");R&&(R.value=u.chestStealthChance||0);const N=document.getElementById("mazemaster_maze_chest_execute");N&&(N.value=u.chestExecuteChance||0);const H=document.getElementById("mazemaster_maze_locked_key");H&&(H.value=u.lockedChestKeyChance||40);const O=document.getElementById("mazemaster_maze_locked_pow");O&&(O.value=u.lockedChestStrikeChance||60);const F=document.getElementById("mazemaster_maze_locked_stealth");F&&(F.value=u.lockedChestStealthChance||30);const W=document.getElementById("mazemaster_maze_locked_execute");W&&(W.value=u.lockedChestExecuteChance||5);let Y=u.startingInventory||{};!(Y.key||Y.stealth||Y.strike||Y.execute)&&null!==(t=Lt[d])&&void 0!==t&&t.startingInventory&&(Y=Lt[d].startingInventory,u.startingInventory=JSON.parse(JSON.stringify(Y)),i());const U=document.getElementById("mazemaster_start_key");U&&(U.value=Y.key||0);const G=document.getElementById("mazemaster_start_floorKey");G&&(G.value=Y.floorKey||0);const j=document.getElementById("mazemaster_start_strike");j&&(j.value=Y.strike||0);const K=document.getElementById("mazemaster_start_stealth");K&&(K.value=Y.stealth||0);const V=document.getElementById("mazemaster_start_execute");V&&(V.value=Y.execute||0);const X=document.getElementById("mazemaster_start_minionBane");X&&(X.value=Y.minionBane||0);const Q=document.getElementById("mazemaster_start_portalStone");Q&&(Q.value=Y.portalStone||0);const J=document.getElementById("mazemaster_start_mapFragment");J&&(J.value=Y.mapFragment||0);const Z=document.getElementById("mazemaster_start_voidWalk");Z&&(Z.value=Y.voidWalk||0);const $=document.getElementById("mazemaster_start_timeShard");$&&($.value=Y.timeShard||0);const ee=document.getElementById("mazemaster_start_healingPotion");ee&&(ee.value=Y.healingPotion||0);const te=document.getElementById("mazemaster_start_greaterHealing");te&&(te.value=Y.greaterHealing||0);const ae=document.getElementById("mazemaster_start_elixir");ae&&(ae.value=Y.elixir||0);const ne=document.getElementById("mazemaster_start_revivalCharm");ne&&(ne.value=Y.revivalCharm||0);const oe=document.getElementById("mazemaster_start_heartCrystal");oe&&(oe.value=Y.heartCrystal||0);const ie=document.getElementById("mazemaster_start_torch");ie&&(ie.value=Y.torch||0);const re=document.getElementById("mazemaster_start_lantern");re&&(re.value=Y.lantern||0);const se=document.getElementById("mazemaster_start_revealScroll");se&&(se.value=Y.revealScroll||0);const le=document.getElementById("mazemaster_start_sightPotion");le&&(le.value=Y.sightPotion||0);const ce=document.getElementById("mazemaster_start_crystalBall");ce&&(ce.value=Y.crystalBall||0);const me=document.getElementById("mazemaster_start_weapon_rusty_sword");me&&(me.value=Y.weapon_rusty_sword||0);const de=document.getElementById("mazemaster_start_weapon_iron_sword");de&&(de.value=Y.weapon_iron_sword||0);const ue=document.getElementById("mazemaster_start_weapon_steel_blade");ue&&(ue.value=Y.weapon_steel_blade||0);const pe=document.getElementById("mazemaster_start_weapon_enchanted_blade");pe&&(pe.value=Y.weapon_enchanted_blade||0);const he=document.getElementById("mazemaster_start_weapon_shadow_dagger");he&&(he.value=Y.weapon_shadow_dagger||0);const ge=document.getElementById("mazemaster_start_armor_leather");ge&&(ge.value=Y.armor_leather||0);const fe=document.getElementById("mazemaster_start_armor_chainmail");fe&&(fe.value=Y.armor_chainmail||0);const ye=document.getElementById("mazemaster_start_armor_plate");ye&&(ye.value=Y.armor_plate||0);const ve=document.getElementById("mazemaster_start_ironGuard");ve&&(ve.value=Y.ironGuard||0);const be=document.getElementById("mazemaster_start_accessory_ring_power");be&&(be.value=Y.accessory_ring_power||0);const ze=document.getElementById("mazemaster_start_accessory_amulet_protection");ze&&(ze.value=Y.accessory_amulet_protection||0);const _e=document.getElementById("mazemaster_start_accessory_lucky_charm");_e&&(_e.value=Y.accessory_lucky_charm||0);const xe=document.getElementById("mazemaster_start_accessory_vampiric_pendant");xe&&(xe.value=Y.accessory_vampiric_pendant||0);const ke=document.getElementById("mazemaster_hp_enabled");ke&&(ke.checked=!1!==u.hpEnabled);const Ce=document.getElementById("mazemaster_hp_max");Ce&&(Ce.value=u.maxHP||100);const we=document.getElementById("mazemaster_hp_battlebar_mult");we&&(we.value=null!==(a=u.battlebarDamageMultiplier)&&void 0!==a?a:1);const Ee=document.getElementById("mazemaster_hp_battlebar_diff");Ee&&(Ee.value=null!==(n=u.battlebarDifficultyMultiplier)&&void 0!==n?n:1);const Se=document.getElementById("mazemaster_hp_respawn");Se&&(Se.value=u.respawnHPPercent||50);const Te=document.getElementById("mazemaster_hp_ondeath");Te&&(Te.value=u.onDeath||"respawn");const Ie=document.getElementById("mazemaster_safe_room_count");Ie&&(Ie.value=null!==(o=u.safeRoomCount)&&void 0!==o?o:3);const Me=document.getElementById("mazemaster_safe_room_heal");Me&&(Me.value=null!==(r=u.safeRoomHealPercent)&&void 0!==r?r:100);const Pe=document.getElementById("mazemaster_safe_room_llm");Pe&&(Pe.checked=u.safeRoomUseLLM||!1);const De=document.getElementById("mazemaster_llm_enhance_rooms");De&&(De.checked=!1!==u.llmEnhanceRooms);const Ae=document.getElementById("mazemaster_rest_enabled");Ae&&(Ae.checked=!1!==u.restEnabled);const Be=document.getElementById("mazemaster_rest_heal");Be&&(Be.value=u.restHealPercent||20);const Le=document.getElementById("mazemaster_rest_cooldown");Le&&(Le.value=null!==(s=u.restCooldown)&&void 0!==s?s:3);const qe=document.getElementById("mazemaster_rest_interrupt");qe&&(qe.value=null!==(l=u.restInterruptChance)&&void 0!==l?l:15);const Re=u.mapVisibility||"fogOfWar",Ne=document.querySelector('input[name="mazemaster_map_visibility"][value="'.concat(Re,'"]'));Ne&&(Ne.checked=!0);let He=u.minionEncounters||[],Oe=u.trapEncounters||[],Fe=u.questPool||[];0===He.length&&null!==(c=Lt[d])&&void 0!==c&&c.minionEncounters&&(He=Lt[d].minionEncounters,u.minionEncounters=JSON.parse(JSON.stringify(He)),i()),0===Oe.length&&null!==(m=Lt[d])&&void 0!==m&&m.trapEncounters&&(Oe=Lt[d].trapEncounters,u.trapEncounters=JSON.parse(JSON.stringify(Oe)),i()),function(e){const t=document.getElementById("mazemaster_maze_encounters_list");if(!t)return;const a=un();if(0===e.length)return void(t.innerHTML='<div class="mazemaster-empty-state" style="font-size: 0.85em;">No encounters. Minions will be randomly placed in the maze.</div>');t.innerHTML=e.map(((e,t)=>{pn(e.minionId);return'\n            <div class="mazemaster-encounter-row" data-index="'.concat(t,'">\n                <select class="encounter-minion-select">\n                    ').concat(a.map((t=>{const a=pn(t);return'<option value="'.concat(Or(t),'" ').concat(e.minionId===t?"selected":"",">").concat(Or((null==a?void 0:a.name)||t),"</option>")})).join(""),'\n                </select>\n                <input type="number" class="encounter-percent-input" min="1" max="100" value="').concat(e.percent||5,'" placeholder="%">\n                <span class="encounter-percent-label">%</span>\n                <button class="menu_button menu_button_icon encounter-remove-btn" title="Remove">\n                    <i class="fa-solid fa-trash"></i>\n                </button>\n            </div>\n        ')})).join(""),t.querySelectorAll(".mazemaster-encounter-row").forEach((e=>{var t,a,n;parseInt(e.dataset.index);null===(t=e.querySelector(".encounter-minion-select"))||void 0===t||t.addEventListener("change",(()=>{})),null===(a=e.querySelector(".encounter-percent-input"))||void 0===a||a.addEventListener("change",(()=>{})),null===(n=e.querySelector(".encounter-remove-btn"))||void 0===n||n.addEventListener("click",(()=>{e.remove()}))}))}(He),function(e){const t=document.getElementById("mazemaster_maze_traps_list");if(!t)return;const a=gn();if(0===e.length)return void(t.innerHTML='<div class="mazemaster-empty-state" style="font-size: 0.85em;">No traps. Add traps to place trap tiles in the maze.</div>');t.innerHTML=e.map(((e,t)=>{fn(e.trapId);return'\n            <div class="mazemaster-encounter-row mazemaster-trap-encounter-row" data-index="'.concat(t,'">\n                <select class="trap-encounter-select">\n                    ').concat(a.map((t=>{const a=fn(t);return'<option value="'.concat(Or(t),'" ').concat(e.trapId===t?"selected":"",">").concat(Or((null==a?void 0:a.name)||t),"</option>")})).join(""),'\n                </select>\n                <input type="number" class="trap-encounter-percent-input" min="1" max="100" value="').concat(e.percent||5,'" placeholder="%">\n                <span class="encounter-percent-label">%</span>\n                <button class="menu_button menu_button_icon trap-encounter-remove-btn" title="Remove">\n                    <i class="fa-solid fa-trash"></i>\n                </button>\n            </div>\n        ')})).join(""),t.querySelectorAll(".mazemaster-trap-encounter-row").forEach((e=>{var t;null===(t=e.querySelector(".trap-encounter-remove-btn"))||void 0===t||t.addEventListener("click",(()=>{e.remove()}))}))}(Oe),function(e){const t=document.getElementById("mazemaster_maze_quests_list");if(!t)return;const a=Ct(),n=Object.keys(a);if(!e||0===e.length)return void(t.innerHTML='<div class="mazemaster-empty-state" style="font-size: 0.85em;">No quests. Quests from the pool will be offered to players.</div>');t.innerHTML=e.map(((e,t)=>{kt(e.questId);return'\n            <div class="mazemaster-encounter-row mazemaster-quest-pool-row" data-index="'.concat(t,'">\n                <select class="quest-pool-select">\n                    <option value="">Select Quest</option>\n                    ').concat(n.map((t=>{const n=a[t];return'<option value="'.concat(Or(t),'" ').concat(e.questId===t?"selected":"",">").concat(Or((null==n?void 0:n.name)||t),"</option>")})).join(""),'\n                </select>\n                <input type="number" class="quest-pool-chance-input" min="1" max="100" value="').concat(e.chance||50,'" placeholder="%">\n                <span class="encounter-percent-label">%</span>\n                <button class="menu_button menu_button_icon quest-pool-remove-btn" title="Remove">\n                    <i class="fa-solid fa-trash"></i>\n                </button>\n            </div>\n        ')})).join(""),t.querySelectorAll(".mazemaster-quest-pool-row").forEach((e=>{var t;null===(t=e.querySelector(".quest-pool-remove-btn"))||void 0===t||t.addEventListener("click",(()=>{e.remove()}))}))}(Fe);const We=u.findEarly||{},Ye=document.getElementById("mazemaster_findearly_radius");Ye&&(Ye.value=We.radius||4);const Ue=document.getElementById("mazemaster_findearly_perchest");Ue&&(Ue.value=We.itemsPerChest||1);const Ge=We.items||[],je=Qe();for(const e of je){const t=document.getElementById("mazemaster_findearly_".concat(e));t&&(t.checked=Ge.includes(e))}const Ke=u.itemPool||{},Ve=document.getElementById("mazemaster_itempool_enabled"),Xe=document.getElementById("mazemaster_itempool_items");Ve&&(Ve.checked=Ke.enabled||!1),Xe&&(Xe.style.display=Ke.enabled?"block":"none");const Je=Ke.items||[];document.querySelectorAll("#mazemaster_itempool_items input[data-pool-item]").forEach((e=>{e.checked=Je.includes(e.dataset.poolItem)})),Fa()}function Yr(e,t){const a=document.getElementById("mazemaster_exit_profile_section"),n=document.getElementById("mazemaster_maze_exit_profile");if(!a||!n)return;if("messenger"===e)return void(a.style.display="none");a.style.display="block";let o=[];switch(e){case"battlebar":o=aa(),0===o.length&&(o=Object.keys(Ne));break;case"prizewheel":o=ea(),0===o.length&&(o=Object.keys(Re));break;case"turnbased":o=ia(),0===o.length&&(o=Object.keys(He));break;case"qte":o=la(),0===o.length&&(o=Object.keys(Oe));break;case"dice":o=da(),0===o.length&&(o=Object.keys(Fe));break;case"stealth":o=ha(),0===o.length&&(o=Object.keys(We));break;case"puzzle":o=ya(),0===o.length&&(o=Object.keys(Ye));break;case"negotiation":o=za(),0===o.length&&(o=Object.keys(Ue))}n.innerHTML='<option value="">Select...</option>'+o.map((e=>'<option value="'.concat(Or(e),'" ').concat(e===t?"selected":"",">").concat(Or(e),"</option>"))).join("")}function Ur(){var e,t,a,n,o,i,r,s,l,c,m,d,u,p,h,g,f,y,v,b,z,_,x,k,C,w,E,S,T,I,M,P,D,A,B,L,q,R,N,H,O,F,W,Y,U,G,j,K,V,X,Q,J,Z,$,ee,te,ae,ne,oe,ie,re,se,le,ce,me,de,ue,pe,he,ge,fe,ye,ve,be,ze,_e,xe,ke,Ce,we,Ee,Se,Te,Ie,Me,Pe,De,Ae,Be,Le,qe,Re,Ne,He,Oe,Fe,We,Ye,Ue,Ge,je,Ke;const Ve=Da(null===(e=document.getElementById("mazemaster_maze_profile_select"))||void 0===e?void 0:e.value)||{},Xe=document.querySelectorAll("#mazemaster_maze_encounters_list .mazemaster-encounter-row"),Qe=[];Xe.forEach((e=>{var t,a;const n=null===(t=e.querySelector(".encounter-minion-select"))||void 0===t?void 0:t.value,o=parseInt(null===(a=e.querySelector(".encounter-percent-input"))||void 0===a?void 0:a.value)||5;n&&Qe.push({minionId:n,percent:o})}));const Je=document.querySelectorAll("#mazemaster_maze_traps_list .mazemaster-trap-encounter-row"),Ze=[];Je.forEach((e=>{var t,a;const n=null===(t=e.querySelector(".trap-encounter-select"))||void 0===t?void 0:t.value,o=parseInt(null===(a=e.querySelector(".trap-encounter-percent-input"))||void 0===a?void 0:a.value)||5;n&&Ze.push({trapId:n,percent:o})}));const $e=document.querySelectorAll("#mazemaster_maze_quests_list .mazemaster-quest-pool-row"),et=[];$e.forEach((e=>{var t,a;const n=null===(t=e.querySelector(".quest-pool-select"))||void 0===t?void 0:t.value,o=parseInt(null===(a=e.querySelector(".quest-pool-chance-input"))||void 0===a?void 0:a.value)||50;n&&et.push({questId:n,chance:o})}));const tt=((null===(t=document.getElementById("mazemaster_maze_random_messages"))||void 0===t?void 0:t.value)||"").split("\n").filter((e=>e.trim()));return{gridSize:parseInt(null===(a=document.getElementById("mazemaster_maze_size"))||void 0===a?void 0:a.value)||10,difficulty:(null===(n=document.getElementById("mazemaster_maze_difficulty"))||void 0===n?void 0:n.value)||"normal",theme:(null===(o=document.getElementById("mazemaster_maze_theme"))||void 0===o?void 0:o.value)||"fantasy",mapStyle:(null===(i=document.getElementById("mazemaster_maze_mapstyle"))||void 0===i?void 0:i.value)||"maze",floors:parseInt(null===(r=document.getElementById("mazemaster_maze_floors"))||void 0===r?void 0:r.value)||1,mapVisibility:(null===(s=document.querySelector('input[name="mazemaster_map_visibility"]:checked'))||void 0===s?void 0:s.value)||"fogOfWar",winCommand:(null===(l=document.getElementById("mazemaster_maze_win_cmd"))||void 0===l?void 0:l.value)||"",loseCommand:(null===(c=document.getElementById("mazemaster_maze_lose_cmd"))||void 0===c?void 0:c.value)||"",winMessage:(null===(m=document.getElementById("mazemaster_maze_win_message"))||void 0===m?void 0:m.value)||"",winImage:Ve.winImage||"",chestImage:Ve.chestImage||"",mainMinion:(null===(d=document.getElementById("mazemaster_maze_main_minion"))||void 0===d?void 0:d.value)||"",mainMinionIntroMessage:(null===(u=document.getElementById("mazemaster_maze_intro_message"))||void 0===u?void 0:u.value)||"",mainMinionRandomChance:parseInt(null===(p=document.getElementById("mazemaster_maze_random_chance"))||void 0===p?void 0:p.value)||15,mainMinionRandomMessages:tt,mainMinionExitType:(null===(h=document.getElementById("mazemaster_maze_exit_type"))||void 0===h?void 0:h.value)||"messenger",mainMinionExitProfile:(null===(g=document.getElementById("mazemaster_maze_exit_profile"))||void 0===g?void 0:g.value)||"",minionEncounters:Qe,trapEncounters:Ze,questPool:et,onBattlebarLoss:(null===(f=document.getElementById("mazemaster_maze_loss_action"))||void 0===f?void 0:f.value)||"continue",chestTilePercent:parseInt(null===(y=document.getElementById("mazemaster_maze_chest_percent"))||void 0===y?void 0:y.value)||10,chestLockedPercent:parseInt(null===(v=document.getElementById("mazemaster_maze_locked_percent"))||void 0===v?void 0:v.value)||30,chestLockedBonusPercent:parseInt(null===(b=document.getElementById("mazemaster_maze_locked_bonus"))||void 0===b?void 0:b.value)||50,chestMimicPercent:parseInt(null===(z=document.getElementById("mazemaster_maze_mimic_percent"))||void 0===z?void 0:z.value)||15,chestLootMin:parseInt(null===(_=document.getElementById("mazemaster_maze_loot_min"))||void 0===_?void 0:_.value)||1,chestLootMax:parseInt(null===(x=document.getElementById("mazemaster_maze_loot_max"))||void 0===x?void 0:x.value)||2,chestKeyChance:parseInt(null===(k=document.getElementById("mazemaster_maze_chest_key"))||void 0===k?void 0:k.value)||30,chestStrikeChance:parseInt(null===(C=document.getElementById("mazemaster_maze_chest_pow"))||void 0===C?void 0:C.value)||50,chestStealthChance:parseInt(null===(w=document.getElementById("mazemaster_maze_chest_stealth"))||void 0===w?void 0:w.value)||0,chestExecuteChance:parseInt(null===(E=document.getElementById("mazemaster_maze_chest_execute"))||void 0===E?void 0:E.value)||0,lockedChestKeyChance:parseInt(null===(S=document.getElementById("mazemaster_maze_locked_key"))||void 0===S?void 0:S.value)||40,lockedChestStrikeChance:parseInt(null===(T=document.getElementById("mazemaster_maze_locked_pow"))||void 0===T?void 0:T.value)||60,lockedChestStealthChance:parseInt(null===(I=document.getElementById("mazemaster_maze_locked_stealth"))||void 0===I?void 0:I.value)||30,lockedChestExecuteChance:parseInt(null===(M=document.getElementById("mazemaster_maze_locked_execute"))||void 0===M?void 0:M.value)||5,startingInventory:{key:parseInt(null===(P=document.getElementById("mazemaster_start_key"))||void 0===P?void 0:P.value)||0,floorKey:parseInt(null===(D=document.getElementById("mazemaster_start_floorKey"))||void 0===D?void 0:D.value)||0,strike:parseInt(null===(A=document.getElementById("mazemaster_start_strike"))||void 0===A?void 0:A.value)||0,stealth:parseInt(null===(B=document.getElementById("mazemaster_start_stealth"))||void 0===B?void 0:B.value)||0,execute:parseInt(null===(L=document.getElementById("mazemaster_start_execute"))||void 0===L?void 0:L.value)||0,minionBane:parseInt(null===(q=document.getElementById("mazemaster_start_minionBane"))||void 0===q?void 0:q.value)||0,portalStone:parseInt(null===(R=document.getElementById("mazemaster_start_portalStone"))||void 0===R?void 0:R.value)||0,mapFragment:parseInt(null===(N=document.getElementById("mazemaster_start_mapFragment"))||void 0===N?void 0:N.value)||0,voidWalk:parseInt(null===(H=document.getElementById("mazemaster_start_voidWalk"))||void 0===H?void 0:H.value)||0,timeShard:parseInt(null===(O=document.getElementById("mazemaster_start_timeShard"))||void 0===O?void 0:O.value)||0,healingPotion:parseInt(null===(F=document.getElementById("mazemaster_start_healingPotion"))||void 0===F?void 0:F.value)||0,greaterHealing:parseInt(null===(W=document.getElementById("mazemaster_start_greaterHealing"))||void 0===W?void 0:W.value)||0,elixir:parseInt(null===(Y=document.getElementById("mazemaster_start_elixir"))||void 0===Y?void 0:Y.value)||0,revivalCharm:parseInt(null===(U=document.getElementById("mazemaster_start_revivalCharm"))||void 0===U?void 0:U.value)||0,heartCrystal:parseInt(null===(G=document.getElementById("mazemaster_start_heartCrystal"))||void 0===G?void 0:G.value)||0,torch:parseInt(null===(j=document.getElementById("mazemaster_start_torch"))||void 0===j?void 0:j.value)||0,lantern:parseInt(null===(K=document.getElementById("mazemaster_start_lantern"))||void 0===K?void 0:K.value)||0,revealScroll:parseInt(null===(V=document.getElementById("mazemaster_start_revealScroll"))||void 0===V?void 0:V.value)||0,sightPotion:parseInt(null===(X=document.getElementById("mazemaster_start_sightPotion"))||void 0===X?void 0:X.value)||0,crystalBall:parseInt(null===(Q=document.getElementById("mazemaster_start_crystalBall"))||void 0===Q?void 0:Q.value)||0,weapon_rusty_sword:parseInt(null===(J=document.getElementById("mazemaster_start_weapon_rusty_sword"))||void 0===J?void 0:J.value)||0,weapon_iron_sword:parseInt(null===(Z=document.getElementById("mazemaster_start_weapon_iron_sword"))||void 0===Z?void 0:Z.value)||0,weapon_steel_blade:parseInt(null===($=document.getElementById("mazemaster_start_weapon_steel_blade"))||void 0===$?void 0:$.value)||0,weapon_enchanted_blade:parseInt(null===(ee=document.getElementById("mazemaster_start_weapon_enchanted_blade"))||void 0===ee?void 0:ee.value)||0,weapon_shadow_dagger:parseInt(null===(te=document.getElementById("mazemaster_start_weapon_shadow_dagger"))||void 0===te?void 0:te.value)||0,armor_leather:parseInt(null===(ae=document.getElementById("mazemaster_start_armor_leather"))||void 0===ae?void 0:ae.value)||0,armor_chainmail:parseInt(null===(ne=document.getElementById("mazemaster_start_armor_chainmail"))||void 0===ne?void 0:ne.value)||0,armor_plate:parseInt(null===(oe=document.getElementById("mazemaster_start_armor_plate"))||void 0===oe?void 0:oe.value)||0,ironGuard:parseInt(null===(ie=document.getElementById("mazemaster_start_ironGuard"))||void 0===ie?void 0:ie.value)||0,accessory_ring_power:parseInt(null===(re=document.getElementById("mazemaster_start_accessory_ring_power"))||void 0===re?void 0:re.value)||0,accessory_amulet_protection:parseInt(null===(se=document.getElementById("mazemaster_start_accessory_amulet_protection"))||void 0===se?void 0:se.value)||0,accessory_lucky_charm:parseInt(null===(le=document.getElementById("mazemaster_start_accessory_lucky_charm"))||void 0===le?void 0:le.value)||0,accessory_vampiric_pendant:parseInt(null===(ce=document.getElementById("mazemaster_start_accessory_vampiric_pendant"))||void 0===ce?void 0:ce.value)||0},hpEnabled:!1!==(null===(me=document.getElementById("mazemaster_hp_enabled"))||void 0===me?void 0:me.checked),maxHP:parseInt(null===(de=document.getElementById("mazemaster_hp_max"))||void 0===de?void 0:de.value)||100,battlebarDamageMultiplier:parseFloat(null===(ue=document.getElementById("mazemaster_hp_battlebar_mult"))||void 0===ue?void 0:ue.value)||1,battlebarDifficultyMultiplier:parseFloat(null===(pe=document.getElementById("mazemaster_hp_battlebar_diff"))||void 0===pe?void 0:pe.value)||1,respawnHPPercent:parseInt(null===(he=document.getElementById("mazemaster_hp_respawn"))||void 0===he?void 0:he.value)||50,onDeath:(null===(ge=document.getElementById("mazemaster_hp_ondeath"))||void 0===ge?void 0:ge.value)||"respawn",safeRoomCount:null!==(fe=parseInt(null===(ye=document.getElementById("mazemaster_saferoom_count"))||void 0===ye?void 0:ye.value))&&void 0!==fe?fe:3,safeRoomHealPercent:null!==(ve=parseInt(null===(be=document.getElementById("mazemaster_saferoom_heal"))||void 0===be?void 0:be.value))&&void 0!==ve?ve:100,safeRoomUseLLM:(null===(ze=document.getElementById("mazemaster_saferoom_llm"))||void 0===ze?void 0:ze.checked)||!1,llmEnhanceRooms:!1!==(null===(_e=document.getElementById("mazemaster_llm_enhance_rooms"))||void 0===_e?void 0:_e.checked),restEnabled:!1!==(null===(xe=document.getElementById("mazemaster_rest_enabled"))||void 0===xe?void 0:xe.checked),restHealPercent:null!==(ke=parseInt(null===(Ce=document.getElementById("mazemaster_rest_heal"))||void 0===Ce?void 0:Ce.value))&&void 0!==ke?ke:20,restCooldown:null!==(we=parseInt(null===(Ee=document.getElementById("mazemaster_rest_cooldown"))||void 0===Ee?void 0:Ee.value))&&void 0!==we?we:3,restInterruptChance:null!==(Se=parseInt(null===(Te=document.getElementById("mazemaster_rest_interrupt"))||void 0===Te?void 0:Te.value))&&void 0!==Se?Se:0,restInterruptScript:(null===(Ie=document.getElementById("mazemaster_rest_interrupt_script"))||void 0===Ie?void 0:Ie.value)||"",portals:Kr(),bspConfig:{zoneCount:parseInt(null===(Me=document.getElementById("mazemaster_bsp_zone_count"))||void 0===Me?void 0:Me.value)||1,secretDensity:parseFloat(null===(Pe=document.getElementById("mazemaster_bsp_secret_density"))||void 0===Pe?void 0:Pe.value)||0,zonesRequireClear:!1!==(null===(De=document.getElementById("mazemaster_bsp_zones_require_clear"))||void 0===De?void 0:De.checked),secretHints:!1!==(null===(Ae=document.getElementById("mazemaster_bsp_secret_hints"))||void 0===Ae?void 0:Ae.checked),floorComplexityScaling:!1!==(null===(Be=document.getElementById("mazemaster_bsp_floor_scaling"))||void 0===Be?void 0:Be.checked)},objectives:Vr(),onMove:(null===(Le=document.getElementById("mazemaster_hook_onMove"))||void 0===Le?void 0:Le.value)||"",onMilestone:(null===(qe=document.getElementById("mazemaster_hook_onMilestone"))||void 0===qe?void 0:qe.value)||"",onExploreComplete:(null===(Re=document.getElementById("mazemaster_hook_onExploreComplete"))||void 0===Re?void 0:Re.value)||"",onItemAdd:(null===(Ne=document.getElementById("mazemaster_hook_onItemAdd"))||void 0===Ne?void 0:Ne.value)||"",onItemRemove:(null===(He=document.getElementById("mazemaster_hook_onItemRemove"))||void 0===He?void 0:He.value)||"",onChestOpen:(null===(Oe=document.getElementById("mazemaster_hook_onChestOpen"))||void 0===Oe?void 0:Oe.value)||"",onTrade:(null===(Fe=document.getElementById("mazemaster_hook_onTrade"))||void 0===Fe?void 0:Fe.value)||"",onEnemyMove:(null===(We=document.getElementById("mazemaster_hook_onEnemyMove"))||void 0===We?void 0:We.value)||"",onTeleport:(null===(Ye=document.getElementById("mazemaster_hook_onTeleport"))||void 0===Ye?void 0:Ye.value)||"",onObjectiveProgress:(null===(Ue=document.getElementById("mazemaster_hook_onObjectiveProgress"))||void 0===Ue?void 0:Ue.value)||"",onObjectiveComplete:(null===(Ge=document.getElementById("mazemaster_hook_onObjectiveComplete"))||void 0===Ge?void 0:Ge.value)||"",onAllObjectivesComplete:(null===(je=document.getElementById("mazemaster_hook_onAllObjectivesComplete"))||void 0===je?void 0:je.value)||"",onStatUpdate:(null===(Ke=document.getElementById("mazemaster_hook_onStatUpdate"))||void 0===Ke?void 0:Ke.value)||"",storyConfig:Ve.storyConfig||{mainStory:"",milestones:[]},findEarly:Gr(),itemPool:jr()}}function Gr(){var e,t;const a=parseInt(null===(e=document.getElementById("mazemaster_findearly_radius"))||void 0===e?void 0:e.value)||4,n=parseInt(null===(t=document.getElementById("mazemaster_findearly_perchest"))||void 0===t?void 0:t.value)||1,o=[],i=Qe();for(const e of i){const t=document.getElementById("mazemaster_findearly_".concat(e));null!=t&&t.checked&&o.push(e)}return 0===o.length?null:{radius:a,items:o,itemsPerChest:n}}function jr(){var e;const t=(null===(e=document.getElementById("mazemaster_itempool_enabled"))||void 0===e?void 0:e.checked)||!1,a=[];return document.querySelectorAll("#mazemaster_itempool_items input[data-pool-item]:checked").forEach((e=>{a.push(e.dataset.poolItem)})),{enabled:t,items:a}}function Kr(){const e=[];return document.querySelectorAll("#mazemaster_portals_list .mazemaster-portal-item").forEach((t=>{var a,n,o,i,r,s,l,c;const m=(null===(a=t.querySelector(".portal-id"))||void 0===a||null===(a=a.value)||void 0===a?void 0:a.trim())||"",d=(null===(n=t.querySelector(".portal-color-input"))||void 0===n?void 0:n.value)||"#9b59b6",u=null===(o=null===(i=t.querySelector(".portal-bidirectional"))||void 0===i?void 0:i.checked)||void 0===o||o,p=null===(r=t.querySelector(".portal-start-x"))||void 0===r?void 0:r.value,h=null===(s=t.querySelector(".portal-start-y"))||void 0===s?void 0:s.value,g=null===(l=t.querySelector(".portal-end-x"))||void 0===l?void 0:l.value,f=null===(c=t.querySelector(".portal-end-y"))||void 0===c?void 0:c.value;e.push({id:m||"portal_".concat(e.length+1),color:d,bidirectional:u,startX:""!==p?parseInt(p):null,startY:""!==h?parseInt(h):null,endX:""!==g?parseInt(g):null,endY:""!==f?parseInt(f):null})})),e}function Vr(){const e=[];return document.querySelectorAll("#mazemaster_objectives_list .mazemaster-objective-item").forEach(((t,a)=>{var n,o,i,r,s,l,c,m;const d=(null===(n=t.querySelector(".objective-id"))||void 0===n||null===(n=n.value)||void 0===n?void 0:n.trim())||"obj_".concat(a+1),u=(null===(o=t.querySelector(".objective-type"))||void 0===o?void 0:o.value)||"collect",p=(null===(i=t.querySelector(".objective-target"))||void 0===i||null===(i=i.value)||void 0===i?void 0:i.trim())||"",h=parseInt(null===(r=t.querySelector(".objective-count"))||void 0===r?void 0:r.value)||1,g=(null===(s=t.querySelector(".objective-description"))||void 0===s||null===(s=s.value)||void 0===s?void 0:s.trim())||"",f=null===(l=null===(c=t.querySelector(".objective-required"))||void 0===c?void 0:c.checked)||void 0===l||l,y=(null===(m=t.querySelector(".objective-reward"))||void 0===m||null===(m=m.value)||void 0===m?void 0:m.trim())||"";e.push({id:d,type:u,target:"explore"===u?null:p,count:h,description:g||"".concat("collect"===u?"Collect":"defeat"===u?"Defeat":"Explore"," ").concat(h).concat("explore"===u?"%":" "+p),required:f,reward:y})})),e}async function Xr(e,t){let a;try{a=await async function(e){return new Promise(((t,a)=>{const n=new Image,o=URL.createObjectURL(e);n.onload=()=>{URL.revokeObjectURL(o);const i=Math.min(n.width,n.height),r=(n.width-i)/2,s=(n.height-i)/2,l=document.createElement("canvas");l.width=i,l.height=i,l.getContext("2d").drawImage(n,r,s,i,i,0,0,i,i),l.toBlob((e=>{e?t(e):a(new Error("Failed to create cropped image"))}),e.type||"image/png")},n.onerror=()=>{URL.revokeObjectURL(o),a(new Error("Failed to load image"))},n.src=o}))}(e)}catch(t){console.warn("[MazeMaster] Could not crop image, using original:",t),a=e}return new Promise(((n,o)=>{const i=new FileReader;i.onload=async a=>{try{const i=a.target.result.split(",")[1],r=e.name.split(".").pop().toLowerCase(),s=Date.now(),l="".concat(t,"_").concat(s),c=await fetch("/api/images/upload",{method:"POST",headers:d(),body:JSON.stringify({image:i,ch_name:"MazeMaster",filename:l,format:r})});if(c.ok)n("user/images/MazeMaster/".concat(l,".").concat(r));else{const e=await c.json().catch((()=>({})));o(new Error(e.error||"Upload failed"))}}catch(e){o(e)}},i.onerror=()=>o(new Error("Failed to read file")),i.readAsDataURL(a)}))}function Qr(){var e;const t=document.getElementById("mazemaster_minions_list");if(!t)return;const a=document.getElementById("mazemaster_minion_profile_select"),n=(null==a?void 0:a.value)||"";let o=un();if(n&&null!==(e=qt.minionProfiles)&&void 0!==e&&e[n]){const e=qt.minionProfiles[n];if(Array.isArray(e.minions))o=o.filter((t=>e.minions.includes(t)));else if("object"==typeof e&&!e.minions){const t=Object.keys(e);o=o.filter((e=>t.includes(e)))}}if(0===o.length){const e=n?'No minions in profile "'.concat(n,'". Select a different profile or add minions.'):"No minions. Add minions for use in the maze game.";return void(t.innerHTML='<div class="mazemaster-empty-state">'.concat(e,"</div>"))}const r=aa(),s=ea(),l=ia(),c=la(),m=da(),d=ha(),h=ya(),g=za();t.innerHTML=o.map((e=>{const t=pn(e);if(!t)return console.warn('[MazeMaster] Minion "'.concat(e,'" not found, skipping')),"";const a=t.type||"messenger",n=t.battlebarProfiles||[],o=t.wheelProfiles||[],i=t.turnbasedProfiles||[],u=t.qteProfiles||[],p=t.diceProfiles||[],f=t.stealthProfiles||[],y=t.puzzleProfiles||[],v=t.negotiationProfiles||[],b=t.messages||[],z=t.encounterScript||"",_=t.merchantItemCount||{min:1,max:3},x=t.merchantItemPool||"Common Goods",k=Object.keys(qt.merchantItemPools||Dt),C=t.movement||{type:"stationary",patrolRadius:3,chaseRange:5,speed:1};return'\n            <div class="mazemaster-minion-card" data-id="'.concat(Or(e),'">\n                <div class="minion-image">\n                    ').concat(t.imagePath?'<img src="'.concat(Or(It(t.imagePath)),'" alt="').concat(Or(t.name),'">'):"",'\n                </div>\n                <div class="minion-info">\n                    <div class="minion-row">\n                        <input type="text" class="minion-name-input" value="').concat(Or(t.name),'" placeholder="Minion name">\n                        <select class="minion-type-select">\n                            <option value="messenger" ').concat("messenger"===a?"selected":"",'>Messenger</option>\n                            <option value="battlebar" ').concat("battlebar"===a?"selected":"",'>Battlebar</option>\n                            <option value="prizewheel" ').concat("prizewheel"===a?"selected":"",'>PrizeWheel</option>\n                            <option value="merchant" ').concat("merchant"===a?"selected":"",'>Merchant</option>\n                            <option value="turnbased" ').concat("turnbased"===a?"selected":"",'>Turn-Based Combat</option>\n                            <option value="qte" ').concat("qte"===a?"selected":"",'>QTE Combat</option>\n                            <option value="dice" ').concat("dice"===a?"selected":"",'>Dice Combat</option>\n                            <option value="stealth" ').concat("stealth"===a?"selected":"",'>Stealth</option>\n                            <option value="puzzle" ').concat("puzzle"===a?"selected":"",'>Puzzle</option>\n                            <option value="negotiation" ').concat("negotiation"===a?"selected":"",'>Negotiation</option>\n                        </select>\n                    </div>\n                    <div class="minion-profiles battlebar-profiles" style="display: ').concat("battlebar"===a?"block":"none",';">\n                        <label>Battlebar Profiles:</label>\n                        <select multiple class="minion-battlebar-select">\n                            ').concat(r.map((e=>'<option value="'.concat(Or(e),'" ').concat(n.includes(e)?"selected":"",">").concat(Or(e),"</option>"))).join(""),'\n                        </select>\n                    </div>\n                    <div class="minion-profiles wheel-profiles" style="display: ').concat("prizewheel"===a?"block":"none",';">\n                        <label>Wheel Profiles:</label>\n                        <select multiple class="minion-wheel-select">\n                            ').concat(s.map((e=>'<option value="'.concat(Or(e),'" ').concat(o.includes(e)?"selected":"",">").concat(Or(e),"</option>"))).join(""),'\n                        </select>\n                    </div>\n                    <div class="minion-profiles messenger-messages" style="display: ').concat("messenger"===a?"block":"none",';">\n                        <label>Messages (one per line):</label>\n                        <textarea class="minion-messages-input" rows="2" placeholder="Hello traveler!&#10;Beware the maze...">').concat(Or(b.join("\n")),'</textarea>\n                    </div>\n                    <div class="minion-profiles merchant-settings" style="display: ').concat("merchant"===a?"block":"none",';">\n                        <label>Item Pool:</label>\n                        <select class="merchant-pool-select">\n                            ').concat(k.map((e=>'<option value="'.concat(Or(e),'" ').concat(x===e?"selected":"",">").concat(Or(e),"</option>"))).join(""),'\n                        </select>\n                        <label>Items Offered (random range):</label>\n                        <div class="merchant-range-row">\n                            <input type="number" class="merchant-min-input mazemaster-input-small" min="1" max="10" value="').concat(_.min,'">\n                            <span>to</span>\n                            <input type="number" class="merchant-max-input mazemaster-input-small" min="1" max="10" value="').concat(_.max,'">\n                            <span>items</span>\n                        </div>\n                    </div>\n                    <div class="minion-profiles turnbased-profiles" style="display: ').concat("turnbased"===a?"block":"none",';">\n                        <label>Turn-Based Profiles:</label>\n                        <select multiple class="minion-turnbased-select">\n                            ').concat(l.map((e=>'<option value="'.concat(Or(e),'" ').concat(i.includes(e)?"selected":"",">").concat(Or(e),"</option>"))).join(""),'\n                        </select>\n                    </div>\n                    <div class="minion-profiles qte-profiles" style="display: ').concat("qte"===a?"block":"none",';">\n                        <label>QTE Profiles:</label>\n                        <select multiple class="minion-qte-select">\n                            ').concat(c.map((e=>'<option value="'.concat(Or(e),'" ').concat(u.includes(e)?"selected":"",">").concat(Or(e),"</option>"))).join(""),'\n                        </select>\n                    </div>\n                    <div class="minion-profiles dice-profiles" style="display: ').concat("dice"===a?"block":"none",';">\n                        <label>Dice Profiles:</label>\n                        <select multiple class="minion-dice-select">\n                            ').concat(m.map((e=>'<option value="'.concat(Or(e),'" ').concat(p.includes(e)?"selected":"",">").concat(Or(e),"</option>"))).join(""),'\n                        </select>\n                    </div>\n                    <div class="minion-profiles stealth-profiles" style="display: ').concat("stealth"===a?"block":"none",';">\n                        <label>Stealth Profiles:</label>\n                        <select multiple class="minion-stealth-select">\n                            ').concat(d.map((e=>'<option value="'.concat(Or(e),'" ').concat(f.includes(e)?"selected":"",">").concat(Or(e),"</option>"))).join(""),'\n                        </select>\n                    </div>\n                    <div class="minion-profiles puzzle-profiles" style="display: ').concat("puzzle"===a?"block":"none",';">\n                        <label>Puzzle Profiles:</label>\n                        <select multiple class="minion-puzzle-select">\n                            ').concat(h.map((e=>'<option value="'.concat(Or(e),'" ').concat(y.includes(e)?"selected":"",">").concat(Or(e),"</option>"))).join(""),'\n                        </select>\n                    </div>\n                    <div class="minion-profiles negotiation-profiles" style="display: ').concat("negotiation"===a?"block":"none",';">\n                        <label>Negotiation Profiles:</label>\n                        <select multiple class="minion-negotiation-select">\n                            ').concat(g.map((e=>'<option value="'.concat(Or(e),'" ').concat(v.includes(e)?"selected":"",">").concat(Or(e),"</option>"))).join(""),'\n                        </select>\n                    </div>\n                    <div class="minion-encounter-script">\n                        <label>Encounter Script (STScript):</label>\n                        <textarea class="minion-script-input" rows="2" placeholder="/echo Custom action on encounter...">').concat(Or(z),'</textarea>\n                    </div>\n                    <div class="minion-movement-settings">\n                        <label>Maze Movement:</label>\n                        <div class="movement-row">\n                            <select class="minion-movement-type">\n                                <option value="stationary" ').concat("stationary"===C.type?"selected":"",'>Stationary</option>\n                                <option value="patrol" ').concat("patrol"===C.type?"selected":"",'>Patrol</option>\n                                <option value="chase" ').concat("chase"===C.type?"selected":"",'>Chase Player</option>\n                            </select>\n                        </div>\n                        <div class="movement-params" style="display: ').concat("stationary"!==C.type?"flex":"none",';">\n                            <div class="movement-param patrol-param" style="display: ').concat("patrol"===C.type?"flex":"none",';">\n                                <span>Radius:</span>\n                                <input type="number" class="minion-patrol-radius mazemaster-input-small" min="1" max="10" value="').concat(C.patrolRadius||3,'">\n                            </div>\n                            <div class="movement-param chase-param" style="display: ').concat("chase"===C.type?"flex":"none",';">\n                                <span>Range:</span>\n                                <input type="number" class="minion-chase-range mazemaster-input-small" min="1" max="20" value="').concat(C.chaseRange||5,'">\n                            </div>\n                            <div class="movement-param">\n                                <span>Speed:</span>\n                                <input type="number" class="minion-movement-speed mazemaster-input-small" min="1" max="5" value="').concat(C.speed||1,'" title="Moves every N player moves">\n                            </div>\n                        </div>\n                        <div class="enhanced-ai-settings" style="margin-top: 8px; display: ').concat("stationary"!==C.type?"block":"none",';">\n                            <label style="font-size: 0.85em; color: #888; margin-bottom: 4px;">Enhanced AI (v1.5.0):</label>\n                            <div class="enhanced-ai-toggles" style="display: flex; flex-wrap: wrap; gap: 8px;">\n                                <label class="checkbox-inline" style="display: flex; align-items: center; gap: 4px; cursor: pointer;">\n                                    <input type="checkbox" class="minion-enhanced-ai" ').concat(!1!==C.enhancedAI?"checked":"",'>\n                                    <span>Enhanced AI</span>\n                                </label>\n                                <label class="checkbox-inline" style="display: flex; align-items: center; gap: 4px; cursor: pointer;">\n                                    <input type="checkbox" class="minion-pathfinding" ').concat(!1!==C.usePathfinding?"checked":"",'>\n                                    <span>A* Pathfinding</span>\n                                </label>\n                                <label class="checkbox-inline" style="display: flex; align-items: center; gap: 4px; cursor: pointer;">\n                                    <input type="checkbox" class="minion-alert-pack" ').concat(!1!==C.alertPack?"checked":"",'>\n                                    <span>Alert Pack</span>\n                                </label>\n                            </div>\n                            <div class="enhanced-ai-params" style="display: flex; gap: 8px; margin-top: 4px;">\n                                <div class="movement-param">\n                                    <span>Detection:</span>\n                                    <input type="number" class="minion-detection-range mazemaster-input-small" min="1" max="10" value="').concat(C.detectionRange||3,'" title="Detection range in tiles">\n                                </div>\n                                <div class="movement-param">\n                                    <span>Chase Timeout:</span>\n                                    <input type="number" class="minion-chase-timeout mazemaster-input-small" min="1" max="20" value="').concat(C.chaseDuration||10,'" title="Turns before giving up chase">\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <button class="menu_button menu_button_icon minion-delete-btn" title="Delete Minion">\n                    <i class="fa-solid fa-trash"></i>\n                </button>\n            </div>\n        ')})).join(""),t.querySelectorAll(".mazemaster-minion-card").forEach((e=>{const t=e.dataset.id,a=e.querySelector(".minion-name-input");a&&a.addEventListener("change",(()=>{const e=pn(t);e&&(e.name=a.value.trim()||"Unknown",hn(t,e))}));const n=e.querySelector(".minion-type-select");n&&n.addEventListener("change",(()=>{const a=pn(t);if(a){a.type=n.value,hn(t,a);const o={battlebar:e.querySelector(".battlebar-profiles"),prizewheel:e.querySelector(".wheel-profiles"),messenger:e.querySelector(".messenger-messages"),merchant:e.querySelector(".merchant-settings"),turnbased:e.querySelector(".turnbased-profiles"),qte:e.querySelector(".qte-profiles"),dice:e.querySelector(".dice-profiles"),stealth:e.querySelector(".stealth-profiles"),puzzle:e.querySelector(".puzzle-profiles"),negotiation:e.querySelector(".negotiation-profiles")};for(const[e,t]of Object.entries(o))t&&(t.style.display=a.type===e?"block":"none")}}));const o=e.querySelector(".minion-battlebar-select");o&&o.addEventListener("change",(()=>{const e=pn(t);e&&(e.battlebarProfiles=Array.from(o.selectedOptions).map((e=>e.value)),hn(t,e))}));const r=e.querySelector(".minion-wheel-select");r&&r.addEventListener("change",(()=>{const e=pn(t);e&&(e.wheelProfiles=Array.from(r.selectedOptions).map((e=>e.value)),hn(t,e))}));const s=e.querySelector(".minion-turnbased-select");s&&s.addEventListener("change",(()=>{const e=pn(t);e&&(e.turnbasedProfiles=Array.from(s.selectedOptions).map((e=>e.value)),hn(t,e))}));const l=e.querySelector(".minion-qte-select");l&&l.addEventListener("change",(()=>{const e=pn(t);e&&(e.qteProfiles=Array.from(l.selectedOptions).map((e=>e.value)),hn(t,e))}));const c=e.querySelector(".minion-dice-select");c&&c.addEventListener("change",(()=>{const e=pn(t);e&&(e.diceProfiles=Array.from(c.selectedOptions).map((e=>e.value)),hn(t,e))}));const m=e.querySelector(".minion-stealth-select");m&&m.addEventListener("change",(()=>{const e=pn(t);e&&(e.stealthProfiles=Array.from(m.selectedOptions).map((e=>e.value)),hn(t,e))}));const d=e.querySelector(".minion-puzzle-select");d&&d.addEventListener("change",(()=>{const e=pn(t);e&&(e.puzzleProfiles=Array.from(d.selectedOptions).map((e=>e.value)),hn(t,e))}));const h=e.querySelector(".minion-negotiation-select");h&&h.addEventListener("change",(()=>{const e=pn(t);e&&(e.negotiationProfiles=Array.from(h.selectedOptions).map((e=>e.value)),hn(t,e))}));const g=e.querySelector(".minion-messages-input");g&&g.addEventListener("change",(()=>{const e=pn(t);e&&(e.messages=g.value.split("\n").filter((e=>e.trim())),hn(t,e))}));const f=e.querySelector(".merchant-pool-select"),y=e.querySelector(".merchant-min-input"),v=e.querySelector(".merchant-max-input");f&&f.addEventListener("change",(()=>{const e=pn(t);e&&(e.merchantItemPool=f.value,hn(t,e))})),y&&y.addEventListener("change",(()=>{const e=pn(t);e&&(e.merchantItemCount=e.merchantItemCount||{min:1,max:3},e.merchantItemCount.min=parseInt(y.value)||1,hn(t,e))})),v&&v.addEventListener("change",(()=>{const e=pn(t);e&&(e.merchantItemCount=e.merchantItemCount||{min:1,max:3},e.merchantItemCount.max=parseInt(v.value)||3,hn(t,e))}));const b=e.querySelector(".minion-script-input");b&&b.addEventListener("change",(()=>{const e=pn(t);e&&(e.encounterScript=b.value,hn(t,e))}));const z=e.querySelector(".minion-movement-type"),_=e.querySelector(".movement-params"),x=e.querySelector(".patrol-param"),k=e.querySelector(".chase-param"),C=e.querySelector(".minion-patrol-radius"),w=e.querySelector(".minion-chase-range"),E=e.querySelector(".minion-movement-speed"),S=e.querySelector(".enhanced-ai-settings");z&&z.addEventListener("change",(()=>{const e=pn(t);e&&(e.movement=e.movement||{type:"stationary",patrolRadius:3,chaseRange:5,speed:1},e.movement.type=z.value,hn(t,e),_&&(_.style.display="stationary"!==z.value?"flex":"none"),x&&(x.style.display="patrol"===z.value?"flex":"none"),k&&(k.style.display="chase"===z.value?"flex":"none"),S&&(S.style.display="stationary"!==z.value?"block":"none"))})),C&&C.addEventListener("change",(()=>{const e=pn(t);e&&(e.movement=e.movement||{type:"patrol",patrolRadius:3,chaseRange:5,speed:1},e.movement.patrolRadius=parseInt(C.value)||3,hn(t,e))})),w&&w.addEventListener("change",(()=>{const e=pn(t);e&&(e.movement=e.movement||{type:"chase",patrolRadius:3,chaseRange:5,speed:1},e.movement.chaseRange=parseInt(w.value)||5,hn(t,e))})),E&&E.addEventListener("change",(()=>{const e=pn(t);e&&(e.movement=e.movement||{type:"stationary",patrolRadius:3,chaseRange:5,speed:1},e.movement.speed=parseInt(E.value)||1,hn(t,e))}));const T=e.querySelector(".minion-enhanced-ai"),I=e.querySelector(".minion-pathfinding"),M=e.querySelector(".minion-alert-pack"),P=e.querySelector(".minion-detection-range"),D=e.querySelector(".minion-chase-timeout");T&&T.addEventListener("change",(()=>{const e=pn(t);e&&(e.movement=e.movement||{},e.movement.enhancedAI=T.checked,hn(t,e))})),I&&I.addEventListener("change",(()=>{const e=pn(t);e&&(e.movement=e.movement||{},e.movement.usePathfinding=I.checked,hn(t,e))})),M&&M.addEventListener("change",(()=>{const e=pn(t);e&&(e.movement=e.movement||{},e.movement.alertPack=M.checked,hn(t,e))})),P&&P.addEventListener("change",(()=>{const e=pn(t);e&&(e.movement=e.movement||{},e.movement.detectionRange=parseInt(P.value)||3,hn(t,e))})),D&&D.addEventListener("change",(()=>{const e=pn(t);e&&(e.movement=e.movement||{},e.movement.chaseDuration=parseInt(D.value)||10,hn(t,e))}));const A=e.querySelector(".minion-image");A&&(A.style.cursor="pointer",A.title="Click to change image",A.addEventListener("click",(()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.style.display="none",document.body.appendChild(e),e.addEventListener("change",(async a=>{var n;const o=null===(n=a.target.files)||void 0===n?void 0:n[0];if(o){try{const e=await Xr(o,t),a=pn(t);a&&(a.imagePath=e,hn(t,a),Qr())}catch(e){console.error("[MazeMaster] Image upload failed:",e),alert("Image upload failed: ".concat(e.message))}document.body.removeChild(e)}else document.body.removeChild(e)})),e.click()})));const B=e.querySelector(".minion-delete-btn");B&&B.addEventListener("click",(async()=>{const e=pn(t);var a;await u('Delete minion "'.concat((null==e?void 0:e.name)||t,'"?'),p.CONFIRM)&&(a=t,delete qt.minions[a],i(),Qr())}))}))}function Jr(){const e=document.getElementById("mazemaster_traps_list");if(!e)return;const t=gn();0!==t.length?(e.innerHTML=t.map((e=>{var t;const a=fn(e),n=null!==(t=a.avoidChance)&&void 0!==t?t:0;return'\n            <div class="mazemaster-trap-card" data-id="'.concat(Or(e),'">\n                <div class="trap-image">\n                    ').concat(a.imagePath?'<img src="'.concat(Or(It(a.imagePath)),'" alt="').concat(Or(a.name),'">'):'<div class="trap-no-image"><i class="fa-solid fa-dungeon"></i></div>','\n                </div>\n                <div class="trap-info">\n                    <div class="trap-row">\n                        <input type="text" class="trap-name-input mazemaster-input" value="').concat(Or(a.name),'" placeholder="Trap name">\n                    </div>\n                    <div class="trap-message-row">\n                        <label>Message:</label>\n                        <textarea class="trap-message-input" rows="2" placeholder="You triggered a trap!">').concat(Or(a.message||""),'</textarea>\n                    </div>\n                    <div class="trap-script-row">\n                        <label>Script (STScript):</label>\n                        <textarea class="trap-script-input" rows="2" placeholder="/echo Trap triggered! | /mazedamage 25">').concat(Or(a.script||""),'</textarea>\n                    </div>\n                    <div class="trap-avoid-row" style="display: flex; gap: 8px; align-items: center; margin-top: 4px;">\n                        <label style="white-space: nowrap;">Avoid %:</label>\n                        <input type="number" class="trap-avoid-input mazemaster-input" value="').concat(n,'" min="0" max="100" style="width: 60px;">\n                        <input type="text" class="trap-avoid-message-input mazemaster-input" value="').concat(Or(a.avoidMessage||""),'" placeholder="Message when avoided" style="flex: 1;">\n                    </div>\n                    <div class="trap-avoid-script-row" style="margin-top: 4px;">\n                        <label>Avoid Script (STScript):</label>\n                        <textarea class="trap-avoid-script-input" rows="1" placeholder="/echo {{user}} dodged the trap!">').concat(Or(a.avoidScript||""),'</textarea>\n                    </div>\n                </div>\n                <button class="menu_button menu_button_icon trap-delete-btn" title="Delete Trap">\n                    <i class="fa-solid fa-trash"></i>\n                </button>\n            </div>\n        ')})).join(""),e.querySelectorAll(".mazemaster-trap-card").forEach((e=>{const t=e.dataset.id,a=e.querySelector(".trap-name-input");a&&a.addEventListener("change",(()=>{const e=fn(t);e&&(e.name=a.value.trim()||"Unknown Trap",yn(t,e))}));const n=e.querySelector(".trap-message-input");n&&n.addEventListener("change",(()=>{const e=fn(t);e&&(e.message=n.value,yn(t,e))}));const o=e.querySelector(".trap-script-input");o&&o.addEventListener("change",(()=>{const e=fn(t);e&&(e.script=o.value,yn(t,e))}));const r=e.querySelector(".trap-avoid-input");r&&r.addEventListener("change",(()=>{const e=fn(t);e&&(e.avoidChance=Math.max(0,Math.min(100,parseInt(r.value)||0)),yn(t,e))}));const s=e.querySelector(".trap-avoid-message-input");s&&s.addEventListener("change",(()=>{const e=fn(t);e&&(e.avoidMessage=s.value,yn(t,e))}));const l=e.querySelector(".trap-avoid-script-input");l&&l.addEventListener("change",(()=>{const e=fn(t);e&&(e.avoidScript=l.value,yn(t,e))}));const c=e.querySelector(".trap-image");c&&(c.style.cursor="pointer",c.title="Click to change image",c.addEventListener("click",(()=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.style.display="none",document.body.appendChild(e),e.addEventListener("change",(async a=>{var n;const o=null===(n=a.target.files)||void 0===n?void 0:n[0];if(o){try{const e=await Xr(o,t),a=fn(t);a&&(a.imagePath=e,yn(t,a),Jr())}catch(e){console.error("[MazeMaster] Image upload failed:",e),alert("Image upload failed: ".concat(e.message))}document.body.removeChild(e)}else document.body.removeChild(e)})),e.click()})));const m=e.querySelector(".trap-delete-btn");m&&m.addEventListener("click",(async()=>{const e=fn(t);var a;await u('Delete trap "'.concat((null==e?void 0:e.name)||t,'"?'),p.CONFIRM)&&(a=t,delete qt.traps[a],i(),Jr())}))}))):e.innerHTML='<div class="mazemaster-empty-state">No traps. Add traps for use in maze profiles.</div>'}function Zr(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;console.log("[MazeMaster] initUI called (attempt "+(e+1)+")");if(document.getElementById("mazemaster-button"))return console.log("[MazeMaster] Drawer already exists, skipping insertion"),os(),Hr(),Qr(),Jr(),Wr(),void("battlebar"===qt.activeGameConfig&&Fr());const t=document.getElementById("extensions-settings-button");if(!t)return e<10?(console.log("[MazeMaster] extensions-settings-button not found, retrying in 500ms..."),void setTimeout((()=>Zr(e+1)),500)):void console.error("[MazeMaster] extensions-settings-button NOT FOUND after 10 retries!");let a;try{a=Nr(),console.log("[MazeMaster] getPanelHtml succeeded")}catch(e){console.error("[MazeMaster] getPanelHtml FAILED:",e),a="<div>Error loading panel</div>"}const n=document.createElement("div");n.id="mazemaster-button",n.className="drawer",n.innerHTML='\n        <div class="drawer-toggle drawer-header">\n            <div class="drawer-icon fa-solid fa-dharmachakra fa-fw closedIcon" title="MazeMaster"></div>\n        </div>\n        <div id="mazemaster_drawer" class="drawer-content closedDrawer">\n            '.concat(a,"\n        </div>\n    "),t.after(n),console.log("[MazeMaster] Drawer inserted after extensions button");const o=n.querySelector(".drawer-toggle");if(o&&window.jQuery){const e=window.jQuery;e(o).on("click",(async function(){const t=e(this).find(".drawer-icon"),a=e(this).parent().find(".drawer-content");a.hasClass("openDrawer")||(e(".openDrawer:not(.pinnedOpen)").removeClass("openDrawer").addClass("closedDrawer"),e(".openIcon:not(.drawerPinnedOpen)").removeClass("openIcon").addClass("closedIcon")),t.toggleClass("openIcon closedIcon"),a.toggleClass("openDrawer closedDrawer")}))}os(),Hr(),Qr(),Jr(),Wr(),"battlebar"===qt.activeGameConfig&&Fr()}function $r(){var e;const t=document.getElementById("mazemaster_maze_chest_percent");t&&(t.value="15");const a=document.getElementById("mazemaster_maze_encounters_list"),n=(null==a?void 0:a.querySelectorAll(".mazemaster-encounter-row"))||[],o={messenger:10,prizewheel:6,battlebar:4,merchant:1};let i=0;const r=[];n.forEach((e=>{const t=e.getAttribute("data-minion-id");if(!t)return;const a=pn(t),n=(null==a?void 0:a.type)||"battlebar",s=o[n]||4;i+=s,r.push({row:e,type:n,weight:s})}));i>0&&r.forEach((e=>{let{row:t,weight:a}=e;const n=Math.round(a/i*60),o=t.querySelector(".encounter-percent-input");o&&(o.value=n)}));const s=document.getElementById("mazemaster_maze_traps_list"),l=(null==s?void 0:s.querySelectorAll(".mazemaster-encounter-row"))||[];if(l.length>0){const e=Math.floor(5/l.length);l.forEach((t=>{const a=t.querySelector(".encounter-percent-input");a&&(a.value=e||1)}))}const c=null===(e=document.getElementById("mazemaster_maze_profile_select"))||void 0===e?void 0:e.value;if(c){Aa(c,Ur()),loadMazeProfileSettings()}console.log("[MazeMaster] Intelligent Distribute applied: Chests 15%, Traps 5%, Minions distributed")}function es(){var e,a,n;if(!jt.isOpen||!jt.profileName)return console.warn("[MazeMaster] No active maze to save"),!1;const o={profileName:jt.profileName,size:jt.size,playerX:jt.playerX,playerY:jt.playerY,exitX:jt.exitX,exitY:jt.exitY,visited:Array.from(jt.visited),inventory:t({},jt.inventory),exitEncounterDone:jt.exitEncounterDone,shownMilestones:Array.from(jt.shownMilestones||[]),currentFloor:jt.currentFloor||0,totalFloors:jt.totalFloors||1,floors:(jt.floors||[jt.grid]).map((e=>e.map((e=>e.map((e=>({walls:e.walls,visited:e.visited,minion:e.minion,trap:e.trap,chest:e.chest,staircase:e.staircase,roomInfo:e.roomInfo,safeRoom:e.safeRoom}))))))),grid:jt.grid.map((e=>e.map((e=>({walls:e.walls,visited:e.visited,minion:e.minion,trap:e.trap,chest:e.chest,staircase:e.staircase,roomInfo:e.roomInfo,safeRoom:e.safeRoom}))))),messageLog:jt.messageLog||[],hpEnabled:jt.hpEnabled,hp:jt.hp?t({},jt.hp):null,restCooldown:jt.restCooldown||0,sessionNotes:jt.sessionNotes||"",fairness:jt.fairness||{},enhancedRooms:jt.enhancedRooms||{},equipment:jt.equipment?{weapon:(null===(e=jt.equipment.weapon)||void 0===e?void 0:e.id)||null,armor:(null===(a=jt.equipment.armor)||void 0===a?void 0:a.id)||null,accessory:(null===(n=jt.equipment.accessory)||void 0===n?void 0:n.id)||null}:null,equipmentInventory:jt.equipmentInventory||[],character:jt.character?{level:jt.character.level,xp:jt.character.xp,xpToNextLevel:jt.character.xpToNextLevel,skillPoints:jt.character.skillPoints,lastExplorationMilestone:jt.character.lastExplorationMilestone}:null,skills:jt.skills?{learned:t({},jt.skills.learned),cooldowns:t({},jt.skills.cooldowns),activeEffects:[...jt.skills.activeEffects],abilityBar:[...jt.skills.abilityBar]}:null,quests:jt.quests?{active:jt.quests.active.map((e=>({questId:e.questId,progress:e.progress,accepted:e.accepted}))),available:jt.quests.available.map((e=>({questId:e.questId,offered:e.offered}))),completed:[...jt.quests.completed],maxActive:jt.quests.maxActive}:null,timestamp:Date.now()};return qt.savedMazes[jt.profileName]=o,i(),console.log('[MazeMaster] Maze progress saved for "'.concat(jt.profileName,'"')),!0}function ts(e){var a,n,o,i,r,s,l,c,m,d,u,p,h,g,f;const y=null===(a=qt.savedMazes)||void 0===a?void 0:a[e];if(!y)return console.warn('[MazeMaster] No saved game for "'.concat(e,'"')),!1;const v=Da(e);if(!v)return console.error('[MazeMaster] Profile "'.concat(e,'" no longer exists')),!1;const b=y.totalFloors||1,z=y.currentFloor||0;let _;_=y.floors&&y.floors.length>0?y.floors.map((e=>e.map((e=>e.map((e=>({walls:e.walls,visited:e.visited,minion:e.minion,trap:e.trap,chest:e.chest,staircase:e.staircase,roomInfo:e.roomInfo,safeRoom:e.safeRoom}))))))):[y.grid.map((e=>e.map((e=>({walls:e.walls,visited:e.visited,minion:e.minion,trap:e.trap,chest:e.chest,staircase:e.staircase,roomInfo:e.roomInfo,safeRoom:e.safeRoom})))))];const x=_[z];let k={name:"The Maze",imagePath:"",message:"Find your way to the exit..."};const C=v.mainMinion?pn(v.mainMinion):null;if(C&&(k={name:C.name,imagePath:C.imagePath,message:"Continuing your journey..."}),jt={isOpen:!0,profile:v,profileName:e,grid:x,size:y.size,playerX:y.playerX,playerY:y.playerY,exitX:y.exitX,exitY:y.exitY,visited:new Set(y.visited),isVictory:!1,currentMinion:k,isPaused:!1,pendingEncounter:null,exitEncounterDone:y.exitEncounterDone,pendingConfirmation:null,pendingChest:null,inventory:t({key:0,stealth:0,strike:0,execute:0,floorKey:0,portalStone:0,minionBane:0,mapFragment:0,timeShard:0,voidWalk:0,healingPotion:0,greaterHealing:0,elixir:0,revivalCharm:0,heartCrystal:0},y.inventory),shownMilestones:new Set(y.shownMilestones||[]),currentFloor:z,totalFloors:b,floors:_,voidWalkActive:!1,messageLog:y.messageLog||[],hpEnabled:null!==(n=y.hpEnabled)&&void 0!==n?n:!1!==v.hpEnabled,hp:y.hp?{current:null!==(o=y.hp.current)&&void 0!==o?o:j(v).current,max:null!==(i=y.hp.max)&&void 0!==i?i:j(v).max,maxBonus:null!==(r=y.hp.maxBonus)&&void 0!==r?r:0,reviveCharges:null!==(s=y.hp.reviveCharges)&&void 0!==s?s:0}:j(v),restCooldown:y.restCooldown||0,sessionNotes:y.sessionNotes||"",fairness:y.fairness||{chestsWithoutKey:0,combatLossStreak:0,chestsWithoutHealing:0,lockedChestsSkipped:0,lastHealingFoundFloor:0},enhancedRooms:y.enhancedRooms||{},equipment:{weapon:null!==(l=y.equipment)&&void 0!==l&&l.weapon?Oi(y.equipment.weapon):null,armor:null!==(c=y.equipment)&&void 0!==c&&c.armor?Oi(y.equipment.armor):null,accessory:null!==(m=y.equipment)&&void 0!==m&&m.accessory?Oi(y.equipment.accessory):null},equipmentInventory:y.equipmentInventory||[],character:y.character?{level:null!==(d=y.character.level)&&void 0!==d?d:1,xp:null!==(u=y.character.xp)&&void 0!==u?u:0,xpToNextLevel:null!==(p=y.character.xpToNextLevel)&&void 0!==p?p:100,skillPoints:null!==(h=y.character.skillPoints)&&void 0!==h?h:0,lastExplorationMilestone:null!==(g=y.character.lastExplorationMilestone)&&void 0!==g?g:0}:{level:1,xp:0,xpToNextLevel:100,skillPoints:0,lastExplorationMilestone:0},skills:y.skills?{learned:t({},y.skills.learned||{}),cooldowns:t({},y.skills.cooldowns||{}),activeEffects:[...y.skills.activeEffects||[]],abilityBar:[...y.skills.abilityBar||[]]}:{learned:{},cooldowns:{},activeEffects:[],abilityBar:[]},quests:y.quests?{active:(y.quests.active||[]).map((e=>{var t;return{questId:e.questId,progress:e.progress||0,accepted:null===(t=e.accepted)||void 0===t||t}})),available:(y.quests.available||[]).map((e=>{var t;return{questId:e.questId,offered:null===(t=e.offered)||void 0===t||t}})),completed:[...y.quests.completed||[]],maxActive:null!==(f=y.quests.maxActive)&&void 0!==f?f:3}:{active:[],available:[],completed:[],maxActive:3}},jt.hp){const e=jt.hp.max+(jt.hp.maxBonus||0);jt.hp.current>e&&(console.log("[MazeMaster] Clamping HP from ".concat(jt.hp.current," to ").concat(e)),jt.hp.current=e)}return ki(),wi(),ze(!1),Ti(),Ii(),Ri(),Z(),J(),Wi(),ve(),fe(),document.addEventListener("keydown",Di,{capture:!0}),console.log('[MazeMaster] Loaded saved maze "'.concat(e,'" (floor ').concat(z+1,"/").concat(b,")")),!0}function as(e){var t;return!(null===(t=qt.savedMazes)||void 0===t||!t[e])&&(delete qt.savedMazes[e],i(),console.log('[MazeMaster] Deleted saved maze "'.concat(e,'"')),!0)}function ns(){const e=["mazemaster_saved_games_list","mazemaster_game_tab_saves"],t=Object.keys(qt.savedMazes||{});for(const a of e){const e=document.getElementById(a);e&&(0!==t.length?(e.innerHTML=t.map((e=>{const t=qt.savedMazes[e],a=new Date(t.timestamp),n=t.visited?Math.round(t.visited.length/(t.size*t.size)*100):0;return'\n                <div class="mazemaster-saved-game" data-profile="'.concat(Or(e),'">\n                    <div class="mazemaster-saved-game-info">\n                        <div class="mazemaster-saved-game-name">').concat(Or(e),'</div>\n                        <div class="mazemaster-saved-game-details">').concat(n,"% explored - ").concat(a.toLocaleDateString(),'</div>\n                    </div>\n                    <div class="mazemaster-saved-game-actions">\n                        <button class="menu_button menu_button_icon saved-game-load" title="Resume">\n                            <i class="fa-solid fa-play"></i>\n                        </button>\n                        <button class="menu_button menu_button_icon saved-game-delete" title="Delete">\n                            <i class="fa-solid fa-trash"></i>\n                        </button>\n                    </div>\n                </div>\n            ')})).join(""),e.querySelectorAll(".mazemaster-saved-game").forEach((e=>{var t,a;const n=e.dataset.profile;null===(t=e.querySelector(".saved-game-load"))||void 0===t||t.addEventListener("click",(()=>{ts(n)})),null===(a=e.querySelector(".saved-game-delete"))||void 0===a||a.addEventListener("click",(async()=>{await u('Delete saved game "'.concat(n,'"?'),p.CONFIRM)&&(as(n),ns())}))}))):e.innerHTML='<div class="mazemaster-no-saves">No saved games</div>')}}function os(){var e,a,n,o,r;const s=document.getElementById("mazemaster_profile_select");s&&s.addEventListener("change",(e=>{qt.currentProfile=e.target.value,i(),function(){var e;const t=ta(null===(e=document.getElementById("mazemaster_profile_select"))||void 0===e?void 0:e.value),a=document.getElementById("mazemaster_randomize");a&&(a.checked=(null==t?void 0:t.randomize)||!1);const n=document.getElementById("mazemaster_difficulty");n&&(n.value=(null==t?void 0:t.difficulty)||1)}(),Hr()}));const l=document.getElementById("mazemaster_new_profile_btn");l&&l.addEventListener("click",(async e=>{e.preventDefault(),e.stopPropagation();const t=await u("Enter new wheel profile name:",p.INPUT,"");if(t&&t.trim()){const e=t.trim();qt.profiles[e]?await u('Profile "'.concat(e,'" already exists.'),p.TEXT):(qt.profiles[e]={segments:[],randomize:!1,difficulty:1},qt.currentProfile=e,i(),is())}}));const c=document.getElementById("mazemaster_delete_profile_btn");c&&c.addEventListener("click",(async()=>{var e;const t=null===(e=document.getElementById("mazemaster_profile_select"))||void 0===e?void 0:e.value;if(t){await u('Delete wheel profile "'.concat(t,'"?'),p.CONFIRM)&&(!function(e){if(delete qt.profiles[e],qt.currentProfile===e){const e=ea();qt.currentProfile=e[0]||"Tutorial - Learn the Wheel"}i()}(t),is())}}));const h=document.getElementById("mazemaster_rename_profile_btn");h&&h.addEventListener("click",(async()=>{var e;const t=null===(e=document.getElementById("mazemaster_profile_select"))||void 0===e?void 0:e.value;if(!t)return void alert("No profile selected to rename");const a=await u("Enter new profile name:",p.INPUT,t);if(a&&a.trim()&&a.trim()!==t){const e=a.trim();if(qt.profiles[e])return void alert("A profile with that name already exists");qt.profiles[e]=qt.profiles[t],delete qt.profiles[t],qt.currentProfile=e,i(),is()}}));const f=document.getElementById("mazemaster_export_btn");f&&f.addEventListener("click",(()=>{var e;const t=null===(e=document.getElementById("mazemaster_profile_select"))||void 0===e?void 0:e.value;t?function(e){const t=ta(e);if(!t)return void alert('Profile "'.concat(e,'" not found'));const a={name:e,profile:t,exportedAt:(new Date).toISOString(),version:"1.0"},n=JSON.stringify(a,null,2),o=new Blob([n],{type:"application/json"}),i=URL.createObjectURL(o),r=document.createElement("a");r.href=i,r.download="mazemaster-".concat(e,".json"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),console.log('[MazeMaster] Exported profile "'.concat(e,'"'))}(t):alert("No profile selected to export")}));const y=document.getElementById("mazemaster_import_btn"),v=document.getElementById("mazemaster_import_file");y&&v&&(y.addEventListener("click",(()=>{v.click()})),v.addEventListener("change",(async e=>{var t;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){try{const e=await function(e){return new Promise(((t,a)=>{const n=new FileReader;n.onload=e=>{try{const n=JSON.parse(e.target.result);if(!n.profile||!n.name)return void a(new Error("Invalid profile format: missing name or profile data"));let o=n.name;if(qt.profiles[o]){const e=prompt('Profile "'.concat(o,'" already exists. Enter a new name:'),"".concat(o,"_imported"));if(!e||!e.trim())return void a(new Error("Import cancelled"));o=e.trim()}const r=n.profile;r.segments&&Array.isArray(r.segments)||(r.segments=[]),"boolean"!=typeof r.randomize&&(r.randomize=!1),("number"!=typeof r.difficulty||r.difficulty<1||r.difficulty>5)&&(r.difficulty=1),qt.profiles[o]=r,qt.currentProfile=o,i(),console.log('[MazeMaster] Imported profile "'.concat(o,'":'),r),t(o)}catch(e){a(new Error("Failed to parse JSON: ".concat(e.message)))}},n.onerror=()=>a(new Error("Failed to read file")),n.readAsText(e)}))}(a);alert('Profile "'.concat(e,'" imported successfully!')),is()}catch(e){alert("Import failed: ".concat(e.message))}v.value=""}})));const z=document.getElementById("mazemaster_add_segment_btn");z&&z.addEventListener("click",(()=>{const e=document.getElementById("mazemaster_segments_list");if(!e)return;const t=e.querySelector(".mazemaster-empty-state");t&&t.remove();const a=e.querySelectorAll(".mazemaster-segment-item").length,n=document.createElement("div");n.className="mazemaster-segment-item",n.dataset.index=a,n.innerHTML='\n                <div class="mazemaster-segment-row">\n                    <div class="mazemaster-segment-field small">\n                        <label>Trigger</label>\n                        <input type="text" class="seg-trigger" value="com'.concat(a+1,'" placeholder="com1">\n                    </div>\n                    <div class="mazemaster-segment-field">\n                        <label>Display Text</label>\n                        <input type="text" class="seg-text" value="" placeholder="Prize name">\n                    </div>\n                    <div class="mazemaster-segment-field small">\n                        <label>Size</label>\n                        <select class="seg-size">\n                            ').concat(b.map((e=>'<option value="'.concat(e,'" ').concat("fraction"===e?"selected":"",">").concat(e,"</option>"))).join(""),'\n                        </select>\n                    </div>\n                    <button class="menu_button menu_button_icon mazemaster-segment-delete" title="Delete">\n                        <i class="fa-solid fa-trash"></i>\n                    </button>\n                </div>\n                <div class="mazemaster-segment-row">\n                    <div class="mazemaster-segment-field">\n                        <label>STScript Command</label>\n                        <textarea class="seg-command" placeholder="/echo You won!"></textarea>\n                    </div>\n                    <div class="mazemaster-segment-field tiny">\n                        <label>&nbsp;</label>\n                        <label class="mazemaster-segment-checkbox">\n                            <input type="checkbox" class="seg-respin">\n                            Respin\n                        </label>\n                    </div>\n                </div>\n            '),n.querySelector(".mazemaster-segment-delete").addEventListener("click",(()=>{n.remove()})),e.appendChild(n)}));const _=document.getElementById("mazemaster_save_btn");_&&_.addEventListener("click",(()=>{var e,t,a;const n=null===(e=document.getElementById("mazemaster_profile_select"))||void 0===e?void 0:e.value;if(!n)return void alert("Please create a profile first");const o=function(){const e=document.querySelectorAll(".mazemaster-segment-item"),t=[];return e.forEach((e=>{const a=e.querySelector(".seg-trigger").value.trim(),n=e.querySelector(".seg-text").value.trim(),o=e.querySelector(".seg-command").value.trim(),i=e.querySelector(".seg-size").value,r=e.querySelector(".seg-respin").checked;(a||n)&&t.push({trigger:a,text:n,command:o,size:i,respin:r})})),t}(),r=(null===(t=document.getElementById("mazemaster_randomize"))||void 0===t?void 0:t.checked)||!1,s=parseInt(null===(a=document.getElementById("mazemaster_difficulty"))||void 0===a?void 0:a.value)||1;if(0===o.length)return void alert("Error: Wheel must have at least one segment");const l=o.filter((e=>"halfseg"===e.size)).length,c=o.filter((e=>"doubleseg"===e.size)).length;l===c?(!function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;qt.profiles[e]={segments:t,randomize:a,difficulty:n},i(),console.log("[MazeMaster] Profile saved:",e,qt.profiles[e])}(n,o,r,s),console.log('[MazeMaster] Saved profile "'.concat(n,'":'),{segments:o,randomize:r,difficulty:s}),alert('Profile "'.concat(n,'" saved!'))):alert("Error: Wheel unbalanced!\n\n".concat(l," halfseg(s)  ").concat(c," doubleseg(s)\n\nFor every halfseg, you need a doubleseg to balance the wheel."))}));const k=document.getElementById("mazemaster_preview_wheel_btn");k&&k.addEventListener("click",(()=>{var e;const t=null===(e=document.getElementById("mazemaster_profile_select"))||void 0===e?void 0:e.value;if(!t)return void alert("Please select or create a wheel profile first");const a=vn(t);if(a.error)return void alert("Error: ".concat(a.error));const n=bn();n.valid?xn():alert("Error: ".concat(n.error))}));const C=document.getElementById("mazemaster_preview_battlebar_btn");C&&C.addEventListener("click",(()=>{var e;const t=null===(e=document.getElementById("mazemaster_bb_profile_select"))||void 0===e?void 0:e.value;if(!t)return void alert("Please select or create a battlebar profile first");const a=Io(t);a.error&&alert("Error: ".concat(a.error))}));const w=document.getElementById("mazemaster_show_wheel"),S=document.getElementById("mazemaster_show_combat"),I=document.getElementById("mazemaster_show_maze"),M=document.getElementById("mazemaster_show_minions"),P=document.getElementById("mazemaster_show_traps"),D=document.getElementById("mazemaster_show_themes"),A=document.getElementById("mazemaster_show_styles"),B=document.getElementById("mazemaster_show_quests"),L=document.getElementById("mazemaster_show_items"),q=document.getElementById("mazemaster_show_factions"),N=document.getElementById("mazemaster_show_vision"),O=document.getElementById("mazemaster_show_sound"),F=document.getElementById("mazemaster_wheel_config"),W=document.getElementById("mazemaster_combat_config"),Y=document.getElementById("mazemaster_maze_config"),U=document.getElementById("mazemaster_minions_config"),j=document.getElementById("mazemaster_traps_config"),K=document.getElementById("mazemaster_themes_config"),V=document.getElementById("mazemaster_styles_config"),X=document.getElementById("mazemaster_quests_config"),Q=document.getElementById("mazemaster_items_config"),J=document.getElementById("mazemaster_factions_config"),Z=document.getElementById("mazemaster_vision_config"),$=document.getElementById("mazemaster_sound_config");function ee(e){"battlebar"===e&&(e="combat"),qt.activeGameConfig=e,i(),null==w||w.classList.toggle("active","wheel"===e),null==S||S.classList.toggle("active","combat"===e),null==I||I.classList.toggle("active","maze"===e),null==M||M.classList.toggle("active","minions"===e),null==P||P.classList.toggle("active","traps"===e),null==D||D.classList.toggle("active","themes"===e),null==A||A.classList.toggle("active","styles"===e),null==B||B.classList.toggle("active","quests"===e),null==L||L.classList.toggle("active","items"===e),null==q||q.classList.toggle("active","factions"===e),null==N||N.classList.toggle("active","vision"===e),null==O||O.classList.toggle("active","sound"===e),F&&(F.style.display="wheel"===e?"block":"none"),W&&(W.style.display="combat"===e?"block":"none"),Y&&(Y.style.display="maze"===e?"block":"none"),U&&(U.style.display="minions"===e?"block":"none"),j&&(j.style.display="traps"===e?"block":"none"),K&&(K.style.display="themes"===e?"block":"none"),V&&(V.style.display="styles"===e?"block":"none"),X&&(X.style.display="quests"===e?"block":"none"),Q&&(Q.style.display="items"===e?"block":"none"),J&&(J.style.display="factions"===e?"block":"none"),Z&&(Z.style.display="vision"===e?"block":"none"),$&&($.style.display="sound"===e?"block":"none"),"combat"===e&&Fr(),"minions"===e&&Qr(),"traps"===e&&Jr(),"themes"===e&&ln(),"styles"===e&&cn(),"quests"===e&&Na(),"items"===e&&(Oa(),Fa()),"factions"===e&&function(){var e;const t=document.getElementById("mazemaster_factions_list");if(!t)return;const a=null===(e=qt.factionProfiles)||void 0===e?void 0:e[qt.currentFactionProfile],n=(null==a?void 0:a.factions)||[];0!==n.length?t.innerHTML=n.map(((e,t)=>'\n        <div class="mazemaster-faction-card" data-index="'.concat(t,'" style="border-left: 3px solid ').concat(e.color||"#888",';">\n            <div class="mazemaster-faction-header">\n                <i class="fa-solid ').concat(e.icon||"fa-users",'"></i>\n                <span class="mazemaster-faction-name">').concat(Or(e.name),'</span>\n            </div>\n            <div class="mazemaster-faction-desc">').concat(Or(e.description||""),'</div>\n            <div class="mazemaster-faction-actions">\n                <button class="menu_button menu_button_icon mazemaster-faction-edit-btn" title="Edit">\n                    <i class="fa-solid fa-pen"></i>\n                </button>\n                <button class="menu_button menu_button_icon mazemaster-faction-delete-btn" title="Delete">\n                    <i class="fa-solid fa-trash"></i>\n                </button>\n            </div>\n        </div>\n    '))).join(""):t.innerHTML='<p style="color: #888; text-align: center;">No factions defined. Click "Add Faction" to create one.</p>'}(),"vision"===e&&function(){var e,t,a,n,o,i,r,s,l,c,m;const d=(null===(e=qt.visionProfiles)||void 0===e?void 0:e[qt.currentVisionProfile])||{},u=document.getElementById("mazemaster_vision_base"),p=document.getElementById("mazemaster_vision_torch"),h=document.getElementById("mazemaster_vision_torch_duration"),g=document.getElementById("mazemaster_vision_lantern"),f=document.getElementById("mazemaster_vision_dark"),y=document.getElementById("mazemaster_vision_dim"),v=document.getElementById("mazemaster_vision_bright");u&&(u.value=null!==(t=d.baseVisibility)&&void 0!==t?t:1),p&&(p.value=null!==(a=d.torchBonus)&&void 0!==a?a:2),h&&(h.value=null!==(n=d.torchDuration)&&void 0!==n?n:3),g&&(g.value=null!==(o=d.lanternBonus)&&void 0!==o?o:1),f&&(f.value=null!==(i=null===(r=d.ambientLevels)||void 0===r?void 0:r.dark)&&void 0!==i?i:-1),y&&(y.value=null!==(s=null===(l=d.ambientLevels)||void 0===l?void 0:l.dim)&&void 0!==s?s:0),v&&(v.value=null!==(c=null===(m=d.ambientLevels)||void 0===m?void 0:m.bright)&&void 0!==c?c:1)}(),"sound"===e&&function(){var e;const t=(null===(e=qt.soundProfiles)||void 0===e?void 0:e[qt.currentSoundProfile])||{},a=document.getElementById("mazemaster_sound_master"),n=document.getElementById("mazemaster_sound_master_value");if(a&&n){var o;const e=Math.round(100*(null!==(o=t.masterVolume)&&void 0!==o?o:.8));a.value=e,n.textContent="".concat(e,"%")}["combat","ui","ambient"].forEach((e=>{const a=document.getElementById("mazemaster_sound_".concat(e)),n=document.getElementById("mazemaster_sound_".concat(e,"_value"));if(a&&n){var o,i;const r=Math.round(100*(null!==(o=null===(i=t.categoryVolumes)||void 0===i?void 0:i[e])&&void 0!==o?o:.5));a.value=r,n.textContent="".concat(r,"%")}}));const i=document.getElementById("mazemaster_sound_enabled");i&&(i.checked=!1!==t.enabled)}()}w&&w.addEventListener("click",(()=>ee("wheel"))),S&&S.addEventListener("click",(()=>ee("combat"))),I&&I.addEventListener("click",(()=>ee("maze"))),M&&M.addEventListener("click",(()=>ee("minions"))),P&&P.addEventListener("click",(()=>ee("traps"))),D&&D.addEventListener("click",(()=>ee("themes"))),A&&A.addEventListener("click",(()=>ee("styles"))),B&&B.addEventListener("click",(()=>ee("quests"))),L&&L.addEventListener("click",(()=>ee("items"))),q&&q.addEventListener("click",(()=>ee("factions"))),N&&N.addEventListener("click",(()=>ee("vision"))),O&&O.addEventListener("click",(()=>ee("sound"))),document.querySelectorAll(".combat-subtab").forEach((e=>{e.addEventListener("click",(()=>{var t;document.querySelectorAll(".combat-subtab").forEach((e=>e.classList.remove("active"))),document.querySelectorAll(".combat-content").forEach((e=>e.classList.remove("active"))),e.classList.add("active");const a=e.dataset.combat;null===(t=document.getElementById("combat_".concat(a,"_content")))||void 0===t||t.classList.add("active"),"battlebar"===a&&Fr()}))})),document.querySelectorAll(".help-subtab").forEach((e=>{e.addEventListener("click",(()=>{var t;document.querySelectorAll(".help-subtab").forEach((e=>e.classList.remove("active"))),document.querySelectorAll(".help-content").forEach((e=>e.classList.remove("active"))),e.classList.add("active");const a=e.dataset.help;null===(t=document.getElementById("help_".concat(a,"_content")))||void 0===t||t.classList.add("active")}))}));const te=document.querySelectorAll(".mazemaster-tab"),ae=document.querySelectorAll(".mazemaster-tab-content");te.forEach((e=>{e.addEventListener("click",(()=>{const t=e.dataset.tab;te.forEach((t=>t.classList.toggle("active",t===e))),ae.forEach((e=>{const a=e.id==="mazemaster-tab-".concat(t);e.classList.toggle("active",a)}))}))}));const ne=document.getElementById("mazemaster_theme_profile_select");ne&&ne.addEventListener("change",(e=>{e.target.value?function(e){var t,a,n,o,i,r,s,l,c,m,d;const u=La(e);if(!u)return;const p=(e,t)=>{const a=document.getElementById(e);a&&(a.value=t||"")};p("mazemaster_theme_name",u.name),p("mazemaster_theme_display",u.displayName),p("mazemaster_theme_tags",(u.tags||[]).join(", ")),p("mazemaster_theme_atmosphere",u.atmosphere),p("mazemaster_theme_adjectives",(u.adjectives||[]).join(", ")),p("mazemaster_theme_rooms_small",((null===(t=u.roomTypes)||void 0===t?void 0:t.small)||[]).join(", ")),p("mazemaster_theme_rooms_medium",((null===(a=u.roomTypes)||void 0===a?void 0:a.medium)||[]).join(", ")),p("mazemaster_theme_rooms_large",((null===(n=u.roomTypes)||void 0===n?void 0:n.large)||[]).join(", ")),p("mazemaster_theme_rooms_special",((null===(o=u.roomTypes)||void 0===o?void 0:o.special)||[]).join(", ")),p("mazemaster_theme_flavor_chest",null===(i=u.flavorMessages)||void 0===i?void 0:i.chestFind),p("mazemaster_theme_flavor_trap",null===(r=u.flavorMessages)||void 0===r?void 0:r.trapTrigger),p("mazemaster_theme_flavor_victory",null===(s=u.flavorMessages)||void 0===s?void 0:s.victory),p("mazemaster_theme_flavor_defeat",null===(l=u.flavorMessages)||void 0===l?void 0:l.defeat),p("mazemaster_theme_color_primary",(null===(c=u.colors)||void 0===c?void 0:c.primary)||"#8b0000"),p("mazemaster_theme_color_secondary",(null===(m=u.colors)||void 0===m?void 0:m.secondary)||"#2d1f1f"),p("mazemaster_theme_color_accent",(null===(d=u.colors)||void 0===d?void 0:d.accent)||"#ff4444")}(e.target.value):mn()}));const oe=document.getElementById("mazemaster_theme_new_btn");oe&&oe.addEventListener("click",(()=>{mn(),ne&&(ne.value="")}));const ie=document.getElementById("mazemaster_theme_save_btn");ie&&ie.addEventListener("click",(()=>{const e=function(){const e=e=>{var t;return(null===(t=document.getElementById(e))||void 0===t?void 0:t.value)||""},t=t=>e(t).split(",").map((e=>e.trim())).filter(Boolean);return{name:e("mazemaster_theme_name"),displayName:e("mazemaster_theme_display"),tags:t("mazemaster_theme_tags"),atmosphere:e("mazemaster_theme_atmosphere"),adjectives:t("mazemaster_theme_adjectives"),roomTypes:{small:t("mazemaster_theme_rooms_small"),medium:t("mazemaster_theme_rooms_medium"),large:t("mazemaster_theme_rooms_large"),special:t("mazemaster_theme_rooms_special")},flavorMessages:{chestFind:e("mazemaster_theme_flavor_chest"),trapTrigger:e("mazemaster_theme_flavor_trap"),victory:e("mazemaster_theme_flavor_victory"),defeat:e("mazemaster_theme_flavor_defeat")},colors:{primary:e("mazemaster_theme_color_primary"),secondary:e("mazemaster_theme_color_secondary"),accent:e("mazemaster_theme_color_accent")}}}();var a,n,o,r,s,l,c,m,d,u,p,h,g;e.name?(a=e.name,n=e,qt.customThemes||(qt.customThemes={}),qt.customThemes[a]=t(t({},E),{},{name:n.name||a,displayName:n.displayName||a,tags:n.tags||[],atmosphere:n.atmosphere||"",adjectives:n.adjectives||[],roomTypes:{small:(null===(o=n.roomTypes)||void 0===o?void 0:o.small)||[],medium:(null===(r=n.roomTypes)||void 0===r?void 0:r.medium)||[],large:(null===(s=n.roomTypes)||void 0===s?void 0:s.large)||[],special:(null===(l=n.roomTypes)||void 0===l?void 0:l.special)||[]},flavorMessages:{chestFind:(null===(c=n.flavorMessages)||void 0===c?void 0:c.chestFind)||"",trapTrigger:(null===(m=n.flavorMessages)||void 0===m?void 0:m.trapTrigger)||"",victory:(null===(d=n.flavorMessages)||void 0===d?void 0:d.victory)||"",defeat:(null===(u=n.flavorMessages)||void 0===u?void 0:u.defeat)||""},colors:{primary:(null===(p=n.colors)||void 0===p?void 0:p.primary)||"#8b0000",secondary:(null===(h=n.colors)||void 0===h?void 0:h.secondary)||"#2d1f1f",accent:(null===(g=n.colors)||void 0===g?void 0:g.accent)||"#ff4444"}}),i(),console.log("[MazeMaster] Custom theme saved:",a),ln(),ne&&(ne.value=e.name),toastr.success('Theme "'.concat(e.displayName||e.name,'" saved')),renderConfigPanel()):toastr.error("Theme name is required")}));const re=document.getElementById("mazemaster_theme_delete_btn");re&&re.addEventListener("click",(()=>{const e=null==ne?void 0:ne.value;if(!e)return void toastr.warning("Select a theme to delete");const t=La(e);confirm('Delete theme "'.concat((null==t?void 0:t.displayName)||e,'"?'))&&(!function(e){var t;null!==(t=qt.customThemes)&&void 0!==t&&t[e]&&(delete qt.customThemes[e],i(),console.log("[MazeMaster] Custom theme deleted:",e))}(e),mn(),ln(),toastr.info('Theme "'.concat((null==t?void 0:t.displayName)||e,'" deleted')),renderConfigPanel())}));const se=document.getElementById("mazemaster_style_profile_select");se&&se.addEventListener("change",(e=>{e.target.value?function(e){var t,a,n,o,i,r,s,l,c,m,d,u,p,h,g,f,y,v,b,z,_,x,k,C,w,E,S,T,I,M,P,D,A,B,L,q;const R=Ra(e);if(!R)return;const N=(e,t)=>{const a=document.getElementById(e);a&&(a.value=t||"")},H=(e,t)=>{const a=document.getElementById(e);a&&(a.checked=!!t)};N("mazemaster_style_name",R.name),N("mazemaster_style_display",R.displayName),N("mazemaster_style_bsp_minroom",null!==(t=null===(a=R.bspConfig)||void 0===a?void 0:a.minRoomSize)&&void 0!==t?t:2),N("mazemaster_style_bsp_maxroom",null!==(n=null===(o=R.bspConfig)||void 0===o?void 0:o.maxRoomSize)&&void 0!==n?n:5),N("mazemaster_style_bsp_corridor",null!==(i=null===(r=R.bspConfig)||void 0===r?void 0:r.corridorWidth)&&void 0!==i?i:1),N("mazemaster_style_bsp_padding",null!==(s=null===(l=R.bspConfig)||void 0===l?void 0:l.roomPadding)&&void 0!==s?s:1),N("mazemaster_style_bsp_minsplit",null!==(c=null===(m=R.bspConfig)||void 0===m?void 0:m.minSplitSize)&&void 0!==c?c:4),N("mazemaster_style_bsp_variance",null!==(d=null===(u=R.bspConfig)||void 0===u?void 0:u.splitVariance)&&void 0!==d?d:.3),N("mazemaster_style_bsp_connections",null!==(p=null===(h=R.bspConfig)||void 0===h?void 0:h.extraConnections)&&void 0!==p?p:.1),N("mazemaster_style_bsp_branch",null!==(g=null===(f=R.bspConfig)||void 0===f?void 0:f.branchChance)&&void 0!==g?g:.3),H("mazemaster_style_bsp_grid",null===(y=R.bspConfig)||void 0===y?void 0:y.gridAlign),H("mazemaster_style_bsp_winding",null===(v=R.bspConfig)||void 0===v?void 0:v.windingCorridors),H("mazemaster_style_bsp_modular",null===(b=R.bspConfig)||void 0===b?void 0:b.modularRooms),H("mazemaster_style_bsp_square",null===(z=R.bspConfig)||void 0===z?void 0:z.preferSquareRooms),N("mazemaster_style_common_prefixes",((null===(_=R.roomNames)||void 0===_||null===(_=_.common)||void 0===_?void 0:_.prefixes)||[]).join(", ")),N("mazemaster_style_common_nouns",((null===(x=R.roomNames)||void 0===x||null===(x=x.common)||void 0===x?void 0:x.nouns)||[]).join(", ")),N("mazemaster_style_common_desc",((null===(k=R.roomNames)||void 0===k||null===(k=k.common)||void 0===k?void 0:k.descriptions)||[]).join("\n")),N("mazemaster_style_junction_prefixes",((null===(C=R.roomNames)||void 0===C||null===(C=C.junction)||void 0===C?void 0:C.prefixes)||[]).join(", ")),N("mazemaster_style_junction_nouns",((null===(w=R.roomNames)||void 0===w||null===(w=w.junction)||void 0===w?void 0:w.nouns)||[]).join(", ")),N("mazemaster_style_junction_desc",((null===(E=R.roomNames)||void 0===E||null===(E=E.junction)||void 0===E?void 0:E.descriptions)||[]).join("\n")),N("mazemaster_style_deadend_prefixes",((null===(S=R.roomNames)||void 0===S||null===(S=S.deadend)||void 0===S?void 0:S.prefixes)||[]).join(", ")),N("mazemaster_style_deadend_nouns",((null===(T=R.roomNames)||void 0===T||null===(T=T.deadend)||void 0===T?void 0:T.nouns)||[]).join(", ")),N("mazemaster_style_deadend_desc",((null===(I=R.roomNames)||void 0===I||null===(I=I.deadend)||void 0===I?void 0:I.descriptions)||[]).join("\n")),N("mazemaster_style_start_names",((null===(M=R.roomNames)||void 0===M||null===(M=M.start)||void 0===M?void 0:M.names)||[]).join(", ")),N("mazemaster_style_staircase_names",((null===(P=R.roomNames)||void 0===P||null===(P=P.staircase)||void 0===P?void 0:P.names)||[]).join(", ")),N("mazemaster_style_portal_names",((null===(D=R.roomNames)||void 0===D||null===(D=D.portal)||void 0===D?void 0:D.names)||[]).join(", ")),N("mazemaster_style_chest_names",((null===(A=R.roomNames)||void 0===A||null===(A=A.chest)||void 0===A?void 0:A.names)||[]).join(", ")),N("mazemaster_style_minion_names",((null===(B=R.roomNames)||void 0===B||null===(B=B.minion)||void 0===B?void 0:B.names)||[]).join(", ")),N("mazemaster_style_trap_names",((null===(L=R.roomNames)||void 0===L||null===(L=L.trap)||void 0===L?void 0:L.names)||[]).join(", ")),N("mazemaster_style_exit_names",((null===(q=R.roomNames)||void 0===q||null===(q=q.exit)||void 0===q?void 0:q.names)||[]).join(", "))}(e.target.value):dn()}));const le=document.getElementById("mazemaster_style_new_btn");le&&le.addEventListener("click",(()=>{dn(),se&&(se.value="")}));const ce=document.getElementById("mazemaster_style_save_btn");ce&&ce.addEventListener("click",(()=>{const e=function(){const e=e=>{var t;return(null===(t=document.getElementById(e))||void 0===t?void 0:t.value)||""},t=(e,t)=>{var a;return parseFloat(null===(a=document.getElementById(e))||void 0===a?void 0:a.value)||t},a=(e,t)=>{var a;return parseInt(null===(a=document.getElementById(e))||void 0===a?void 0:a.value)||t},n=e=>{var t;return(null===(t=document.getElementById(e))||void 0===t?void 0:t.checked)||!1},o=t=>e(t).split(",").map((e=>e.trim())).filter(Boolean),i=t=>e(t).split("\n").map((e=>e.trim())).filter(Boolean);return{name:e("mazemaster_style_name"),displayName:e("mazemaster_style_display"),bspConfig:{minRoomSize:a("mazemaster_style_bsp_minroom",2),maxRoomSize:a("mazemaster_style_bsp_maxroom",5),corridorWidth:a("mazemaster_style_bsp_corridor",1),roomPadding:a("mazemaster_style_bsp_padding",1),minSplitSize:a("mazemaster_style_bsp_minsplit",4),splitVariance:t("mazemaster_style_bsp_variance",.3),extraConnections:t("mazemaster_style_bsp_connections",.1),branchChance:t("mazemaster_style_bsp_branch",.3),gridAlign:n("mazemaster_style_bsp_grid"),windingCorridors:n("mazemaster_style_bsp_winding"),modularRooms:n("mazemaster_style_bsp_modular"),preferSquareRooms:n("mazemaster_style_bsp_square")},roomNames:{common:{prefixes:o("mazemaster_style_common_prefixes"),nouns:o("mazemaster_style_common_nouns"),descriptions:i("mazemaster_style_common_desc")},junction:{prefixes:o("mazemaster_style_junction_prefixes"),nouns:o("mazemaster_style_junction_nouns"),descriptions:i("mazemaster_style_junction_desc")},deadend:{prefixes:o("mazemaster_style_deadend_prefixes"),nouns:o("mazemaster_style_deadend_nouns"),descriptions:i("mazemaster_style_deadend_desc")},start:{names:o("mazemaster_style_start_names"),descriptions:[]},staircase:{names:o("mazemaster_style_staircase_names"),descriptions:[]},portal:{names:o("mazemaster_style_portal_names"),descriptions:[]},chest:{names:o("mazemaster_style_chest_names"),descriptions:[]},minion:{names:o("mazemaster_style_minion_names"),descriptions:[]},trap:{names:o("mazemaster_style_trap_names"),descriptions:[]},exit:{names:o("mazemaster_style_exit_names"),descriptions:[]}}}}();var a,n,o,r,s,l,c,m,d,u,p,h,g,f,y,v,b,z,_,x,k,C,w,E,S,I,M,P,D,A,B,L,q,R,N,H,O,F,W,Y,U,G,j,K,V,X,Q,J,Z;e.name?(a=e.name,n=e,qt.customStyles||(qt.customStyles={}),qt.customStyles[a]=t(t({},T),{},{name:n.name||a,displayName:n.displayName||a,roomNames:{common:{prefixes:(null===(o=n.roomNames)||void 0===o||null===(o=o.common)||void 0===o?void 0:o.prefixes)||[],nouns:(null===(r=n.roomNames)||void 0===r||null===(r=r.common)||void 0===r?void 0:r.nouns)||[],descriptions:(null===(s=n.roomNames)||void 0===s||null===(s=s.common)||void 0===s?void 0:s.descriptions)||[]},junction:{prefixes:(null===(l=n.roomNames)||void 0===l||null===(l=l.junction)||void 0===l?void 0:l.prefixes)||[],nouns:(null===(c=n.roomNames)||void 0===c||null===(c=c.junction)||void 0===c?void 0:c.nouns)||[],descriptions:(null===(m=n.roomNames)||void 0===m||null===(m=m.junction)||void 0===m?void 0:m.descriptions)||[]},deadend:{prefixes:(null===(d=n.roomNames)||void 0===d||null===(d=d.deadend)||void 0===d?void 0:d.prefixes)||[],nouns:(null===(u=n.roomNames)||void 0===u||null===(u=u.deadend)||void 0===u?void 0:u.nouns)||[],descriptions:(null===(p=n.roomNames)||void 0===p||null===(p=p.deadend)||void 0===p?void 0:p.descriptions)||[]},staircase:{names:(null===(h=n.roomNames)||void 0===h||null===(h=h.staircase)||void 0===h?void 0:h.names)||[],descriptions:(null===(g=n.roomNames)||void 0===g||null===(g=g.staircase)||void 0===g?void 0:g.descriptions)||[]},portal:{names:(null===(f=n.roomNames)||void 0===f||null===(f=f.portal)||void 0===f?void 0:f.names)||[],descriptions:(null===(y=n.roomNames)||void 0===y||null===(y=y.portal)||void 0===y?void 0:y.descriptions)||[]},chest:{names:(null===(v=n.roomNames)||void 0===v||null===(v=v.chest)||void 0===v?void 0:v.names)||[],descriptions:(null===(b=n.roomNames)||void 0===b||null===(b=b.chest)||void 0===b?void 0:b.descriptions)||[]},minion:{names:(null===(z=n.roomNames)||void 0===z||null===(z=z.minion)||void 0===z?void 0:z.names)||[],descriptions:(null===(_=n.roomNames)||void 0===_||null===(_=_.minion)||void 0===_?void 0:_.descriptions)||[]},trap:{names:(null===(x=n.roomNames)||void 0===x||null===(x=x.trap)||void 0===x?void 0:x.names)||[],descriptions:(null===(k=n.roomNames)||void 0===k||null===(k=k.trap)||void 0===k?void 0:k.descriptions)||[]},exit:{names:(null===(C=n.roomNames)||void 0===C||null===(C=C.exit)||void 0===C?void 0:C.names)||[],descriptions:(null===(w=n.roomNames)||void 0===w||null===(w=w.exit)||void 0===w?void 0:w.descriptions)||[]},start:{names:(null===(E=n.roomNames)||void 0===E||null===(E=E.start)||void 0===E?void 0:E.names)||[],descriptions:(null===(S=n.roomNames)||void 0===S||null===(S=S.start)||void 0===S?void 0:S.descriptions)||[]}},bspConfig:{minRoomSize:null!==(I=null===(M=n.bspConfig)||void 0===M?void 0:M.minRoomSize)&&void 0!==I?I:2,maxRoomSize:null!==(P=null===(D=n.bspConfig)||void 0===D?void 0:D.maxRoomSize)&&void 0!==P?P:5,minSplitSize:null!==(A=null===(B=n.bspConfig)||void 0===B?void 0:B.minSplitSize)&&void 0!==A?A:4,splitVariance:null!==(L=null===(q=n.bspConfig)||void 0===q?void 0:q.splitVariance)&&void 0!==L?L:.3,corridorWidth:null!==(R=null===(N=n.bspConfig)||void 0===N?void 0:N.corridorWidth)&&void 0!==R?R:1,roomPadding:null!==(H=null===(O=n.bspConfig)||void 0===O?void 0:O.roomPadding)&&void 0!==H?H:1,extraConnections:null!==(F=null===(W=n.bspConfig)||void 0===W?void 0:W.extraConnections)&&void 0!==F?F:.1,branchChance:null!==(Y=null===(U=n.bspConfig)||void 0===U?void 0:U.branchChance)&&void 0!==Y?Y:.3,preferSquareRooms:null!==(G=null===(j=n.bspConfig)||void 0===j?void 0:j.preferSquareRooms)&&void 0!==G&&G,gridAlign:null!==(K=null===(V=n.bspConfig)||void 0===V?void 0:V.gridAlign)&&void 0!==K&&K,windingCorridors:null!==(X=null===(Q=n.bspConfig)||void 0===Q?void 0:Q.windingCorridors)&&void 0!==X&&X,modularRooms:null!==(J=null===(Z=n.bspConfig)||void 0===Z?void 0:Z.modularRooms)&&void 0!==J&&J}}),i(),console.log("[MazeMaster] Custom style saved:",a),cn(),se&&(se.value=e.name),toastr.success('Style "'.concat(e.displayName||e.name,'" saved')),renderConfigPanel()):toastr.error("Style name is required")}));const me=document.getElementById("mazemaster_style_delete_btn");me&&me.addEventListener("click",(()=>{const e=null==se?void 0:se.value;if(!e)return void toastr.warning("Select a style to delete");const t=Ra(e);confirm('Delete style "'.concat((null==t?void 0:t.displayName)||e,'"?'))&&(!function(e){var t;null!==(t=qt.customStyles)&&void 0!==t&&t[e]&&(delete qt.customStyles[e],i(),console.log("[MazeMaster] Custom style deleted:",e))}(e),dn(),cn(),toastr.info('Style "'.concat((null==t?void 0:t.displayName)||e,'" deleted')),renderConfigPanel())}));const de=document.getElementById("mazemaster_play_maze");function ue(){var e;const t=document.getElementById("mazemaster_play_profile"),a=null==t?void 0:t.value;if(!a)return;const n=G(a);if(!n)return;const o=e=>e?e.charAt(0).toUpperCase()+e.slice(1):"";document.getElementById("preview_title").textContent=a,document.getElementById("preview_story").textContent=(null===(e=n.storyConfig)||void 0===e?void 0:e.mainStory)||"No story available",document.getElementById("preview_theme").textContent=o(n.theme),document.getElementById("preview_style").textContent=o(n.mapStyle),document.getElementById("preview_difficulty").textContent=o(n.difficulty),document.getElementById("preview_size").textContent="".concat(n.gridSize,"x").concat(n.gridSize,"  ").concat(n.floors," floor").concat(n.floors>1?"s":""),document.getElementById("preview_hp").textContent=n.hpEnabled?"".concat(n.maxHP," HP"):"Disabled",document.getElementById("preview_permadeath").textContent=n.permadeathEnabled?"Yes":"No",document.getElementById("preview_combat").textContent=o(n.combatMechanicsProfile||"default"),document.getElementById("preview_vision").textContent=o(n.visionProfile||"default");const i=n.startingInventory||{},r=[],s={key:"Key",floorKey:"Floor Key",strike:"Strike",stealth:"Stealth",execute:"Execute",minionBane:"Minion Bane",portalStone:"Portal Stone",mapFragment:"Map",voidWalk:"Void Walk",timeShard:"Time Shard",healingPotion:"Potion",greaterHealing:"Greater",elixir:"Elixir",revivalCharm:"Revival",heartCrystal:"Heart Crystal",ironGuard:"Iron Guard",torch:"Torch",lantern:"Lantern",revealScroll:"Reveal",sightPotion:"Sight",crystalBall:"Crystal Ball",weapon_rusty_sword:"Rusty Sword",weapon_iron_sword:"Iron Sword",weapon_steel_blade:"Steel Blade",weapon_enchanted_blade:"Enchanted Blade",weapon_shadow_dagger:"Shadow Dagger",armor_leather:"Leather Armor",armor_chainmail:"Chainmail",armor_plate:"Plate Armor",accessory_ring_power:"Ring of Power",accessory_amulet_protection:"Amulet",accessory_lucky_charm:"Lucky Charm",accessory_vampiric_pendant:"Vampiric Pendant"};for(const[e,t]of Object.entries(i))if(t&&t>0){const a=s[e]||e;r.push("".concat(t," ").concat(a).concat(t>1&&!a.endsWith("s")?"s":""))}document.getElementById("preview_starting_items").textContent=r.length?"Starting: ".concat(r.join(", ")):"No starting items",document.getElementById("preview_content").style.display="block"}de&&de.addEventListener("click",(async()=>{const e=document.getElementById("mazemaster_play_profile"),t=(null==e?void 0:e.value)||qt.currentMazeProfile||"Tutorial - Learn the Basics";try{await m("/closechat")}catch(e){console.log("[MazeMaster] No active chat to close")}xi(t)}));const pe=document.getElementById("mazemaster_play_profile");pe&&(pe.addEventListener("change",ue),ue()),function(){const e=document.getElementById("mazemaster_llm_preset");if(e){e.innerHTML='<option value="">(Use Current)</option>';try{if("function"==typeof g){const t=g();if(t&&"function"==typeof t.getAllPresets){const a=t.getAllPresets();a.forEach((t=>{const a=document.createElement("option");a.value=t,a.textContent=t,t===qt.llmPreset&&(a.selected=!0),e.appendChild(a)})),console.log("[MazeMaster] Populated LLM preset dropdown with ".concat(a.length," presets"))}}}catch(e){console.warn("[MazeMaster] Could not populate LLM presets:",e)}}}(),console.log("[MazeMaster] After populateLLMPresetDropdown, continuing initUI...");const ge=document.getElementById("mazemaster_llm_preset");ge&&ge.addEventListener("change",(e=>{qt.llmPreset=e.target.value,i()}));const fe=document.getElementById("mazemaster_llm_enabled");fe&&fe.addEventListener("change",(e=>{qt.llmEnabled=e.target.checked,i()}));const ye=document.getElementById("mazemaster_close_chat");ye&&ye.addEventListener("change",(e=>{qt.closeChatOnStart=e.target.checked,i()}));const ve=document.getElementById("mazemaster_dpad_enabled");ve&&ve.addEventListener("change",(e=>{qt.dpadConfig||(qt.dpadConfig={enabled:!0,floating:!0,position:{x:null,y:null}}),qt.dpadConfig.enabled=e.target.checked;const t=document.getElementById("maze_dpad");t&&(t.style.display=e.target.checked?"":"none"),i()}));const be=document.getElementById("mazemaster_dpad_floating");be&&be.addEventListener("change",(e=>{qt.dpadConfig||(qt.dpadConfig={enabled:!0,floating:!0,position:{x:null,y:null}}),qt.dpadConfig.floating=e.target.checked;const t=document.getElementById("maze_dpad");t&&(t.classList.toggle("floating",e.target.checked),e.target.checked&&he()),i()}));const ze=document.getElementById("mazemaster_dpad_reset");ze&&ze.addEventListener("click",(()=>{qt.dpadConfig||(qt.dpadConfig={enabled:!0,floating:!0,position:{x:null,y:null}}),qt.dpadConfig.position={x:null,y:null},i();const e=document.getElementById("maze_dpad");e&&(e.style.left="",e.style.top="",e.style.right="20px",e.style.bottom="100px")}));const _e=document.getElementById("mazemaster_reset_factory");_e&&_e.addEventListener("click",(async()=>{await u("This will DELETE all your custom profiles (including themes/styles) and restore v2.0.1 factory defaults.\n\nThis cannot be undone!",p.CONFIRM)&&($t(),i(),await u("Factory defaults restored! Refreshing panel...",p.TEXT),is())}));const xe=document.getElementById("mazemaster_minimap_enabled");xe&&xe.addEventListener("change",(e=>{qt.minimapSettings||(qt.minimapSettings={enabled:!0}),qt.minimapSettings.enabled=e.target.checked;const t=document.getElementById("mazemaster_minimap_container");t&&(t.style.display=e.target.checked?"":"none"),i()}));const ke=document.getElementById("mazemaster_minimap_position");ke&&ke.addEventListener("change",(e=>{qt.minimapSettings||(qt.minimapSettings={enabled:!0}),qt.minimapSettings.position=e.target.value;const t=document.getElementById("mazemaster_minimap_container");t&&(t.className="mazemaster-minimap-container ".concat(e.target.value)),i()}));const Ce=document.getElementById("mazemaster_minimap_size");Ce&&Ce.addEventListener("change",(e=>{qt.minimapSettings||(qt.minimapSettings={enabled:!0}),qt.minimapSettings.size=parseInt(e.target.value)||150,Ia(),i()}));const we=document.getElementById("mazemaster_minimap_opacity");we&&we.addEventListener("input",(e=>{qt.minimapSettings||(qt.minimapSettings={enabled:!0}),qt.minimapSettings.opacity=parseInt(e.target.value)/100;const t=e.target.parentElement.querySelector(".mazemaster-range-value");t&&(t.textContent="".concat(e.target.value,"%"));const a=document.getElementById("mazemaster_minimap_container");a&&(a.style.opacity=qt.minimapSettings.opacity),i()}));const Ee=document.getElementById("mazemaster_minimap_show_markers");Ee&&Ee.addEventListener("change",(e=>{qt.minimapSettings||(qt.minimapSettings={enabled:!0}),qt.minimapSettings.showMarkers=e.target.checked,Ia(),i()}));const Se=document.getElementById("mazemaster_minimap_show_minions");Se&&Se.addEventListener("change",(e=>{qt.minimapSettings||(qt.minimapSettings={enabled:!0}),qt.minimapSettings.showMinions=e.target.checked,Ia(),i()}));const Te=document.getElementById("mazemaster_minimap_show_chests");Te&&Te.addEventListener("change",(e=>{qt.minimapSettings||(qt.minimapSettings={enabled:!0}),qt.minimapSettings.showChests=e.target.checked,Ia(),i()}));const Ie=document.getElementById("mazemaster_renderer_type");Ie&&Ie.addEventListener("change",(e=>{qt.rendererType=e.target.value,R.getRenderer(e.target.value),i()}));const Me=document.getElementById("mazemaster_layout_mode");Me&&Me.addEventListener("change",(e=>{qt.layoutMode=e.target.value,i(),H()}));const Pe=document.getElementById("mazemaster_bb_profile_select");Pe&&Pe.addEventListener("change",(e=>{qt.currentBattlebarProfile=e.target.value,i(),function(){var e;const t=na(null===(e=document.getElementById("mazemaster_bb_profile_select"))||void 0===e?void 0:e.value)||{},a=document.getElementById("mazemaster_bb_difficulty"),n=document.getElementById("mazemaster_bb_diff_val");if(a){let e=t.difficulty||5;e<=5&&x[e]&&(e=x[e]),a.value=e,n&&(n.textContent="(".concat(e,")"))}const o=document.getElementById("mazemaster_bb_damage");o&&(o.value=t.damage||25);const i=document.getElementById("mazemaster_bb_hits");i&&(i.value=t.hitsToWin||5);const r=document.getElementById("mazemaster_bb_misses");r&&(r.value=t.missesToLose||3);const s=document.getElementById("mazemaster_bb_hit_cmd");s&&(s.value=t.hitCommand||"");const l=document.getElementById("mazemaster_bb_miss_cmd");l&&(l.value=t.missCommand||"");const c=document.getElementById("mazemaster_bb_win_cmd");c&&(c.value=t.winCommand||"");const m=document.getElementById("mazemaster_bb_lose_cmd");m&&(m.value=t.loseCommand||"");const d=document.getElementById("mazemaster_bb_main_title");d&&(d.value=t.mainTitle||"")}(),Fr()}));const De=document.getElementById("mazemaster_bb_new_profile_btn");De&&De.addEventListener("click",(async e=>{e.preventDefault(),e.stopPropagation();const t=await u("Enter new battlebar profile name:",p.INPUT,"");if(t&&t.trim()){const e=t.trim();qt.battlebarProfiles[e]?await u('Battlebar profile "'.concat(e,'" already exists.'),p.TEXT):(oa(e,{}),qt.currentBattlebarProfile=e,i(),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click()}),100))}}));const Ae=document.getElementById("mazemaster_bb_delete_profile_btn");Ae&&Ae.addEventListener("click",(async()=>{var e;const t=null===(e=document.getElementById("mazemaster_bb_profile_select"))||void 0===e?void 0:e.value;if(t){await u('Delete battlebar profile "'.concat(t,'"?'),p.CONFIRM)&&(!function(e){if(delete qt.battlebarProfiles[e],qt.currentBattlebarProfile===e){const e=aa();qt.currentBattlebarProfile=e[0]||"Tutorial - Learn Combat"}i()}(t),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click()}),100))}}));const Be=document.getElementById("mazemaster_bb_rename_profile_btn");Be&&Be.addEventListener("click",(async()=>{var e;const t=null===(e=document.getElementById("mazemaster_bb_profile_select"))||void 0===e?void 0:e.value;if(!t)return void alert("No profile selected to rename");const a=await u("Enter new profile name:",p.INPUT,t);if(a&&a.trim()&&a.trim()!==t){const e=a.trim();if(qt.battlebarProfiles[e])return void alert("A profile with that name already exists");qt.battlebarProfiles[e]=qt.battlebarProfiles[t],delete qt.battlebarProfiles[t],qt.currentBattlebarProfile=e,i(),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click()}),100)}}));const Le=document.getElementById("mazemaster_bb_export_btn");Le&&Le.addEventListener("click",(()=>{var e;const t=null===(e=document.getElementById("mazemaster_bb_profile_select"))||void 0===e?void 0:e.value;t?function(e){const t=na(e);if(!t)return void alert('Battlebar profile "'.concat(e,'" not found'));const a={name:e,type:"battlebar",profile:t,exportedAt:(new Date).toISOString(),version:"1.0"},n=JSON.stringify(a,null,2),o=new Blob([n],{type:"application/json"}),i=URL.createObjectURL(o),r=document.createElement("a");r.href=i,r.download="mazemaster-battlebar-".concat(e,".json"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),console.log('[MazeMaster] Exported battlebar profile "'.concat(e,'"'))}(t):alert("No profile selected to export")}));const qe=document.getElementById("mazemaster_bb_import_btn"),Re=document.getElementById("mazemaster_bb_import_file");qe&&Re&&(qe.addEventListener("click",(()=>{Re.click()})),Re.addEventListener("change",(async e=>{var t;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){try{var n;const e=await function(e){return new Promise(((t,a)=>{const n=new FileReader;n.onload=e=>{try{const n=JSON.parse(e.target.result);if(!n.profile||!n.name)return void a(new Error("Invalid profile format: missing name or profile data"));let o=n.name;if(qt.battlebarProfiles[o]){const e=prompt('Battlebar profile "'.concat(o,'" already exists. Enter a new name:'),"".concat(o,"_imported"));if(!e||!e.trim())return void a(new Error("Import cancelled"));o=e.trim()}oa(o,n.profile),qt.currentBattlebarProfile=o,i(),console.log('[MazeMaster] Imported battlebar profile "'.concat(o,'":'),n.profile),t(o)}catch(e){a(new Error("Failed to parse JSON: ".concat(e.message)))}},n.onerror=()=>a(new Error("Failed to read file")),n.readAsText(e)}))}(a);alert('Battlebar profile "'.concat(e,'" imported successfully!')),is(),null===(n=document.getElementById("mazemaster_show_combat"))||void 0===n||n.click()}catch(e){alert("Import failed: ".concat(e.message))}Re.value=""}})));const Ne=document.getElementById("mazemaster_bb_save_btn");Ne&&Ne.addEventListener("click",(()=>{var e;const t=null===(e=document.getElementById("mazemaster_bb_profile_select"))||void 0===e?void 0:e.value;if(!t)return void alert("Please create a battlebar profile first");const a=function(){var e,t,a,n,o,i,r,s,l,c,m,d,u,p,h,g;const f=na(null===(e=document.getElementById("mazemaster_bb_profile_select"))||void 0===e?void 0:e.value)||{};return{difficulty:parseInt(null===(t=document.getElementById("mazemaster_bb_difficulty"))||void 0===t?void 0:t.value)||5,damage:parseInt(null===(a=document.getElementById("mazemaster_bb_damage"))||void 0===a?void 0:a.value)||25,hitsToWin:parseInt(null===(n=document.getElementById("mazemaster_bb_hits"))||void 0===n?void 0:n.value)||5,missesToLose:parseInt(null===(o=document.getElementById("mazemaster_bb_misses"))||void 0===o?void 0:o.value)||3,mainTitle:(null===(i=document.getElementById("mazemaster_bb_main_title"))||void 0===i?void 0:i.value)||"",hitCommand:(null===(r=document.getElementById("mazemaster_bb_hit_cmd"))||void 0===r?void 0:r.value)||"",missCommand:(null===(s=document.getElementById("mazemaster_bb_miss_cmd"))||void 0===s?void 0:s.value)||"",winCommand:(null===(l=document.getElementById("mazemaster_bb_win_cmd"))||void 0===l?void 0:l.value)||"",loseCommand:(null===(c=document.getElementById("mazemaster_bb_lose_cmd"))||void 0===c?void 0:c.value)||"",images:f.images||[],keyDropChance:null!==(m=parseInt(null===(d=document.getElementById("mazemaster_bb_key_drop"))||void 0===d?void 0:d.value))&&void 0!==m?m:40,strikeDropChance:null!==(u=parseInt(null===(p=document.getElementById("mazemaster_bb_pow_drop"))||void 0===p?void 0:p.value))&&void 0!==u?u:20,stealthDropChance:null!==(h=parseInt(null===(g=document.getElementById("mazemaster_bb_stealth_drop"))||void 0===g?void 0:g.value))&&void 0!==h?h:10}}(),n=[];(!a.hitsToWin||a.hitsToWin<1)&&n.push("Hits to Win must be at least 1"),(!a.missesToLose||a.missesToLose<1)&&n.push("Misses to Lose must be at least 1"),(!a.difficulty||a.difficulty<1||a.difficulty>10)&&n.push("Difficulty must be between 1 and 10"),n.length>0?alert("Validation Error:\n\n"+n.join("\n")):(oa(t,a),alert('Battlebar profile "'.concat(t,'" saved!')))}));const He=document.getElementById("mazemaster_bb_difficulty"),Oe=document.getElementById("mazemaster_bb_diff_val");He&&Oe&&He.addEventListener("input",(e=>{Oe.textContent="(".concat(e.target.value,")")}));const Fe=document.getElementById("mazemaster_bb_add_image_btn"),We=document.getElementById("mazemaster_bb_image_file");Fe&&We&&(Fe.addEventListener("click",(()=>{We.click()})),We.addEventListener("change",(async e=>{var t,a;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!n)return;const o=null===(a=document.getElementById("mazemaster_bb_profile_select"))||void 0===a?void 0:a.value;if(!o)return alert("Please create a profile first"),void(We.value="");try{const e=await async function(e,t){return new Promise(((a,n)=>{const o=new FileReader;o.onload=async o=>{try{const i=o.target.result.split(",")[1],r=e.name.split(".").pop().toLowerCase(),s=Date.now(),l="battlebar_".concat(t,"_").concat(s),c=await fetch("/api/images/upload",{method:"POST",headers:d(),body:JSON.stringify({image:i,ch_name:"MazeMaster",filename:l,format:r})});if(c.ok)a("user/images/MazeMaster/".concat(l,".").concat(r));else{const e=await c.json().catch((()=>({})));n(new Error(e.error||"Upload failed"))}}catch(e){n(e)}},o.onerror=()=>n(new Error("Failed to read file")),o.readAsDataURL(e)}))}(n,o),t=na(o)||{},a=t.images||[];a.push({path:e,name:n.name}),t.images=a,oa(o,t),Fr()}catch(e){alert("Image upload failed: ".concat(e.message))}We.value=""})));const Ye=document.getElementById("mazemaster_tb_profile_select");Ye&&Ye.addEventListener("change",(e=>{qt.currentTurnbasedProfile=e.target.value,i(),tt(e.target.value)}));const Ue=document.getElementById("mazemaster_tb_new_profile_btn");Ue&&Ue.addEventListener("click",(async e=>{e.preventDefault(),e.stopPropagation();const a=await u("Enter new Turn-Based profile name:",p.INPUT,"");if(a&&a.trim()){const e=a.trim();if(qt.turnbasedProfiles[e])await u('Turn-Based profile "'.concat(e,'" already exists.'),p.TEXT);else{sa(e,t(t({},ra("Tutorial - Learn Turn-Based")||{}),{},{mainTitle:e})),qt.currentTurnbasedProfile=e,i(),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click(),setTimeout((()=>{var e;null===(e=document.querySelector('[data-combat="turnbased"]'))||void 0===e||e.click()}),50)}),100)}}}));const je=document.getElementById("mazemaster_tb_delete_profile_btn");je&&je.addEventListener("click",(async()=>{var e;const t=null===(e=document.getElementById("mazemaster_tb_profile_select"))||void 0===e?void 0:e.value;if(t){await u('Delete Turn-Based profile "'.concat(t,'"?'),p.CONFIRM)&&(!function(e){var t;if(null===(t=qt.turnbasedProfiles)||void 0===t||delete t[e],qt.currentTurnbasedProfile===e){const e=ia();qt.currentTurnbasedProfile=e[0]||""}i()}(t),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click(),setTimeout((()=>{var e;null===(e=document.querySelector('[data-combat="turnbased"]'))||void 0===e||e.click()}),50)}),100))}}));const Qe=document.getElementById("mazemaster_tb_rename_profile_btn");Qe&&Qe.addEventListener("click",(async()=>{var e;const t=null===(e=document.getElementById("mazemaster_tb_profile_select"))||void 0===e?void 0:e.value;if(!t)return void alert("No profile selected to rename");const a=await u("Enter new profile name:",p.INPUT,t);if(a&&a.trim()&&a.trim()!==t){const e=a.trim();if(qt.turnbasedProfiles[e])return void await u('Profile "'.concat(e,'" already exists.'),p.TEXT);qt.turnbasedProfiles[e]=qt.turnbasedProfiles[t],delete qt.turnbasedProfiles[t],qt.currentTurnbasedProfile=e,i(),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click(),setTimeout((()=>{var e;null===(e=document.querySelector('[data-combat="turnbased"]'))||void 0===e||e.click()}),50)}),100)}}));const Ze=document.getElementById("mazemaster_tb_difficulty"),$e=document.getElementById("mazemaster_tb_diff_val");Ze&&$e&&Ze.addEventListener("input",(e=>{$e.textContent="(".concat(e.target.value,")")}));const et=document.getElementById("mazemaster_tb_save_btn");function tt(e){const t=ra(e)||{},a=(e,t)=>{const a=document.getElementById(e);a&&(a.value=null!=t?t:"")};a("mazemaster_tb_main_title",t.mainTitle),a("mazemaster_tb_enemy_name",t.enemyName),a("mazemaster_tb_description",t.description),a("mazemaster_tb_player_hp",t.playerHP||100),a("mazemaster_tb_player_attack",t.playerAttack||15),a("mazemaster_tb_player_defense",t.playerDefense||5),a("mazemaster_tb_enemy_hp",t.enemyHP||50),a("mazemaster_tb_enemy_attack",t.enemyAttack||8),a("mazemaster_tb_enemy_defense",t.enemyDefense||2),a("mazemaster_tb_turn_order",t.turnOrder||"player_first"),a("mazemaster_tb_flee_chance",t.fleeChance||50),a("mazemaster_tb_crit_chance",t.critChance||15),a("mazemaster_tb_crit_mult",t.critMultiplier||1.5),a("mazemaster_tb_difficulty",t.difficulty||5),a("mazemaster_tb_damage",t.damage||15),a("mazemaster_tb_on_win",t.onWin),a("mazemaster_tb_on_lose",t.onLose),a("mazemaster_tb_key_drop",t.keyDropChance||30),a("mazemaster_tb_strike_drop",t.strikeDropChance||15),a("mazemaster_tb_stealth_drop",t.stealthDropChance||10),a("mazemaster_tb_potion_drop",t.healingPotionDropChance||25);const n=document.getElementById("mazemaster_tb_diff_val");n&&(n.textContent="(".concat(t.difficulty||5,")"))}et&&et.addEventListener("click",(()=>{var e,t,a,n,o,i,r,s,l,c,m,d,u,p,h,g,f,y,v,b,z,_;const x=null===(e=document.getElementById("mazemaster_tb_profile_select"))||void 0===e?void 0:e.value;if(!x)return void alert("Please create a Turn-Based profile first");sa(x,{mainTitle:(null===(t=document.getElementById("mazemaster_tb_main_title"))||void 0===t?void 0:t.value)||"",enemyName:(null===(a=document.getElementById("mazemaster_tb_enemy_name"))||void 0===a?void 0:a.value)||"Enemy",description:(null===(n=document.getElementById("mazemaster_tb_description"))||void 0===n?void 0:n.value)||"",playerHP:parseInt(null===(o=document.getElementById("mazemaster_tb_player_hp"))||void 0===o?void 0:o.value)||100,playerAttack:parseInt(null===(i=document.getElementById("mazemaster_tb_player_attack"))||void 0===i?void 0:i.value)||15,playerDefense:parseInt(null===(r=document.getElementById("mazemaster_tb_player_defense"))||void 0===r?void 0:r.value)||5,enemyHP:parseInt(null===(s=document.getElementById("mazemaster_tb_enemy_hp"))||void 0===s?void 0:s.value)||50,enemyAttack:parseInt(null===(l=document.getElementById("mazemaster_tb_enemy_attack"))||void 0===l?void 0:l.value)||8,enemyDefense:parseInt(null===(c=document.getElementById("mazemaster_tb_enemy_defense"))||void 0===c?void 0:c.value)||2,turnOrder:(null===(m=document.getElementById("mazemaster_tb_turn_order"))||void 0===m?void 0:m.value)||"player_first",fleeChance:parseInt(null===(d=document.getElementById("mazemaster_tb_flee_chance"))||void 0===d?void 0:d.value)||50,critChance:parseInt(null===(u=document.getElementById("mazemaster_tb_crit_chance"))||void 0===u?void 0:u.value)||15,critMultiplier:parseFloat(null===(p=document.getElementById("mazemaster_tb_crit_mult"))||void 0===p?void 0:p.value)||1.5,difficulty:parseInt(null===(h=document.getElementById("mazemaster_tb_difficulty"))||void 0===h?void 0:h.value)||5,damage:parseInt(null===(g=document.getElementById("mazemaster_tb_damage"))||void 0===g?void 0:g.value)||15,onWin:(null===(f=document.getElementById("mazemaster_tb_on_win"))||void 0===f?void 0:f.value)||"",onLose:(null===(y=document.getElementById("mazemaster_tb_on_lose"))||void 0===y?void 0:y.value)||"",keyDropChance:parseInt(null===(v=document.getElementById("mazemaster_tb_key_drop"))||void 0===v?void 0:v.value)||30,strikeDropChance:parseInt(null===(b=document.getElementById("mazemaster_tb_strike_drop"))||void 0===b?void 0:b.value)||15,stealthDropChance:parseInt(null===(z=document.getElementById("mazemaster_tb_stealth_drop"))||void 0===z?void 0:z.value)||10,healingPotionDropChance:parseInt(null===(_=document.getElementById("mazemaster_tb_potion_drop"))||void 0===_?void 0:_.value)||25}),alert('Turn-Based profile "'.concat(x,'" saved!'))})),qt.currentTurnbasedProfile&&tt(qt.currentTurnbasedProfile);const at=document.getElementById("mazemaster_qte_profile_select");at&&at.addEventListener("change",(e=>{qt.currentQteProfile=e.target.value,i(),mt(e.target.value)}));const nt=document.getElementById("mazemaster_qte_new_profile_btn");nt&&nt.addEventListener("click",(async e=>{e.preventDefault(),e.stopPropagation();const a=await u("Enter new QTE profile name:",p.INPUT,"");if(a&&a.trim()){const e=a.trim();if(qt.qteProfiles[e])await u('QTE profile "'.concat(e,'" already exists.'),p.TEXT);else{ma(e,t(t({},ca("Tutorial - First Steps")||{}),{},{mainTitle:e})),qt.currentQteProfile=e,i(),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click(),setTimeout((()=>{var e;null===(e=document.querySelector('[data-combat="qte"]'))||void 0===e||e.click()}),50)}),100)}}}));const ot=document.getElementById("mazemaster_qte_delete_profile_btn");ot&&ot.addEventListener("click",(async()=>{var e;const t=null===(e=document.getElementById("mazemaster_qte_profile_select"))||void 0===e?void 0:e.value;if(t){await u('Delete QTE profile "'.concat(t,'"?'),p.CONFIRM)&&(!function(e){var t;if(null===(t=qt.qteProfiles)||void 0===t||delete t[e],qt.currentQteProfile===e){const e=la();qt.currentQteProfile=e[0]||""}i()}(t),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click(),setTimeout((()=>{var e;null===(e=document.querySelector('[data-combat="qte"]'))||void 0===e||e.click()}),50)}),100))}}));const it=document.getElementById("mazemaster_qte_rename_profile_btn");it&&it.addEventListener("click",(async()=>{var e;const t=null===(e=document.getElementById("mazemaster_qte_profile_select"))||void 0===e?void 0:e.value;if(!t)return void alert("No profile selected to rename");const a=await u("Enter new profile name:",p.INPUT,t);if(a&&a.trim()&&a.trim()!==t){const e=a.trim();if(qt.qteProfiles[e])return void alert("A profile with that name already exists");qt.qteProfiles[e]=qt.qteProfiles[t],qt.qteProfiles[e].mainTitle=e,delete qt.qteProfiles[t],qt.currentQteProfile=e,i(),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click(),setTimeout((()=>{var e;null===(e=document.querySelector('[data-combat="qte"]'))||void 0===e||e.click()}),50)}),100)}}));const rt=document.getElementById("mazemaster_preview_qte_btn");rt&&rt.addEventListener("click",(()=>{var e;const t=null===(e=document.getElementById("mazemaster_qte_profile_select"))||void 0===e?void 0:e.value;if(!t)return void alert("Please select a QTE profile first");const a=On(t);a.error&&alert("Error: ".concat(a.error))}));const st=document.getElementById("mazemaster_qte_difficulty"),lt=document.getElementById("mazemaster_qte_diff_val");st&&lt&&st.addEventListener("input",(e=>{lt.textContent="(".concat(e.target.value,")")}));const ct=document.getElementById("mazemaster_qte_save_btn");function mt(e){const t=ca(e)||{},a=(e,t)=>{const a=document.getElementById(e);a&&(a.value=null!=t?t:"")},n=(e,t)=>{const a=document.getElementById(e);a&&(a.checked=t)};a("mazemaster_qte_main_title",t.mainTitle),a("mazemaster_qte_description",t.description),a("mazemaster_qte_seq_min",t.sequenceLengthMin||3),a("mazemaster_qte_seq_max",t.sequenceLengthMax||5),a("mazemaster_qte_time_base",t.timeWindowBase||1500),a("mazemaster_qte_time_min",t.timeWindowMin||800),a("mazemaster_qte_difficulty",t.difficulty||5),a("mazemaster_qte_damage",t.damage||10),a("mazemaster_qte_perfect",t.perfectWindowPercent||30),a("mazemaster_qte_on_complete",t.onComplete),a("mazemaster_qte_on_fail",t.onFail);const o=t.allowedKeys||["W","A","S","D","SPACE"];n("mazemaster_qte_key_w",o.includes("W")),n("mazemaster_qte_key_a",o.includes("A")),n("mazemaster_qte_key_s",o.includes("S")),n("mazemaster_qte_key_d",o.includes("D")),n("mazemaster_qte_key_space",o.includes("SPACE"));const i=document.getElementById("mazemaster_qte_diff_val");i&&(i.textContent="(".concat(t.difficulty||5,")"))}ct&&ct.addEventListener("click",(()=>{var e,t,a,n,o,i,r,s,l,c,m,d,u,p,h,g,f;const y=null===(e=document.getElementById("mazemaster_qte_profile_select"))||void 0===e?void 0:e.value;if(!y)return void alert("Please create a QTE profile first");const v=[];null!==(t=document.getElementById("mazemaster_qte_key_w"))&&void 0!==t&&t.checked&&v.push("W"),null!==(a=document.getElementById("mazemaster_qte_key_a"))&&void 0!==a&&a.checked&&v.push("A"),null!==(n=document.getElementById("mazemaster_qte_key_s"))&&void 0!==n&&n.checked&&v.push("S"),null!==(o=document.getElementById("mazemaster_qte_key_d"))&&void 0!==o&&o.checked&&v.push("D"),null!==(i=document.getElementById("mazemaster_qte_key_space"))&&void 0!==i&&i.checked&&v.push("SPACE");ma(y,{mainTitle:(null===(r=document.getElementById("mazemaster_qte_main_title"))||void 0===r?void 0:r.value)||"",description:(null===(s=document.getElementById("mazemaster_qte_description"))||void 0===s?void 0:s.value)||"",sequenceLengthMin:parseInt(null===(l=document.getElementById("mazemaster_qte_seq_min"))||void 0===l?void 0:l.value)||3,sequenceLengthMax:parseInt(null===(c=document.getElementById("mazemaster_qte_seq_max"))||void 0===c?void 0:c.value)||5,timeWindowBase:parseInt(null===(m=document.getElementById("mazemaster_qte_time_base"))||void 0===m?void 0:m.value)||1500,timeWindowMin:parseInt(null===(d=document.getElementById("mazemaster_qte_time_min"))||void 0===d?void 0:d.value)||800,difficulty:parseInt(null===(u=document.getElementById("mazemaster_qte_difficulty"))||void 0===u?void 0:u.value)||5,damage:parseInt(null===(p=document.getElementById("mazemaster_qte_damage"))||void 0===p?void 0:p.value)||10,perfectWindowPercent:parseInt(null===(h=document.getElementById("mazemaster_qte_perfect"))||void 0===h?void 0:h.value)||30,allowedKeys:v,onComplete:(null===(g=document.getElementById("mazemaster_qte_on_complete"))||void 0===g?void 0:g.value)||"",onFail:(null===(f=document.getElementById("mazemaster_qte_on_fail"))||void 0===f?void 0:f.value)||""}),alert('QTE profile "'.concat(y,'" saved!'))})),qt.currentQteProfile&&mt(qt.currentQteProfile);const dt=document.getElementById("mazemaster_dice_profile_select");dt&&dt.addEventListener("change",(e=>{qt.currentDiceProfile=e.target.value,i(),bt(e.target.value)}));const ut=document.getElementById("mazemaster_dice_new_profile_btn");ut&&ut.addEventListener("click",(async e=>{e.preventDefault(),e.stopPropagation();const a=await u("Enter new Dice profile name:",p.INPUT,"");if(a&&a.trim()){const e=a.trim();if(qt.diceProfiles[e])await u('Dice profile "'.concat(e,'" already exists.'),p.TEXT);else{pa(e,t(t({},ua("Tutorial - Luck Practice")||{}),{},{mainTitle:e})),qt.currentDiceProfile=e,i(),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click(),setTimeout((()=>{var e;null===(e=document.querySelector('[data-combat="dice"]'))||void 0===e||e.click()}),50)}),100)}}}));const pt=document.getElementById("mazemaster_dice_delete_profile_btn");pt&&pt.addEventListener("click",(async()=>{var e;const t=null===(e=document.getElementById("mazemaster_dice_profile_select"))||void 0===e?void 0:e.value;if(t){await u('Delete Dice profile "'.concat(t,'"?'),p.CONFIRM)&&(!function(e){var t;if(null===(t=qt.diceProfiles)||void 0===t||delete t[e],qt.currentDiceProfile===e){const e=da();qt.currentDiceProfile=e[0]||""}i()}(t),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click(),setTimeout((()=>{var e;null===(e=document.querySelector('[data-combat="dice"]'))||void 0===e||e.click()}),50)}),100))}}));const ht=document.getElementById("mazemaster_dice_rename_profile_btn");ht&&ht.addEventListener("click",(async()=>{var e;const t=null===(e=document.getElementById("mazemaster_dice_profile_select"))||void 0===e?void 0:e.value;if(!t)return void alert("No profile selected to rename");const a=await u("Enter new profile name:",p.INPUT,t);if(a&&a.trim()&&a.trim()!==t){const e=a.trim();if(qt.diceProfiles[e])return void alert("A profile with that name already exists");qt.diceProfiles[e]=qt.diceProfiles[t],qt.diceProfiles[e].mainTitle=e,delete qt.diceProfiles[t],qt.currentDiceProfile=e,i(),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click(),setTimeout((()=>{var e;null===(e=document.querySelector('[data-combat="dice"]'))||void 0===e||e.click()}),50)}),100)}}));const gt=document.getElementById("mazemaster_preview_dice_btn");gt&&gt.addEventListener("click",(()=>{var e;const t=null===(e=document.getElementById("mazemaster_dice_profile_select"))||void 0===e?void 0:e.value;if(!t)return void alert("Please select a Dice profile first");const a=Xn(t);a.error&&alert("Error: ".concat(a.error))}));const ft=document.getElementById("mazemaster_dice_difficulty"),yt=document.getElementById("mazemaster_dice_diff_val");ft&&yt&&ft.addEventListener("input",(e=>{yt.textContent="(".concat(e.target.value,")")}));const vt=document.getElementById("mazemaster_dice_save_btn");function bt(e){const t=ua(e)||{},a=(e,t)=>{const a=document.getElementById(e);a&&(a.value=null!=t?t:"")};a("mazemaster_dice_main_title",t.mainTitle),a("mazemaster_dice_description",t.description),a("mazemaster_dice_count",t.diceCount||2),a("mazemaster_dice_type",t.diceType||6),a("mazemaster_dice_target",t.targetNumber||7),a("mazemaster_dice_modifier",t.modifier||0),a("mazemaster_dice_difficulty",t.difficulty||5),a("mazemaster_dice_damage",t.damage||15),a("mazemaster_dice_rerolls",t.rerolls||1),a("mazemaster_dice_on_success",t.onSuccess),a("mazemaster_dice_on_fail",t.onFail),a("mazemaster_dice_on_crit",t.onCritical);const n=document.getElementById("mazemaster_dice_diff_val");n&&(n.textContent="(".concat(t.difficulty||5,")"))}vt&&vt.addEventListener("click",(()=>{var e,t,a,n,o,i,r,s,l,c,m,d,u;const p=null===(e=document.getElementById("mazemaster_dice_profile_select"))||void 0===e?void 0:e.value;if(!p)return void alert("Please create a Dice profile first");pa(p,{mainTitle:(null===(t=document.getElementById("mazemaster_dice_main_title"))||void 0===t?void 0:t.value)||"",description:(null===(a=document.getElementById("mazemaster_dice_description"))||void 0===a?void 0:a.value)||"",diceCount:parseInt(null===(n=document.getElementById("mazemaster_dice_count"))||void 0===n?void 0:n.value)||2,diceType:parseInt(null===(o=document.getElementById("mazemaster_dice_type"))||void 0===o?void 0:o.value)||6,targetNumber:parseInt(null===(i=document.getElementById("mazemaster_dice_target"))||void 0===i?void 0:i.value)||7,modifier:parseInt(null===(r=document.getElementById("mazemaster_dice_modifier"))||void 0===r?void 0:r.value)||0,difficulty:parseInt(null===(s=document.getElementById("mazemaster_dice_difficulty"))||void 0===s?void 0:s.value)||5,damage:parseInt(null===(l=document.getElementById("mazemaster_dice_damage"))||void 0===l?void 0:l.value)||15,rerolls:parseInt(null===(c=document.getElementById("mazemaster_dice_rerolls"))||void 0===c?void 0:c.value)||1,onSuccess:(null===(m=document.getElementById("mazemaster_dice_on_success"))||void 0===m?void 0:m.value)||"",onFail:(null===(d=document.getElementById("mazemaster_dice_on_fail"))||void 0===d?void 0:d.value)||"",onCritical:(null===(u=document.getElementById("mazemaster_dice_on_crit"))||void 0===u?void 0:u.value)||""}),alert('Dice profile "'.concat(p,'" saved!'))})),qt.currentDiceProfile&&bt(qt.currentDiceProfile);const zt=document.getElementById("mazemaster_stealth_profile_select");zt&&zt.addEventListener("change",(e=>{qt.currentStealthProfile=e.target.value,i(),Pt(e.target.value)}));const xt=document.getElementById("mazemaster_stealth_new_profile_btn");xt&&xt.addEventListener("click",(async e=>{e.preventDefault(),e.stopPropagation();const a=await u("Enter new Stealth profile name:",p.INPUT,"");if(a&&a.trim()){const e=a.trim();if(qt.stealthProfiles[e])await u('Stealth profile "'.concat(e,'" already exists.'),p.TEXT);else{fa(e,t(t({},ga("Tutorial - Stealth Basics")||{}),{},{mainTitle:e})),qt.currentStealthProfile=e,i(),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click(),setTimeout((()=>{var e;null===(e=document.querySelector('[data-combat="stealth"]'))||void 0===e||e.click()}),50)}),100)}}}));const wt=document.getElementById("mazemaster_stealth_delete_profile_btn");wt&&wt.addEventListener("click",(async()=>{var e;const t=null===(e=document.getElementById("mazemaster_stealth_profile_select"))||void 0===e?void 0:e.value;if(t){await u('Delete Stealth profile "'.concat(t,'"?'),p.CONFIRM)&&(!function(e){var t;if(null===(t=qt.stealthProfiles)||void 0===t||delete t[e],qt.currentStealthProfile===e){const e=ha();qt.currentStealthProfile=e[0]||""}i()}(t),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click(),setTimeout((()=>{var e;null===(e=document.querySelector('[data-combat="stealth"]'))||void 0===e||e.click()}),50)}),100))}}));const Et=document.getElementById("mazemaster_stealth_rename_profile_btn");Et&&Et.addEventListener("click",(async()=>{var e;const t=null===(e=document.getElementById("mazemaster_stealth_profile_select"))||void 0===e?void 0:e.value;if(!t)return void alert("No profile selected to rename");const a=await u("Enter new profile name:",p.INPUT,t);if(a&&a.trim()&&a.trim()!==t){const e=a.trim();if(qt.stealthProfiles[e])return void alert("A profile with that name already exists");qt.stealthProfiles[e]=qt.stealthProfiles[t],qt.stealthProfiles[e].mainTitle=e,delete qt.stealthProfiles[t],qt.currentStealthProfile=e,i(),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click(),setTimeout((()=>{var e;null===(e=document.querySelector('[data-combat="stealth"]'))||void 0===e||e.click()}),50)}),100)}}));const St=document.getElementById("mazemaster_preview_stealth_btn");St&&St.addEventListener("click",(()=>{var e;const t=null===(e=document.getElementById("mazemaster_stealth_profile_select"))||void 0===e?void 0:e.value;if(!t)return void alert("Please select a Stealth profile first");const a=ao(t);a.error&&alert("Error: ".concat(a.error))}));const Tt=document.getElementById("mazemaster_stealth_difficulty"),It=document.getElementById("mazemaster_stealth_diff_val");Tt&&It&&Tt.addEventListener("input",(e=>{It.textContent="(".concat(e.target.value,")")}));const Mt=document.getElementById("mazemaster_stealth_save_btn");function Pt(e){const t=ga(e)||{},a=(e,t)=>{const a=document.getElementById(e);a&&(a.value=null!=t?t:"")};a("mazemaster_stealth_main_title",t.mainTitle),a("mazemaster_stealth_guard_name",t.guardName||"Guard"),a("mazemaster_stealth_description",t.description),a("mazemaster_stealth_sections",t.sections||3),a("mazemaster_stealth_detection_limit",t.detectionLimit||100),a("mazemaster_stealth_base_detection",t.baseDetection||15),a("mazemaster_stealth_damage",t.damage||20),a("mazemaster_stealth_difficulty",t.difficulty||5),a("mazemaster_stealth_hide_reduce",t.hideReduction||10),a("mazemaster_stealth_distract_max",t.distractMax||25),a("mazemaster_stealth_on_success",t.onSuccess),a("mazemaster_stealth_on_caught",t.onCaught);const n=document.getElementById("mazemaster_stealth_diff_val");n&&(n.textContent="(".concat(t.difficulty||5,")"))}Mt&&Mt.addEventListener("click",(()=>{var e,t,a,n,o,i,r,s,l,c,m,d,u;const p=null===(e=document.getElementById("mazemaster_stealth_profile_select"))||void 0===e?void 0:e.value;if(!p)return void alert("Please create a Stealth profile first");fa(p,{mainTitle:(null===(t=document.getElementById("mazemaster_stealth_main_title"))||void 0===t?void 0:t.value)||"",guardName:(null===(a=document.getElementById("mazemaster_stealth_guard_name"))||void 0===a?void 0:a.value)||"Guard",description:(null===(n=document.getElementById("mazemaster_stealth_description"))||void 0===n?void 0:n.value)||"",sections:parseInt(null===(o=document.getElementById("mazemaster_stealth_sections"))||void 0===o?void 0:o.value)||3,detectionLimit:parseInt(null===(i=document.getElementById("mazemaster_stealth_detection_limit"))||void 0===i?void 0:i.value)||100,baseDetection:parseInt(null===(r=document.getElementById("mazemaster_stealth_base_detection"))||void 0===r?void 0:r.value)||15,damage:parseInt(null===(s=document.getElementById("mazemaster_stealth_damage"))||void 0===s?void 0:s.value)||20,difficulty:parseInt(null===(l=document.getElementById("mazemaster_stealth_difficulty"))||void 0===l?void 0:l.value)||5,hideReduction:parseInt(null===(c=document.getElementById("mazemaster_stealth_hide_reduce"))||void 0===c?void 0:c.value)||10,distractMax:parseInt(null===(m=document.getElementById("mazemaster_stealth_distract_max"))||void 0===m?void 0:m.value)||25,onSuccess:(null===(d=document.getElementById("mazemaster_stealth_on_success"))||void 0===d?void 0:d.value)||"",onCaught:(null===(u=document.getElementById("mazemaster_stealth_on_caught"))||void 0===u?void 0:u.value)||""}),alert('Stealth profile "'.concat(p,'" saved!'))})),qt.currentStealthProfile&&Pt(qt.currentStealthProfile);const Dt=document.getElementById("mazemaster_puzzle_profile_select");Dt&&Dt.addEventListener("change",(e=>{qt.currentPuzzleProfile=e.target.value,i(),Ft(e.target.value)}));const At=document.getElementById("mazemaster_puzzle_new_profile_btn");At&&At.addEventListener("click",(async e=>{e.preventDefault(),e.stopPropagation();const a=await u("Enter new Puzzle profile name:",p.INPUT,"");if(a&&a.trim()){const e=a.trim();if(qt.puzzleProfiles[e])await u('Puzzle profile "'.concat(e,'" already exists.'),p.TEXT);else{ba(e,t(t({},va("Tutorial - Mind Training")||{}),{},{mainTitle:e})),qt.currentPuzzleProfile=e,i(),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click(),setTimeout((()=>{var e;null===(e=document.querySelector('[data-combat="puzzle"]'))||void 0===e||e.click()}),50)}),100)}}}));const Bt=document.getElementById("mazemaster_puzzle_delete_profile_btn");Bt&&Bt.addEventListener("click",(async()=>{var e;const t=null===(e=document.getElementById("mazemaster_puzzle_profile_select"))||void 0===e?void 0:e.value;if(t){await u('Delete Puzzle profile "'.concat(t,'"?'),p.CONFIRM)&&(!function(e){var t;if(null===(t=qt.puzzleProfiles)||void 0===t||delete t[e],qt.currentPuzzleProfile===e){const e=ya();qt.currentPuzzleProfile=e[0]||""}i()}(t),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click(),setTimeout((()=>{var e;null===(e=document.querySelector('[data-combat="puzzle"]'))||void 0===e||e.click()}),50)}),100))}}));const Lt=document.getElementById("mazemaster_puzzle_rename_profile_btn");Lt&&Lt.addEventListener("click",(async()=>{var e;const t=null===(e=document.getElementById("mazemaster_puzzle_profile_select"))||void 0===e?void 0:e.value;if(!t)return void alert("No profile selected to rename");const a=await u("Enter new profile name:",p.INPUT,t);if(a&&a.trim()&&a.trim()!==t){const e=a.trim();if(qt.puzzleProfiles[e])return void alert("A profile with that name already exists");qt.puzzleProfiles[e]=qt.puzzleProfiles[t],qt.puzzleProfiles[e].mainTitle=e,delete qt.puzzleProfiles[t],qt.currentPuzzleProfile=e,i(),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click(),setTimeout((()=>{var e;null===(e=document.querySelector('[data-combat="puzzle"]'))||void 0===e||e.click()}),50)}),100)}}));const Rt=document.getElementById("mazemaster_preview_puzzle_btn");Rt&&Rt.addEventListener("click",(()=>{var e;const t=null===(e=document.getElementById("mazemaster_puzzle_profile_select"))||void 0===e?void 0:e.value;if(!t)return void alert("Please select a Puzzle profile first");const a=lo(t);a.error&&alert("Error: ".concat(a.error))}));const Nt=document.getElementById("mazemaster_puzzle_difficulty"),Ht=document.getElementById("mazemaster_puzzle_diff_val");Nt&&Ht&&Nt.addEventListener("input",(e=>{Ht.textContent="(".concat(e.target.value,")")}));const Ot=document.getElementById("mazemaster_puzzle_save_btn");function Ft(e){const t=va(e)||{},a=(e,t)=>{const a=document.getElementById(e);a&&(a.value=null!=t?t:"")};a("mazemaster_puzzle_main_title",t.mainTitle),a("mazemaster_puzzle_description",t.description),a("mazemaster_puzzle_grid_size",t.gridSize||3),a("mazemaster_puzzle_seq_length",t.sequenceLength||4),a("mazemaster_puzzle_max_mistakes",t.maxMistakes||5),a("mazemaster_puzzle_hints",t.hints||3),a("mazemaster_puzzle_difficulty",t.difficulty||5),a("mazemaster_puzzle_damage",t.damage||15),a("mazemaster_puzzle_time_limit",t.timeLimit||60),a("mazemaster_puzzle_on_solve",t.onSolve),a("mazemaster_puzzle_on_fail",t.onFail);const n=document.getElementById("mazemaster_puzzle_diff_val");n&&(n.textContent="(".concat(t.difficulty||5,")"))}Ot&&Ot.addEventListener("click",(()=>{var e,t,a,n,o,i,r,s,l,c,m,d;const u=null===(e=document.getElementById("mazemaster_puzzle_profile_select"))||void 0===e?void 0:e.value;if(!u)return void alert("Please create a Puzzle profile first");ba(u,{mainTitle:(null===(t=document.getElementById("mazemaster_puzzle_main_title"))||void 0===t?void 0:t.value)||"",description:(null===(a=document.getElementById("mazemaster_puzzle_description"))||void 0===a?void 0:a.value)||"",gridSize:parseInt(null===(n=document.getElementById("mazemaster_puzzle_grid_size"))||void 0===n?void 0:n.value)||3,sequenceLength:parseInt(null===(o=document.getElementById("mazemaster_puzzle_seq_length"))||void 0===o?void 0:o.value)||4,maxMistakes:parseInt(null===(i=document.getElementById("mazemaster_puzzle_max_mistakes"))||void 0===i?void 0:i.value)||5,hints:parseInt(null===(r=document.getElementById("mazemaster_puzzle_hints"))||void 0===r?void 0:r.value)||3,difficulty:parseInt(null===(s=document.getElementById("mazemaster_puzzle_difficulty"))||void 0===s?void 0:s.value)||5,damage:parseInt(null===(l=document.getElementById("mazemaster_puzzle_damage"))||void 0===l?void 0:l.value)||15,timeLimit:parseInt(null===(c=document.getElementById("mazemaster_puzzle_time_limit"))||void 0===c?void 0:c.value)||60,onSolve:(null===(m=document.getElementById("mazemaster_puzzle_on_solve"))||void 0===m?void 0:m.value)||"",onFail:(null===(d=document.getElementById("mazemaster_puzzle_on_fail"))||void 0===d?void 0:d.value)||""}),alert('Puzzle profile "'.concat(u,'" saved!'))})),qt.currentPuzzleProfile&&Ft(qt.currentPuzzleProfile);const Wt=document.getElementById("mazemaster_negotiation_profile_select");Wt&&Wt.addEventListener("change",(e=>{qt.currentNegotiationProfile=e.target.value,i(),Qt(e.target.value)}));const Yt=document.getElementById("mazemaster_negotiation_new_profile_btn");Yt&&Yt.addEventListener("click",(async e=>{e.preventDefault(),e.stopPropagation();const a=await u("Enter new Negotiation profile name:",p.INPUT,"");if(a&&a.trim()){const e=a.trim();if(qt.negotiationProfiles[e])await u('Negotiation profile "'.concat(e,'" already exists.'),p.TEXT);else{xa(e,t(t({},_a("Tutorial - Social Training")||{}),{},{mainTitle:e})),qt.currentNegotiationProfile=e,i(),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click(),setTimeout((()=>{var e;null===(e=document.querySelector('[data-combat="negotiation"]'))||void 0===e||e.click()}),50)}),100)}}}));const Ut=document.getElementById("mazemaster_negotiation_delete_profile_btn");Ut&&Ut.addEventListener("click",(async()=>{var e;const t=null===(e=document.getElementById("mazemaster_negotiation_profile_select"))||void 0===e?void 0:e.value;if(t){await u('Delete Negotiation profile "'.concat(t,'"?'),p.CONFIRM)&&(!function(e){var t;if(null===(t=qt.negotiationProfiles)||void 0===t||delete t[e],qt.currentNegotiationProfile===e){const e=za();qt.currentNegotiationProfile=e[0]||""}i()}(t),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click(),setTimeout((()=>{var e;null===(e=document.querySelector('[data-combat="negotiation"]'))||void 0===e||e.click()}),50)}),100))}}));const Gt=document.getElementById("mazemaster_negotiation_rename_profile_btn");Gt&&Gt.addEventListener("click",(async()=>{var e;const t=null===(e=document.getElementById("mazemaster_negotiation_profile_select"))||void 0===e?void 0:e.value;if(!t)return void alert("No profile selected to rename");const a=await u("Enter new profile name:",p.INPUT,t);if(a&&a.trim()&&a.trim()!==t){const e=a.trim();if(qt.negotiationProfiles[e])return void alert("A profile with that name already exists");qt.negotiationProfiles[e]=qt.negotiationProfiles[t],qt.negotiationProfiles[e].mainTitle=e,delete qt.negotiationProfiles[t],qt.currentNegotiationProfile=e,i(),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click(),setTimeout((()=>{var e;null===(e=document.querySelector('[data-combat="negotiation"]'))||void 0===e||e.click()}),50)}),100)}}));const jt=document.getElementById("mazemaster_preview_negotiation_btn");jt&&jt.addEventListener("click",(()=>{var e;const t=null===(e=document.getElementById("mazemaster_negotiation_profile_select"))||void 0===e?void 0:e.value;if(!t)return void alert("Please select a Negotiation profile first");const a=yo(t);a.error&&alert("Error: ".concat(a.error))}));const Kt=document.getElementById("mazemaster_negotiate_difficulty"),Vt=document.getElementById("mazemaster_negotiate_diff_val");Kt&&Vt&&Kt.addEventListener("input",(e=>{Vt.textContent="(".concat(e.target.value,")")}));const Xt=document.getElementById("mazemaster_negotiate_save_btn");function Qt(e){const t=_a(e)||{},a=(e,t)=>{const a=document.getElementById(e);a&&(a.value=null!=t?t:"")};a("mazemaster_negotiate_main_title",t.mainTitle),a("mazemaster_negotiate_npc_name",t.npcName||"NPC"),a("mazemaster_negotiate_description",t.description),a("mazemaster_negotiate_favor_target",t.favorTarget||75),a("mazemaster_negotiate_starting_favor",t.startingFavor||25),a("mazemaster_negotiate_max_turns",t.maxTurns||6),a("mazemaster_negotiate_damage",t.damage||10),a("mazemaster_negotiate_difficulty",t.difficulty||5),a("mazemaster_negotiate_persuade",t.persuadeAvg||12),a("mazemaster_negotiate_flatter",t.flatterAvg||10),a("mazemaster_negotiate_mood",t.startingMood||"unfriendly"),a("mazemaster_negotiate_intimidate",t.intimidateRisk||"medium"),a("mazemaster_negotiate_bribe_cost",t.bribeCost||"gold"),a("mazemaster_negotiate_on_success",t.onSuccess),a("mazemaster_negotiate_on_fail",t.onFail);const n=document.getElementById("mazemaster_negotiate_diff_val");n&&(n.textContent="(".concat(t.difficulty||5,")"))}Xt&&Xt.addEventListener("click",(()=>{var e,t,a,n,o,i,r,s,l,c,m,d,u,p,h,g;const f=null===(e=document.getElementById("mazemaster_negotiation_profile_select"))||void 0===e?void 0:e.value;if(!f)return void alert("Please create a Negotiation profile first");xa(f,{mainTitle:(null===(t=document.getElementById("mazemaster_negotiate_main_title"))||void 0===t?void 0:t.value)||"",npcName:(null===(a=document.getElementById("mazemaster_negotiate_npc_name"))||void 0===a?void 0:a.value)||"NPC",description:(null===(n=document.getElementById("mazemaster_negotiate_description"))||void 0===n?void 0:n.value)||"",favorTarget:parseInt(null===(o=document.getElementById("mazemaster_negotiate_favor_target"))||void 0===o?void 0:o.value)||75,startingFavor:parseInt(null===(i=document.getElementById("mazemaster_negotiate_starting_favor"))||void 0===i?void 0:i.value)||25,maxTurns:parseInt(null===(r=document.getElementById("mazemaster_negotiate_max_turns"))||void 0===r?void 0:r.value)||6,damage:parseInt(null===(s=document.getElementById("mazemaster_negotiate_damage"))||void 0===s?void 0:s.value)||10,difficulty:parseInt(null===(l=document.getElementById("mazemaster_negotiate_difficulty"))||void 0===l?void 0:l.value)||5,persuadeAvg:parseInt(null===(c=document.getElementById("mazemaster_negotiate_persuade"))||void 0===c?void 0:c.value)||12,flatterAvg:parseInt(null===(m=document.getElementById("mazemaster_negotiate_flatter"))||void 0===m?void 0:m.value)||10,startingMood:(null===(d=document.getElementById("mazemaster_negotiate_mood"))||void 0===d?void 0:d.value)||"unfriendly",intimidateRisk:(null===(u=document.getElementById("mazemaster_negotiate_intimidate"))||void 0===u?void 0:u.value)||"medium",bribeCost:(null===(p=document.getElementById("mazemaster_negotiate_bribe_cost"))||void 0===p?void 0:p.value)||"gold",onSuccess:(null===(h=document.getElementById("mazemaster_negotiate_on_success"))||void 0===h?void 0:h.value)||"",onFail:(null===(g=document.getElementById("mazemaster_negotiate_on_fail"))||void 0===g?void 0:g.value)||""}),alert('Negotiation profile "'.concat(f,'" saved!'))})),qt.currentNegotiationProfile&&Qt(qt.currentNegotiationProfile);const Jt=document.getElementById("mazemaster_cm_profile_select");Jt&&Jt.addEventListener("change",(e=>{qt.currentCombatMechanicsProfile=e.target.value,i(),qa(e.target.value)}));const Zt=document.getElementById("mazemaster_cm_new_profile_btn");Zt&&Zt.addEventListener("click",(async e=>{e.preventDefault(),e.stopPropagation();const t=await u("Enter new combat mechanics profile name:",p.INPUT,"");if(t&&t.trim()){var a;const e=t.trim();null!==(a=qt.combatMechanicsProfiles)&&void 0!==a&&a[e]||Ge[e]?await u('Combat mechanics profile "'.concat(e,'" already exists.'),p.TEXT):(Ca(e,Ge.default),qt.currentCombatMechanicsProfile=e,i(),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_combat"))||void 0===e||e.click(),setTimeout((()=>{var e;null===(e=document.querySelector('.combat-subtab[data-combat="mechanics"]'))||void 0===e||e.click()}),100)}),100))}}));const Ta=document.getElementById("mazemaster_cm_delete_profile_btn");Ta&&Ta.addEventListener("click",(async()=>{var e;const t=null===(e=document.getElementById("mazemaster_cm_profile_select"))||void 0===e?void 0:e.value;if(t){if(Ge[t])return void await u("Cannot delete default profiles.",p.TEXT);await u('Delete combat mechanics profile "'.concat(t,'"?'),p.CONFIRM)&&(wa(t),is())}}));const Ma=document.getElementById("mazemaster_cm_rename_profile_btn");Ma&&Ma.addEventListener("click",(async()=>{var e;const t=null===(e=document.getElementById("mazemaster_cm_profile_select"))||void 0===e?void 0:e.value;if(!t)return;if(Ge[t])return void await u("Cannot rename default profiles.",p.TEXT);const a=await u("Enter new name:",p.INPUT,t);if(a&&a.trim()&&a.trim()!==t){const e=a.trim();Ca(e,ka(t)),wa(t),qt.currentCombatMechanicsProfile=e,i(),is()}}));const Ba=document.getElementById("mazemaster_cm_save_btn");function qa(e){const t=ka(e)||Ge.default,a=(e,t)=>{const a=document.getElementById(e);a&&(a.value=null!=t?t:"")},n=(e,t)=>{const a=document.getElementById(e);a&&(a.checked=null!=t&&t)};n("mazemaster_cm_combo_enabled",t.comboEnabled),a("mazemaster_cm_combo_bonus",t.comboBonusPerHit||5),a("mazemaster_cm_combo_max",t.maxComboBonus||50),a("mazemaster_cm_combo_decay",t.comboDecayTurns||2),n("mazemaster_cm_combo_reset_miss",!1!==t.comboResetOnMiss),n("mazemaster_cm_combo_reset_damage",t.comboResetOnDamage||!1),n("mazemaster_cm_block_enabled",t.blockEnabled),a("mazemaster_cm_block_reduction",Math.round(100*(t.blockDamageReduction||.5))),a("mazemaster_cm_block_threshold",t.blockBreakThreshold||0),a("mazemaster_cm_perfect_block",Math.round(100*(t.perfectBlockReduction||.8))),n("mazemaster_cm_parry_enabled",t.parryEnabled),a("mazemaster_cm_parry_window",t.parryWindow||.5),a("mazemaster_cm_parry_mult",t.parryDamageMultiplier||1.5),a("mazemaster_cm_parry_stun",t.parryStunDuration||1),a("mazemaster_cm_parry_diff",t.parryDifficulty||"normal"),n("mazemaster_cm_counter_enabled",!1!==t.counterEnabled),a("mazemaster_cm_counter_bonus",t.counterDamageBonus||25),a("mazemaster_cm_counter_crit",t.counterCritBonus||15),a("mazemaster_cm_on_combo",t.onComboIncrease||""),a("mazemaster_cm_on_combo_break",t.onComboBreak||""),a("mazemaster_cm_on_block",t.onBlockSuccess||""),a("mazemaster_cm_on_parry",t.onParrySuccess||""),a("mazemaster_cm_on_counter",t.onCounterAttack||"")}Ba&&Ba.addEventListener("click",(()=>{var e,t,a,n,o,i,r,s,l,c,m,d,u,p,h,g,f,y,v,b,z,_,x,k,C,w,E,S,T,I;const M=null===(e=document.getElementById("mazemaster_cm_profile_select"))||void 0===e?void 0:e.value;if(!M)return void alert("Please select a combat mechanics profile first");Ca(M,{name:M,comboEnabled:null===(t=null===(a=document.getElementById("mazemaster_cm_combo_enabled"))||void 0===a?void 0:a.checked)||void 0===t||t,comboBonusPerHit:parseInt(null===(n=document.getElementById("mazemaster_cm_combo_bonus"))||void 0===n?void 0:n.value)||5,maxComboBonus:parseInt(null===(o=document.getElementById("mazemaster_cm_combo_max"))||void 0===o?void 0:o.value)||50,comboDecayTurns:parseInt(null===(i=document.getElementById("mazemaster_cm_combo_decay"))||void 0===i?void 0:i.value)||2,comboResetOnMiss:null===(r=null===(s=document.getElementById("mazemaster_cm_combo_reset_miss"))||void 0===s?void 0:s.checked)||void 0===r||r,comboResetOnDamage:null!==(l=null===(c=document.getElementById("mazemaster_cm_combo_reset_damage"))||void 0===c?void 0:c.checked)&&void 0!==l&&l,blockEnabled:null===(m=null===(d=document.getElementById("mazemaster_cm_block_enabled"))||void 0===d?void 0:d.checked)||void 0===m||m,blockDamageReduction:(parseInt(null===(u=document.getElementById("mazemaster_cm_block_reduction"))||void 0===u?void 0:u.value)||50)/100,blockBreakThreshold:parseInt(null===(p=document.getElementById("mazemaster_cm_block_threshold"))||void 0===p?void 0:p.value)||0,perfectBlockReduction:(parseInt(null===(h=document.getElementById("mazemaster_cm_perfect_block"))||void 0===h?void 0:h.value)||80)/100,parryEnabled:null===(g=null===(f=document.getElementById("mazemaster_cm_parry_enabled"))||void 0===f?void 0:f.checked)||void 0===g||g,parryWindow:parseFloat(null===(y=document.getElementById("mazemaster_cm_parry_window"))||void 0===y?void 0:y.value)||.5,parryDamageMultiplier:parseFloat(null===(v=document.getElementById("mazemaster_cm_parry_mult"))||void 0===v?void 0:v.value)||1.5,parryStunDuration:parseInt(null===(b=document.getElementById("mazemaster_cm_parry_stun"))||void 0===b?void 0:b.value)||1,parryDifficulty:(null===(z=document.getElementById("mazemaster_cm_parry_diff"))||void 0===z?void 0:z.value)||"normal",counterEnabled:null===(_=null===(x=document.getElementById("mazemaster_cm_counter_enabled"))||void 0===x?void 0:x.checked)||void 0===_||_,counterDamageBonus:parseInt(null===(k=document.getElementById("mazemaster_cm_counter_bonus"))||void 0===k?void 0:k.value)||25,counterCritBonus:parseInt(null===(C=document.getElementById("mazemaster_cm_counter_crit"))||void 0===C?void 0:C.value)||15,onComboIncrease:(null===(w=document.getElementById("mazemaster_cm_on_combo"))||void 0===w?void 0:w.value)||"",onComboBreak:(null===(E=document.getElementById("mazemaster_cm_on_combo_break"))||void 0===E?void 0:E.value)||"",onBlockSuccess:(null===(S=document.getElementById("mazemaster_cm_on_block"))||void 0===S?void 0:S.value)||"",onParrySuccess:(null===(T=document.getElementById("mazemaster_cm_on_parry"))||void 0===T?void 0:T.value)||"",onCounterAttack:(null===(I=document.getElementById("mazemaster_cm_on_counter"))||void 0===I?void 0:I.value)||""}),toastr.success('Combat mechanics profile "'.concat(M,'" saved!'))})),qt.currentCombatMechanicsProfile&&qa(qt.currentCombatMechanicsProfile);let Wa=[];const Ya=document.getElementById("mazemaster_item_add_btn");Ya&&Ya.addEventListener("click",(()=>{document.getElementById("mazemaster_item_edit_id").value="",document.getElementById("mazemaster_item_name").value="",document.getElementById("mazemaster_item_type").value="consumable",document.getElementById("mazemaster_item_rarity").value="common",document.getElementById("mazemaster_item_icon").value="fa-box",document.getElementById("mazemaster_item_subtype").value="",document.getElementById("mazemaster_item_loot_weight").value="20",document.getElementById("mazemaster_item_description").value="",document.getElementById("mazemaster_item_attack").value="0",document.getElementById("mazemaster_item_defense").value="0",document.getElementById("mazemaster_item_crit").value="0",document.getElementById("mazemaster_item_on_use").value="",document.getElementById("mazemaster_item_on_equip").value="",document.getElementById("mazemaster_item_source_chest").checked=!0,document.getElementById("mazemaster_item_source_combat").checked=!1,document.getElementById("mazemaster_item_source_shop").checked=!1,document.getElementById("mazemaster_item_source_quest").checked=!1,document.getElementById("mazemaster_item_charges").value="3",document.getElementById("mazemaster_item_absorb_percent").value="100",document.getElementById("mazemaster_item_auto_use").checked=!0,document.getElementById("mazemaster_item_trigger_combat").checked=!0,document.getElementById("mazemaster_item_trigger_trap").checked=!0,document.getElementById("mazemaster_item_heal_amount").value="25",document.getElementById("mazemaster_item_heal_is_percent").checked=!0,document.getElementById("mazemaster_item_visibility_bonus").value="1",document.getElementById("mazemaster_item_duration").value="0",document.getElementById("mazemaster_item_is_passive").checked=!1;Je().forEach((e=>{const t=document.getElementById("mazemaster_item_alias_".concat(e));t&&(t.value="")})),Wa=[],Ka(),Va("consumable"),document.getElementById("mazemaster_item_editor").style.display="block"}));const Ua=document.getElementById("mazemaster_item_cancel_btn");Ua&&Ua.addEventListener("click",(()=>{document.getElementById("mazemaster_item_editor").style.display="none"}));const Ga=document.getElementById("mazemaster_item_save_btn");Ga&&Ga.addEventListener("click",(()=>{var e,a,n,o,r,s,l,c,m,d,u,p,h,g,f,y,v,b,z,_,x,k,C,w,E,S,T;const I=null===(e=document.getElementById("mazemaster_item_edit_id"))||void 0===e?void 0:e.value,M=null===(a=document.getElementById("mazemaster_item_name"))||void 0===a||null===(a=a.value)||void 0===a?void 0:a.trim();if(!M)return void toastr.error("Item name is required");const P=[];null!==(n=document.getElementById("mazemaster_item_source_chest"))&&void 0!==n&&n.checked&&P.push("chest"),null!==(o=document.getElementById("mazemaster_item_source_combat"))&&void 0!==o&&o.checked&&P.push("combat"),null!==(r=document.getElementById("mazemaster_item_source_shop"))&&void 0!==r&&r.checked&&P.push("shop"),null!==(s=document.getElementById("mazemaster_item_source_quest"))&&void 0!==s&&s.checked&&P.push("quest");const D=(null===(l=document.getElementById("mazemaster_item_type"))||void 0===l?void 0:l.value)||"consumable",A=[];null!==(c=document.getElementById("mazemaster_item_trigger_combat"))&&void 0!==c&&c.checked&&A.push("combat"),null!==(m=document.getElementById("mazemaster_item_trigger_trap"))&&void 0!==m&&m.checked&&A.push("trap");const B={};Je().forEach((e=>{var t;const a=null===(t=document.getElementById("mazemaster_item_alias_".concat(e)))||void 0===t||null===(t=t.value)||void 0===t?void 0:t.trim();a&&(B[e]=a)}));const L={id:I||M.toLowerCase().replace(/\s+/g,"_"),name:M,type:D,rarity:(null===(d=document.getElementById("mazemaster_item_rarity"))||void 0===d?void 0:d.value)||"common",icon:(null===(u=document.getElementById("mazemaster_item_icon"))||void 0===u?void 0:u.value)||"fa-box",subtype:(null===(p=document.getElementById("mazemaster_item_subtype"))||void 0===p?void 0:p.value)||null,lootWeight:parseInt(null===(h=document.getElementById("mazemaster_item_loot_weight"))||void 0===h?void 0:h.value)||20,description:(null===(g=document.getElementById("mazemaster_item_description"))||void 0===g?void 0:g.value)||"",attack:parseInt(null===(f=document.getElementById("mazemaster_item_attack"))||void 0===f?void 0:f.value)||0,defense:parseInt(null===(y=document.getElementById("mazemaster_item_defense"))||void 0===y?void 0:y.value)||0,critBonus:parseInt(null===(v=document.getElementById("mazemaster_item_crit"))||void 0===v?void 0:v.value)||0,effects:Wa,lootSources:P,onUse:(null===(b=document.getElementById("mazemaster_item_on_use"))||void 0===b?void 0:b.value)||"",onEquip:(null===(z=document.getElementById("mazemaster_item_on_equip"))||void 0===z?void 0:z.value)||"",aliases:Object.keys(B).length>0?B:void 0,charges:"equipment"===D?parseInt(null===(_=document.getElementById("mazemaster_item_charges"))||void 0===_?void 0:_.value)||3:void 0,absorbPercent:"equipment"===D?parseInt(null===(x=document.getElementById("mazemaster_item_absorb_percent"))||void 0===x?void 0:x.value)||100:void 0,autoUse:"equipment"===D?null===(k=document.getElementById("mazemaster_item_auto_use"))||void 0===k?void 0:k.checked:void 0,triggers:"equipment"===D&&A.length>0?A:void 0,healAmount:"potion"===D?parseInt(null===(C=document.getElementById("mazemaster_item_heal_amount"))||void 0===C?void 0:C.value)||25:void 0,healIsPercent:"potion"===D?null===(w=document.getElementById("mazemaster_item_heal_is_percent"))||void 0===w?void 0:w.checked:void 0,visibilityBonus:"vision"===D?parseInt(null===(E=document.getElementById("mazemaster_item_visibility_bonus"))||void 0===E?void 0:E.value)||1:void 0,duration:"vision"===D?parseInt(null===(S=document.getElementById("mazemaster_item_duration"))||void 0===S?void 0:S.value)||0:void 0,passive:"vision"===D?null===(T=document.getElementById("mazemaster_item_is_passive"))||void 0===T?void 0:T.checked:void 0};var q,R;Ve[I]?(q=I,R=L,qt.itemProfiles||(qt.itemProfiles={}),qt.itemProfiles[q]=R,i(),toastr.success('Item "'.concat(M,'" customized!')),Qa()):I?(!function(e,a){var n;null===(n=qt.customItems)||void 0===n||!n[e]||(qt.customItems[e]=t(t(t({},qt.customItems[e]),a),{},{id:e}),i())}(I,L),toastr.success('Item "'.concat(M,'" updated!'))):(Sa(L),toastr.success('Item "'.concat(M,'" created!'))),document.getElementById("mazemaster_item_editor").style.display="none",Oa(),Fa(),Ja()}));const ja=document.getElementById("mazemaster_item_add_effect_btn");function Ka(){const e=document.getElementById("mazemaster_item_effects_list");e&&(0!==Wa.length?(e.innerHTML=Wa.map(((e,t)=>'\n            <div class="mazemaster-effect-row" data-index="'.concat(t,'">\n                <select class="effect-type mazemaster-select" style="width: 100px;">\n                    <option value="damage" ').concat("damage"===e.type?"selected":"",'>Damage</option>\n                    <option value="heal" ').concat("heal"===e.type?"selected":"",'>Heal</option>\n                    <option value="status" ').concat("status"===e.type?"selected":"",'>Status</option>\n                    <option value="buff" ').concat("buff"===e.type?"selected":"",'>Buff</option>\n                    <option value="teleport" ').concat("teleport"===e.type?"selected":"",'>Teleport</option>\n                    <option value="reveal" ').concat("reveal"===e.type?"selected":"",'>Reveal</option>\n                </select>\n                <select class="effect-target mazemaster-select" style="width: 80px;">\n                    <option value="enemy" ').concat("enemy"===e.target?"selected":"",'>Enemy</option>\n                    <option value="self" ').concat("self"===e.target?"selected":"",'>Self</option>\n                </select>\n                <input type="number" class="effect-value" value="').concat(e.value||0,'" min="0" max="999" style="width: 60px;" placeholder="Value">\n                <input type="text" class="effect-extra" value="').concat(e.element||e.status||"",'" style="width: 80px;" placeholder="Element/Status">\n                <button class="menu_button menu_button_icon effect-delete" title="Remove">\n                    <i class="fa-solid fa-times"></i>\n                </button>\n            </div>\n        '))).join(""),e.querySelectorAll(".mazemaster-effect-row").forEach(((e,t)=>{e.querySelector(".effect-type").addEventListener("change",(e=>{Wa[t].type=e.target.value})),e.querySelector(".effect-target").addEventListener("change",(e=>{Wa[t].target=e.target.value})),e.querySelector(".effect-value").addEventListener("change",(e=>{Wa[t].value=parseInt(e.target.value)||0})),e.querySelector(".effect-extra").addEventListener("change",(e=>{const a=e.target.value;"status"===Wa[t].type?Wa[t].status=a:Wa[t].element=a})),e.querySelector(".effect-delete").addEventListener("click",(()=>{Wa.splice(t,1),Ka()}))}))):e.innerHTML='<p style="color: #888; font-size: 12px;">No effects. Add effects to define what the item does.</p>')}function Va(e){const t=document.getElementById("mazemaster_item_armor_settings"),a=document.getElementById("mazemaster_item_potion_settings"),n=document.getElementById("mazemaster_item_vision_settings"),o=document.getElementById("mazemaster_item_equip_stats");switch(t&&(t.style.display="none"),a&&(a.style.display="none"),n&&(n.style.display="none"),o&&(o.style.display="none"),e){case"equipment":o&&(o.style.display="block"),t&&(t.style.display="block");break;case"potion":a&&(a.style.display="block");break;case"vision":n&&(n.style.display="block")}}ja&&ja.addEventListener("click",(()=>{Wa.push({type:"damage",target:"enemy",value:10,element:"",status:"",duration:3}),Ka()}));const Xa=document.getElementById("mazemaster_item_type");function Qa(){const e=document.getElementById("mazemaster_default_items_list");if(!e)return;const t=Object.keys(Ve),a=qt.itemProfiles||{};e.innerHTML=t.map((e=>{const t=Ve[e],n=!!a[e],o=t.icon||"fa-box",i=t.iconColor||"#888";return'\n                <div class="mazemaster-item-card default-item '.concat(n?"has-override":"",'" data-id="').concat(e,'" title="').concat(t.description||"",'">\n                    <i class="fa-solid ').concat(o,'" style="color: ').concat(i,'; margin-right: 8px;"></i>\n                    <span class="item-name">').concat(t.name,'</span>\n                    <span class="item-type" style="color: #888; font-size: 11px; margin-left: auto;">').concat(t.type,"</span>\n                    ").concat(n?'<i class="fa-solid fa-pen" style="color: #f39c12; margin-left: 5px;" title="Has custom override"></i>':"","\n                </div>\n            ")})).join(""),e.querySelectorAll(".mazemaster-item-card").forEach((e=>{e.addEventListener("click",(()=>{!function(e){var t;const a=Xe(e);if(!a)return;document.getElementById("mazemaster_item_edit_id").value=e,document.getElementById("mazemaster_item_name").value=a.name||"",document.getElementById("mazemaster_item_type").value=a.type||"consumable",document.getElementById("mazemaster_item_rarity").value=a.rarity||"common",document.getElementById("mazemaster_item_icon").value=a.icon||"fa-box",document.getElementById("mazemaster_item_subtype").value=a.subtype||"",document.getElementById("mazemaster_item_loot_weight").value=null!==(t=a.lootWeight)&&void 0!==t?t:20,document.getElementById("mazemaster_item_description").value=a.description||"",document.getElementById("mazemaster_item_attack").value=a.attack||0,document.getElementById("mazemaster_item_defense").value=a.defense||0,document.getElementById("mazemaster_item_crit").value=a.critBonus||0,document.getElementById("mazemaster_item_charges").value=a.charges||3,document.getElementById("mazemaster_item_absorb_percent").value=a.absorbPercent||100,document.getElementById("mazemaster_item_auto_use").checked=!1!==a.autoUse,document.getElementById("mazemaster_item_trigger_combat").checked=(a.triggers||[]).includes("combat"),document.getElementById("mazemaster_item_trigger_trap").checked=(a.triggers||[]).includes("trap"),document.getElementById("mazemaster_item_heal_amount").value=a.healAmount||25,document.getElementById("mazemaster_item_heal_is_percent").checked=!1!==a.healIsPercent,document.getElementById("mazemaster_item_visibility_bonus").value=a.visibilityBonus||1,document.getElementById("mazemaster_item_duration").value=a.duration||0,document.getElementById("mazemaster_item_is_passive").checked=!!a.passive;Je().forEach((e=>{var t;const n=document.getElementById("mazemaster_item_alias_".concat(e));n&&(n.value=(null===(t=a.aliases)||void 0===t?void 0:t[e])||"")})),document.getElementById("mazemaster_item_on_use").value=a.onUse||a.onActivate||"",document.getElementById("mazemaster_item_on_equip").value=a.onEquip||a.onBreak||"",Wa=JSON.parse(JSON.stringify(a.effects||[])),Ka(),Va(a.type),document.getElementById("mazemaster_item_editor").style.display="block"}(e.dataset.id)}))}))}function Ja(){document.querySelectorAll(".mazemaster-item-edit-btn").forEach((e=>{e.addEventListener("click",(e=>{var t;const a=e.target.closest(".mazemaster-item-card"),n=null==a?void 0:a.dataset.id;if(!n)return;const o=Ea(n);if(!o)return;document.getElementById("mazemaster_item_edit_id").value=n,document.getElementById("mazemaster_item_name").value=o.name||"",document.getElementById("mazemaster_item_type").value=o.type||"consumable",document.getElementById("mazemaster_item_rarity").value=o.rarity||"common",document.getElementById("mazemaster_item_icon").value=o.icon||"fa-box",document.getElementById("mazemaster_item_subtype").value=o.subtype||"",document.getElementById("mazemaster_item_loot_weight").value=null!==(t=o.lootWeight)&&void 0!==t?t:20,document.getElementById("mazemaster_item_description").value=o.description||"",document.getElementById("mazemaster_item_attack").value=o.attack||0,document.getElementById("mazemaster_item_defense").value=o.defense||0,document.getElementById("mazemaster_item_crit").value=o.critBonus||0,document.getElementById("mazemaster_item_on_use").value=o.onUse||"",document.getElementById("mazemaster_item_on_equip").value=o.onEquip||"";const i=o.lootSources||["chest"];document.getElementById("mazemaster_item_source_chest").checked=i.includes("chest"),document.getElementById("mazemaster_item_source_combat").checked=i.includes("combat"),document.getElementById("mazemaster_item_source_shop").checked=i.includes("shop"),document.getElementById("mazemaster_item_source_quest").checked=i.includes("quest"),Wa=JSON.parse(JSON.stringify(o.effects||[])),Ka(),document.getElementById("mazemaster_item_editor").style.display="block"}))})),document.querySelectorAll(".mazemaster-item-delete-btn").forEach((e=>{e.addEventListener("click",(async e=>{const t=e.target.closest(".mazemaster-item-card"),a=null==t?void 0:t.dataset.id;if(!a)return;const n=Ea(a);await u('Delete item "'.concat((null==n?void 0:n.name)||a,'"?'),p.CONFIRM)&&(!function(e){var t;null===(t=qt.customItems)||void 0===t||!t[e]||(delete qt.customItems[e],i())}(a),Oa(),Fa(),Ja())}))}))}Xa&&Xa.addEventListener("change",(e=>{Va(e.target.value)})),Qa();const Za=document.getElementById("mazemaster_items_export_btn");Za&&Za.addEventListener("click",(()=>{const e=JSON.stringify(qt.customItems||{},null,2),t=new Blob([e],{type:"application/json"}),a=URL.createObjectURL(t),n=document.createElement("a");n.href=a,n.download="mazemaster-custom-items.json",n.click(),URL.revokeObjectURL(a),toastr.success("Custom items exported!")}));const $a=document.getElementById("mazemaster_items_import_btn"),en=document.getElementById("mazemaster_items_import_file");$a&&en&&($a.addEventListener("click",(()=>en.click())),en.addEventListener("change",(async e=>{var t;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a)return;const n=function(e){try{const t=JSON.parse(e);qt.customItems||(qt.customItems={});let a=0;for(const[e,n]of Object.entries(t))n.name&&n.type&&(qt.customItems[e]=n,a++);return i(),a}catch(e){return console.error("[MazeMaster] Failed to import custom items:",e),0}}(await a.text());n>0?(toastr.success("Imported ".concat(n," custom items!")),Oa(),Fa(),Ja()):toastr.error("No valid items found in file"),en.value=""}))),Oa(),Fa(),Ja();const tn=document.getElementById("mazemaster_maze_profile_select");tn&&tn.addEventListener("change",(e=>{qt.currentMazeProfile=e.target.value,i(),Wr()}));const an=document.getElementById("mazemaster_maze_new_profile_btn");an&&an.addEventListener("click",(async e=>{e.preventDefault(),e.stopPropagation();const t=await u("Enter new maze profile name:",p.INPUT,"");if(t&&t.trim()){const e=t.trim();qt.mazeProfiles[e]?await u('Maze profile "'.concat(e,'" already exists.'),p.TEXT):(Aa(e,{gridSize:10}),qt.currentMazeProfile=e,i(),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_maze"))||void 0===e||e.click()}),100))}}));const nn=document.getElementById("mazemaster_maze_delete_profile_btn");nn&&nn.addEventListener("click",(async()=>{var e;const t=null===(e=document.getElementById("mazemaster_maze_profile_select"))||void 0===e?void 0:e.value;if(t){await u('Delete maze profile "'.concat(t,'"?'),p.CONFIRM)&&(!function(e){if(delete qt.mazeProfiles[e],qt.currentMazeProfile===e){const e=Pa();qt.currentMazeProfile=e[0]||"Tutorial - Learn the Basics"}i()}(t),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_maze"))||void 0===e||e.click()}),100))}}));const on=document.getElementById("mazemaster_maze_rename_profile_btn");on&&on.addEventListener("click",(async()=>{var e;const t=null===(e=document.getElementById("mazemaster_maze_profile_select"))||void 0===e?void 0:e.value;if(!t)return void alert("No profile selected to rename");const a=await u("Enter new profile name:",p.INPUT,t);if(a&&a.trim()&&a.trim()!==t){const e=a.trim();if(qt.mazeProfiles[e])return void alert("A profile with that name already exists");qt.mazeProfiles[e]=qt.mazeProfiles[t],delete qt.mazeProfiles[t],qt.currentMazeProfile=e,i(),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_maze"))||void 0===e||e.click()}),100)}}));const rn=document.getElementById("mazemaster_maze_save_btn");rn&&rn.addEventListener("click",(()=>{var e;const t=null===(e=document.getElementById("mazemaster_maze_profile_select"))||void 0===e?void 0:e.value;if(!t)return void alert("Please create a maze profile first");const a=Ur(),n=[];if((!a.gridSize||a.gridSize<5||a.gridSize>20)&&n.push("Grid Size must be between 5 and 20"),a.minionEncounters&&a.minionEncounters.length>0){const e=a.minionEncounters.reduce(((e,t)=>e+(t.percent||0)),0);e>100&&n.push("Encounter percentages total ".concat(e,"% (max 100%)"))}n.length>0?alert("Validation Error:\n\n"+n.join("\n")):(Aa(t,a),alert('Maze profile "'.concat(t,'" saved!')))}));const sn=document.getElementById("mazemaster_maze_story_btn");sn&&sn.addEventListener("click",(()=>{!async function(){var e,t,a,n;const o=null===(e=document.getElementById("mazemaster_maze_profile_select"))||void 0===e?void 0:e.value;if(!o)return void alert("Please create a maze profile first");const i=Da(o)||{},r=i.storyConfig||{mainStory:"",milestones:[]},s='\n        <div id="mazemaster_story_modal" class="mazemaster-story-modal">\n            <div class="mazemaster-story-modal-content">\n                <h3><i class="fa-solid fa-book"></i> Story Milestones</h3>\n\n                <div class="mazemaster-section">\n                    <label class="mazemaster-label">Main Story</label>\n                    <textarea id="story_main_text" class="mazemaster-story-textarea" rows="4"\n                        placeholder="The maze stretches before you, filled with danger and mystery...">'.concat(Or(r.mainStory||""),'</textarea>\n                </div>\n\n                <div class="mazemaster-section">\n                    <label class="mazemaster-label">Milestones</label>\n                    <div id="story_milestones_list" class="mazemaster-milestones-list">\n                        \x3c!-- Milestones rendered here --\x3e\n                    </div>\n                    <button id="story_add_milestone_btn" class="menu_button mazemaster-add-btn">\n                        <i class="fa-solid fa-plus"></i> Add Milestone\n                    </button>\n                </div>\n\n                <div class="mazemaster-story-modal-buttons">\n                    <button id="story_save_btn" class="menu_button menu_button_primary">\n                        <i class="fa-solid fa-save"></i> Save\n                    </button>\n                    <button id="story_cancel_btn" class="menu_button">\n                        Cancel\n                    </button>\n                </div>\n            </div>\n        </div>\n    '),l=document.createElement("div");l.innerHTML=s,document.body.appendChild(l.firstElementChild);const c=document.getElementById("mazemaster_story_modal"),m=document.getElementById("story_milestones_list");function d(){0!==r.milestones.length?(m.innerHTML=r.milestones.map(((e,t)=>'\n            <div class="mazemaster-milestone-row" data-index="'.concat(t,'">\n                <div class="milestone-percent">\n                    <input type="number" class="milestone-percent-input" min="1" max="99" value="').concat(e.percent||25,'" placeholder="%">\n                    <span>%</span>\n                </div>\n                <textarea class="milestone-text-input" rows="2" placeholder="Story update at this point...">').concat(Or(e.storyUpdate||""),'</textarea>\n                <button class="menu_button menu_button_icon milestone-remove-btn" title="Remove">\n                    <i class="fa-solid fa-trash"></i>\n                </button>\n            </div>\n        '))).join(""),m.querySelectorAll(".milestone-remove-btn").forEach((e=>{e.addEventListener("click",(e=>{const t=e.target.closest(".mazemaster-milestone-row"),a=parseInt(t.dataset.index);r.milestones.splice(a,1),d()}))}))):m.innerHTML='<div class="mazemaster-empty-state">No milestones. Add milestones to show story updates at specific progress points.</div>'}d(),null===(t=document.getElementById("story_add_milestone_btn"))||void 0===t||t.addEventListener("click",(()=>{r.milestones.push({percent:50,storyUpdate:""}),d()})),null===(a=document.getElementById("story_save_btn"))||void 0===a||a.addEventListener("click",(()=>{var e;r.mainStory=(null===(e=document.getElementById("story_main_text"))||void 0===e?void 0:e.value)||"";const t=m.querySelectorAll(".mazemaster-milestone-row");r.milestones=[],t.forEach((e=>{var t,a;const n=parseInt(null===(t=e.querySelector(".milestone-percent-input"))||void 0===t?void 0:t.value)||25,o=(null===(a=e.querySelector(".milestone-text-input"))||void 0===a?void 0:a.value)||"";o.trim()&&r.milestones.push({percent:n,storyUpdate:o})})),r.milestones.sort(((e,t)=>e.percent-t.percent)),i.storyConfig=r,Aa(o,i),c.remove(),alert("Story milestones saved!")})),null===(n=document.getElementById("story_cancel_btn"))||void 0===n||n.addEventListener("click",(()=>{c.remove()})),c.addEventListener("click",(e=>{e.target===c&&c.remove()}))}()})),document.querySelectorAll(".mazemaster-collapsible-header").forEach((e=>{e.addEventListener("click",(()=>{const t=e.getAttribute("data-target"),a=document.getElementById(t),n=e.closest(".mazemaster-collapsible");if(a){const e="none"!==a.style.display;a.style.display=e?"none":"block",null==n||n.classList.toggle("expanded",!e)}}))}));const un=document.getElementById("mazemaster_itempool_enabled"),pn=document.getElementById("mazemaster_itempool_items");function zn(){const e=new Set;document.querySelectorAll("#mazemaster_itempool_items input[data-pool-item]:checked").forEach((t=>{e.add(t.dataset.poolItem)}));const t=document.getElementById("mazemaster_start_weapon");t&&Array.from(t.options).forEach((a=>{""!==a.value&&(a.disabled=!e.has(a.value),a.disabled&&a.selected&&(t.value=""))}));const a=document.getElementById("mazemaster_start_armor");a&&Array.from(a.options).forEach((t=>{""!==t.value&&(t.disabled=!e.has(t.value),t.disabled&&t.selected&&(a.value=""))}));const n=document.getElementById("mazemaster_start_accessory");n&&Array.from(n.options).forEach((t=>{""!==t.value&&(t.disabled=!e.has(t.value),t.disabled&&t.selected&&(n.value=""))}))}un&&pn&&un.addEventListener("change",(e=>{pn.style.display=e.target.checked?"block":"none"})),null===(e=document.getElementById("mazemaster_itempool_all"))||void 0===e||e.addEventListener("click",(()=>{document.querySelectorAll("#mazemaster_itempool_items input[data-pool-item]").forEach((e=>{e.checked=!0}))})),null===(a=document.getElementById("mazemaster_itempool_none"))||void 0===a||a.addEventListener("click",(()=>{document.querySelectorAll("#mazemaster_itempool_items input[data-pool-item]").forEach((e=>{e.checked=!1}))})),null===(n=document.getElementById("mazemaster_itempool_core"))||void 0===n||n.addEventListener("click",(()=>{const e=["key","strike","stealth","execute","healingPotion","greaterHealing"];document.querySelectorAll("#mazemaster_itempool_items input[data-pool-item]").forEach((t=>{t.checked=e.includes(t.dataset.poolItem)})),zn()})),document.querySelectorAll("#mazemaster_itempool_items input[data-pool-item]").forEach((e=>{e.addEventListener("change",zn)})),null===(o=document.getElementById("mazemaster_itempool_all"))||void 0===o||o.addEventListener("click",(()=>{setTimeout(zn,10)})),null===(r=document.getElementById("mazemaster_itempool_none"))||void 0===r||r.addEventListener("click",(()=>{setTimeout(zn,10)})),window.updateStartingItemsFromPool=zn,ns();const _n=document.getElementById("mazemaster_intelligent_distribute");_n&&_n.addEventListener("click",$r);const kn=document.getElementById("mazemaster_maze_win_image_btn"),Cn=document.getElementById("mazemaster_maze_win_image_file");kn&&Cn&&(kn.addEventListener("click",(()=>{Cn.click()})),Cn.addEventListener("change",(async e=>{var t,a;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!n)return;const o=null===(a=document.getElementById("mazemaster_maze_profile_select"))||void 0===a?void 0:a.value;if(!o)return alert("Please create a profile first"),void(Cn.value="");try{const e=await Xr(n,"maze_win_".concat(o)),t=Da(o)||{};t.winImage=e,Aa(o,t);const a=document.querySelector(".mazemaster-maze-win-image-preview");a&&(a.innerHTML='<img id="maze_win_image_preview" src="'.concat(e,'" alt="Victory">'))}catch(e){alert("Image upload failed: ".concat(e.message))}Cn.value=""})));const wn=document.getElementById("mazemaster_chest_image_btn"),En=document.getElementById("mazemaster_chest_image_file");wn&&En&&(wn.addEventListener("click",(()=>{En.click()})),En.addEventListener("change",(async e=>{var t,a;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!n)return;const o=null===(a=document.getElementById("mazemaster_maze_profile_select"))||void 0===a?void 0:a.value;if(!o)return alert("Please create a profile first"),void(En.value="");try{const e=await Xr(n,"chest_".concat(o)),t=Da(o);if(t){t.chestImage=e,Aa(o,t);const a=document.querySelector(".mazemaster-chest-preview");a&&(a.innerHTML='<img id="mazemaster_chest_preview_img" src="'.concat(e,'" style="width: 100%; height: 100%; object-fit: cover;">'))}}catch(e){alert("Image upload failed: ".concat(e.message))}En.value=""})));const Sn=document.getElementById("mazemaster_maze_main_minion");Sn&&Sn.addEventListener("change",(e=>{const t=document.getElementById("mazemaster_main_minion_settings");t&&(t.style.display=e.target.value?"":"none")}));const Tn=document.getElementById("mazemaster_maze_exit_type");Tn&&Tn.addEventListener("change",(()=>{Yr(Tn.value,"")}));const In=document.getElementById("mazemaster_add_portal_btn");function Mn(){var e;const t=document.getElementById("mazemaster_portals_list"),a=null===(e=document.querySelector('[data-target="portals_section"]'))||void 0===e||null===(e=e.closest(".mazemaster-collapsible"))||void 0===e?void 0:e.querySelector(".mazemaster-collapse-hint");t&&a&&(a.textContent="(".concat(t.children.length," portal pairs)"))}In&&In.addEventListener("click",(()=>{const e=document.getElementById("mazemaster_portals_list");if(!e)return;const t=e.children.length,a=document.createElement("div");a.className="mazemaster-portal-item",a.dataset.portalIndex=t,a.innerHTML='\n                <div class="portal-header">\n                    <span class="portal-color" style="background: #9b59b6"></span>\n                    <span class="portal-name">Portal '.concat(t+1,'</span>\n                    <button class="menu_button remove-portal-btn" title="Remove Portal">\n                        <i class="fa-solid fa-trash"></i>\n                    </button>\n                </div>\n                <div class="portal-details">\n                    <div class="portal-row">\n                        <label>ID:</label>\n                        <input type="text" class="portal-id mazemaster-input" value="" placeholder="portal').concat(t+1,'">\n                    </div>\n                    <div class="portal-row">\n                        <label>Color:</label>\n                        <input type="color" class="portal-color-input" value="#9b59b6">\n                    </div>\n                    <div class="portal-row">\n                        <label>Bidirectional:</label>\n                        <input type="checkbox" class="portal-bidirectional" checked>\n                    </div>\n                    <div class="portal-row coords-row">\n                        <span>Start: X</span>\n                        <input type="number" class="portal-start-x mazemaster-input" value="" placeholder="auto" min="0">\n                        <span>Y</span>\n                        <input type="number" class="portal-start-y mazemaster-input" value="" placeholder="auto" min="0">\n                    </div>\n                    <div class="portal-row coords-row">\n                        <span>End: X</span>\n                        <input type="number" class="portal-end-x mazemaster-input" value="" placeholder="auto" min="0">\n                        <span>Y</span>\n                        <input type="number" class="portal-end-y mazemaster-input" value="" placeholder="auto" min="0">\n                    </div>\n                </div>\n            '),a.querySelector(".remove-portal-btn").addEventListener("click",(()=>{a.remove(),Mn()})),a.querySelector(".portal-color-input").addEventListener("input",(e=>{a.querySelector(".portal-color").style.background=e.target.value})),a.querySelector(".portal-id").addEventListener("input",(e=>{a.querySelector(".portal-name").textContent=e.target.value||"Portal ".concat(t+1)})),e.appendChild(a),Mn()})),document.querySelectorAll("#mazemaster_portals_list .remove-portal-btn").forEach((e=>{e.addEventListener("click",(()=>{e.closest(".mazemaster-portal-item").remove(),Mn()}))})),document.querySelectorAll("#mazemaster_portals_list .portal-color-input").forEach((e=>{e.addEventListener("input",(e=>{e.target.closest(".mazemaster-portal-item").querySelector(".portal-color").style.background=e.target.value}))}));const Pn=document.getElementById("mazemaster_add_objective_btn");function Dn(){var e;const t=document.getElementById("mazemaster_objectives_list"),a=null===(e=document.querySelector('[data-target="objectives_section"]'))||void 0===e||null===(e=e.closest(".mazemaster-collapsible"))||void 0===e?void 0:e.querySelector(".mazemaster-collapse-hint");t&&a&&(a.textContent="(".concat(t.children.length," objectives)"))}Pn&&Pn.addEventListener("click",(()=>{const e=document.getElementById("mazemaster_objectives_list");if(!e)return;const t=e.children.length,a=document.createElement("div");a.className="mazemaster-objective-item",a.dataset.objectiveIndex=t,a.innerHTML='\n                <div class="objective-config-header">\n                    <span class="objective-name">Objective '.concat(t+1,'</span>\n                    <button class="menu_button remove-objective-btn" title="Remove Objective">\n                        <i class="fa-solid fa-trash"></i>\n                    </button>\n                </div>\n                <div class="objective-config-details">\n                    <div class="objective-config-row">\n                        <label>ID:</label>\n                        <input type="text" class="objective-id mazemaster-input" value="" placeholder="obj').concat(t+1,'">\n                    </div>\n                    <div class="objective-config-row">\n                        <label>Type:</label>\n                        <select class="objective-type mazemaster-select">\n                            <option value="collect">Collect Item</option>\n                            <option value="defeat">Defeat Minion</option>\n                            <option value="explore">Explore %</option>\n                        </select>\n                    </div>\n                    <div class="objective-config-row objective-target-row">\n                        <label>Target:</label>\n                        <input type="text" class="objective-target mazemaster-input" value="" placeholder="key, strike, stealth...">\n                    </div>\n                    <div class="objective-config-row">\n                        <label>Count:</label>\n                        <input type="number" class="objective-count mazemaster-input" value="1" min="1">\n                    </div>\n                    <div class="objective-config-row">\n                        <label>Description:</label>\n                        <input type="text" class="objective-description mazemaster-input" value="" placeholder="Find 3 Keys">\n                    </div>\n                    <div class="objective-config-row">\n                        <label>Required:</label>\n                        <input type="checkbox" class="objective-required" checked>\n                    </div>\n                    <div class="objective-config-row">\n                        <label>Reward Script:</label>\n                        <input type="text" class="objective-reward mazemaster-input" value="" placeholder="/echo Objective complete!">\n                    </div>\n                </div>\n            '),a.querySelector(".remove-objective-btn").addEventListener("click",(()=>{a.remove(),Dn()}));const n=a.querySelector(".objective-type"),o=a.querySelector(".objective-target-row");n.addEventListener("change",(()=>{o.style.display="explore"===n.value?"none":"flex"})),a.querySelector(".objective-description").addEventListener("input",(e=>{a.querySelector(".objective-name").textContent=e.target.value||"Objective ".concat(t+1)})),e.appendChild(a),Dn()})),document.querySelectorAll("#mazemaster_objectives_list .remove-objective-btn").forEach((e=>{e.addEventListener("click",(()=>{e.closest(".mazemaster-objective-item").remove(),Dn()}))})),document.querySelectorAll("#mazemaster_objectives_list .objective-type").forEach((e=>{const t=e.closest(".mazemaster-objective-item").querySelector(".objective-target-row");e.addEventListener("change",(()=>{t.style.display="explore"===e.value?"none":"flex"}))}));const An=document.getElementById("mazemaster_add_encounter_btn");An&&An.addEventListener("click",(()=>{const e=document.getElementById("mazemaster_maze_encounters_list");if(!e)return;const t=Object.keys(qt.minions||{}).map((e=>{const t=qt.minions[e];return'<option value="'.concat(e,'">').concat(t.name||e,"</option>")})).join(""),a=document.createElement("div");a.className="mazemaster-encounter-row",a.innerHTML='\n                <select class="encounter-minion-select">\n                    <option value="">Select Minion</option>\n                    '.concat(t,'\n                </select>\n                <input type="number" class="encounter-percent-input" min="1" max="100" value="5" placeholder="%">\n                <span class="encounter-percent-label">%</span>\n                <button class="encounter-remove-btn menu_button"><i class="fa-solid fa-trash"></i></button>\n            '),a.querySelector(".encounter-remove-btn").addEventListener("click",(()=>{a.remove()})),e.appendChild(a)}));const Bn=document.getElementById("mazemaster_add_trap_encounter_btn");Bn&&Bn.addEventListener("click",(()=>{const e=document.getElementById("mazemaster_maze_traps_list");if(!e)return;const t=gn().map((e=>{const t=fn(e);return'<option value="'.concat(Or(e),'">').concat(Or((null==t?void 0:t.name)||e),"</option>")})).join("");if(!t)return void alert("No traps available. Create traps in the Traps tab first.");const a=document.createElement("div");a.className="mazemaster-encounter-row mazemaster-trap-encounter-row",a.innerHTML='\n                <select class="trap-encounter-select">\n                    <option value="">Select Trap</option>\n                    '.concat(t,'\n                </select>\n                <input type="number" class="trap-encounter-percent-input" min="1" max="100" value="5" placeholder="%">\n                <span class="encounter-percent-label">%</span>\n                <button class="trap-encounter-remove-btn menu_button"><i class="fa-solid fa-trash"></i></button>\n            '),a.querySelector(".trap-encounter-remove-btn").addEventListener("click",(()=>{a.remove()})),e.appendChild(a)}));const Ln=document.getElementById("mazemaster_add_quest_pool_btn");Ln&&Ln.addEventListener("click",(()=>{const e=document.getElementById("mazemaster_maze_quests_list");if(!e)return;const t=Ct(),a=Object.keys(t).map((e=>{const a=t[e];return'<option value="'.concat(Or(e),'">').concat(Or((null==a?void 0:a.name)||e),"</option>")})).join("");if(!a)return void toastr.warning("No quests available. Create quests in the Quests tab first.");const n=document.createElement("div");n.className="mazemaster-encounter-row mazemaster-quest-pool-row",n.innerHTML='\n                <select class="quest-pool-select">\n                    <option value="">Select Quest</option>\n                    '.concat(a,'\n                </select>\n                <input type="number" class="quest-pool-chance-input" min="1" max="100" value="50" placeholder="%">\n                <span class="encounter-percent-label">%</span>\n                <button class="quest-pool-remove-btn menu_button"><i class="fa-solid fa-trash"></i></button>\n            '),n.querySelector(".quest-pool-remove-btn").addEventListener("click",(()=>{n.remove()})),e.appendChild(n)}));const qn=document.getElementById("mazemaster_add_minion_btn"),Rn=document.getElementById("mazemaster_minion_image_file");qn&&Rn&&(qn.addEventListener("click",(()=>{Rn.click()})),Rn.addEventListener("change",(async e=>{var t;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){try{const e="minion_".concat(Date.now()),t=await Xr(a,e),n=await u("Enter minion name:",p.INPUT,"New Minion");n&&n.trim()&&(hn(e,{name:n.trim(),imagePath:t}),Qr())}catch(e){alert("Image upload failed: ".concat(e.message))}Rn.value=""}})));const Nn=document.getElementById("mazemaster_minion_profile_select");Nn&&Nn.addEventListener("change",(()=>{Qr()}));const Hn=document.getElementById("mazemaster_minion_profile_save_btn");Hn&&Hn.addEventListener("click",(async()=>{const e=await u("Enter profile name:",p.INPUT,"My Minions");if(e&&e.trim()){const t=e.trim();qt.minionProfiles[t]=JSON.parse(JSON.stringify(qt.minions||{})),i(),alert('Minion profile "'.concat(t,'" saved!')),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_minions"))||void 0===e||e.click()}),100)}}));const Fn=document.getElementById("mazemaster_minion_profile_load_btn");Fn&&Fn.addEventListener("click",(async()=>{const e=document.getElementById("mazemaster_minion_profile_select"),t=null==e?void 0:e.value;if(!t)return void alert("Select a profile to load");await u('Load minion profile "'.concat(t,'"? This will replace your current minions.'),p.CONFIRM)&&(qt.minions=JSON.parse(JSON.stringify(qt.minionProfiles[t]||{})),i(),Qr(),alert('Minion profile "'.concat(t,'" loaded!')))}));const Wn=document.getElementById("mazemaster_minion_profile_delete_btn");Wn&&Wn.addEventListener("click",(async()=>{const e=document.getElementById("mazemaster_minion_profile_select"),t=null==e?void 0:e.value;if(!t)return void alert("Select a profile to delete");await u('Delete minion profile "'.concat(t,'"?'),p.CONFIRM)&&(delete qt.minionProfiles[t],i(),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_minions"))||void 0===e||e.click()}),100))}));const Yn=document.getElementById("mazemaster_add_trap_btn"),Un=document.getElementById("mazemaster_trap_image_file");Yn&&Un&&(Yn.addEventListener("click",(()=>{Un.click()})),Un.addEventListener("change",(async e=>{var t;const a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){try{const e="trap_".concat(Date.now()),t=await Xr(a,e),n=await u("Enter trap name:",p.INPUT,"New Trap");n&&n.trim()&&(yn(e,{name:n.trim(),imagePath:t,message:"You triggered a trap!",script:""}),Jr())}catch(e){alert("Image upload failed: ".concat(e.message))}Un.value=""}})));const Gn=document.getElementById("mazemaster_trap_profile_save_btn");Gn&&Gn.addEventListener("click",(async()=>{const e=await u("Enter profile name:",p.INPUT,"My Traps");if(e&&e.trim()){const t=e.trim();qt.trapProfiles[t]=JSON.parse(JSON.stringify(qt.traps||{})),i(),alert('Trap profile "'.concat(t,'" saved!')),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_traps"))||void 0===e||e.click()}),100)}}));const jn=document.getElementById("mazemaster_trap_profile_load_btn");jn&&jn.addEventListener("click",(async()=>{const e=document.getElementById("mazemaster_trap_profile_select"),t=null==e?void 0:e.value;if(!t)return void alert("Select a profile to load");await u('Load trap profile "'.concat(t,'"? This will replace your current traps.'),p.CONFIRM)&&(qt.traps=JSON.parse(JSON.stringify(qt.trapProfiles[t]||{})),i(),Jr(),alert('Trap profile "'.concat(t,'" loaded!')))}));const Kn=document.getElementById("mazemaster_trap_profile_delete_btn");Kn&&Kn.addEventListener("click",(async()=>{const e=document.getElementById("mazemaster_trap_profile_select"),t=null==e?void 0:e.value;if(!t)return void alert("Select a profile to delete");await u('Delete trap profile "'.concat(t,'"?'),p.CONFIRM)&&(delete qt.trapProfiles[t],i(),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_traps"))||void 0===e||e.click()}),100))}));const Vn=document.getElementById("mazemaster_quest_add_btn");Vn&&Vn.addEventListener("click",(()=>{Ha(null)}));const Qn=document.getElementById("mazemaster_quest_list");Qn&&Qn.addEventListener("click",(async e=>{const t=e.target.closest(".quest-edit-btn"),a=e.target.closest(".quest-delete-btn");if(t){Ha(t.dataset.quest)}if(a){const e=a.dataset.quest,t=kt(e);await u('Delete quest "'.concat((null==t?void 0:t.name)||e,'"?'),p.CONFIRM)&&(!function(e){var t;const a=SillyTavern.getContext();null!==(t=a.extensionSettings.mazemaster)&&void 0!==t&&null!==(t=t.quests)&&void 0!==t&&t[e]&&(delete a.extensionSettings.mazemaster.quests[e],a.saveSettingsDebounced())}(e),Na())}}));const Jn=document.getElementById("mazemaster_quest_profile_save_btn");Jn&&Jn.addEventListener("click",(async()=>{const e=await u("Enter profile name:",p.INPUT,"My Quests");if(e&&e.trim()){const o=e.trim(),i=Ct(),r=Object.keys(i).filter((e=>!_t[e]));n=r,(a=o)&&(qt.questProfiles||(qt.questProfiles={}),qt.questProfiles[a]=t(t({},n),{},{name:a}),saveExtensionSettings()),toastr.success('Quest profile "'.concat(o,'" saved!')),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_quests"))||void 0===e||e.click()}),100)}var a,n}));const Zn=document.getElementById("mazemaster_quest_profile_delete_btn");Zn&&Zn.addEventListener("click",(async()=>{const e=document.getElementById("mazemaster_quest_profile_select"),t=null==e?void 0:e.value;if(!t)return void toastr.warning("Select a profile to delete");var a,n,o;await u('Delete quest profile "'.concat(t,'"?'),p.CONFIRM)&&((a=t)&&(!Ke[a]||null!==(n=qt.questProfiles)&&void 0!==n&&n[a]?null===(o=qt.questProfiles)||void 0===o||!o[a]||(delete qt.questProfiles[a],saveExtensionSettings()):toastr.warning("Cannot delete default profiles")),is(),setTimeout((()=>{var e;null===(e=document.getElementById("mazemaster_show_quests"))||void 0===e||e.click()}),100))})),console.log("[MazeMaster] initUI() completed successfully")}function is(){const e=document.getElementById("mazemaster_drawer");e&&(e.innerHTML=Nr(),os(),Hr(),Fr(),Qr(),Jr(),Wr())}async function rs(e){if(Vt.has(e))return;if(e.classList.contains("streaming")||e.classList.contains("is-typing")||e.querySelector(".mes_text.streaming"))return;const t=e.querySelector(".mes_text .stle--content")||e.querySelector(".mes_text");if(!t)return;const a=t.textContent||"",n=/\{\{wheel:([^}]+)\}\}/gi,o=/\{\{battlebar:([^}]+)\}\}/gi,i=/\{\{maze:([^}]+)\}\}/gi,r=[],s=[],l=[];let c;for(;null!==(c=n.exec(a));)r.push({full:c[0],profile:c[1].trim()});for(;null!==(c=o.exec(a));)s.push({full:c[0],profile:c[1].trim()});for(;null!==(c=i.exec(a));)l.push({full:c[0],profile:c[1].trim()});if(0===r.length&&0===s.length&&0===l.length)return;Vt.add(e);const m=SillyTavern.getContext(),d=e.getAttribute("mesid");for(const t of r){console.log("[MazeMaster] Processing wheel macro: ".concat(t.full));if(!vn(t.profile).error){bn().valid&&xn()}const a="[ Wheel: ".concat(t.profile,"]");if(m.chat&&null!==d){const n=parseInt(d);if(m.chat[n]){const o=m.chat[n].mes,i=o.replace(t.full,"").replace(/\s+/g," ").trim(),r=o.replace(t.full,a);m.chat[n].mes=i;const s=e.querySelector(".mes_text");s&&(s.innerHTML=r)}}}for(const t of s){console.log("[MazeMaster] Processing battlebar macro: ".concat(t.full)),Io(t.profile);const a="[ Battlebar: ".concat(t.profile,"]");if(m.chat&&null!==d){const n=parseInt(d);if(m.chat[n]){const o=m.chat[n].mes,i=o.replace(t.full,"").replace(/\s+/g," ").trim(),r=o.replace(t.full,a);m.chat[n].mes=i;const s=e.querySelector(".mes_text");s&&(s.innerHTML=r)}}}for(const t of l){console.log("[MazeMaster] Processing maze macro: ".concat(t.full)),xi(t.profile);const a="[ Maze: ".concat(t.profile,"]");if(m.chat&&null!==d){const n=parseInt(d);if(m.chat[n]){const o=m.chat[n].mes,i=o.replace(t.full,"").replace(/\s+/g," ").trim(),r=o.replace(t.full,a);m.chat[n].mes=i;const s=e.querySelector(".mes_text");s&&(s.innerHTML=r)}}}}function ss(){const e=SillyTavern.getContext();if(!e||!e.eventSource||!e.eventTypes)return console.warn("[MazeMaster] Context not ready for macro hooks, retrying..."),void setTimeout(ss,500);e.eventTypes.USER_MESSAGE_RENDERED&&e.eventSource.on(e.eventTypes.USER_MESSAGE_RENDERED,(e=>{setTimeout((()=>{const t=document.querySelector('#chat .mes[mesid="'.concat(e,'"]'));t&&rs(t)}),500)})),e.eventTypes.CHARACTER_MESSAGE_RENDERED&&e.eventSource.on(e.eventTypes.CHARACTER_MESSAGE_RENDERED,(e=>{const t=function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const n=document.querySelector('#chat .mes[mesid="'.concat(e,'"]'));if(!n)return;(n.classList.contains("streaming")||n.classList.contains("is-typing"))&&a<5?setTimeout((()=>t(a+1)),1e3):rs(n)};setTimeout((()=>t()),500)})),console.log("[MazeMaster] Macro hooks registered")}!function(){console.log("[MazeMaster] Registering slash commands immediately...");try{!function(){console.log("[MazeMaster] registerSlashCommands() starting...");try{r.addCommandObject(s.fromProps({name:"wheel",callback:async e=>{let t=e.profile;if(!t){const e=qt.currentProfile;if(e&&ta(e))t=e;else{const e=ea();t=e.length>0?e[0]:"Blessing Wheel"}}console.log("[MazeMaster] /wheel command - loading profile:",t);const a=vn(t);if(a.error)return console.error("[MazeMaster] /wheel error:",a.error),"Error: ".concat(a.error);const n=bn();return n.valid?(qt.currentProfile=t,xn(),'Wheel "'.concat(t,'" opened with ').concat(a.count," segments. Click SPIN!")):"Error: ".concat(n.error)},namedArgumentList:[c.fromProps({name:"profile",description:"Name of the wheel profile to use",typeList:[l.STRING],isRequired:!1,defaultValue:"default"})],helpString:'Open a wheel by profile name. Example: /wheel profile="mywheel"'})),r.addCommandObject(s.fromProps({name:"battlebar",callback:async e=>{const t=e.profile||qt.currentBattlebarProfile||"Tutorial - Learn Combat",a=Io(t);return a.error?"Error: ".concat(a.error):'Battlebar "'.concat(t,'" started! Press SPACE when the arrow is in the green zone.')},namedArgumentList:[c.fromProps({name:"profile",description:"Name of the battlebar profile to use",typeList:[l.STRING],isRequired:!1,defaultValue:"default"})],helpString:'Start a battlebar challenge. Example: /battlebar profile="boss1"'})),r.addCommandObject(s.fromProps({name:"maze",callback:async e=>{const t=e.profile||qt.currentMazeProfile||"Tutorial - Learn the Basics",a=xi(t);return a.error?"Error: ".concat(a.error):'Maze "'.concat(t,'" started! Use arrow keys to navigate.')},namedArgumentList:[c.fromProps({name:"profile",description:"Name of the maze profile to use",typeList:[l.STRING],isRequired:!1})],helpString:'Start a maze game. Example: /maze profile="dungeon1"'})),r.addCommandObject(s.fromProps({name:"mazeminion",callback:async e=>{if(!jt.isOpen)return"No maze is currently open.";const t=e.name,a=e.message||"",n=pn(t);return jt.currentMinion=n?{name:n.name,imagePath:n.imagePath,message:a}:{name:t||"Unknown",imagePath:"",message:a},Ii(),""},namedArgumentList:[c.fromProps({name:"name",description:"Minion name (from config) or custom name",typeList:[l.STRING],isRequired:!1}),c.fromProps({name:"message",description:"Message to display",typeList:[l.STRING],isRequired:!1})],helpString:'Set the minion display in an active maze. Example: /mazeminion name="Goblin" message="You shall not pass!"'})),r.addCommandObject(s.fromProps({name:"mazestats",callback:async()=>{var e,t,a,n,o,i,r,s;if(!jt.isOpen)return JSON.stringify({error:"No maze is currently open."});const l={moves:(null===(e=jt.stats)||void 0===e?void 0:e.moves)||0,encountersTotal:(null===(t=jt.stats)||void 0===t?void 0:t.encountersTotal)||0,encountersWon:(null===(a=jt.stats)||void 0===a?void 0:a.encountersWon)||0,chestsOpened:(null===(n=jt.stats)||void 0===n?void 0:n.chestsOpened)||0,trapsTriggered:(null===(o=jt.stats)||void 0===o?void 0:o.trapsTriggered)||0,teleportsUsed:(null===(i=jt.stats)||void 0===i?void 0:i.teleportsUsed)||0,itemsCollected:(null===(r=jt.stats)||void 0===r?void 0:r.itemsCollected)||{},exploration:se(),elapsedTime:re(),difficulty:(null===(s=jt.profile)||void 0===s?void 0:s.difficulty)||"normal"};return JSON.stringify(l)},helpString:"Get current maze session statistics as JSON. Example: /mazestats"})),r.addCommandObject(s.fromProps({name:"mazeexplore",callback:async()=>{if(!jt.isOpen)return"No maze is currently open.";const e=se();return String(e)},helpString:"Get current maze exploration percentage (0-100). Example: /mazeexplore"})),r.addCommandObject(s.fromProps({name:"mazeobjective",callback:async e=>{var t;if(!jt.isOpen)return JSON.stringify({error:"No maze is currently open."});const a=(null===(t=jt.profile)||void 0===t?void 0:t.objectives)||[],n=jt.objectiveProgress||{};if(e.id){const t=a.find((t=>t.id===e.id));if(!t)return JSON.stringify({error:'Objective "'.concat(e.id,'" not found.')});const o=n[e.id]||{current:0,completed:!1};return JSON.stringify({id:t.id,type:t.type,target:t.target,description:t.description,current:o.current,required:t.count,completed:o.completed,isRequired:t.required})}{const e=a.map((e=>{const t=n[e.id]||{current:0,completed:!1};return{id:e.id,type:e.type,description:e.description,current:t.current,required:e.count,completed:t.completed,isRequired:e.required}}));return JSON.stringify(e)}},namedArgumentList:[c.fromProps({name:"id",description:"Specific objective ID to get (optional, returns all if omitted)",typeList:[l.STRING],isRequired:!1})],helpString:'Get maze objective progress. Example: /mazeobjective id="collect_keys" or /mazeobjective (for all)'})),r.addCommandObject(s.fromProps({name:"mazedifficulty",callback:async e=>{var t,a;const n=null===(t=e.tier)||void 0===t?void 0:t.toLowerCase(),o=Ze();if(!n){var i;const e=null===(i=qt.mazeProfiles)||void 0===i?void 0:i[qt.currentMazeProfile||"Tutorial - Learn the Basics"];return(null==e?void 0:e.difficulty)||"normal"}if(!o.includes(n))return"Error: Invalid difficulty tier. Valid options: ".concat(o.join(", "));const r=qt.currentMazeProfile||"Tutorial - Learn the Basics";return null!==(a=qt.mazeProfiles)&&void 0!==a&&a[r]?(qt.mazeProfiles[r].difficulty=n,saveSettings(),'Difficulty set to "'.concat(n,'" for profile "').concat(r,'".')):'Error: Profile "'.concat(r,'" not found.')},namedArgumentList:[c.fromProps({name:"tier",description:"Difficulty tier: easy, normal, hard, or nightmare",typeList:[l.STRING],isRequired:!1})],helpString:'Get or set maze difficulty. Example: /mazedifficulty tier="hard" or /mazedifficulty (to get current)'})),r.addCommandObject(s.fromProps({name:"mazepersonastats",callback:async e=>{var t;const a=e.persona||oe(),n=null===(t=qt.mazeStats)||void 0===t||null===(t=t.personas)||void 0===t?void 0:t[a];return n?JSON.stringify({persona:a,totalGames:n.totalGames||0,wins:n.wins||0,losses:n.losses||0,totalMoves:n.totalMoves||0,bestTime:n.bestTime,profileStats:n.profileStats||{}}):JSON.stringify({error:'No stats found for persona "'.concat(a,'".')})},namedArgumentList:[c.fromProps({name:"persona",description:"Name of the persona to get stats for (default: current persona)",typeList:[l.STRING],isRequired:!1})],helpString:'Get maze stats for a specific persona. Example: /mazepersonastats persona="Alice"'})),r.addCommandObject(s.fromProps({name:"mazefloor",callback:async()=>jt.isOpen?JSON.stringify({current:(jt.currentFloor||0)+1,total:jt.totalFloors||1}):JSON.stringify({error:"No maze is currently open."}),helpString:"Get current floor information in an active maze. Example: /mazefloor"})),r.addCommandObject(s.fromProps({name:"mazetheme",callback:async e=>{var t,a;const n=null===(t=e.theme)||void 0===t?void 0:t.toLowerCase(),o=Je();if(!n){var i;const e=qt.currentMazeProfile||"Tutorial - Learn the Basics",t=null===(i=qt.mazeProfiles)||void 0===i?void 0:i[e];return(null==t?void 0:t.theme)||"fantasy"}if(!o.includes(n))return"Error: Invalid theme. Valid options: ".concat(o.join(", "));const r=qt.currentMazeProfile||"Tutorial - Learn the Basics";return null!==(a=qt.mazeProfiles)&&void 0!==a&&a[r]?(qt.mazeProfiles[r].theme=n,saveSettings(),'Theme set to "'.concat(n,'" for profile "').concat(r,'".')):'Error: Profile "'.concat(r,'" not found.')},namedArgumentList:[c.fromProps({name:"theme",description:"Theme: fantasy, horror, scifi, or action",typeList:[l.STRING],isRequired:!1})],helpString:'Get or set maze theme. Example: /mazetheme theme="horror" or /mazetheme (to get current)'})),r.addCommandObject(s.fromProps({name:"mazemapstyle",callback:async e=>{var t,a;const n=null===(t=e.style)||void 0===t?void 0:t.toLowerCase(),o=$e();if(!n){var i;const e=qt.currentMazeProfile||"Tutorial - Learn the Basics",t=null===(i=qt.mazeProfiles)||void 0===i?void 0:i[e];return(null==t?void 0:t.mapStyle)||"maze"}if(!o.includes(n))return"Error: Invalid map style. Valid options: ".concat(o.join(", "));const r=qt.currentMazeProfile||"Tutorial - Learn the Basics";return null!==(a=qt.mazeProfiles)&&void 0!==a&&a[r]?(qt.mazeProfiles[r].mapStyle=n,saveSettings(),'Map style set to "'.concat(n,'" for profile "').concat(r,'".')):'Error: Profile "'.concat(r,'" not found.')},namedArgumentList:[c.fromProps({name:"style",description:"Map style: maze, dungeon, city, forest, or spaceship",typeList:[l.STRING],isRequired:!1})],helpString:'Get or set maze map style. Example: /mazemapstyle style="dungeon" or /mazemapstyle (to get current)'}));const e={1:"key",2:"stealth",3:"strike",4:"execute",5:"floorKey",6:"portalStone",7:"minionBane",8:"mapFragment",9:"timeShard",10:"voidWalk",11:"healingPotion",12:"greaterHealing",13:"elixir",14:"revivalCharm",15:"heartCrystal",16:"torch",17:"lantern",18:"revealScroll",19:"sightPotion",20:"crystalBall",key:"key",stealth:"stealth",strike:"strike",execute:"execute",floorkey:"floorKey",portalstone:"portalStone",minionbane:"minionBane",mapfragment:"mapFragment",timeshard:"timeShard",voidwalk:"voidWalk",healingpotion:"healingPotion",greaterhealing:"greaterHealing",elixir:"elixir",revivalcharm:"revivalCharm",heartcrystal:"heartCrystal",torch:"torch",lantern:"lantern",revealscroll:"revealScroll",sightpotion:"sightPotion",crystalball:"crystalBall",hp:"healingPotion",ghp:"greaterHealing",potion:"healingPotion",light:"torch",scroll:"revealScroll",sight:"sightPotion",ball:"crystalBall"};console.log("[MazeMaster] Registering /mazeitem command..."),r.addCommandObject(s.fromProps({name:"mazeitem",aliases:["mitem","mazeinv"],callback:async t=>{var a,n;if(console.log("[MazeMaster] /mazeitem callback invoked with args:",t),!jt.isOpen)return"Error: No maze is currently open.";const o=null===(a=t.action)||void 0===a?void 0:a.toLowerCase(),i=null===(n=t.item)||void 0===n?void 0:n.toString().toLowerCase(),r=parseInt(t.amount)||1;if(!o||!["add","remove","list"].includes(o))return'Error: action must be "add", "remove", or "list". Example: /mazeitem action="add" item="key" amount=1';if("list"===o)return"Available items:\n".concat(["1=key, 2=stealth, 3=strike, 4=execute","5=floorKey, 6=portalStone, 7=minionBane, 8=mapFragment, 9=timeShard, 10=voidWalk","11=healingPotion, 12=greaterHealing, 13=elixir, 14=revivalCharm, 15=heartCrystal","16=torch, 17=lantern, 18=revealScroll, 19=sightPotion, 20=crystalBall"].join("\n"));if(!i)return'Error: item is required. Use item number (1-15) or name. Use /mazeitem action="list" to see all items.';const s=e[i];if(!s)return'Error: Unknown item "'.concat(i,'". Use /mazeitem action="list" to see available items.');if("add"===o)return await Ni(s,r),"Added ".concat(r,"x ").concat(s," to inventory.");if("remove"===o){const e=jt.inventory[s]||0,t=Math.min(r,e);return t>0?(await Hi(s,t),"Removed ".concat(t,"x ").concat(s," from inventory.")):"No ".concat(s," in inventory to remove.")}},namedArgumentList:[c.fromProps({name:"action",description:"Action: add, remove, or list",typeList:[l.STRING],isRequired:!0}),c.fromProps({name:"item",description:"Item number (1-15) or name",typeList:[l.STRING],isRequired:!1}),c.fromProps({name:"amount",description:"Amount to add/remove (default: 1)",typeList:[l.NUMBER],isRequired:!1})],helpString:'Manage maze inventory. Examples: /mazeitem action="add" item="key" amount=3, /mazeitem action="remove" item="11", /mazeitem action="list"'})),console.log("[MazeMaster] /mazeitem command registered successfully"),r.addCommandObject(s.fromProps({name:"mazehp",callback:async e=>{if(!jt.isOpen)return JSON.stringify({error:"No maze is currently open."});if(!jt.hpEnabled||!jt.hp)return JSON.stringify({error:"HP system is not enabled for this maze."});if(void 0!==e.set){const t=parseInt(e.set);if(isNaN(t)||t<0)return"Error: set must be a positive number.";const a=jt.hp.max+jt.hp.maxBonus;return jt.hp.current=Math.min(t,a),Z(),"HP set to ".concat(jt.hp.current,"/").concat(a)}const t=jt.hp.max+jt.hp.maxBonus;return JSON.stringify({current:jt.hp.current,max:t,percent:Math.round(jt.hp.current/t*100),reviveCharges:jt.hp.reviveCharges})},namedArgumentList:[c.fromProps({name:"set",description:"Set HP to this value",typeList:[l.NUMBER],isRequired:!1})],helpString:"Get or set player HP. Examples: /mazehp (get status), /mazehp set=50"})),r.addCommandObject(s.fromProps({name:"mazeheal",callback:async e=>{if(!jt.isOpen)return"Error: No maze is currently open.";if(!jt.hpEnabled||!jt.hp)return"Error: HP system is not enabled for this maze.";const t=parseInt(e.amount)||25,a="true"===e.percent||!0===e.percent;return await V(t,a,"command"),"Healed ".concat(t).concat(a?"%":""," HP.")},namedArgumentList:[c.fromProps({name:"amount",description:"Amount to heal (default: 25)",typeList:[l.NUMBER],isRequired:!1}),c.fromProps({name:"percent",description:"If true, amount is percentage of max HP",typeList:[l.STRING],isRequired:!1})],helpString:"Heal the player. Examples: /mazeheal amount=50, /mazeheal amount=25 percent=true"})),r.addCommandObject(s.fromProps({name:"mazedamage",callback:async e=>{if(!jt.isOpen)return"Error: No maze is currently open.";if(!jt.hpEnabled||!jt.hp)return"Error: HP system is not enabled for this maze.";const t=parseInt(e.amount)||10,a=e.source||"command";return await K(t,a),"Dealt ".concat(t," damage (source: ").concat(a,").")},namedArgumentList:[c.fromProps({name:"amount",description:"Amount of damage (default: 10)",typeList:[l.NUMBER],isRequired:!1}),c.fromProps({name:"source",description:"Damage source for hooks (default: command)",typeList:[l.STRING],isRequired:!1})],helpString:'Deal damage to the player. Examples: /mazedamage amount=25, /mazedamage amount=10 source="trap"'})),r.addCommandObject(s.fromProps({name:"turnbased",callback:async e=>{const t=e.profile||qt.currentTurnbasedProfile||"Tutorial - Learn Turn-Based",a=Cn(t);return a.error?"Error: ".concat(a.error):'Turn-based combat "'.concat(t,'" started!')},namedArgumentList:[c.fromProps({name:"profile",description:"Name of the turn-based combat profile to use",typeList:[l.STRING],isRequired:!1})],helpString:'Start a turn-based combat encounter. Example: /turnbased profile="Dungeon Skirmish"'})),r.addCommandObject(s.fromProps({name:"qte",callback:async e=>{const t=e.profile||qt.currentQteProfile||"Tutorial - First Steps",a=On(t);return a.error?"Error: ".concat(a.error):'QTE "'.concat(t,'" started! Press the keys as they appear!')},namedArgumentList:[c.fromProps({name:"profile",description:"Name of the QTE profile to use",typeList:[l.STRING],isRequired:!1})],helpString:'Start a Quick-Time Event challenge. Example: /qte profile="Combat Flurry"'})),r.addCommandObject(s.fromProps({name:"dice",callback:async e=>{const t=e.profile||qt.currentDiceProfile||"Tutorial - Luck Practice",a=Xn(t);return a.error?"Error: ".concat(a.error):'Dice challenge "'.concat(t,'" started! Click to roll!')},namedArgumentList:[c.fromProps({name:"profile",description:"Name of the dice profile to use",typeList:[l.STRING],isRequired:!1})],helpString:'Start a dice roll challenge. Example: /dice profile="Skill Check"'})),r.addCommandObject(s.fromProps({name:"stealth",callback:async e=>{const t=e.profile||qt.currentStealthProfile||"Tutorial - Stealth Basics",a=ao(t);return a.error?"Error: ".concat(a.error):'Stealth encounter "'.concat(t,'" started! Sneak past the guards!')},namedArgumentList:[c.fromProps({name:"profile",description:"Name of the stealth profile to use",typeList:[l.STRING],isRequired:!1})],helpString:'Start a stealth encounter. Example: /stealth profile="Guard Patrol"'})),r.addCommandObject(s.fromProps({name:"puzzle",callback:async e=>{const t=e.profile||qt.currentPuzzleProfile||"Tutorial - Mind Training",a=lo(t);return a.error?"Error: ".concat(a.error):'Puzzle "'.concat(t,'" started! Solve the sequence!')},namedArgumentList:[c.fromProps({name:"profile",description:"Name of the puzzle profile to use",typeList:[l.STRING],isRequired:!1})],helpString:'Start a puzzle encounter. Example: /puzzle profile="Memory Trial"'})),r.addCommandObject(s.fromProps({name:"negotiate",callback:async e=>{const t=e.profile||qt.currentNegotiationProfile||"Tutorial - Social Training",a=yo(t);return a.error?"Error: ".concat(a.error):'Negotiation "'.concat(t,'" started! Convince them to help!')},namedArgumentList:[c.fromProps({name:"profile",description:"Name of the negotiation profile to use",typeList:[l.STRING],isRequired:!1})],helpString:'Start a negotiation encounter. Example: /negotiate profile="Merchant Haggle"'})),console.log("[MazeMaster] Slash commands registered")}catch(e){console.error("[MazeMaster] ERROR registering slash commands:",e)}}(),console.log("[MazeMaster] Slash commands registered successfully")}catch(e){console.error("[MazeMaster] ERROR registering slash commands:",e)}try{ss(),console.log("[MazeMaster] Macro hooks registered successfully")}catch(e){console.error("[MazeMaster] ERROR registering macro hooks:",e)}}(),function(){if(console.log("[MazeMaster] init() starting, readyState:",document.readyState),function(){const e=SillyTavern.getContext();e.extensionSettings[n]||(e.extensionSettings[n]=JSON.parse(JSON.stringify(qe))),qt=e.extensionSettings[n];const t=qt.factoryDefaultsVersion||0;t<13&&(console.log("[MazeMaster] Factory defaults version changed: ".concat(t," -> ").concat(13)),qt.traps||(qt.traps={}),qt.minions||(qt.minions={}),qt.profiles||(qt.profiles={}),qt.battlebarProfiles||(qt.battlebarProfiles={}),qt.turnbasedProfiles||(qt.turnbasedProfiles={}),qt.qteProfiles||(qt.qteProfiles={}),qt.diceProfiles||(qt.diceProfiles={}),qt.stealthProfiles||(qt.stealthProfiles={}),qt.puzzleProfiles||(qt.puzzleProfiles={}),qt.negotiationProfiles||(qt.negotiationProfiles={}),qt.mazeProfiles||(qt.mazeProfiles={}),qt.minionProfiles||(qt.minionProfiles={}),qt.trapProfiles||(qt.trapProfiles={}),$t(),i());for(const e in qe)void 0===qt[e]&&(qt[e]=JSON.parse(JSON.stringify(qe[e])));qt.profiles||(qt.profiles={}),qt.battlebarProfiles||(qt.battlebarProfiles={}),qt.mazeProfiles||(qt.mazeProfiles={}),qt.minions||(qt.minions={}),qt.traps||(qt.traps={}),qt.savedMazes||(qt.savedMazes={}),qt.minionProfiles||(qt.minionProfiles={}),qt.trapProfiles||(qt.trapProfiles={});let a=!1;for(const[e,t]of Object.entries(Re))qt.profiles[e]||(qt.profiles[e]=JSON.parse(JSON.stringify(t)),a=!0,console.log("[MazeMaster] Added default wheel profile: ".concat(e)));for(const[e,t]of Object.entries(Re)){var o;const n=qt.profiles[e];if((null==n||null===(o=n.segments)||void 0===o?void 0:o.length)>0){const o=n.segments.map((e=>e.trigger));(1===new Set(o).size||o.some((e=>!e||""===e)))&&(qt.profiles[e]=JSON.parse(JSON.stringify(t)),a=!0,console.log("[MazeMaster] Fixed broken wheel profile: ".concat(e)))}}qt.currentProfile||(qt.currentProfile="Blessing Wheel");for(const[e,t]of Object.entries(Ne))qt.battlebarProfiles[e]||(qt.battlebarProfiles[e]=JSON.parse(JSON.stringify(t)),a=!0,console.log("[MazeMaster] Added default battlebar profile: ".concat(e)));qt.currentBattlebarProfile||(qt.currentBattlebarProfile="Tutorial - Learn Combat");const r=Ne["Tutorial - Learn Combat"];for(const[e,t]of Object.entries(qt.battlebarProfiles))for(const[n,o]of Object.entries(r))void 0===t[n]&&(t[n]=JSON.parse(JSON.stringify(o)),a=!0,console.log('[MazeMaster] Added missing field "'.concat(n,'" to battlebar profile: ').concat(e)));qt.turnbasedProfiles||(qt.turnbasedProfiles={},a=!0);for(const[e,t]of Object.entries(He))qt.turnbasedProfiles[e]||(qt.turnbasedProfiles[e]=JSON.parse(JSON.stringify(t)),a=!0,console.log("[MazeMaster] Added default turn-based profile: ".concat(e)));qt.currentTurnbasedProfile||(qt.currentTurnbasedProfile="Tutorial - Learn Turn-Based");const s=He["Tutorial - Learn Turn-Based"];for(const[e,t]of Object.entries(qt.turnbasedProfiles))for(const[n,o]of Object.entries(s))void 0===t[n]&&(t[n]=JSON.parse(JSON.stringify(o)),a=!0,console.log('[MazeMaster] Added missing field "'.concat(n,'" to turn-based profile: ').concat(e)));qt.qteProfiles||(qt.qteProfiles={},a=!0);for(const[e,t]of Object.entries(Oe))qt.qteProfiles[e]||(qt.qteProfiles[e]=JSON.parse(JSON.stringify(t)),a=!0,console.log("[MazeMaster] Added default QTE profile: ".concat(e)));qt.currentQteProfile||(qt.currentQteProfile="Tutorial - First Steps");const l=Oe["Tutorial - First Steps"];for(const[e,t]of Object.entries(qt.qteProfiles))for(const[n,o]of Object.entries(l))void 0===t[n]&&(t[n]=JSON.parse(JSON.stringify(o)),a=!0,console.log('[MazeMaster] Added missing field "'.concat(n,'" to QTE profile: ').concat(e)));qt.diceProfiles||(qt.diceProfiles={},a=!0);for(const[e,t]of Object.entries(Fe))qt.diceProfiles[e]||(qt.diceProfiles[e]=JSON.parse(JSON.stringify(t)),a=!0,console.log("[MazeMaster] Added default Dice profile: ".concat(e)));qt.currentDiceProfile||(qt.currentDiceProfile="Tutorial - Luck Practice");const c=Fe["Tutorial - Luck Practice"];for(const[e,t]of Object.entries(qt.diceProfiles))for(const[n,o]of Object.entries(c))void 0===t[n]&&(t[n]=JSON.parse(JSON.stringify(o)),a=!0,console.log('[MazeMaster] Added missing field "'.concat(n,'" to Dice profile: ').concat(e)));qt.stealthProfiles||(qt.stealthProfiles={},a=!0);for(const[e,t]of Object.entries(We))qt.stealthProfiles[e]||(qt.stealthProfiles[e]=JSON.parse(JSON.stringify(t)),a=!0,console.log("[MazeMaster] Added default Stealth profile: ".concat(e)));qt.currentStealthProfile||(qt.currentStealthProfile="Tutorial - Stealth Basics");const m=We["Tutorial - Stealth Basics"];for(const[e,t]of Object.entries(qt.stealthProfiles))for(const[n,o]of Object.entries(m))void 0===t[n]&&(t[n]=JSON.parse(JSON.stringify(o)),a=!0,console.log('[MazeMaster] Added missing field "'.concat(n,'" to Stealth profile: ').concat(e)));qt.puzzleProfiles||(qt.puzzleProfiles={},a=!0);for(const[e,t]of Object.entries(Ye))qt.puzzleProfiles[e]||(qt.puzzleProfiles[e]=JSON.parse(JSON.stringify(t)),a=!0,console.log("[MazeMaster] Added default Puzzle profile: ".concat(e)));qt.currentPuzzleProfile||(qt.currentPuzzleProfile="Tutorial - Mind Training");const d=Ye["Tutorial - Mind Training"];for(const[e,t]of Object.entries(qt.puzzleProfiles))for(const[n,o]of Object.entries(d))void 0===t[n]&&(t[n]=JSON.parse(JSON.stringify(o)),a=!0,console.log('[MazeMaster] Added missing field "'.concat(n,'" to Puzzle profile: ').concat(e)));qt.negotiationProfiles||(qt.negotiationProfiles={},a=!0);for(const[e,t]of Object.entries(Ue))qt.negotiationProfiles[e]||(qt.negotiationProfiles[e]=JSON.parse(JSON.stringify(t)),a=!0,console.log("[MazeMaster] Added default Negotiation profile: ".concat(e)));qt.currentNegotiationProfile||(qt.currentNegotiationProfile="Tutorial - Social Training");const u=Ue["Tutorial - Social Training"];for(const[e,t]of Object.entries(qt.negotiationProfiles))for(const[n,o]of Object.entries(u))void 0===t[n]&&(t[n]=JSON.parse(JSON.stringify(o)),a=!0,console.log('[MazeMaster] Added missing field "'.concat(n,'" to Negotiation profile: ').concat(e)));qt.merchantItemPools||(qt.merchantItemPools={},a=!0);for(const[e,t]of Object.entries(Dt))qt.merchantItemPools[e]||(qt.merchantItemPools[e]=JSON.parse(JSON.stringify(t)),a=!0,console.log("[MazeMaster] Added default Merchant Item Pool: ".concat(e)));for(const[e,t]of Object.entries(Mt))qt.minions[e]||(qt.minions[e]=JSON.parse(JSON.stringify(t)),a=!0,console.log("[MazeMaster] Added default minion: ".concat(e)));for(const[e,t]of Object.entries(Pt))qt.traps[e]||(qt.traps[e]=JSON.parse(JSON.stringify(t)),a=!0,console.log("[MazeMaster] Added default trap: ".concat(e)));for(const[e,t]of Object.entries(At))qt.minionProfiles[e]||(qt.minionProfiles[e]=JSON.parse(JSON.stringify(t)),a=!0,console.log("[MazeMaster] Added default minion profile: ".concat(e)));for(const[e,t]of Object.entries(Bt))qt.trapProfiles[e]||(qt.trapProfiles[e]=JSON.parse(JSON.stringify(t)),a=!0,console.log("[MazeMaster] Added default trap profile: ".concat(e)));for(const[e,t]of Object.entries(Lt))if(qt.mazeProfiles[e]){const n=qt.mazeProfiles[e];for(const[o,i]of Object.entries(t)){const t=Array.isArray(n[o])&&0===n[o].length,r="object"==typeof n[o]&&null!==n[o]&&!Array.isArray(n[o])&&0===Object.keys(n[o]).length,s="gridSize"===o&&(!n[o]||n[o]<5),l=void 0===n[o]||t||r||s,c="startingInventory"===o&&n[o]&&"object"==typeof n[o]&&0===(n[o].key||0)&&0===(n[o].stealth||0)&&0===(n[o].strike||0)&&0===(n[o].execute||0);(l||c)&&i&&(!Array.isArray(i)||i.length>0)&&(n[o]=JSON.parse(JSON.stringify(i)),a=!0,console.log("[MazeMaster] Added missing/empty field '".concat(o,"' to maze profile: ").concat(e)))}}else qt.mazeProfiles[e]=JSON.parse(JSON.stringify(t)),a=!0,console.log("[MazeMaster] Added default maze profile: ".concat(e));qt.currentMazeProfile||(qt.currentMazeProfile="Tutorial - Learn the Basics"),a&&i(),console.log("[MazeMaster] Loaded settings:",qt)}(),"loading"===document.readyState)console.log("[MazeMaster] Document still loading, adding DOMContentLoaded listener"),document.addEventListener("DOMContentLoaded",(()=>{console.log("[MazeMaster] DOMContentLoaded fired");try{Zr(),console.log("[MazeMaster] initUI complete")}catch(e){console.error("[MazeMaster] ERROR in initUI():",e)}}));else{console.log("[MazeMaster] Document ready, initializing UI immediately");try{Zr(),console.log("[MazeMaster] initUI complete")}catch(e){console.error("[MazeMaster] ERROR in initUI():",e)}}console.log("[".concat(n,"] Extension loaded (folder: ").concat(o,")"))}()})();